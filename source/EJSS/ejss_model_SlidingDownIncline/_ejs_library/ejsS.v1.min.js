function Matrix(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=hasFloat32Array?new Float32Array(e):e}function Vector(e,t,r){"object"==typeof e?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=r||0)}var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.AnalyticCurve={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setNumPoints(e.getNumPoints()),t.setMinimun(e.getMinimun()),t.setMaximun(e.getMaximun()),t.setVariable(e.getVariable()),t.setFunctionX(e.getFunctionX()),t.setFunctionY(e.getFunctionY())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints,e.getNumPoints),t.registerProperty("Minimum",e.setMinimun,e.getMinimun),t.registerProperty("Maximum",e.setMaximun,e.getMaximun),t.registerProperty("Variable",e.setVariable,e.getVariable),t.registerProperty("FunctionX",e.setFunctionX,e.getFunctionX),t.registerProperty("FunctionY",e.setFunctionY,e.getFunctionY),t.registerAction("OnError")}},EJSS_DRAWING2D.analyticCurve=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i="t",o="t",a="0",s={},l=5*screen.width;return n.getClass=function(){return"ElementAnalyticCurve"},n.setParameters=function(e){for(var t in e)s[t]=e[t];n.setChanged(!0)},n.getParameters=function(){return s},n.getBounds=function(e){var u,g,c=n.getX(),S=n.getY(),d=n.getSizeX(),f=n.getSizeY(),E=d/2,p=f/2,h=n.getRelativePositionOffset(d,f),m=EJSS_DRAWING2D.functionsParser(),A=!1;try{u=m.parse(o)}catch(e){console.log("Analytic curve error parsing FunctionX: "+o),A=!0}if(!A)try{g=m.parse(a)}catch(e){console.log("Analytic curve error parsing FunctionY: "+a),A=!0}if(A)return n.getController().invokeAction("OnError"),{left:c+h[0]-E-d,right:c+h[0]-E+d,top:S+h[1]-p+f,bottom:S+h[1]-p-f};var y="undefined"==typeof t||null===t?n.getPanel().getRealWorldXMin():t,v="undefined"==typeof r||null===r?n.getPanel().getRealWorldXMax():r,P=(v-y)/l,D=[],I={};for(var _ in s)I[_]=s[_];try{for(var C=0,R=y;R<v;R+=P){I[i]=R;var T=u.evaluate(I),N=g.evaluate(I);isNaN(T)||isNaN(N)||(D[C]=[],D[C][0]=T,D[C++][1]=N)}}catch(e){return n.getController().invokeAction("OnError"),{left:c+h[0]-E-d,right:c+h[0]-E+d,top:S+h[1]-p+f,bottom:S+h[1]-p-f}}var O=0,M=0,b=0,G=0;if(D.length>0){O=D[0][0],b=D[0][0],M=D[0][1],G=D[0][1];for(var x=0;x<D.length;x++)D[x][0]>O&&(O=D[x][0]),D[x][0]<b&&(b=D[x][0]),D[x][1]>M&&(M=D[x][1]),D[x][1]<G&&(G=D[x][1])}return{left:c+h[0]-E+b*d,right:c+h[0]-E+O*d,top:S+h[1]-p+M*f,bottom:S+h[1]-p+G*f}},n.setNumPoints=function(e){l!=e&&(l=e,n.setChanged(!0))},n.getNumPoints=function(){return l},n.setMinimun=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getMinimun=function(){return t},n.setMaximun=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getMaximun=function(){return r},n.setVariable=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getVariable=function(){return i},n.setFunctionX=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getFunctionX=function(){return o},n.setFunctionY=function(e){a!=e&&(a=e,n.setChanged(!0))},n.getFunctionY=function(){return a},n.registerProperties=function(e){EJSS_DRAWING2D.AnalyticCurve.registerProperties(n,e)},n.setSize([1,1]),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Arrow={NONE:0,ANGLE:1,CIRCLE:2,RECTANGLE:3,LINE:4,CURVE:5,TRIANGLE:6,DIAMOND:7,WEDGE:8,POINTED:9,INVANGLE:10,INVTRIANGLE:11,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setMarkEnd(e.getMarkEnd()),t.setMarkStart(e.getMarkStart())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition),t.registerProperty("MarkEnd",e.setMarkEnd),t.registerProperty("MarkEndWidth",e.setMarkEndWidth),t.registerProperty("MarkEndHeight",e.setMarkEndHeight),t.registerProperty("MarkEndDiameter",e.setMarkEndDiameter),t.registerProperty("MarkEndColor",e.setMarkEndColor),t.registerProperty("MarkEndStroke",e.setMarkEndStroke),t.registerProperty("MarkEndOrient",e.setMarkEndOrient),t.registerProperty("MarkStart",e.setMarkStart),t.registerProperty("MarkStartWidth",e.setMarkStartWidth),t.registerProperty("MarkStartHeight",e.setMarkStartHeight),t.registerProperty("MarkStartDiameter",e.setMarkStartDiameter),t.registerProperty("MarkStartColor",e.setMarkStartColor),t.registerProperty("MarkStartStroke",e.setMarkStartStroke),t.registerProperty("MarkStartOrient",e.setMarkStartOrient),t.registerProperty("MarkMiddle",e.setMarkMiddle),t.registerProperty("MarkMiddleWidth",e.setMarkMiddleWidth),t.registerProperty("MarkMiddleHeight",e.setMarkMiddleHeight),t.registerProperty("MarkMiddleDiameter",e.setMarkMiddleDiameter),t.registerProperty("MarkMiddleColor",e.setMarkMiddleColor),t.registerProperty("MarkMiddleColorSnd",e.setMarkMiddleColorSnd),t.registerProperty("MarkMiddleStroke",e.setMarkMiddleStroke),t.registerProperty("MarkMiddleOrient",e.setMarkMiddleOrient),t.registerProperty("MarkProportion",e.setMarkProportion)}},EJSS_DRAWING2D.arrow=function(e){var t=EJSS_DRAWING2D.element(e),r=.5,n=EJSS_DRAWING2D.Arrow.NONE,i="none",o=12,a=10,s=-1,l="auto",u=EJSS_DRAWING2D.Arrow.ANGLE,g="none",c=12,S=12,d=-1,f="auto",E=EJSS_DRAWING2D.Arrow.NONE,p="none",h="none",m=12,A=10,y=-1,v="auto";return t.getClass=function(){return"ElementArrow"},t.setMarkProportion=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getMarkProportion=function(){return r},t.setMarkStart=function(e){n="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkStart=function(){return n},t.setMarkStartColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setChanged(!0)),t},t.getMarkStartColor=function(){return i},t.setMarkStartStroke=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarkStartStroke=function(){return s},t.setMarkStartWidth=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getMarkStartWidth=function(){return o},t.setMarkStartHeight=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarkStartHeight=function(){return a},t.setMarkStartDiameter=function(e){a==e&&o==e||(a=e,o=e,t.setChanged(!0))},t.getMarkStartOrient=function(){return l},t.setMarkStartOrient=function(e){l!=e&&(l=e,t.setChanged(!0))},t.setMarkEnd=function(e){u="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkEnd=function(){return u},t.setMarkEndColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=g&&(g=e,t.setChanged(!0)),t},t.getMarkEndColor=function(){return g},t.setMarkEndStroke=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getMarkEndStroke=function(){return d},t.setMarkEndWidth=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getMarkEndWidth=function(){return c},t.setMarkEndHeight=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getMarkEndHeight=function(){return S},t.setMarkEndDiameter=function(e){S==e&&c==e||(S=e,c=e,t.setChanged(!0))},t.getMarkEndOrient=function(){return f},t.setMarkEndOrient=function(e){f!=e&&(f=e,t.setChanged(!0))},t.setMarkMiddle=function(e){E="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkMiddle=function(){return E},t.setMarkMiddleColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=p&&(p=e,t.setChanged(!0)),t},t.getMarkMiddleColor=function(){return p},t.setMarkMiddleStroke=function(e){y!=e&&(y=e,t.setChanged(!0))},t.getMarkMiddleStroke=function(){return y},t.setMarkMiddleColorSnd=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=h&&(h=e,t.setChanged(!0)),t},t.getMarkMiddleColorSnd=function(){return h},t.setMarkMiddleWidth=function(e){m!=e&&(m=e,t.setChanged(!0))},t.getMarkMiddleWidth=function(){return m},t.setMarkMiddleHeight=function(e){A!=e&&(A=e,t.setChanged(!0))},t.getMarkMiddleHeight=function(){return A},t.setMarkMiddleDiameter=function(e){A==e&&m==e||(A=e,m=e,t.setChanged(!0))},t.getMarkMiddleOrient=function(){return v},t.setMarkMiddleOrient=function(e){v!=e&&(v=e,t.setChanged(!0))},t.registerProperties=function(e){EJSS_DRAWING2D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Arrow.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.ArrowSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("MarkEnd",function(t){e.setToEach(function(e,t){e.setMarkEnd(t)},t)}),t.registerProperty("MarkEndWidth",function(t){e.setToEach(function(e,t){e.setMarkEndWidth(t)},t)}),t.registerProperty("MarkEndHeight",function(t){e.setToEach(function(e,t){e.setMarkEndHeight(t)},t)}),t.registerProperty("MarkEndDiameter",function(t){e.setToEach(function(e,t){e.setMarkEndDiameter(t)},t)}),t.registerProperty("MarkEndColor",function(t){e.setToEach(function(e,t){e.setMarkEndColor(t)},t)}),t.registerProperty("MarkEndStroke",function(t){e.setToEach(function(e,t){e.setMarkEndStroke(t)},t)}),t.registerProperty("MarkEndRotate",function(t){e.setToEach(function(e,t){e.setMarkEndRotate(t)},t)}),t.registerProperty("MarkEndOrient",function(t){e.setToEach(function(e,t){e.setMarkEndOrient(t)},t)}),t.registerProperty("MarkStart",function(t){e.setToEach(function(e,t){e.setMarkStart(t)},t)}),t.registerProperty("MarkStartWidth",function(t){e.setToEach(function(e,t){e.setMarkStartWidth(t)},t)}),t.registerProperty("MarkStartHeight",function(t){e.setToEach(function(e,t){e.setMarkStartHeight(t)},t)}),t.registerProperty("MarkStartDiameter",function(t){e.setToEach(function(e,t){e.setMarkStartDiameter(t)},t)}),t.registerProperty("MarkStartColor",function(t){e.setToEach(function(e,t){e.setMarkStartColor(t)},t)}),t.registerProperty("MarkStartStroke",function(t){e.setToEach(function(e,t){e.setMarkStartStroke(t)},t)}),t.registerProperty("MarkStartRotate",function(t){e.setToEach(function(e,t){e.setMarkStartRotate(t)},t)}),t.registerProperty("MarkStartOrient",function(t){e.setToEach(function(e,t){e.setMarkStartOrient(t)},t)}),t.registerProperty("MarkMiddle",function(t){e.setToEach(function(e,t){e.setMarkMiddle(t)},t)}),t.registerProperty("MarkMiddleWidth",function(t){e.setToEach(function(e,t){e.setMarkMiddleWidth(t)},t)}),t.registerProperty("MarkMiddleHeight",function(t){e.setToEach(function(e,t){e.setMarkMiddleHeight(t)},t)}),t.registerProperty("MarkMiddleDiameter",function(t){e.setToEach(function(e,t){e.setMarkMiddleDiameter(t)},t)}),t.registerProperty("MarkMiddleColor",function(t){e.setToEach(function(e,t){e.setMarkMiddleColor(t)},t)}),t.registerProperty("MarkMiddleColorSnd",function(t){e.setToEach(function(e,t){e.setMarkMiddleColorSnd(t)},t)}),t.registerProperty("MarkMiddleStroke",function(t){e.setToEach(function(e,t){e.setMarkMiddleStroke(t)},t)}),t.registerProperty("MarkMiddleRotate",function(t){e.setToEach(function(e,t){e.setMarkMiddleRotate(t)},t)}),t.registerProperty("MarkProportion",function(t){e.setToEach(function(e,t){e.setMarkProportion(t)},t)}),t.registerProperty("MarkMiddleOrient",function(t){e.setToEach(function(e,t){e.setMarkMiddleOrient(t)},t)})}},EJSS_DRAWING2D.arrowSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.arrow,e),r=EJSS_DRAWING2D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Axis={AXIS_VERTICAL:0,AXIS_HORIZONTAL:1,TICKS_UP:2,TICKS_DOWN:3,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("TickStep",e.setTickStep,e.getTickStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("AutoTicks",e.setAutoTicks,e.getAutoTicks),t.registerProperty("FixedTick",e.setFixedTick,e.getFixedTick),t.registerProperty("Orient",e.setOrient,e.getOrient),t.registerProperty("Scale",e.setScale,e.getScale),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode),t.registerProperty("TicksSize",e.setTicksSize,e.getTicksSize),t.registerProperty("AutoStepMin",e.setAutoStepMin,e.getAutoStepMin),t.registerProperty("AutoTicksRange",e.setAutoTicksRange,e.getAutoTicksRange),t.registerProperty("TextPosition",e.setTextPosition,e.getTextPosition),t.registerProperty("ScalePrecision",e.setScalePrecision,e.getScalePrecision),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("FontOutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FontFillColor",e.getFont().setFillColor),t.registerProperty("Show",e.setShow,e.getShow)}},EJSS_DRAWING2D.axis=function(e){var t=EJSS_DRAWING2D.segment(e),r=!0,n=0,i=20,o=0,a=Number.NaN,s=EJSS_DRAWING2D.Axis.AXIS_VERTICAL,l=[-1,1],u=!1,g=EJSS_DRAWING2D.Axis.SCALE_NUM,c=EJSS_DRAWING2D.Axis.TICKS_UP,S=10,d=1,f=EJSS_DRAWING2D.font(e),E=40,p=[5,10,20],h=!0;return t.getClass=function(){return"ElementAxis"},t.setShow=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getShow=function(){return h},t.getFont=function(){return f},t.setAutoTicksRange=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getAutoTicksRange=function(){return p},t.setAutoStepMin=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getAutoStepMin=function(){return E},t.setFixedTick=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getFixedTick=function(){return a},t.setAutoTicks=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicks=function(){return r},t.setStep=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getStep=function(){return i},t.setTickStep=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTickStep=function(){return o},t.setTicks=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getTicks=function(){return n},t.setTicksMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),g!=e&&(g=e,t.setChanged(!0))},t.getTicksMode=function(){return g},t.setTextPosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),c!=e&&(c=e,t.setChanged(!0))},t.getTextPosition=function(){return c},t.setOrient=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),s!=e&&(s=e,t.setChanged(!0))},t.getOrient=function(){return s},t.setScale=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getScale=function(){return l},t.setScalePrecision=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getScalePrecision=function(){return d},t.setTicksSize=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getTicksSize=function(){return S},t.setInvertedScaleY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getInvertedScaleY=function(){return u},t.registerProperties=function(e){EJSS_DRAWING2D.Axis.registerProperties(t,e)},f.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ByteRaster={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate),t.registerProperty("RGBData",e.setRGBData)}},EJSS_DRAWING2D.byteRaster=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=[],i=!1,o=!0,a=!1;return t.getClass=function(){return"ElementByteRaster"},t.setData=function(e){(o||n!=e)&&(n=e,i=!0,t.setChanged(!0))},t.getData=function(){return n},t.setRGBData=function(e){a=e,o&&(i=!0)},t.isRGBData=function(){return a},t.setAutoupdate=function(e){o=e,o&&(i=!0)},t.setColorMapper=function(e){r!=e&&(r=e,i=!0,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setIndexedColor=function(e){var n=e.color,i=void 0===n[3]?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgb("+n[0]+","+n[1]+","+n[2]+","+n[3]+")";console.log(t.getName()+": setIndexedColor("+e.index+","+i+")");var o=r.getColors();o[e.index]=i},t.getDataChanged=function(){return i},t.setDataChanged=function(e){i=e},t.invalidate=function(){i=!0},t.registerProperties=function(e){EJSS_DRAWING2D.ByteRaster.registerProperties(t,e)},r.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.CellLattice={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("ShowGrid",e.setShowGrid,e.getShowGrid),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType)}},EJSS_DRAWING2D.cellLattice=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=!0,i=[];return t.getClass=function(){return"ElementCellLattice"},t.setData=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getData=function(){return i},t.setColorMapper=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setShowGrid=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getShowGrid=function(){return n},t.setStepY=function(e){mStepY!=e&&(mStepY=e,t.setChanged(!0))},t.getStepY=function(){return mStepY},t.setTicksX=function(e){mTicksX!=e&&(mTicksX=e,t.setChanged(!0))},t.getTicksX=function(){return mTicksX},t.setTicksY=function(e){mTicksY!=e&&(mTicksY=e,t.setChanged(!0))},t.getTicksY=function(){return mTicksY},t.setTicksXMode=function(e){var r=EJSS_DRAWING2D.CellLattice.TICKS_NUM;"string"==typeof e&&(r=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksXMode!=r&&(mTicksXMode=r,t.setChanged(!0))},t.getTicksXMode=function(){return mTicksXMode},t.setTicksYMode=function(e){var r=EJSS_DRAWING2D.CellLattice.TICKS_NUM;"string"==typeof e&&(r=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksYMode!=r&&(mTicksYMode=r,t.setChanged(!0))},t.getTicksYMode=function(){return mTicksYMode},t.registerProperties=function(e){EJSS_DRAWING2D.CellLattice.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Cursor={HORIZONTAL:0,VERTICAL:1,CROSSHAIR:2,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("CursorType",e.setCursorType,e.getCursorType)}},EJSS_DRAWING2D.cursor=function(e){var t,r=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Cursor;return r.getClass=function(){return"ElementCursor"},r.setCursorType=function(e){var i=EJSS_DRAWING2D.InteractionTarget,o=r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION);switch(t="string"==typeof e?EJSS_DRAWING2D.Cursor[e.toUpperCase()]:e){default:o.setSensitivityType(i.SENSITIVITY_ANY);break;case n.HORIZONTAL:o.setSensitivityType(i.SENSITIVITY_HORIZONTAL);break;case n.VERTICAL:o.setSensitivityType(i.SENSITIVITY_VERTICAL)}},r.getCursorType=function(){return t},r.isChanged=function(){return!0},r.registerProperties=function(e){n.registerProperties(r,e)},r.setMeasured(!1),t=n.CROSSHAIR,r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivityType(EJSS_DRAWING2D.InteractionTarget.SENSITIVITY_ANY),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Custom={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t)}},EJSS_DRAWING2D.custom=function(e){var t,r=EJSS_DRAWING2D.element(e);return r.getClass=function(){return"ElementCustom"},r.registerProperties=function(e){EJSS_DRAWING2D.Custom.registerProperties(r,e)},r.setFunction=function(e){t=e},r.getFunction=function(){return t},r.setSize([1,1]),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.DrawingPanel={MOUSE_ENTERED:0,MOUSE_EXITED:1,MOUSE_PRESSED:2,MOUSE_DRAGGED:3,MOUSE_RELEASED:4,GRAPHICS2D_SVG:0,GRAPHICS2D_CANVAS:1,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){e.setController(t),t.registerProperty("AutoScale",e.setAutoScale,e.getAutoScale),t.registerProperty("AutoScaleX",e.setAutoScaleX,e.getAutoScaleX),t.registerProperty("AutoScaleY",e.setAutoScaleY,e.getAutoScaleY),t.registerProperty("InvertedScaleY",e.setInvertedScaleY,e.getInvertedScaleY),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("ScaleXType",function(t){e.setTypeScaleX(t),e.scale()},e.getTypeScaleX),t.registerProperty("ScaleYType",function(t){e.setTypeScaleY(t),e.scale()},e.getTypeScaleY),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",function(t){e.getGraphics().setWidth(t)&&e.scale()},e.getGraphics().getBox().width),t.registerProperty("Height",function(t){e.getGraphics().setHeight(t)&&e.scale()},e.getGraphics().getBox().height),t.registerProperty("SquareAspect",e.setSquareAspect),t.registerProperty("GraphicsMode",e.setGraphicsMode),t.registerProperty("Enabled",e.getPanelInteraction().setEnabled),t.registerProperty("StopMoveEvents",e.getPanelInteraction().setStopMoveEvents),t.registerProperty("StopGestures",e.getPanelInteraction().setStopGestures),t.registerProperty("Gutters",e.setGutters),t.registerProperty("GuttersLineColor",e.getGuttersStyle().setLineColor),t.registerProperty("GuttersLineWidth",e.getGuttersStyle().setLineWidth),t.registerProperty("GuttersDrawLines",e.getGuttersStyle().setDrawLines),t.registerProperty("GuttersColor",e.getGuttersStyle().setFillColor),t.registerProperty("GuttersFill",e.getGuttersStyle().setDrawFill),t.registerProperty("GuttersRendering",e.getStyle().setShapeRendering),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerProperty("TRMessage",e.getMessageDecoration("TR").setText),t.registerProperty("TLMessage",e.getMessageDecoration("TL").setText),t.registerProperty("BRMessage",e.getMessageDecoration("BR").setText),t.registerProperty("BLMessage",e.getMessageDecoration("BL").setText),t.registerProperty("CoordinatesFormat",e.getCoordinates().setFormat),t.registerProperty("ShowCoordinates",e.setShowCoordinates),t.registerProperty("ShowAreaRectangle",e.setShowAreaRectangle),t.registerProperty("CursorTypeForMove",e.getInteraction().setCursorTypeForMove),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint,e.getOnMoveHandler),t.registerAction("OnPress",e.getInteraction().getInteractionPoint,e.getOnPressHandler),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds,e.getOnReleaseHandler),t.registerAction("OnResize",e.getInteraction().getInteractionBounds,e.scale),t.registerAction("OnOrientationChange",e.getInteraction().getOrientation,e.scale)}},EJSS_DRAWING2D.drawingPanel=function(e,t){var r,n={},i=EJSS_DRAWING2D.style(e),o=[],a=[],s=!1,l=!1,u=!1,g=!1,c=0,S=0,d=[],f=!0,E=!0,p=[],h=-1,m=1,A=-1,y=1,v={xminPreferred:NaN,xmaxPreferred:NaN,yminPreferred:NaN,ymaxPreferred:NaN,xminMeasured:NaN,xmaxMeasured:NaN,yminMeasured:NaN,ymaxMeasured:NaN,xmargin:0,ymargin:0,xmin:-1,xmax:1,ymin:-1,ymax:1,squareAspect:!1,xorigin:0,yorigin:0,xscale:1,yscale:1},P={left:0,right:0,top:0,bottom:0,visible:!1},D=EJSS_DRAWING2D.style(e+" gutters"),I=!0,_=!0,C={propertiesChanged:function(){},invokeAction:function(){}};n.getName=function(){return e},n.getGraphics=function(){return r},n.importGraphics=function(e){return r.importSVG?r.importSVG(e):null},n.getStyle=function(){return i},n.getGraphicsMode=function(){return t},n.getGraphicsModeName=function(){switch(t){case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS:return"CANVAS";default:case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG:return"SVG"}},n.setGraphicsMode=function(n){if("string"==typeof n?(0!=n.indexOf("GRAPHICS2D_")&&(n="GRAPHICS2D_"+n),n=EJSS_DRAWING2D.DrawingPanel[n.toUpperCase()]|EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG):"undefined"==typeof n&&(n=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG),n!=t){t=n;var i="undefined"!=typeof r;if(i){var o=r.getParent(),a=r.getWidth(),l=r.getHeight(),u=r.getEventContext().getAttribute("style"),g=document.getElementById(e);g.parentNode.removeChild(g)}n==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):n==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS?r=EJSS_GRAPHICS.canvasGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported"),i&&(r.setParent(o),r.setWidth(a),r.setHeight(l),r.getEventContext().setAttribute("style",u),s=!0,G.reload())}},n.getAutoScale=function(){return l||u},n.setAutoScale=function(e){n.setAutoScaleX(e),n.setAutoScaleY(e)},n.setAutoScaleX=function(e){l=e},n.getAutoScaleX=function(){return l},n.setAutoScaleY=function(e){u=e},n.getAutoScaleY=function(){return u},n.setInvertedScaleY=function(e){if(g!=e){g=e,g&&(S=EJSS_DRAWING2D.DrawingPanel.SCALE_NUM);var t=n.reportDecorations("bounds");t&&(I=!0)}},n.getInvertedScaleY=function(){return g},n.setTypeScaleX=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),c=e},n.getTypeScaleX=function(){return c},n.setTypeScaleY=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),S=e,S==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG&&(g=!1)},n.getTypeScaleY=function(){return S},n.setWorldXMin=function(e){e!==v.xminPreferred&&(v.xminPreferred=e)},n.getWorldXMin=function(){return v.xminPreferred},n.setWorldXMax=function(e){e!==v.xmaxPreferred&&(v.xmaxPreferred=e)},n.getWorldXMax=function(){return v.xmaxPreferred},n.setWorldYMin=function(e){e!==v.yminPreferred&&(v.yminPreferred=e)},n.getWorldYMin=function(){return v.yminPreferred},n.setWorldYMax=function(e){e!==v.ymaxPreferred&&(v.ymaxPreferred=e)},n.getWorldYMax=function(){return v.ymaxPreferred},n.setWorldCoordinates=function(e){n.setWorldXMin(e[0]),n.setWorldXMax(e[1]),n.setWorldYMin(e[2]),n.setWorldYMax(e[3])},n.getWorldCoordinates=function(){return[n.getWorldXMin(),n.getWorldXMax(),n.getWorldYMin(),n.getWorldYMax()]},n.getRealWorldCoordinates=function(){return[v.xmin,v.xmax,v.ymin,v.ymax]},n.getRealWorldXMin=function(){return v.xmin},n.getRealWorldXMax=function(){return v.xmax},n.getRealWorldYMin=function(){return v.ymin},n.getRealWorldYMax=function(){return v.ymax},n.setSquareAspect=function(e){e!==v.squareAspect&&(v.squareAspect=e,_=!0)},n.setMarginX=function(e){v.xmargin!=e&&(v.xmargin=e,_=!0)},n.getMarginX=function(){return v.xmargin},n.setMarginY=function(e){v.ymargin!=e&&(v.ymargin=e,_=!0)},n.getMarginY=function(){return v.ymargin},n.setShowCoordinates=function(e){f=e},n.setShowAreaRectangle=function(e){E=e},n.addDecoration=function(e,t,r){return r?EJSS_TOOLS.addToArray(d,e,t):EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(n),n},n.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),EJSS_TOOLS.removeFromArray(d,e),e.setPanel&&e.setPanel(null),n},n.addElement=function(e,t){if("undefined"==typeof t)EJSS_TOOLS.addToArray(a,e);else if("object"==typeof t){var r=EJSS_TOOLS.arrayObjectIndexOf(a,t);EJSS_TOOLS.addToArray(a,e,r)}else EJSS_TOOLS.addToArray(a,e,t);e.setPanel(n),e.dataCollected&&p.push(e),s=!0},n.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(p,e),s=!0},n.getElements=function(){return a},n.indexOfElement=function(e){return a.indexOf(e)},n.setGutters=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=!1;t!==P.left&&(P.left=t,o=!0),r!==P.top&&(P.top=r,o=!0),n!==P.right&&(P.right=n,o=!0),i!==P.bottom&&(P.bottom=i,o=!0),o&&(P.visible=P.left>0||P.top>0||P.right>0||P.bottom>0,I=!0,_=!0)},n.getGutters=function(){return P},n.getGuttersStyle=function(){return D},n.toPixelAxisY=function(e){return v.yorigin-e-v.yscale*v.ymin},n.toPixelAxisX=function(e){return v.xorigin+e-v.xscale*v.xmin},n.toPixelPosition=function(e,t){var r="undefined"!=typeof t?t:c,i="undefined"!=typeof t?t:S,o=[];return r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[0]=n.toPixelLogScale(e[0],v.xorigin,v.xmin,v.xmax,v.xscale):o[0]=v.xorigin+v.xscale*(e[0]-v.xmin),i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[1]=n.toPixelLogScale(e[1],v.yorigin,v.ymin,v.ymax,v.yscale):g?o[1]=P.top+v.yscale*(v.ymin-e[1]):o[1]=v.yorigin+v.yscale*(e[1]-v.ymin),o},n.toPixelMod=function(e){var t=[];return t[0]=e[0]*v.xscale,t[1]=e[1]*v.yscale,t},n.toPanelPosition=function(e,t){var r="undefined"!=typeof t?t:c,i="undefined"!=typeof t?t:S,o=[];return r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[0]=n.toPanelLogScale(e[0],v.xorigin,v.xmin,v.xmax,v.xscale):o[0]=v.xmin+(e[0]-v.xorigin)/v.xscale,i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?o[1]=n.toPanelLogScale(e[1],v.yorigin,v.ymin,v.ymax,v.yscale):g?o[1]=v.ymin-(e[1]-P.top)/v.yscale:o[1]=v.ymin+(e[1]-v.yorigin)/v.yscale,o},n.toPanelMod=function(e){var t=[];return t[0]=0==v.xscale?0:e[0]/v.xscale,t[1]=0==v.yscale?0:e[1]/v.yscale,t},n.toPixelLogScale=function(e,t,r,n,i){var o=r<=0?1:Math.log(r)/Math.log(10),a=n<=0?1:Math.log(n)/Math.log(10),s=(n-r)*i,l=a-o,u=s/l,g=e<=0?0:Math.log(e)/Math.log(10);return t+u*(g-o)},n.toPanelLogScale=function(e,t,r,n,i){var o=r<0?0:Math.log(r)/Math.log(10),a=n<0?0:Math.log(n)/Math.log(10),s=(n-r)*i,l=a-o,u=s/l;return Math.pow(10,o+(e-t)/u)},n.getPixelPositionWorldOrigin=function(){return[v.xorigin,v.yorigin]},n.getInnerRect=function(){var e=n.getRealWorldCoordinates();if(n.getInvertedScaleY())var t=n.toPixelPosition([e[0],e[2]]);else var t=n.toPixelPosition([e[0],e[3]]);var r=n.toPixelMod([e[1]-e[0],e[3]-e[2]]);return{x:t[0],width:Math.abs(r[0]),y:t[1],height:Math.abs(r[1])}},n.scale=function(){_=!0,s=!0},n.touch=function(){_=!0,s=!0;for(var e=0,t=a.length;e<t;e++)a[e].setChanged(!0)},n.recomputeScales=function(){var e,t,i=!1,o=(v.xmaxMeasured-v.xminMeasured)/2,s=(v.ymaxMeasured-v.yminMeasured)/2,l=v.xminMeasured-Math.abs(o*v.xmargin/100),u=v.xmaxMeasured+Math.abs(o*v.xmargin/100),g=v.yminMeasured-Math.abs(s*v.ymargin/100),c=v.ymaxMeasured+Math.abs(s*v.ymargin/100),S=r.getBox(),d=S.width-(P.left+P.right),f=S.height-(P.bottom+P.top),E=d/(u-l),p=f/(c-g);if(v.squareAspect&&(e=Math.abs(E/p),e>=1?(e=Math.min(e,d),t=(u-l)*(e-1)/2,l-=t,u+=t,E=d/(u-l)):(e=Math.max(e,1/f),t=(c-g)*(1/e-1)/2,g-=t,c+=t,p=f/(c-g))),i=v.xscale!=E||v.yscale!=-p,v.xscale=E,v.yscale=-p,v.xorigin=P.left+.5,v.yorigin=f+P.top+.5,_=!1,v.xmin!==l||v.xmax!==u||v.ymin!==g||v.ymax!==c){v.xmin=l,v.xmax=u,v.ymin=g,v.ymax=c;var h=n.reportDecorations("bounds");h&&(I=!0),i=!0}if(i)for(var m=0,A=a.length;m<A;m++)a[m].setMustProject(!0)},n.reportDecorations=function(e){var t,r,n=!1;for(t=0,r=o.length;t<r;t++)n|=o[t].panelChangeListener&&o[t].panelChangeListener("bounds");for(t=0,r=d.length;t<r;t++)d[t].panelChangeListener&&d[t].panelChangeListener("bounds");return n},n.checkMeasure=function(){var e=Number.MAX_VALUE,t=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;if(n.getAutoScaleY()||n.getAutoScaleX())for(var o=0,s=a.length;o<s;o++)if(a[o].isMeasured()&&!a[o].isGroup()&&(null==a[o].getGroup()||a[o].getGroup().isMeasured()))if(a[o].isPixelSize()){var l=a[o].getPosition();e=Math.min(e,l[0]),t=Math.max(t,l[0]),r=Math.min(r,l[1]),i=Math.max(i,l[1])}else{var u=a[o].getAbsoluteBounds();e=Math.min(e,u.left),
t=Math.max(t,u.right),r=Math.min(r,u.bottom),i=Math.max(i,u.top)}var g=!1;n.getAutoScaleX()?(isNaN(v.xminPreferred)||(e=Math.min(e,v.xminPreferred)),isNaN(v.xmaxPreferred)||(t=Math.max(t,v.xmaxPreferred)),t<=e?(g=v.xminMeasured!=h||v.xmaxMeasured!=m,v.xminMeasured=h,v.xmaxMeasured=m):(g=v.xminMeasured!=e||v.xmaxMeasured!=t,v.xminMeasured=e,v.xmaxMeasured=t)):isNaN(v.xminPreferred)||isNaN(v.xmaxPreferred)?(g=v.xminMeasured!=h||v.xmaxMeasured!=m,v.xminMeasured=h,v.xmaxMeasured=m):(g=v.xminMeasured!=v.xminPreferred||v.xmaxMeasured!=v.xmaxPreferred,v.xminMeasured=v.xminPreferred,v.xmaxMeasured=v.xmaxPreferred);var c=!1;return n.getAutoScaleY()?(isNaN(v.yminPreferred)||(r=Math.min(r,v.yminPreferred)),isNaN(v.ymaxPreferred)||(i=Math.max(i,v.ymaxPreferred)),i<=r?(c=v.yminMeasured!=A||v.ymaxMeasured!=y,v.yminMeasured=A,v.ymaxMeasured=y):(c=v.yminMeasured!=r||v.ymaxMeasured!=i,v.yminMeasured=r,v.ymaxMeasured=i)):isNaN(v.yminPreferred)||isNaN(v.ymaxPreferred)?(c=v.yminMeasured!=A||v.ymaxMeasured!=y,v.yminMeasured=A,v.ymaxMeasured=y):(c=v.yminMeasured!=v.yminPreferred||v.ymaxMeasured!=v.ymaxPreferred,v.yminMeasured=v.yminPreferred,v.ymaxMeasured=v.ymaxPreferred),g||c},n.reset=function(){r.reset()},n.render=function(){var e=!1;(r.setImageData||s)&&(r.reset(),e=!0,s=!1);for(var t=0,i=p.length;t<i;t++)p[t].dataCollected();var l=n.checkMeasure();(_||l)&&n.recomputeScales(),(I||e)&&(r.drawPanel(n),r.draw(o)),r.draw(a,e),(I||e)&&r.drawGutters(n),r.draw(d),I=!1;for(var t=0,i=a.length;t<i;t++)a[t].setChanged(!1)},n.getPanelInteraction=function(){return G},n.getController=function(){return C},n.setController=function(e){C=e},n.getOnMoveHandler=null,n.getOnPressHandler=function(){if(f){var e=G.getInteractionPoint(),t=n.getRealWorldCoordinates();t[0]<e[0]&&t[1]>e[0]&&t[3]>e[1]&&t[2]<e[1]&&(b.setText(e),b.setVisible(!0),b.getController().propertiesChanged("Visible","Text"))}},n.getOnDragHandler=function(){if(f){var e=G.getInteractionPoint(),t=n.getRealWorldCoordinates();t[0]<e[0]&&t[1]>e[0]&&t[3]>e[1]&&t[2]<e[1]&&(b.setText(e),b.setVisible(!0),b.getController().propertiesChanged("Visible","Text"))}if(E){var r=G.getInteractionBounds();r.length>0&&c==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM&&S==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM?(R.setBounds(r),R.setVisible(!0),R.getController().propertiesChanged("Position","X","Y","Size","SizeX","SizeY","Visible")):(R.setVisible(!1),R.getController().propertiesChanged("Visible"))}},n.getOnReleaseHandler=function(){f&&(b.setVisible(!1),b.getController().propertiesChanged("Visible")),E&&(R.setVisible(!1),R.getController().propertiesChanged("Visible"))},n.getMessageDecoration=function(e){switch(e){case"TL":return T;case"BR":return O;case"BL":return N}return M},n.getCoordinates=function(){return b},n.getInteraction=function(){return G},n.registerProperties=function(e){EJSS_DRAWING2D.DrawingPanel.registerProperties(n,e)},n.serialize=function(){return{mStyle:i.serialize(),mTopDecorations:d,mBottomDecorations:o,mElements:a,mCollectersList:p,mAutoScaleX:l,mAutoScaleY:u,mInvertedScaleY:g,mTypeScaleX:c,mTypeScaleY:S,mShowCoordinates:f,xmindef:h,xmaxdef:m,ymindef:A,ymaxdef:y,mWorld:v,mGutters:P,mGuttersStyle:D.serialize()}},n.unserialize=function(e){i.unserialize(e.mStyle),l=e.mAutoScaleX,u=e.mAutoScaleY,g=e.mInvertedScaleY,c=e.mTypeScaleX,S=e.mTypeScaleY,f=e.mShowCoordinates,h=e.xmindef,m=e.xmaxdef,A=e.ymindef,y=e.ymaxdef,v=e.mWorld,P=e.mGutters,D.unserialize(e.mGuttersStyle),I=!0},n.setGraphicsMode(t),i.setLineColor("black"),i.setFillColor("rgb(239,239,255)"),i.setChangeListener(function(e){I=!0}),D.setChangeListener(function(e){I=!0});var R=EJSS_DRAWING2D.shape(e+"__cursorBox__");R.setShapeType(EJSS_DRAWING2D.Shape.RECTANGLE),R.getStyle().setDrawFill(!1),R.getStyle().setLineColor("black"),R.setRelativePosition("CENTER"),R.setVisible(!1),n.addDecoration(R,0,!0);var T=EJSS_DRAWING2D.text(e+"__tlmessage__");T.setRelativePosition("NORTH_WEST"),T.getStyle().setDrawLines(!0),T.getStyle().setDrawFill(!0),T.getStyle().setFillColor("yellow"),T.getStyle().setLineColor("black"),T.getFont().setFontSize(12),T.setPosition([v.xmin,v.ymax]),T.setFramed(!0),T.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?T.setPosition([v.xmin,v.ymin]):T.setPosition([v.xmin,v.ymax]))},n.addDecoration(T,0,!0);var N=EJSS_DRAWING2D.text(e+"__blmessage__");N.setRelativePosition("SOUTH_WEST"),N.getStyle().setDrawLines(!0),N.getStyle().setDrawFill(!0),N.getStyle().setFillColor("yellow"),N.getStyle().setLineColor("black"),N.getFont().setFontSize(12),N.setPosition([v.xmin,v.ymin]),N.setFramed(!0),N.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?N.setPosition([v.xmin,v.ymax]):N.setPosition([v.xmin,v.ymin]))},n.addDecoration(N,0,!0);var O=EJSS_DRAWING2D.text(e+"__brmessage__");O.setRelativePosition("SOUTH_EAST"),O.getStyle().setDrawLines(!0),O.getStyle().setDrawFill(!0),O.getStyle().setFillColor("yellow"),O.getStyle().setLineColor("black"),O.getFont().setFontSize(12),O.setPosition([v.xmax,v.ymin]),O.setFramed(!0),O.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?O.setPosition([v.xmax,v.ymax]):O.setPosition([v.xmax,v.ymin]))},n.addDecoration(O,0,!0);var M=EJSS_DRAWING2D.text(e+"__trmessage__");M.setRelativePosition("NORTH_EAST"),M.getStyle().setDrawLines(!0),M.getStyle().setDrawFill(!0),M.getStyle().setFillColor("yellow"),M.getStyle().setLineColor("black"),M.getFont().setFontSize(12),M.setPosition([v.xmax,v.ymax]),M.setFramed(!0),M.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?M.setPosition([v.xmax,v.ymin]):M.setPosition([v.xmax,v.ymax]))},n.addDecoration(M,0,!0);var b=EJSS_DRAWING2D.infoText(e+"__coor__");b.setRelativePosition("SOUTH_WEST"),b.getFont().setFontSize(12),b.getStyle().setFillColor("yellow"),b.setPosition([v.xmin,v.ymin]),b.setFormat("x:0.##,y:0.##"),b.setFramed(!0),b.setVisible(!1),b.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?b.setPosition([v.xmin,v.ymax]):b.setPosition([v.xmin,v.ymin]))},n.addDecoration(b,0,!0),n.getGuttersStyle().setLineColor("black"),n.getGuttersStyle().setFillColor("rgb(239,239,255)"),n.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES");var G=EJSS_DRAWING2D.panelInteraction(n);return r.getEventContext().addEventListener("dblclick",function(e){return e.preventDefault(),e.stopPropagation(),!1},!0),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Element={CENTER:0,NORTH:1,SOUTH:2,EAST:3,WEST:4,NORTH_EAST:5,NORTH_WEST:6,SOUTH_EAST:7,SOUTH_WEST:8,registerProperties:function(e,t){var r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE,i=e.getStyle();e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("PixelPosition",e.setPixelPosition,e.getPixelPosition),t.registerProperty("Diameter",function(t){e.setSize([t,t])}),t.registerProperty("Radius",function(t){e.setSize([2*t,2*t])}),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("PixelSize",e.setPixelSize,e.getPixelSize),t.registerProperty("Bounds",e.setBounds,e.getBounds),t.registerProperty("RelativePosition",e.setRelativePosition,e.getRelativePosition),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("LineColor",i.setLineColor,i.getLineColor),t.registerProperty("LineWidth",i.setLineWidth,i.getLineWidth),t.registerProperty("DrawLines",i.setDrawLines,i.getDrawLines),t.registerProperty("FillColor",i.setFillColor,i.getFillColor),t.registerProperty("DrawFill",i.setDrawFill,i.getDrawFill),t.registerProperty("ShapeRendering",i.setShapeRendering,i.getShapeRendering),t.registerProperty("Attributes",i.setAttributes,i.getAttributes),t.registerProperty("EnabledPosition",function(t){e.getInteractionTarget(r).setMotionEnabled(t)}),t.registerProperty("MovesGroup",function(t){e.getInteractionTarget(r).setAffectsGroup(t)}),t.registerProperty("EnabledSize",function(t){e.getInteractionTarget(n).setMotionEnabled(t)}),t.registerProperty("ResizesGroup",function(t){e.getInteractionTarget(n).setAffectsGroup(t)}),t.registerProperty("Sensitivity",function(t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition)},copyTo:function(e,t){var r=EJSS_DRAWING2D.InteractionTarget,n=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,i=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;EJSS_DRAWING2D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setPixelPosition(e.isPixelPosition()),t.setSize(e.getSize()),t.setPixelSize(e.isPixelSize()),t.setTransformation(e.getTransformation()),t.setRelativePosition(e.getRelativePosition()),r.copyTo(e.getInteractionTarget(n),t.getInteractionTarget(n)),r.copyTo(e.getInteractionTarget(i),t.getInteractionTarget(i)),t.setParent(e.getParent(),e)},getRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=0,o=0;break;case EJSS_DRAWING2D.Element.NORTH:i=0,o=-(r/2);break;case EJSS_DRAWING2D.Element.SOUTH:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.EAST:i=-(t/2),o=0;break;case EJSS_DRAWING2D.Element.WEST:i=t/2,o=0;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-(t/2),o=-(r/2);break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=t/2,o=-(r/2);break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-(t/2),o=r/2;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=t/2,o=r/2}return"undefined"!=typeof n&&n&&(o=-o),[i,o]},getSWRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=-(t/2),o=r/2;break;case EJSS_DRAWING2D.Element.NORTH:i=-(t/2),o=r;break;case EJSS_DRAWING2D.Element.SOUTH:i=-(t/2),o=0;break;case EJSS_DRAWING2D.Element.EAST:i=-t,o=r/2;break;case EJSS_DRAWING2D.Element.WEST:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-t,o=r;break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=0,o=r;break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-t,o=0;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=0,o=0}return"undefined"!=typeof n&&n&&(o=-o),[i,o]}},EJSS_DRAWING2D.element=function(e){var t={},r=EJSS_DRAWING2D.Element,n=EJSS_DRAWING2D.PanelInteraction,i=EJSS_DRAWING2D.style(e),o=!0,a=!0,s=r.CENTER,l=0,u=0,g=!1,c=1,S=1,d=!1,f=0,E={positionTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_POSITION,r.CENTER),sizeTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_SIZE,r.NORTH_EAST)},p=null,h=null,m=null,A=-1,y=[],v=[],P=!0,D=!0,I={propertiesChanged:function(){},invokeAction:function(){}};return t.getName=function(){return e},t.setParent=function(e,r){e.render?(t.setGroup(null),e.addElement(t),t.setPanel(e)):"ElementGroup"==e.getClass()?(t.setGroup(e),t.getGroupPanel().addElement(t,r),t.setPanel(t.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},t.getParent=function(){var e;return e=null!==h?t.getGroup():t.getPanel()},t.isGroup=function(){return!1},t.getStyle=function(){return i},t.setX=function(e,t){l!=e&&(l=e,D=!0)},t.getX=function(){return l},t.setY=function(e){u!=e&&(u=e,D=!0)},t.getY=function(){return u},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1])},t.getPosition=function(){return[l,u]},t.setPixelPosition=function(e){g!=e&&(g=e,D=!0)},t.isPixelPosition=function(){return g},t.setSizeX=function(e){c!=e&&(c=e,D=!0)},t.getSizeX=function(){return c},t.setSizeY=function(e){S!=e&&(S=e,D=!0)},t.getSizeY=function(){return S},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1])},t.getSize=function(){return[t.getSizeX(),t.getSizeY()]},t.setPixelSize=function(e){d!=e&&(d=e,D=!0)},t.isPixelSize=function(){return d},t.setBounds=function(e){var r,n,i,o;e.left?(r=e.left,n=e.right,i=e.top,o=e.bottom):(r=e[0],n=e[1],i=e[2],o=e[3]);var a=n-r,s=o-i,l=t.getRelativePositionOffset(a,s),u=a/2,g=s/2,c=r+u-l[0],S=i+g-l[1];t.setX(c),t.setY(S),t.setSizeX(a),t.setSizeY(s)},t.getBounds=function(){var e=d?p.toPanelMod([c,-S]):[c,S],r=e[0]/2,n=e[1]/2,i=t.getRelativePositionOffset(e[0],e[1]);return{left:l+i[0]-r,right:l+i[0]+r,top:u+i[1]+n,bottom:u+i[1]-n}},t.getAbsoluteBounds=function(){var e=t.getBounds(),r=t.toGroupSpace([e.left,e.top]),n=t.toGroupSpace([e.right,e.bottom]);return{left:r[0],top:r[1],right:n[0],bottom:n[1]}},t.setRelativePosition=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),s!=e&&(s=e,D=!0)},t.getRelativePosition=function(){return s},t.getRelativePositionOffset=function(e,t){var n,i;Array.isArray(e)?(n=e[0],i=e[1]):(n=e,i=t);var o=!!p.getInvertedScaleY&&p.getInvertedScaleY();return r.getRelativePositionOffset(s,n,i,o)},t.setVisible=function(e){e!=o&&(o=e,D=!0)},t.isVisible=function(){return o},t.isGroupVisible=function(){for(var e=h;"undefined"!=typeof e&&null!==e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},t.setMeasured=function(e){a=e},t.isMeasured=function(){return a},t.setTransformation=function(e){"undefined"==typeof e||null===e?f=0:Array.isArray(e)&&e.length>5?EJSS_TOOLS.compareArrays(f,e)||(f=e,D=!0):f!=e&&(f=e,D=!0)},t.getTransformation=function(){return f},t.getInfo=function(){var e="x="+l.toFixed(2)+" y="+u.toFixed(2);return e},t.setPanel=function(e){p=e,P=!0},t.getPanel=function(){return p},t.getGroupPanel=function(){for(var e=t;e.getGroup();)e=e.getGroup();return e.getPanel()},t.setGroup=function(e){h=e,D=!0},t.getGroup=function(){return h},t.setSet=function(e,t){m=e,A=t},t.getSet=function(){return m},t.getSetIndex=function(){return A},t.isChanged=function(){return D},t.setChanged=function(e){D=e},t.isGroupChanged=function(){for(var e=t.getGroup();"undefined"!=typeof e&&null!==e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},t.setMustProject=function(e){P=e},t.isMustProject=function(){return P},t.getPixelPosition=function(){return(t.isChanged()||t.isGroupChanged()||t.isMustProject())&&(y=t.getPixelPositionOf(l,u),v=t.getPixelSizeOf(c,S),t.setMustProject(!1)),y},t.getPixelSizes=function(){return(t.isChanged()||t.isGroupChanged()||t.isMustProject())&&(y=t.getPixelPositionOf(l,u),v=t.getPixelSizeOf(c,S),t.setMustProject(!1)),v},t.getAbsoluteSize=function(){var e=d?p.toPanelMod([c,-S]):[c,S];return t.toGroupSpaceMod(e)},t.getAbsolutePosition=function(){var e;return e=g?null===h?p.toPanelPosition([l,u]):p.toPanelPosition([l,u],EJSS_DRAWING2D.DrawingPanel.SCALE_NUM):[l,u],t.toGroupSpace(e)},t.getPixelSizeOf=function(e,r){return d?[e,-r]:t.getGroupPanel().toPixelMod(t.toGroupSpaceMod([e,r]))},t.getPixelPositionOf=function(e,r){var n;return n=g?[t.getGroupPanel().toPixelAxisX(e),t.getGroupPanel().toPixelAxisY(r)]:null===h?t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r])):t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r]),EJSS_DRAWING2D.DrawingPanel.SCALE_NUM)},t.toGroupSpaceMod=function(e){for(var t=h;"undefined"!=typeof t&&null!==t;)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),t=t.getGroup();return e},t.toGroupSpace=function(e){for(var t=h;"undefined"!=typeof t&&null!==t;)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),e[0]+=t.getX(),e[1]+=t.getY(),t=t.getGroup();return e},t.getController=function(){return I},t.setController=function(e){I=e},t.getInteractionTarget=function(e){switch(e){case n.TARGET_POSITION:return E.positionTarget;case n.TARGET_SIZE:return E.sizeTarget}return null},t.getInteractionTargets=function(){return[E.positionTarget,E.sizeTarget]},t.registerProperties=function(e){EJSS_DRAWING2D.Element.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Element.copyTo(t,e)},t.serialize=function(){return{mStyle:i.serialize(),mVisible:o,mMeasured:a,mRelativePosition:s,mX:l,mY:u,mPixelPosition:g,mSizeX:c,mSizeY:S,mPixelSize:d,mTransformation:f,mInteraction:{},mPanel:p?p.getName():p,mGroup:h?h.getName():h,mSet:m?m.getName():m,mIndexInSet:A,mProjectedPosition:y,mProjectedSize:v}},t.unserialize=function(e){i.unserialize(e.mStyle),o=e.mVisible,a=e.mMeasured,s=e.mRelativePosition,l=e.mX,u=e.mY,g=e.mPixelPosition,c=e.mSizeX,S=e.mSizeY,d=e.mPixelSize,f=e.mTransformation,A=e.mIndexInSet,y=e.mProjectedPosition,v=e.mProjectedSize,D=!0},i.setChangeListener(function(e){D=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ElementSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("PixelPosition",function(t){e.setToEach(function(e,t){e.setPixelPosition(t)},t)}),t.registerProperty("Diameter",function(t){e.setToEach(function(e,t){e.setSize([t,t])},t)}),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setSize([2*t,2*t])},t)}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("PixelSize",function(t){e.setToEach(function(e,t){e.setPixelSize(t)},t)}),t.registerProperty("Bounds",function(t){var r=function(e,t){e.setX(t[0]),e.setY(t[2]),e.setSizeX(t[1]-t[0]),e.setSizeY(t[3]-t[2])};e.setToEach(r,t)},function(){var t=function(e){return[e.getX(),e.getX()+e.getSizeX(),e.getY(),e.getY()+e.getSizeY()]};return e.getFromEach(t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("RelativePosition",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("Attributes",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ShapeRendering",function(t){e.setToEach(function(e,t){e.getStyle().setShapeRendering(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setMotionEnabled(t)},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setAffectsGroup(t)},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){e.getInteractionTarget(n).setMotionEnabled(t)},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(n).setAffectsGroup(t)},t)}),t.registerProperty("Sensitivity",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)},t)});var i=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",i),t.registerAction("OnExit",i),t.registerAction("OnPress",i),t.registerAction("OnDrag",i),t.registerAction("OnRelease",i)}},EJSS_DRAWING2D.elementSet=function(e,t){var r=EJSS_DRAWING2D.group(t),n=EJSS_DRAWING2D.ElementSet,i=[],o=-1,a=[];r.setNumberOfElements=function(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){a=i.splice(t,o);for(var s=0;s<a.length;s++){var l=a[s].getPanel();l&&l.removeElement(a[s])}}else if(o<0){a=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;c<t;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}},r.getElements=function(){return i},r.getElement=function(e){return i[e]},r.getLastElements=function(){var e=a.slice();return a=[],e},r.setElementInteracted=function(e){o=e},r.getElementInteracted=function(){return o};var s=r.setPanel;r.setPanel=function(e){s(e);for(var t=0,r=i.length;t<r;t++)i[t].setPanel(e)},r.setToEach=function(e,t){if(Array.isArray(t)){1==i.length&&r.setNumberOfElements(t.length);for(var n=0,o=Math.min(i.length,t.length);n<o;n++)e(i[n],t[n])}else for(var n=0,o=i.length;n<o;n++)e(i[n],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;r<n;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var l=e(t+"[0]");return l.setController(r.getController()),l.setSet(r,0),i.push(l),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Grid={SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("StepX",e.setStepX,e.getStepX),t.registerProperty("StepY",e.setStepY,e.getStepY),t.registerProperty("TicksX",e.setTicksX,e.getTicksX),t.registerProperty("TicksY",e.setTicksY,e.getTicksY),t.registerProperty("TickStepX",e.setTickStepX,e.getTickStepX),t.registerProperty("TickStepY",e.setTickStepY,e.getTickStepY),t.registerProperty("TicksXMode",e.setTicksXMode,e.getTicksXMode),t.registerProperty("TicksYMode",e.setTicksYMode,e.getTicksYMode),t.registerProperty("ShowX",e.setShowX,e.getShowX),t.registerProperty("ShowY",e.setShowY,e.getShowY),t.registerProperty("FixedTickX",e.setFixedTickX,e.getFixedTickX),t.registerProperty("FixedTickY",e.setFixedTickY,e.getFixedTickY),t.registerProperty("ScaleX",e.setScaleX,e.getScaleX),t.registerProperty("ScaleY",e.setScaleY,e.getScaleY),t.registerProperty("ScalePrecisionX",e.setScalePrecisionX,e.getScalePrecisionX),t.registerProperty("ScalePrecisionY",e.setScalePrecisionY,e.getScalePrecisionY),t.registerProperty("AutoTicksX",e.setAutoTicksX,e.getAutoTicksX),t.registerProperty("AutoTicksY",e.setAutoTicksY,e.getAutoTicksY),t.registerProperty("AutoStepXMin",e.setAutoStepXMin,e.getAutoStepXMin),t.registerProperty("AutoStepYMin",e.setAutoStepYMin,e.getAutoStepYMin),t.registerProperty("AutoTicksXRange",e.setAutoTicksXRange,e.getAutoTicksXRange),t.registerProperty("AutoTicksYRange",e.setAutoTicksYRange,e.getAutoTicksYRange),t.registerProperty("LineColorX",e.setLineColorX,e.getLineColorX),t.registerProperty("LineWidthX",e.setLineWidthX,e.getLineWidthX),t.registerProperty("ShapeRenderingX",e.setShapeRenderingX,e.getShapeRenderingX),t.registerProperty("LineColorY",e.setLineColorY,e.getLineColorY),t.registerProperty("LineWidthY",e.setLineWidthY,e.getLineWidthY),t.registerProperty("ShapeRenderingY",e.setShapeRenderingY,e.getShapeRenderingY)}},EJSS_DRAWING2D.grid=function(e){var t=EJSS_DRAWING2D.element(e),r=!0,n=!0,i=0,o=0,a=0,s=0,l=0,u=0,g=!0,c=!0,S=Number.NaN,d=Number.NaN,f=[-1,1],E=[-1,1],p=1,h=1,m=EJSS_DRAWING2D.Grid.SCALE_NUM,A=EJSS_DRAWING2D.Grid.SCALE_NUM,y=40,v=40,P=[5,10,20],D=[5,10,20],I="black",_=.5,C=EJSS_DRAWING2D.Style.RENDER_AUTO,R="black",T=.5,N=EJSS_DRAWING2D.Style.RENDER_AUTO;return t.getClass=function(){return"ElementGrid"},t.setAutoTicksRangeY=function(e){D!=e&&(D=e,t.setChanged(!0))},t.getAutoTicksRangeY=function(){return D},t.setAutoTicksRangeX=function(e){P!=e&&(P=e,t.setChanged(!0))},t.getAutoTicksRangeX=function(){return P},t.setAutoStepYMin=function(e){v!=e&&(v=e,t.setChanged(!0))},t.getAutoStepYMin=function(){return v},t.setAutoStepXMin=function(e){y!=e&&(y=e,t.setChanged(!0))},t.getAutoStepXMin=function(){return y},t.setScaleY=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getScaleY=function(){return E},t.setScaleX=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getScaleX=function(){return f},t.setScalePrecisionX=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getScalePrecisionX=function(){return p},t.setScalePrecisionY=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getScalePrecisionY=function(){return h},t.setFixedTickX=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getFixedTickX=function(){return S},t.setFixedTickY=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getFixedTickY=function(){return d},t.setAutoTicksX=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicksX=function(){return r},t.setAutoTicksY=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getAutoTicksY=function(){return n},t.setStepX=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getStepX=function(){return a},t.setStepY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getStepY=function(){return s},t.setTickStepX=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getTickStepX=function(){return l},t.setTickStepY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getTickStepY=function(){return u},t.setTicksX=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getTicksX=function(){return i},t.setTicksY=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTicksY=function(){return o},t.setTicksXMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),m!=e&&(m=e,t.setChanged(!0))},t.getTicksXMode=function(){return m},t.setTicksYMode=function(e){"string"==typeof e&&(ticksXMode=EJSS_DRAWING2D.Grid[e.toUpperCase()]),A!=e&&(A=e,t.setChanged(!0))},t.setShowX=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getShowX=function(){return g},t.setShowY=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getShowY=function(){return c},t.getTicksYMode=function(){return A},t.setLineColorX=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=I&&(I=e,t.setChanged(!0)),t},t.getLineColorX=function(){return I},t.setLineWidthX=function(e){e!=_&&(_=e,t.setChanged(!0))},t.getLineWidthX=function(){return _},t.setShapeRenderingX=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),C!=e&&(C=e,t.setChanged(!0))},t.getShapeRenderingX=function(){return C},t.setLineColorY=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=R&&(R=e,t.setChanged(!0)),t},t.getLineColorY=function(){return R},t.setLineWidthY=function(e){e!=T&&(T=e,t.setChanged(!0))},t.getLineWidthY=function(){return T},t.setShapeRenderingY=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),N!=e&&(N=e,t.setChanged(!0))},t.getShapeRenderingY=function(){return N},t.registerProperties=function(e){EJSS_DRAWING2D.Grid.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Group={},EJSS_DRAWING2D.group=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t},EJSS_DRAWING2D.GroupSet={},EJSS_DRAWING2D.groupSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.group,e);return t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Histogram={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setInput(e.getInput()),t.setEnabled(e.getEnabled()),t.setOccurrences(e.getOccurrences()),t.setClearAtInput(e.getClearAtInput()),t.setDiscrete(e.getDiscrete()),t.setNormalized(e.getNormalized()),t.setBinWidth(e.getBinWidth())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Input",e.addInput),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("Occurrences",e.setOccurrences,e.getOccurrences),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Discrete",e.setDiscrete,e.getDiscrete),t.registerProperty("Normalized",e.setNormalized,e.getNormalized),t.registerProperty("BinWidth",e.setBinWidth,e.getBinWidth),t.registerProperty("FixBin",e.setFixBin,e.getFixBin)}},EJSS_DRAWING2D.histogram=function(e){var t=EJSS_DRAWING2D.element(e),r=[],n=!0,i=1,o=!1,a=!1,s=!1,l=1,u=0,g=null;return t.getClass=function(){return"ElementHistogram"},t.dataCollected=function(){},t.getInput=function(){return r},t.addInput=function(e){if(n){o&&t.clear();for(var a=0;a<i;a++)e instanceof Array?r=r.concat(e):r.push(e);g=null,t.setChanged(!0)}},t.clear=function(){r=[],g=null,t.setChanged(!0)},t.getClearAtInput=function(){return o},t.setClearAtInput=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getActive=function(){return n},t.setActive=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getOccurrences=function(){return i},t.setOccurrences=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getDiscrete=function(){return a},t.setDiscrete=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getNormalized=function(){return s},t.setNormalized=function(e){s!=e&&(s=e,g=null,t.setChanged(!0))},t.getBinWidth=function(){return l},t.setBinWidth=function(e){l!=e&&(l=e,g=null,t.setChanged(!0))},t.getFixBin=function(){return u},t.setFixBin=function(e){u!=e&&(u=e,g=null,t.setChanged(!0))},t.getBars=function(){if(null!=g)return g;if(0==r.length)return g=[[0,0]];g=[],r=r.sort(function(e,t){return e-t});var e,t=l/2;e=0==l?r[0]:u-t>r[0]?u-(Math.floor((u-t-r[0])/l)+1)*l:u+t<r[0]?u+Math.floor((r[0]-u-t)/l)*l:u;for(var n=e,i=0,o=r.length,a=0;a<o;a++)r[a]<=n+t?i++:(i>0&&(s&&(i/=o),g.push([n,i])),0==l?n=r[a]:n+=(Math.floor((r[a]-n-t)/l)+1)*l,i=1);return i>0&&(s&&(i/=o),g.push([n,i])),g},t.getBounds=function(e){t.getBars();for(var r=g.length,n=g[0][0],i=g[r-1][0],o=0,a=0,s=0;s<r;s++)a=Math.max(a,g[s][1]);var l=t.getX(),u=t.getY(),c=t.getSizeX(),S=t.getSizeY(),d=c/2,f=S/2,E=t.getRelativePositionOffset(c,S);return{left:l+E[0]-d+n*c,right:l+E[0]-d+i*c,top:u+E[1]-f+a*S,bottom:u+E[1]-f+o*S}},t.getBoundsOld=function(e){var n,i,o,a,l=r.length;if(0==l)n=i=o=a=0;else{console.log("mCurrentInput="+r);var u=r.sort(function(e,t){return e-t}),g=u.length;n=u[0],i=u[g-1],a=0,o=0;var c=[];if(u.forEach(function(e){c[e]=(c[e]||0)+1}),s)for(var S in c)c[S]/=g;for(var S in c)c[S]>a&&(a=c[S])}var d=t.getX(),S=t.getY(),f=t.getSizeX(),E=t.getSizeY(),p=f/2,h=E/2,m=t.getRelativePositionOffset(f,E);return{left:d+m[0]-p+n*f,right:d+m[0]-p+i*f,top:S+m[1]-h+a*E,bottom:S+m[1]-h+o*E}},t.registerProperties=function(e){EJSS_DRAWING2D.Histogram.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Histogram.copyTo(t,e)},t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Image={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setImageUrl(e.getImageUrl())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Encode",e.setEncode)}},EJSS_DRAWING2D.image=function(e){var t=EJSS_DRAWING2D.element(e),r="",n="",i=!1;return t.getClass=function(){return"ElementImage"},t.setImageUrl=function(e){var n=t.getSet(),i=null!=n?n.getResourcePath:t.getResourcePath;null!=i?e=i(e):console.log("No getResourcePath function for "+t.getName()+". Texture = "+e),r!=e&&(r=e,t.setChanged(!0),t.setChangedImage(!0))},t.getImageUrl=function(){return r},t.forceImageUrl=function(e){console.log("Setting image to "+e),r=e,t.setChanged(!0),t.setChangedImage(!0);
},t.setChangedImage=function(e){i=e},t.getChangedImage=function(){return i},t.setEncode=function(e){n.length!=e.length&&(n=e,t.setChanged(!0),t.setChangedImage(!0))},t.getEncode=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Image.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Image.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ImageSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("ImageUrl",function(t){e.setToEach(function(e,t){e.setImageUrl(t)},t)})}},EJSS_DRAWING2D.imageSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.image,e),r=EJSS_DRAWING2D.ImageSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.analyticCurve=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}var n,i,o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getNumPoints(),d=t.getMinimun(),f=t.getMaximun(),E="undefined"==typeof d||null===d?t.getPanel().getRealWorldXMin():d,p="undefined"==typeof f||null===f?t.getPanel().getRealWorldXMax():f,h=t.getVariable(),m=t.getFunctionX(),A=t.getFunctionY(),y=EJSS_DRAWING2D.functionsParser(),v=!1;try{n=y.parse(m)}catch(e){console.log("Analytic curve error parsing FunctionX: "+m),v=!0}if(!v)try{i=y.parse(A)}catch(e){console.log("Analytic curve error parsing FunctionY: "+A),v=!0}if(v)return void t.getController().invokeAction("OnError");var P=(p-E)/(S-1),D=[],I={},_=t.getParameters();for(var C in _)I[C]=_[C];try{for(var R=0,T=E;T<=p;T+=P){I[h]=T;var N=n.evaluate(I),O=i.evaluate(I);isNaN(N)||isNaN(O)||(D[R]=[],D[R][0]=N,D[R++][1]=O)}}catch(e){t.getController().invokeAction("OnError")}r(D,l-g,u-c,a[0],a[1]);var M=t.getStyle();M.getDrawFill()&&"none"!=M.getFillColor()&&(e.fillStyle=M.getFillColor(),e.fill()),M.getDrawLines()&&(e.lineWidth=M.getLineWidth(),e.strokeStyle=M.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.arrow=function(e,t){function r(t,r,i,o,a,s,l,u,g){e.save(),o/=2,a/=2;var c=0==u?Math.PI/2:Math.atan(g/u);switch(c+=u<0?-Math.PI/2:Math.PI/2,i){case n.TRIANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,a/2),e.lineTo(o,a/2),e.lineTo(0,-a/2),e.lineTo(-o,a/2),e.closePath();break;case n.ANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(o,a),e.lineTo(0,0),e.lineTo(-o,a);break;case n.LINE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(o,0),e.lineTo(-o,0);break;case n.RECTANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,-a),e.lineTo(o,a),e.lineTo(-o,a),e.lineTo(-o,-a),e.closePath();break;case n.POINTED:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,a/4),e.lineTo(o,a),e.lineTo(0,-a/4),e.lineTo(-o,a),e.closePath();break;case n.CIRCLE:var S=o<a?o:a;e.beginPath(),e.translate(t,r),e.arc(0,0,S,0,2*Math.PI,!1);break;case n.DIAMOND:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath();break;case n.INVTRIANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a/2),e.lineTo(-o,-a/2),e.lineTo(0,a/2),e.lineTo(o,-a/2),e.closePath();break;case n.INVANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(-o,-a),e.lineTo(0,0),e.lineTo(o,-a);break;case n.WEDGE:case n.CURVE:console.log("Type of Arrow: not supported")}"none"!=l&&(i!=n.ANGLE&&i!=n.INVANGLE&&(e.fillStyle=l,e.fill()),i!=n.POINTED&&(e.lineWidth=s,e.strokeStyle=l,e.stroke())),e.restore()}var n=EJSS_DRAWING2D.Arrow,i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=o[0]/2,g=o[1]/2;if(0!=o[0]||0!=o[1]){e.beginPath(),e.moveTo(s-u,l-g),e.lineTo(s+u,l+g);var c=t.getStyle();if(c.getDrawFill()&&"none"!=c.getFillColor()&&(e.fillStyle=c.getFillColor(),e.fill()),c.getDrawLines()&&(e.lineWidth=c.getLineWidth(),e.strokeStyle=c.getLineColor(),e.stroke()),t.getMarkEnd()!=n.NONE){var S=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),d=0!=S&&S<t.getMarkEndWidth()?S:t.getMarkEndWidth(),f=0!=S&&S<t.getMarkEndHeight()?S:t.getMarkEndHeight(),E="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),p=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();r(s+u,l+g,t.getMarkEnd(),d,f,p,E,u,g)}if(t.getMarkMiddle()!=n.NONE){var h=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),m=0!=h&&h<t.getMarkMiddleWidth()?h:t.getMarkMiddleWidth(),A=0!=h&&h<t.getMarkMiddleHeight()?h:t.getMarkMiddleHeight(),E="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),p=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();r(s,l,t.getMarkMiddle(),m,A,p,E,u,g)}if(t.getMarkStart()!=n.NONE){var y=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),v=0!=y&&y<t.getMarkStartWidth()?y:t.getMarkStartWidth(),P=0!=y&&y<t.getMarkStartHeight()?y:t.getMarkStartHeight(),E="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),p=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();r(s-u,l-g,t.getMarkStart(),v,P,p,E,u,g)}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.axis=function(e,t){function r(t,r,n,i,o,a){o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(a&&(i=-i,r=-r),e.moveTo(t,r-i),e.lineTo(t,r+i)):(e.moveTo(t-n,r),e.lineTo(t+n,r))}function n(t,r,n,i){i==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(e.moveTo(t-n/2,r),e.lineTo(t+n/2,r)):(e.moveTo(t,r-n/2),e.lineTo(t,r+n/2))}function i(r,n,i,o,a){e.save();var o=t.getFont(),s="";s+="none"!=o.getFontStyle()?o.getFontStyle()+" ":"",s+="none"!=o.getFontWeight()?o.getFontWeight()+" ":"",s+=o.getFontSizeString()+"px ",s+=o.getFontFamily(),e.font=s,e.fillStyle=o.getFillColor(),a?r-=e.measureText(i).width/2+.5:n+=o.getFontSize()/2,e.fillText(i,r,n),e.restore()}if(t.getShow()){var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getStyle(),d=t.getOrient(),f=t.getInvertedScaleY();e.beginPath(),r(l,u,g,c,d,f);var E=d==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(a[1]):Math.abs(a[0]),p=t.getTicksMode();if(p==EJSS_DRAWING2D.Axis.SCALE_LOG){var h=t.getScale();if(h[0]>0&&h[1]>0){var m=t.getTicks(),A=t.getScalePrecision(),y=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawLogTicks(l,u,g,c,E,y,h,m,d,n);var v=t.getFont(),P=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawLogTicksText(l,u,g,c,m,y,h,A,v,P,d,i)}}else if(p==EJSS_DRAWING2D.Axis.SCALE_NUM){var D=0,I=0;if(t.getAutoTicks())for(var _=t.getAutoStepMin(),C=t.getAutoTicksRange(),R=C.length-1;R>=0&&(D=Math.abs(E/C[R]),!(1.001*D>=_));R--);else{var m=t.getTicks();0!=m?D=E/m:(D=t.getStep(),I=t.getTickStep())}var A=t.getScalePrecision(),h=t.getScale();if(0==I)var T=Math.abs((h[1]-h[0])*D/E);else{var T=I;D=Math.abs(T*E/(h[1]-h[0]))}var N=Math.pow(10,A),O=Math.round(T*N)/N;O>0&&(T=O,D=Math.abs(O*E/(h[1]-h[0])));var M=t.getFixedTick(),b=h[1];isNaN(M)||(b=M<h[0]?M+(Math.floor((h[0]-M)/T)+1)*T:M>h[1]?M-(Math.floor((M-h[1])/T)+1)*T:M);var G=Math.abs((h[0]-b)%T),x=Math.abs(G-T);(G<.001||x<.001)&&(G=0);var L=E*G/Math.abs(h[1]-h[0]),y=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawDecTicks(l,u,g,c,y,D,L,d,f,n);var v=t.getFont(),P=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawDecTicksText(l,u,g,c,y,D,L,h,A,T,G,v,P,d,f,i)}var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.byteRaster=function(e,t){if(t.getDataChanged()){var r=t.getData(),n=t.getColorMapper().getColors(),i=r.length,o=r[0].length,a=t.getColorMapper().getNumberOfColors(),s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=Math.abs(l[0]/2),d=Math.abs(l[1]/2),f=e.canvas.id;EJSS_SVGGRAPHICS.Utils.ImageDataCanvas(i,o,a,r,n,function(t){var r=document.getElementById(f);e=r.getContext("2d"),e.putImageData(t,g-S,c-d)}),t.setDataChanged(!1)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cellLattice=function(e,t){function r(t,r,n,i,o,a){e.beginPath(),0==o&&(o=Math.abs(n-t));for(var s=t;s<=n;s+=o)e.moveTo(s,r),e.lineTo(s,i);0==a&&(a=Math.abs(r-i));for(var s=i;s>=r;s-=a)e.moveTo(t,s),e.lineTo(n,s)}function n(t,r,n,i,o){e.beginPath();var a=n/2,s=i/2;e.moveTo(t-a,r+s),e.lineTo(t+a,r+s),e.lineTo(t+a,r-s),e.lineTo(t-a,r-s),e.lineTo(t-a,r+s),e.fillStyle=o,e.fill(),e.lineWidth=1,e.strokeStyle=o,e.stroke()}function i(t,n,i,o,a,s,l){var u=i/2,g=o/2,c=t-u,S=t+u,d=n+g,f=n-g;r(c,d,S,f,a,s),l.getDrawFill()&&"none"!=l.getFillColor()&&(e.fillStyle=l.getFillColor(),e.fill()),l.getDrawLines()&&(e.lineWidth=l.getLineWidth(),e.strokeStyle=l.getLineColor(),e.stroke())}for(var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getStyle(),d=t.getData(),f=t.getColorMapper().getColors(),E=d.length,p=d[0].length,h=Math.abs(a[0]/E),m=Math.abs(a[1]/p),A=l-g+h/2,y=u-c-m/2,v=0;v<p;v++)for(var P=0;P<E;P++)n(A+h*P,y-m*v,h,m,f[d[P][v]]);var D=t.getShowGrid();D&&i(l,u,a[0],a[1],h,m,S)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cursor=function(e,t){var r=t.getPixelPosition(),n=t.getCursorType(),i=t.getGroupPanel(),o=i.getRealWorldCoordinates(),a=i.toPixelPosition([o[0],o[2]]),s=i.toPixelPosition([o[1],o[3]]);if(e.beginPath(),n!=EJSS_DRAWING2D.Cursor.VERTICAL){var l=a[0],u=s[0],g=r[1];g>a[1]?g=a[1]:g<s[1]&&(g=s[1]),e.moveTo(l,g),e.lineTo(u,g)}if(n!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var c=r[0],S=a[1],d=s[1];c<a[0]?c=a[0]:c>s[0]&&(c=s[0]),e.moveTo(c,S),e.lineTo(c,d)}var f=t.getStyle();f.getDrawFill()&&"none"!=f.getFillColor()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.ellipse=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=.5522848,g=o-s/2,c=a-l/2;ox=s/2*u,oy=l/2*u,xe=g+s,ye=c+l,e.beginPath(),e.moveTo(g,a),e.bezierCurveTo(g,a-oy,o-ox,c,o,c),e.bezierCurveTo(o+ox,c,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,g,a+oy,g,a);var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.grid=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getShowX(),g=t.getShowY();if(u){e.beginPath();var c=t.getTicksXMode();if(c==EJSS_DRAWING2D.Grid.SCALE_LOG){var S=t.getScaleX();if(S[0]>0&&S[1]>0){var d=t.getTicksX(),f=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(f,p,E,h,d,S,1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}}else if(c==EJSS_DRAWING2D.Grid.SCALE_NUM){var m=0,A=0;if(t.getAutoTicksX())for(var y=t.getAutoStepXMin(),v=t.getAutoTicksRangeX(),P=v.length-1;P>=0&&(m=Math.abs(n[0]/v[P]),!(m>=y));P--);else{var d=t.getTicksX();0!=d?m=Math.abs(n[0]/d):(m=t.getStepX(),A=t.getTickStepX())}var D=t.getScalePrecisionX(),S=t.getScaleX();if(0==A)var I=Math.abs((S[1]-S[0])*m/n[0]);else{var I=A;m=Math.abs(I*n[0]/(S[1]-S[0]))}var _=Math.pow(10,D),C=Math.round(I*_)/_;C>0&&(I=C,m=Math.abs(C*n[0]/(S[1]-S[0])));var R=t.getFixedTickX(),T=S[1];isNaN(R)||(T=R<S[0]?R+(Math.floor((S[0]-R)/I)+1)*I:R>S[1]?R-(Math.floor((R-S[1])/I)+1)*I:R);var N=Math.abs((S[0]-T)%I),O=Math.abs(N-I);(N<.001||O<.001)&&(N=0);var M=Math.abs(n[0]*N/(S[1]-S[0])),f=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(f,p,E,h,M,m,1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}e.lineWidth=t.getLineWidthX(),e.strokeStyle=t.getLineColorX(),e.stroke()}if(g){e.beginPath();var b=t.getTicksYMode();if(b==EJSS_DRAWING2D.Grid.SCALE_LOG){var G=t.getScaleY();if(G[0]>0&&G[1]>0){var x=t.getTicksY(),f=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(f,p,E,h,x,G,-1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}}else if(b==EJSS_DRAWING2D.Grid.SCALE_NUM){var L=0,J=0;if(t.getAutoTicksY())for(var w=t.getAutoStepYMin(),W=t.getAutoTicksRangeY(),P=W.length-1;P>=0&&(L=Math.abs(n[1]/W[P]),!(L>=w));P--);else{var x=t.getTicksY();0!=x?L=Math.abs(n[1]/x):(L=t.getStepY(),J=t.getTickStepY())}var k=t.getScalePrecisionY(),G=t.getScaleY();if(0==J)var F=Math.abs((G[1]-G[0])*L/n[1]);else{var F=J;L=Math.abs(F*n[1]/(G[1]-G[0]))}var V=Math.pow(10,k),B=Math.round(F*V)/V;B>0&&(F=B,L=Math.abs(B*n[1]/(G[1]-G[0])));var R=t.getFixedTickY(),T=G[1];isNaN(R)||(T=R<G[0]?R+(Math.floor((G[0]-R)/F)+1)*F:R>G[1]?R-(Math.floor((R-G[1])/F)+1)*F:R);var N=Math.abs((G[0]-T)%F),O=Math.abs(N-F);(N<.001||O<.001)&&(N=0);var H=Math.abs(n[1]*N/(G[1]-G[0])),f=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(f,p,E,h,H,L,-1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}e.lineWidth=t.getLineWidthY(),e.strokeStyle=t.getLineColorY(),e.stroke()}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.histogram=function(e,t){function r(t,r,n,i,o){e.beginPath(),e.moveTo(t,i),e.lineTo(t,n),e.lineTo(r,n),e.lineTo(r,i),o.getDrawFill()&&"none"!=o.getFillColor()&&(e.fillStyle=o.getFillColor(),e.fill()),o.getDrawLines()&&(e.lineWidth=o.getLineWidth(),e.strokeStyle=o.getLineColor(),e.stroke())}for(var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=t.getStyle(),c=t.getDiscrete(),S=t.getBinWidth()/2,d=t.getBars(),f=t.getGroupPanel().getPixelPositionWorldOrigin()[1],E=0;E<d.length;E++){var p,h,m=d[E][0];c?p=h=a-l+m*i[0]:(p=a-l+(m-S)*i[0],h=a-l+(m+S)*i[0]);var A=s-u+d[E][1]*i[1];r(p,h,A,f,g)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.image=function(e,t,r){var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=Math.abs(i[0]/2),u=Math.abs(i[1]/2),g=new Image;g.onload=function(){e.save(),r(t),e.drawImage(g,a-l,s-u,Math.abs(i[0]),Math.abs(i[1])),e.restore()};var c=t.getEncode();c.length>0?g.src="data:png;base64,"+c:g.src=t.getImageUrl(),t.setChangedImage(!1)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.mesh=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;a<n;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]);var s=i.indexToColor(o);e.fillStyle=s,e.fill(),e.lineWidth=1.25,e.strokeStyle=s,e.stroke()}function n(t,r,n,i){e.beginPath();for(var o=t.length,a=0;a<o;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),n&&i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function i(t,r,n,i){e.beginPath();for(var o=t.length,a=0;a<o;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),e.lineWidth=i+.5,e.strokeStyle=n,e.stroke()}function o(t,r,n,i){for(var o=0;o<t.length;o++){var a=t[o],s=r[o],l=n[o][0],u=n[o][1],g=EJSS_TOOLS.Mathematics.norm([l,u]),c=l*i/g,S=u*i/g;if(0!=c||0!=S){var d=.3*EJSS_TOOLS.Mathematics.norm([c,S]),E=0!=d&&d<12?d:12,h=Math.atan2(c,S);e.beginPath(),e.moveTo(a,s),e.lineTo(a+c-E*Math.cos(h),s+S-E*Math.sin(h)),e.lineTo(a+c-E*Math.cos(h-Math.PI/6),s+S-E*Math.sin(h-Math.PI/6)),e.lineTo(a+c,f+p),e.lineTo(a+c-E*Math.cos(h+Math.PI/6),s+S-E*Math.sin(h+Math.PI/6)),e.lineTo(a+c-E*Math.cos(h),s+S-E*Math.sin(h)),e.lineWidth=1,e.strokeStyle="black",e.stroke()}}}var a,s,l,u,g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=c[0]/2,p=c[1]/2,h=t.getPoints();if(null!=h){var m=h.length;a=new Array(m),s=new Array(m);for(var A=0;A<m;A++)a[A]=d-E+h[A][0]*c[0],s[A]=f-p+h[A][1]*c[1];var y=t.getCells(),v=t.getFieldAtPoints();if(v?l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,y,v,!1):(v=t.getFieldAtCells(),l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,y,v,!0)),null!=y){var P=t.getStyle();if(null!=v){var D=t.getColorCoded();EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,D,function(e,t){n(e,t,!1,P)},function(e,t,n,i,o){r(e,t,n,i,o)})}else EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,D,function(e,t){n(e,t,!0,P)},function(e,t,r,n,i){})}var I=t.getBoundary();if(t.getDrawBoundary()&&null!=I){var _=t.getBoundaryLabels(),C=t.getBoundaryColors(),R=t.getBoundaryLineWidth();u=EJSS_GRAPHICS.GraphicsUtils.buildBoundary(a,s,I),EJSS_GRAPHICS.GraphicsUtils.drawBoundary(u,_,C,function(e,t,r){i(e,t,r,R)})}if(t.getDataType()>=4&&null!=v)for(var T=t.getVectorLength()*c[0],A=0,N=y.length;A<N;A++)o(mCellA[A],mCellB[A],v[A],T)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.pipe=function(e,t){var r=t.getPoints();if(r&&!(r.length<=0)){var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=Math.abs(i[0]),u=Math.abs(i[1]),g=a-l/2,c=s+u/2,S=t.getStyle();e.beginPath(),e.moveTo(g,c);for(var a=g,s=c,d=0,f=r.length;d<f;d++){var E=r[d];a+=Math.round(E[0]*l),s+=Math.round(-E[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=2*S.getLineWidth()+t.getPipeWidth(),e.strokeStyle=S.getLineColor(),e.stroke()),e.beginPath(),e.moveTo(g,c);for(var a=g,s=c,d=0,f=r.length;d<f;d++){var E=r[d];a+=Math.round(E[0]*l),s+=Math.round(-E[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=t.getPipeWidth(),e.strokeStyle=S.getFillColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.point=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1];e.beginPath(),e.arc(o,a,2,0,2*Math.PI);var s=t.getStyle();e.fillStyle=s.getFillColor(),e.fill()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.polygon=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath();for(var u=t.getPoints(),g=0;g<u.length;g++){var c=u[g],S=o-s+c[0]*n[0],d=a-l+c[1]*n[1];0==g?e.moveTo(S,d):e.lineTo(S,d)}var f=t.getStyle();f.getDrawFill()&&"none"!=f.getFillColor()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.rectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a+l),e.lineTo(o+s,a+l),e.lineTo(o+s,a-l),e.lineTo(o-s,a-l),e.lineTo(o-s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.roundRectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=o-s/2,g=a-l/2,c=Math.abs(t.getCornerRadius());e.beginPath(),e.moveTo(u+c,g),e.lineTo(u+s-c,g),e.quadraticCurveTo(u+s,g,u+s,g+c),e.lineTo(u+s,g+l-c),e.quadraticCurveTo(u+s,g+l,u+s-c,g+l),e.lineTo(u+c,g+l),e.quadraticCurveTo(u,g+l,u,g+l-c),e.lineTo(u,g+c),e.quadraticCurveTo(u,g,u+c,g),e.closePath();var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.segment=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a-l),e.lineTo(o+s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.spring=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0];e.beginPath(),EJSS_GRAPHICS.GraphicsUtils.drawSpring(t.getLoops(),t.getPointsPerLoop(),u,t.getSolenoid(),t.getThinExtremes(),o-s,a-l,n[0],n[1],function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)});var g=t.getStyle();g.getDrawFill()&&"none"!=g.getFillColor()&&(e.fillStyle=g.getFillColor(),e.fill()),g.getDrawLines()&&(e.lineWidth=g.getLineWidth(),e.strokeStyle=g.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.tank=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]/2),l=Math.abs(n[1]/2),u=t.getPixelSizeOf(0,t.getLevel()),g=o-s,c=o+s,S=a+l,d=a-l,f=S+u[1],E=t.getStyle();e.beginPath(),e.moveTo(g+u[0],f),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c+u[0],f),e.fillStyle=t.getLevelColor(),e.fill(),e.beginPath(),e.moveTo(g,d),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c,d),E.getDrawFill()&&"none"!=E.getFillColor()&&(e.fillStyle=E.getFillColor(),e.fill()),e.lineWidth=E.getLineWidth(),e.strokeStyle=E.getLineColor(),e.stroke()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.text=function(e,t){var r=t.getFont(),n="";n+="none"!=r.getFontStyle()?r.getFontStyle()+" ":"",n+="none"!=r.getFontWeight()?r.getFontWeight()+" ":"",n+=r.getFontSizeString()+(r.getFontSizeString().toString().indexOf("px")>-1?" ":"px "),n+=r.getFontFamily(),e.font=n;var i=t.getText(),o=t.getPixelPosition(),a=t.getFramed()?4:0,s=[e.measureText(i).width+2*a,r.getFontSize()+2*a],l=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),s[0],s[1]),u=t.getMarginX(),g=t.getMarginY(),c=o[0]+l[0]+u+a,S=o[1]+l[1]+g-a;if(t.getFramed()){var d=a,f=a,E=s[0]-2*a,p=s[1]-2*a;if(E>0){var h=S+d,m=S-p-d,A=c-f,y=c+E+d;e.save(),e.beginPath(),e.moveTo(A,h),e.lineTo(y,h),e.lineTo(y,m),e.lineTo(A,m),e.lineTo(A,h);var v=t.getStyle();v.getDrawFill()&&"none"!=v.getFillColor()&&(e.fillStyle=v.getFillColor(),e.fill()),v.getDrawLines()&&(e.lineWidth=v.getLineWidth(),e.strokeStyle=v.getLineColor(),e.stroke()),e.restore()}}var P=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:P=Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:P=Math.PI;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:P=3*Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:P=0}e.translate(o[0]+u,o[1]+g),e.rotate(P),e.translate(-(o[0]+u),-(o[1]+g)),e.fillStyle=r.getFillColor(),e.fillText(t.getText(),c,S)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trace=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}function n(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]),u=.5522848,g=o-s/2,c=a-l/2;ox=s/2*u,oy=l/2*u,xe=g+s,ye=c+l,e.beginPath(),e.moveTo(g,a),e.bezierCurveTo(g,a-oy,o-ox,c,o,c),e.bezierCurveTo(o+ox,c,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,g,a+oy,g,a),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function i(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]);e.beginPath(),e.rect(o-s/2,a-l/2,s,l),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function o(t,r,n,i,o,a){e.beginPath(),e.moveTo(t,o),e.lineTo(t,r),e.lineTo(n,i),e.lineTo(n,o),a.getDrawFill()&&"none"!=a.getFillColor()&&(e.fillStyle=a.getFillColor(),e.fill()),a.getDrawLines()&&(e.lineWidth=a.getLineWidth(),e.strokeStyle=a.getLineColor(),e.stroke())}var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2;r(t.getPoints(),u-c,g-S,s[0],s[1]);var d=t.getStyle();d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),d.getDrawLines()&&(e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke());for(var f,E,p=t.getPoints(),h=0;h<p.length;h++){var m=p[h],A=u-c+m[0]*s[0],y=g-S+m[1]*s[1],v=m[3],P=m[4],D=[m[5],m[6]];if(v==EJSS_DRAWING2D.Trace.ELLIPSE)n(A,y,D,P);else if(v==EJSS_DRAWING2D.Trace.RECTANGLE)i(A,y,D,P);else if(v==EJSS_DRAWING2D.Trace.BAR){var I=t.getGroupPanel().toPixelPosition([0,0])[1];D[1]=I-y,y+=D[1]/2,i(A,y,D,P)}else if(v==EJSS_DRAWING2D.Trace.AREA){if(0!=h){var I=t.getGroupPanel().toPixelPosition([0,0])[1],_=u-c+f*s[0],C=g-S+E*s[1];o(mMark,_,C,A,y,I,P)}f=m[0],E=m[1]}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trail=function(e,t){function r(t,r,n,i,o,a,s){if(!(r<=0)){e.beginPath();for(var l=0;l<r;l++){var u=t[l],g=i+u[0]*a,c=o+u[1]*s,S=u[2];0==l||0==S?e.moveTo(g,c):e.lineTo(g,c)}n.getDrawLines()&&(e.lineWidth=n.getLineWidth(),e.strokeStyle=n.getLineColor(),e.stroke())}}var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=a-l,c=s-u,S=i[0],d=i[1],f=t.getSegmentsCount();if(f>0)for(var E=0;E<f;E++){var p=t.getSegmentPoints(E).length;r(t.getSegmentPoints(E),p,t.getSegmentStyle(E),g,c,S,d)}var p=t.getCurrentPoints().length;r(t.getCurrentPoints(),p,t.getStyle(),g,c,S,d)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.wheel=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=n[0]/2,g=n[1]/2,c=.5522848,S=o-s/2,d=a-l/2;ox=s/2*c,oy=l/2*c,xe=S+s,ye=d+l,e.beginPath(),e.moveTo(S,a),e.bezierCurveTo(S,a-oy,o-ox,d,o,d),e.bezierCurveTo(o+ox,d,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,S,a+oy,S,a),e.moveTo(o-u,a),e.lineTo(o+u,a),e.moveTo(o,a-g),e.lineTo(o,a+g);var f=t.getStyle();f.getDrawFill()&&"none"!=f.getFillColor()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.CanvasGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.canvasGraphics=function(e){var t=EJSS_INTERFACE.canvas(e),r=t.getDOMElement(),n=t.getContext();return t.getEventContext=function(){return r},t.getBox=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);return e.width-=1,e.height-=1,e},t.reset=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);n.clearRect(0,0,e.width,e.height)},t.draw=function(e,r){for(var n=0,i=e.length;n<i;n++){var o=e[n];o.isGroupVisible()&&t.drawElement(o,t.transformElement)}},t.drawElement=function(e,t){var r=EJSS_DRAWING2D.Shape,i=e.getClass();if("ElementImage"===i)EJSS_CANVASGRAPHICS.image(n,e,t);else{switch(n.save(),t(e),i){case"ElementCustom":var o=e.getFunction();o&&o(n,e);break;case"ElementShape":switch(e.getShapeType()){default:case r.ELLIPSE:EJSS_CANVASGRAPHICS.ellipse(n,e);break;case r.RECTANGLE:EJSS_CANVASGRAPHICS.rectangle(n,e);break;case r.ROUND_RECTANGLE:EJSS_CANVASGRAPHICS.roundRectangle(n,e);break;case r.WHEEL:EJSS_CANVASGRAPHICS.wheel(n,e);break;case r.NONE:case r.POINT:EJSS_CANVASGRAPHICS.point(n,e)}break;case"ElementSegment":EJSS_CANVASGRAPHICS.segment(n,e);break;case"ElementArrow":EJSS_CANVASGRAPHICS.arrow(n,e);break;case"ElementText":EJSS_CANVASGRAPHICS.text(n,e);break;case"ElementSpring":EJSS_CANVASGRAPHICS.spring(n,e);break;case"ElementTrail":EJSS_CANVASGRAPHICS.trail(n,e);break;case"ElementTrace":EJSS_CANVASGRAPHICS.trace(n,e);break;case"ElementGrid":EJSS_CANVASGRAPHICS.grid(n,e);break;case"ElementAxis":EJSS_CANVASGRAPHICS.axis(n,e);break;case"ElementCursor":EJSS_CANVASGRAPHICS.cursor(n,e);break;case"ElementPolygon":EJSS_CANVASGRAPHICS.polygon(n,e);break;case"ElementAnalyticCurve":EJSS_CANVASGRAPHICS.analyticCurve(n,e);break;case"ElementCellLattice":EJSS_CANVASGRAPHICS.cellLattice(n,e);break;case"ElementByteRaster":EJSS_CANVASGRAPHICS.byteRaster(n,e);break;case"ElementMesh":EJSS_CANVASGRAPHICS.mesh(n,e);break;case"ElementTank":EJSS_CANVASGRAPHICS.tank(n,e);break;case"ElementPipe":EJSS_CANVASGRAPHICS.pipe(n,e);break;case"ElementHistogram":EJSS_CANVASGRAPHICS.histogram(n,e);break;case"ElementVideo":Console.log("Not supported ElementVideo in Canvas!")}n.restore()}},t.transformElement=function(e){null!=e.getGroup()&&t.transformElement(e.getGroup());var r=e.getTransformation();if(Array.isArray(r))console.log("Array transformations are not supported in Canvas!");else if("string"==typeof r)console.log("SVG-based transformations are not supported in Canvas!");else if("number"==typeof r){var i=e.getPixelPosition();n.translate(i[0],i[1]),n.rotate(-r),n.translate(-i[0],-i[1])}},t.drawGutters=function(e){var r=e.getGutters();if(r.visible){var i=e.getInnerRect(),o=.5,a=.5,s=t.getBox(),l=s.width,u=s.height,g=e.getGuttersStyle(),c=e.getStyle();g.getDrawFill()&&(n.beginPath(),n.moveTo(o,a),n.lineTo(o,a+u),n.lineTo(o+l,a+u),n.lineTo(o+l,a),n.lineTo(o,a),n.moveTo(i.x,i.y),n.lineTo(i.x+i.width,i.y),n.lineTo(i.x+i.width,i.y+i.height),n.lineTo(i.x,i.y+i.height),n.lineTo(i.x,i.y),n.moveTo(o,a),n.closePath(),n.fillStyle=g.getFillColor(),n.fill()),g.getDrawLines()&&(n.beginPath(),n.moveTo(o,a),n.lineTo(o,a+u),n.lineTo(o+l,a+u),n.lineTo(o+l,a),n.lineTo(o,a),n.closePath(),n.lineWidth=g.getLineWidth(),n.strokeStyle=g.getLineColor(),n.stroke()),g.getDrawLines()&&(n.beginPath(),n.moveTo(i.x,i.y),n.lineTo(i.x+i.width,i.y),n.lineTo(i.x+i.width,i.y+i.height),n.lineTo(i.x,i.y+i.height),n.lineTo(i.x,i.y),n.closePath(),n.lineWidth=c.getLineWidth(),n.strokeStyle=c.getLineColor(),n.stroke())}},t.drawPanel=function(e){var r=.5,i=.5,o=t.getBox();n.beginPath(),n.rect(r,i,o.width,o.height);var a=e.getStyle();n.fillStyle=a.getFillColor(),n.fill(),a.getDrawLines()&&(n.lineWidth=a.getLineWidth(),n.strokeStyle=a.getLineColor(),n.stroke())},t};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.GraphicsUtils={getOffsetRect:function(e){var t,r,n,i,o=e.getDOMElement(),a=e.getWidth(),s=e.getHeight();t=parseFloat(a);var l=!isNaN(t)&&isFinite(a);r=parseFloat(s);var u=!isNaN(r)&&isFinite(s);if(o.getBoundingClientRect){var g=o.getElementById?o.getElementById(".myPanel"):null;if(g&&g.childElementCount>0)var c=g.getBoundingClientRect();else var c=o.getBoundingClientRect();n=c.top,i=c.left,l||(t=c.width),u||(r=c.height)}else if(void 0!==o.offsetTop)n=o.offsetTop,i=o.offsetLeft,l||(t=o.offsetWidth),u||(r=o.offsetHeight);else{for(var S=o.parentNode||document.getElementById(o.id).parentNode;S&&!S.offsetTop&&S&&!S.previousElementSibling&&!S.nextElementSibling;)S=S.parentNode;n=S.offsetTop,i=S.offsetLeft,l||(t=S.offsetWidth),u||(r=S.offsetHeight)}var d=document.body,f=document.documentElement,E=f.clientTop||d.clientTop||0,p=f.clientLeft||d.clientLeft||0;return n-=E,i-=p,{top:n,left:i,width:t,height:r,bottom:n+r,right:i+t}},drawSpring:function(e,t,r,n,i,o,a,s,l,u,g){var c=e*t,S=2*Math.PI/t;r<0&&(S*=-1);for(var d=t/2,f=[s,l,0],E=EJSS_TOOLS.Mathematics.normalTo(f),p=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct(f,E)),h=0;h<=c;h++){var m;m=i?h<d?0:h<t?h-d:h>c-d?0:h>c-t?c-h-d:d:d;var A=Math.PI/2+h*S,y=Math.cos(A),v=Math.sin(A),P=o+h*s/c+m*r*(y*E[0]+v*p[0])/d,D=a+h*l/c+m*r*(y*E[1]+v*p[1])/d;if(0!=n){var I=m*Math.cos(2*h*Math.PI/t)/d;P+=n*I*s,D+=n*I*l}0==h?u(P,D):g(P,D)}},drawDecTicks:function(e,t,r,n,i,o,a,s,l,u){var g=EJSS_SVGGRAPHICS.Utils,c=e-r,S=e+r,d=t+n,f=t-n,E=g.crispValue(S),p=g.crispValue(f);if(s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var h=p-a;h>=d-.5;h-=o)u(e,h,i,s);else for(var h=c+a;h<=E+.5;h+=o)u(h,t,i,s);
},drawDecTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c,S,d,f,E){var p=EJSS_SVGGRAPHICS.Utils,h=e-r,m=e+r,A=t+n,y=t-n,v=p.crispValue(m),P=p.crispValue(y);if(d==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var D=0,I=P-a;I>=A-.5;I-=o,D++){if(f)var _=s[1]-g-u*D;else var _=s[0]+g+u*D;var C=parseFloat(_.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){var R=i/2;E(mGroup,e+R,I,C,c,!1)}else{var R=C.length*Math.floor(c.getFontSize()/2);R+=C.length*c.getNumberLetterSpacing(),R+=Math.floor(i/2),E(e-R,I,C,c,!1)}}else for(var D=0,I=h+a;I<=v+.5;I+=o,D++){var _=s[0]+g+u*D,C=parseFloat(_.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){var T=Math.floor(i/2)+2;E(I,t-i,C,c,!0)}else{var T=c.getFontSize()+Math.floor(i/2);E(I,t+T,C,c,!0)}}},drawLogTicks:function(e,t,r,n,i,o,a,s,l,u){var g=EJSS_SVGGRAPHICS.Utils,c=e-r,S=t-n,d=g.crispValue(S);if(l==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var f=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10),p=E-f,h=Math.ceil(p),m=i/p,A=0;A<=h;A++)for(var y=Math.pow(10,A+f),v=Math.pow(10,A+f+1),P=v/s,D=0;D<s-1;D++){var I=y+D*P;if(0!=I&&I>=a[0]&&I<=a[1]){var _=Math.log(I)/Math.log(10),C=d-(_-f)*m;u(e,C,o,l)}}else for(var f=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10),p=E-f,h=Math.ceil(p),m=i/p,A=0;A<=h;A++)for(var y=Math.pow(10,A+f),v=Math.pow(10,A+f+1),P=v/s,D=0;D<s-1;D++){var I=y+D*P;if(0!=I&&I>=a[0]&&I<=a[1]){var _=Math.log(I)/Math.log(10),C=c+(_-f)*m;u(C,t,o,l)}}},drawLogTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c){var S=EJSS_SVGGRAPHICS.Utils,d=e-r,f=t-n,E=S.crispValue(f);if(g==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var p=Math.log(a[0])/Math.log(10),h=Math.log(a[1])/Math.log(10),m=h-p,A=Math.ceil(m),y=segsize/m,v=0;v<=A;v++)for(var P=Math.pow(10,v+p),D=Math.pow(10,v+p+1),I=D/i,_=0;_<i-1;_++){var C=P+_*I;if(0!=C&&C>=a[0]&&C<=a[1]){var R=Math.log(C)/Math.log(10),T=E-(R-p)*y;if(0==_)var N=C.toExponential(s);else var N=parseFloat((C/P).toFixed(s)).toFixed(s);if(u==EJSS_DRAWING2D.Axis.TICKS_DOWN){var O=o/2;c(e+O,T,N,l,!1)}else{var O=N.length*Math.floor(l.getFontSize()/2);O+=N.length*l.getNumberLetterSpacing(),O+=Math.floor(o/2),c(e-O,T,N,l,!1)}}}else for(var p=Math.log(a[0])/Math.log(10),h=Math.log(a[1])/Math.log(10),m=h-p,A=Math.ceil(m),y=segsize/m,v=0;v<=A;v++)for(var P=Math.pow(10,v+p),D=Math.pow(10,v+p+1),I=D/i,_=0;_<i-1;_++){var C=P+_*I;if(0!=C&&C>=a[0]&&C<=a[1]){var R=Math.log(C)/Math.log(10),T=d+(R-p)*y;if(0==_)var N=C.toExponential(s);else var N=parseFloat((C/P).toFixed(s)).toFixed(s);if(u==EJSS_DRAWING2D.Axis.TICKS_DOWN){var M=Math.floor(o/2)+2;c(T,t-o,N,l,!0)}else{var M=l.getFontSize()+Math.floor(o/2);c(T,t+M,N,l,!0)}}}},drawDecGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),d=u.crispValue(n);if(a==-1){0==o&&(o=Math.abs(S-d));for(var f=d-i;f>=t-.5;f-=o)s(e,f),l(r,f)}else{0==o&&(o=Math.abs(c-g));for(var f=e+i;f<=c+.5;f+=o)s(f,t),l(f,n)}},drawLogGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),d=u.crispValue(n),f="",E=Math.log(o[0])/Math.log(10),p=Math.log(o[1])/Math.log(10),h=p-E,m=Math.ceil(h);if(a==-1)var A=(d-S)/h;else var A=(c-g)/h;for(var y=0;y<=m;y++)for(var v=Math.pow(10,y+E),P=Math.pow(10,y+E+1),D=P/i,I=0;I<i-1;I++){var _=v+I*D;if(0!=_&&_>=o[0]&&_<=o[1]){var C=Math.log(_)/Math.log(10);if(a==-1){var R=d-(C-E)*A;s(g,R),l(c,R)}else{var R=g+(C-E)*A;s(R,S),l(R,d)}}}return f},buildCells:function(e,t,r,n,i){var o,a,s,l;if(null!=r&&r.length>0){var u=r.length;o=new Array(u),a=new Array(u),s=new Array(u),l=new Array(u);var g=1;null!=n&&(g=i?n[0][0].length:n[0].length);for(var c=0;c<u;c++){var S=r[c],d=S.length;o[c]=new Array(d),a[c]=new Array(d);for(var f=0;f<d;f++){var E=S[f];o[c][f]=e[E],a[c][f]=t[E]}if(null!=n)if(s[c]=new Array(d),l[c]=new Array(d),i)for(var p=n[c],f=0;f<d;f++){s[c][f]=g<=1?p[f][0]:EJSS_TOOLS.Mathematics.norm(p[f]),l[c][f]=new Array(g);for(var h=0;h<g;h++)l[c][f][h]=p[f][h]}else for(var f=0;f<d;f++){var E=S[f];s[c][f]=g<=1?n[E][0]:EJSS_TOOLS.Mathematics.norm(n[E]),l[c][f]=new Array(g);for(var h=0;h<g;h++)l[c][f][h]=n[E][h]}}}return{cellA:o,cellB:a,cellZ:s,cellVector:l}},drawPolygons:function(e,t,r,n){for(var i=e.cellA,o=e.cellB,a=e.cellZ,s=0,l=i.length;s<l;s++){var u=i[s],g=o[s],c=a[s];if("undefined"!=typeof c){for(var S=u.length,d=new Array(S),f=Number.MAX_VALUE,E=Number.MIN_VALUE,p=0;p<S;p++){var h=t.doubleToIndex(c[p]);f=Math.min(h,f),E=Math.max(h,E),d[p]=h}for(var m=t.getColorThresholds(),A=new Array(2*S),y=new Array(2*S),v=f;v<=E;v++){for(var P=0,D=0;D<S;D++){var I=(D+1)%S;if(d[D]<=v&&d[I]>=v){if(d[D]==v)A[P]=u[D],y[P]=g[D],P++;else{var _=(m[v]-c[D])/(c[I]-c[D]);A[P]=Math.round(u[D]+_*(u[I]-u[D])),y[P]=Math.round(g[D]+_*(g[I]-g[D])),P++}if(d[I]>v){var _=(m[v+1]-c[D])/(c[I]-c[D]);A[P]=Math.round(u[D]+_*(u[I]-u[D])),y[P]=Math.round(g[D]+_*(g[I]-g[D])),P++}}else if(d[D]>=v&&d[I]<=v){if(d[D]==v)A[P]=u[D],y[P]=g[D],P++;else{var _=(m[v+1]-c[D])/(c[I]-c[D]);A[P]=Math.round(u[D]+_*(u[I]-u[D])),y[P]=Math.round(g[D]+_*(g[I]-g[D])),P++}if(d[I]<v){var _=(m[v]-c[D])/(c[I]-c[D]);A[P]=Math.round(u[D]+_*(u[I]-u[D])),y[P]=Math.round(g[D]+_*(g[I]-g[D])),P++}}}P>0&&n(A,y,P,t,v)}}r(u,g)}},buildBoundary:function(e,t,r){var n,i;if(null!=r&&r.length>0){var o=r.length;n=new Array(o),i=new Array(o);for(var a=0;a<o;a++){var s=r[a],l=s.length;n[a]=new Array(l),i[a]=new Array(l);for(var u=0;u<l;u++){var g=s[u];n[a][u]=e[g],i[a][u]=t[g]}}}return{boundaryA:n,boundaryB:i}},drawBoundary:function(e,t,r,n){for(var i=e.boundaryA,o=e.boundaryB,a="black",s=0,l=i.length;s<l;s++){if(null!=t){var u=t[s];null!=r&&u<r.length&&(a=r[u])}n(i[s],o[s],a)}}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.analyticCurve=function(e,t){function r(e,t,r,n,i){for(var o="",a=0;a<e.length;a++){var s=e[a],l=t+s[0]*n,u=r+s[1]*i,g=s[2];o+=0==a||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),n.appendChild(o));var a,s,l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=u[0]/2,f=u[1]/2,E=t.getNumPoints(),p=t.getMinimun(),h=t.getMaximun(),m="undefined"==typeof p||null===p?t.getPanel().getRealWorldXMin():p,A="undefined"==typeof h||null===h?t.getPanel().getRealWorldXMax():h,y=t.getVariable(),v=t.getFunctionX(),P=t.getFunctionY(),D=EJSS_DRAWING2D.functionsParser(),I=!1;try{a=D.parse(v)}catch(e){console.log("Analytic curve error parsing FunctionX: "+v),I=!0}if(!I)try{s=D.parse(P)}catch(e){console.log("Analytic curve error parsing FunctionY: "+P),I=!0}if(I)return void t.getController().invokeAction("OnError");var _=(A-m)/(E-1),C=[],R={},T=t.getParameters();for(var N in T)R[N]=T[N];try{for(var O=0,M=m;M<=A;M+=_){R[y]=M;var b=a.evaluate(R),G=s.evaluate(R);isNaN(b)||isNaN(G)||(C[O]=[],C[O][0]=b,C[O++][1]=G)}}catch(e){t.getController().invokeAction("OnError")}var x=r(C,c-d,S-f,u[0],u[1]);if(""!==x){o.setAttribute("d",x);var L=t.getStyle();L.getDrawFill()?o.setAttribute("fill",L.getFillColor()):o.setAttribute("fill","none"),L.getDrawLines()?(o.setAttribute("stroke",L.getLineColor()),o.setAttribute("stroke-width",L.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",L.getShapeRendering());var J=L.getAttributes();for(var w in J)o.setAttribute(w,J[w])}return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.arrow=function(e,t){function r(t,r,n,i,a,s,l,u,g,c){var S,d,f=e.getElementById(t);null===f?(f=document.createElementNS("http://www.w3.org/2000/svg","marker"),f.setAttribute("id",t),S=document.createElementNS("http://www.w3.org/2000/svg","path"),S.setAttribute("id",t+".markpath"),f.appendChild(S),d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("id",t+".markpath2"),f.appendChild(d),e.getElementsByTagName("defs")[0].appendChild(f)):(S=e.getElementById(t+".markpath"),d=e.getElementById(t+".markpath2"),e.getElementsByTagName("defs")[0].insertBefore(f,f));var E=i+2*s,p=a+2*s;switch(f.setAttribute("viewBox",-s+" "+-s+" "+E+" "+p),f.setAttribute("refX",i/2),f.setAttribute("refY",a/2),f.setAttribute("markerUnits","userSpaceOnUse"),f.setAttribute("markerWidth",E),f.setAttribute("markerHeight",p),f.setAttribute("orient",n),S.setAttribute("fill",l),S.setAttribute("stroke",l),S.setAttribute("stroke-width",s),S.setAttribute("style","  marker-start :none;   marker-end :none; "),d.setAttribute("fill",u),d.setAttribute("stroke",u),d.setAttribute("stroke-width",s),d.setAttribute("style","  marker-start :none;   marker-end :none; "),r){case o.TRIANGLE:var h="M 0 0 L "+i+" "+a/2+" L 0 "+a+" z";S.setAttribute("d",h);break;case o.INVTRIANGLE:var h="M "+i+" 0 L 0 "+a/2+" L "+i+" "+a+" z";S.setAttribute("d",h);break;case o.ANGLE:f.setAttribute("markerHeight",a),f.setAttribute("refX",i);var m=-(s-1),A=a+(s-1),h="M 0 "+m+" L "+i+" "+a/2+" L 0 "+A;S.setAttribute("d",h),S.setAttribute("fill","none");break;case o.INVANGLE:f.setAttribute("markerHeight",a),f.setAttribute("refX",1);var m=-(s-1),A=a+(s-1),h="M "+i+" "+m+" L 0 "+a/2+" L "+i+" "+A;S.setAttribute("d",h),S.setAttribute("fill","none");break;case o.LINE:var h="M "+i/2+" 0 L "+i/2+" "+a+" z";S.setAttribute("d",h);break;case o.RECTANGLE:var h="M 0 0 L "+i+" 0 L "+i+" "+a+" L 0 "+a+" z";S.setAttribute("d",h);break;case o.DIAMOND:var h="M "+i/2+" 0 L "+i+" "+a/2+" L "+i/2+" "+a+" L 0 "+a/2+" z";S.setAttribute("d",h);break;case o.CIRCLE:var y=i<a?i:a;y/=2;var h="M "+i/2+" "+a/2+" m "+-y+", 0 a "+y+","+y+" 0 1,0 "+2*y+",0 a "+y+","+y+" 0 1,0 "+2*-y+",0";S.setAttribute("d",h);break;case o.WEDGE:S.setAttribute("stroke-width",0),d.setAttribute("stroke-width",.5);var v="undefined"==typeof c||0===c?0:Math.atan(g/c),y=i<a?i:a;y/=2;var P=i/2,D=a/2,I=P+y*Math.cos(v),_=D-y*Math.sin(v),C=P+y*Math.cos(Math.PI/3.25-v),R=D+y*Math.sin(Math.PI/3.25-v),T=" M "+P+" "+D+" L "+I+","+_+" A "+y+","+y+" 0 0,1 "+C+","+R,N="M "+P+" "+D+" m "+-y+", 0 a "+y+","+y+" 0 1,0 "+2*y+",0 a "+y+","+y+" 0 1,0 "+2*-y+",0 ";S.setAttribute("d",N),d.setAttribute("d",T);break;case o.POINTED:f.setAttribute("refX",i),S.setAttribute("stroke-width",0);var h="M 0 0 L "+i+" "+a/2+" L 0 "+a+" L "+i/2+" "+a/2+" L 0 0 z";S.setAttribute("d",h);break;case o.CURVE:f.setAttribute("refX",i),S.setAttribute("stroke-width",0);var O=3*i,M=a/2.5,h="M 0 0  A "+O+","+O+" 1 0,0 "+i+","+a/2+" A "+O+","+O+" 1 0,0  0,"+a+" A "+M+","+M+" 1 0,0  0,"+a/2+" A "+M+","+M+" 1 0,0  0,0 z";S.setAttribute("d",h)}}var n,i=EJSS_SVGGRAPHICS.Utils,o=EJSS_DRAWING2D.Arrow,a=t.getGroup();n=null!==a?e.getElementById(a.getName()):e;var s=e.getElementById(t.getName());null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),n.appendChild(s));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=u[0]/2,f=u[1]/2;if(0!=u[0]||0!=u[1]){if(t.getMarkEnd()!=o.NONE){var E=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),p=0!=E&&E<t.getMarkEndWidth()?E:t.getMarkEndWidth(),h=0!=E&&E<t.getMarkEndHeight()?E:t.getMarkEndHeight(),m="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),A=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();r(t.getName()+".end",t.getMarkEnd(),t.getMarkEndOrient(),p,h,A,m),s.setAttribute("marker-end","url(#"+t.getName()+".end)")}else s.removeAttribute("marker-end");if(t.getMarkMiddle()!=o.NONE){var y=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),v=0!=y&&y<t.getMarkMiddleWidth()?y:t.getMarkMiddleWidth(),P=0!=y&&y<t.getMarkMiddleHeight()?y:t.getMarkMiddleHeight(),m="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),D="none"==t.getMarkMiddleColorSnd()?t.getStyle().getLineColor():t.getMarkMiddleColorSnd(),A=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();r(t.getName()+".mid",t.getMarkMiddle(),t.getMarkMiddleOrient(),v,P,A,m,D,u[0],u[1]),s.setAttribute("marker-mid","url(#"+t.getName()+".mid)")}else s.removeAttribute("marker-mid");if(t.getMarkStart()!=o.NONE){var I=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),_=0!=I&&I<t.getMarkStartWidth()?I:t.getMarkStartWidth(),C=0!=I&&I<t.getMarkStartHeight()?I:t.getMarkStartHeight(),m="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),A=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();r(t.getName()+".start",t.getMarkStart(),t.getMarkStartOrient(),_,C,A,m),s.setAttribute("marker-start","url(#"+t.getName()+".start)")}else s.removeAttribute("marker-start")}else s.removeAttribute("marker-end"),s.removeAttribute("marker-mid"),s.removeAttribute("marker-start");var R=t.getStyle();"crispEdges"==R.getShapeRendering()?t.getMarkMiddle()!=o.NONE?s.setAttribute("d","M "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c)+" "+i.crispValue(S)+" L "+i.crispValue(c+d)+" "+i.crispValue(S+f)):s.setAttribute("d","M "+i.crispValue(c-d)+" "+i.crispValue(S-f)+" L "+i.crispValue(c+d)+" "+i.crispValue(S+f)):t.getMarkMiddle()!=o.NONE?s.setAttribute("d","M "+(c-d)+" "+(S-f)+" L "+c+" "+S+" L "+(c+d)+" "+(S+f)):s.setAttribute("d","M "+(c-d)+" "+(S-f)+" L "+(c+d)+" "+(S+f)),R.getDrawFill()?s.setAttribute("fill",R.getFillColor()):s.setAttribute("fill","none"),R.getDrawLines()?(s.setAttribute("stroke",R.getLineColor()),s.setAttribute("stroke-width",R.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",R.getShapeRendering());var T=R.getAttributes();for(var N in T)s.setAttribute(N,T[N]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.axis=function(e,t){function r(e,t,r,n,i,o,s,l){var u=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(u),s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(l&&(i=-i,r=-r),"crispEdges"==o.getShapeRendering()?u.setAttribute("d","M "+a.crispValue(t)+" "+a.crispValue(r-.5-i)+" L "+a.crispValue(t)+" "+a.crispValue(r-.5+i)):u.setAttribute("d","M "+t+" "+(r-i)+" L "+t+" "+(r+i))):"crispEdges"==o.getShapeRendering()?u.setAttribute("d","M "+a.crispValue(t+.5-n)+" "+a.crispValue(r)+" L "+a.crispValue(t+.5+n)+" "+a.crispValue(r)):u.setAttribute("d","M "+(t-n)+" "+r+" L "+(t+n)+" "+r)}function n(e,t,r,n,i,o){if(o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==i.getShapeRendering()?s.setAttribute("d","M "+a.crispValue(t-n/2)+" "+a.crispValue(r)+" L "+a.crispValue(t+n/2)+" "+a.crispValue(r)):s.setAttribute("d","M "+(t-n/2)+" "+r+" L "+(t+n/2)+" "+r)}else{var s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==i.getShapeRendering()?s.setAttribute("d","M "+a.crispValue(t)+" "+a.crispValue(r-n/2)+" L "+a.crispValue(t)+" "+a.crispValue(r+n/2)):s.setAttribute("d","M "+t+" "+(r-n/2)+" L "+t+" "+(r+n/2))}}function i(e,t,r,n,i,o){var a=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(a);var s=document.createElementNS("http://www.w3.org/2000/svg","text");a.appendChild(s),s.setAttribute("font-family",i.getFontFamily()),s.setAttribute("font-size",i.getFontSizeString()),s.setAttribute("fill",i.getFillColor()),s.setAttribute("stroke",i.getOutlineColor()),s.setAttribute("stroke-width",i.getFontWeight()),s.setAttribute("letterSpacing",i.getLetterSpacing()),s.textContent=n,o?t-=s.getComputedTextLength()/2+.5:r+=i.getFontSize()/2,s.setAttribute("x",t),s.setAttribute("y",r)}var o,a=EJSS_SVGGRAPHICS.Utils,s=t.getGroup();o=null!==s?e.getElementById(s.getName()):e;var l=e.getElementById(t.getName());if(null!==l&&o.removeChild(l),t.getShow()){l=document.createElementNS("http://www.w3.org/2000/svg","g"),l.setAttribute("id",t.getName()),o.appendChild(l);var u=t.getPixelPosition(),g=t.getPixelSizes(),c=t.getRelativePositionOffset(g),S=u[0]+c[0],d=u[1]+c[1],f=g[0]/2,E=g[1]/2,p=t.getStyle(),h=t.getOrient(),m=t.getInvertedScaleY();r(l,S,d,f,E,p,h,m);var A=h==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(g[1]):Math.abs(g[0]),y=t.getTicksMode();if(y==EJSS_DRAWING2D.Axis.SCALE_LOG){var v=t.getScale();if(v[0]>0&&v[1]>0){var P=t.getTicks(),D=t.getScalePrecision(),I=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawLogTicks(S,d,f,E,A,I,v,P,h,function(e,t,r,i){n(l,e,t,r,p,i)});var _=t.getFont(),C=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawLogTicksText(S,d,f,E,P,I,v,D,_,C,h,function(e,t,r,n,o){i(l,e,t,r,n,o)})}}else if(y==EJSS_DRAWING2D.Axis.SCALE_NUM){var R=0,T=0;if(t.getAutoTicks())for(var N=t.getAutoStepMin(),O=t.getAutoTicksRange(),M=O.length-1;M>=0&&(R=Math.abs(A/O[M]),!(1.001*R>=N));M--);else{var P=t.getTicks();0!=P?R=A/P:(R=t.getStep(),T=t.getTickStep())}var D=t.getScalePrecision(),v=t.getScale();if(0==T)var b=Math.abs((v[1]-v[0])*R/A);else{var b=T;R=Math.abs(b*A/(v[1]-v[0]))}var G=Math.pow(10,D),x=Math.round(b*G)/G;x>0&&(b=x,R=Math.abs(x*A/(v[1]-v[0])));var L=t.getFixedTick(),J=v[1];isNaN(L)||(J=L<v[0]?L+(Math.floor((v[0]-L)/b)+1)*b:L>v[1]?L-(Math.floor((L-v[1])/b)+1)*b:L);var w=Math.abs((v[0]-J)%b),W=Math.abs(w-b);(w<.001||W<.001)&&(w=0);var k=A*w/Math.abs(v[1]-v[0]),I=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawDecTicks(S,d,f,E,I,R,k,h,m,function(e,t,r,i){n(l,e,t,r,p,i)});var _=t.getFont(),C=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawDecTicksText(S,d,f,E,I,R,k,v,D,b,w,_,C,h,m,function(e,t,r,n,o){i(l,e,t,r,n,o)})}p.getDrawFill()?l.setAttribute("fill",p.getFillColor()):l.setAttribute("fill","none"),p.getDrawLines()?(l.setAttribute("stroke",p.getLineColor()),l.setAttribute("stroke-width",p.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",p.getShapeRendering());var F=p.getAttributes();for(var V in F)l.setAttribute(V,F[V])}return l};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.byteRaster=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());if(null==o?(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o),i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("id",t.getName()+".img"),o.appendChild(i)):i=e.getElementById(t.getName()+".img"),t.getDataChanged()){var a=t.getData(),s=t.getColorMapper().getColors(),l=a.length;if(l>0){var u=a[0].length,g=t.getColorMapper().getNumberOfColors();EJSS_SVGGRAPHICS.Utils.PNGCanvas(l,u,g,a,s,function(e){i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e)})}t.setDataChanged(!1)}var c=t.getPixelPosition(),S=t.getPixelSizes(),d=t.getRelativePositionOffset(S),f=c[0]+d[0],E=c[1]+d[1],p=Math.abs(S[0]/2),h=Math.abs(S[1]/2);i.setAttribute("x",f-p),i.setAttribute("y",E-h),i.setAttribute("width",Math.abs(S[0])),i.setAttribute("height",Math.abs(S[1]));var m=t.getStyle(),A=m.getAttributes();for(var y in A)i.setAttribute(y,A[y]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cellLattice=function(e,t){function r(e,t,r,n,i,o){var a="",l=s.crispValue(e),u=s.crispValue(r),g=s.crispValue(t),c=s.crispValue(n);0==i&&(i=Math.abs(r-e));for(var S=e;S<=Math.max(r,u)+.5;S+=i)a+=" M "+s.crispValue(S)+" "+g+" L "+s.crispValue(S)+" "+c;0==o&&(o=Math.abs(t-n));for(var S=n;S>=Math.min(t,g)-.5;S-=o)a+=" M "+l+" "+s.crispValue(S)+" L "+u+" "+s.crispValue(S);return a}function n(e,t,r,n,i,o){var a="";0==i&&(i=Math.abs(r-e));for(var s=e;s<=r;s+=i)a+=" M "+s+" "+t+" L "+s+" "+n;0==o&&(o=Math.abs(t-n));for(var s=n;s>=t;s-=o)a+=" M "+e+" "+s+" L "+r+" "+s;return a}function i(e,t,r,n,i,o,a){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);var u=n/2,g=i/2;"crispEdges"==o?l.setAttribute("d","M "+s.crispValue(t-u)+" "+s.crispValue(r+g)+" L "+s.crispValue(t+u)+" "+s.crispValue(r+g)+" L "+s.crispValue(t+u)+" "+s.crispValue(r-g)+" L "+s.crispValue(t-u)+" "+s.crispValue(r-g)+" z"):l.setAttribute("d","M "+(t-u)+" "+(r+g)+" L "+(t+u)+" "+(r+g)+" L "+(t+u)+" "+(r-g)+" L "+(t-u)+" "+(r-g)+" z"),l.setAttribute("fill",a),l.setAttribute("stroke",a)}function o(e,t,i,o,a,s,l,u){var g=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(g);var c=o/2,S=a/2,d=t-c,f=t+c,E=i+S,p=i-S;"crispEdges"==u.getShapeRendering()?g.setAttribute("d",r(d,E,f,p,s,l)):g.setAttribute("d",n(d,E,f,p,s,l)),u.getDrawLines()?(g.setAttribute("stroke",u.getLineColor()),g.setAttribute("stroke-width",u.getLineWidth())):(g.setAttribute("stroke","none"),g.setAttribute("stroke-width",0));var h=u.getAttributes();for(var m in h)g.setAttribute(m,h[m])}var a,s=EJSS_SVGGRAPHICS.Utils,l=t.getGroup();a=null!==l?e.getElementById(l.getName()):e;var u=e.getElementById(t.getName());null!==u&&a.removeChild(u),u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",t.getName()),a.appendChild(u);for(var g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=c[0]/2,p=c[1]/2,h=t.getStyle(),m=t.getData(),A=t.getColorMapper().getColors(),y=m.length,v=m[0].length,P=Math.abs(c[0]/y),D=Math.abs(c[1]/v),I=d-E+P/2,_=f-p-D/2,C=0;C<v;C++)for(var R=0;R<y;R++)i(u,I+P*R,_-D*C,P,D,h.getShapeRendering(),A[m[R][C]]);var T=t.getShowGrid();return T&&o(u,d,f,c[0],c[1],P,D,h),u};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cursor=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,a=e.getElementById(t.getName());null===a?(a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("id",t.getName()),r.appendChild(a),i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",t.getName()+".line1"),a.appendChild(i),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".line2"),a.appendChild(o)):(i=e.getElementById(t.getName()+".line1"),o=e.getElementById(t.getName()+".line2"));var s=t.getPixelPosition(),l=t.getCursorType(),u=t.getGroupPanel(),g=u.getRealWorldCoordinates(),c=u.toPixelPosition([g[0],g[2]]),S=u.toPixelPosition([g[1],g[3]]),d=t.getStyle();if(i.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.VERTICAL){var f=c[0],E=S[0],p=s[1];p>c[1]?p=c[1]:p<S[1]&&(p=S[1]),"crispEdges"==d.getShapeRendering()?i.setAttribute("d","M "+UTILS.crispValue(f)+" "+UTILS.crispValue(p)+" L "+UTILS.crispValue(E)+" "+UTILS.crispValue(p)):i.setAttribute("d","M "+f+" "+p+" L "+E+" "+p),i.setAttribute("stroke-width",d.getLineWidth())}if(o.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var h=s[0],m=c[1],A=S[1];h<c[0]?h=c[0]:h>S[0]&&(h=S[0]),"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+UTILS.crispValue(h)+" "+UTILS.crispValue(m)+" L "+UTILS.crispValue(h)+" "+UTILS.crispValue(A)):o.setAttribute("d","M "+h+" "+m+" L "+h+" "+A),o.setAttribute("stroke-width",d.getLineWidth())}d.getDrawFill()?a.setAttribute("fill",d.getFillColor()):a.setAttribute("fill","none"),a.setAttribute("stroke",d.getLineColor()),a.setAttribute("shapeRendering",d.getShapeRendering());var y=d.getAttributes();for(var v in y)a.setAttribute(v,y[v]);return a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.ellipse=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2);i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",g),i.setAttribute("ry",c);var S=t.getStyle();S.getDrawFill()?i.setAttribute("fill",S.getFillColor()):i.setAttribute("fill","none"),S.getDrawLines()?(i.setAttribute("stroke",S.getLineColor()),i.setAttribute("stroke-width",S.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",S.getShapeRendering());var d=S.getAttributes();for(var f in d)i.setAttribute(f,d[f]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.grid=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null!==i&&r.removeChild(i),i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),r.appendChild(i);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("id",t.getName()+"X"),i.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("id",t.getName()+"Y"),i.appendChild(a);var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,d=l[1]/2,f=t.getShowX(),E=t.getShowY(),p="",h="";if(f){var m=t.getTicksXMode();if(m==EJSS_DRAWING2D.Grid.SCALE_LOG){var A=t.getScaleX();if(A[0]>0&&A[1]>0){var y=t.getTicksX(),v=g-S,P=g+S,D=c+d,I=c-d;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(v,D,P,I,y,A,1,function(e,t){p+=" M "+e+" "+t},function(e,t){p+=" L "+e+" "+t})}}else if(m==EJSS_DRAWING2D.Grid.SCALE_NUM){var _=0,C=0;if(t.getAutoTicksX())for(var R=t.getAutoStepXMin(),T=t.getAutoTicksRangeX(),N=T.length-1;N>=0&&(_=Math.abs(l[0]/T[N]),!(_>=R));N--);else{var y=t.getTicksX();0!=y?_=Math.abs(l[0]/y):(_=t.getStepX(),C=t.getTickStepX())}var O=t.getScalePrecisionX(),A=t.getScaleX();if(0==C)var M=Math.abs((A[1]-A[0])*_/l[0]);else{var M=C;_=Math.abs(M*l[0]/(A[1]-A[0]))}var b=Math.pow(10,O),G=Math.round(M*b)/b;G>0&&(M=G,_=Math.abs(G*l[0]/(A[1]-A[0])));var x=t.getFixedTickX(),L=A[1];isNaN(x)||(L=x<A[0]?x+(Math.floor((A[0]-x)/M)+1)*M:x>A[1]?x-(Math.floor((x-A[1])/M)+1)*M:x);var J=Math.abs((A[0]-L)%M),w=Math.abs(J-M);(J<.001||w<.001)&&(J=0);var W=Math.abs(l[0]*J/(A[1]-A[0])),v=g-S,P=g+S,D=c+d,I=c-d;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(v,D,P,I,W,_,1,function(e,t){p+=" M "+e+" "+t},function(e,t){p+=" L "+e+" "+t})}}if(E){var k=t.getTicksYMode();if(k==EJSS_DRAWING2D.Grid.SCALE_LOG){var F=t.getScaleY();if(F[0]>0&&F[1]>0){var V=t.getTicksY(),v=g-S,P=g+S,D=c+d,I=c-d;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(v,D,P,I,V,F,-1,function(e,t){h+=" M "+e+" "+t},function(e,t){h+=" L "+e+" "+t})}}else if(k==EJSS_DRAWING2D.Grid.SCALE_NUM){var B=0,H=0;if(t.getAutoTicksY())for(var z=t.getAutoStepYMin(),Y=t.getAutoTicksRangeY(),N=Y.length-1;N>=0&&(B=Math.abs(l[1]/Y[N]),!(B>=z));N--);else{var V=t.getTicksY();0!=V?B=Math.abs(l[1]/V):(B=t.getStepY(),H=t.getTickStepY())}var U=t.getScalePrecisionY(),F=t.getScaleY();if(0==H)var X=Math.abs((F[1]-F[0])*B/l[1]);else{var X=H;B=Math.abs(X*l[1]/(F[1]-F[0]))}var Z=Math.pow(10,U),j=Math.round(X*Z)/Z;j>0&&(X=j,B=Math.abs(j*l[1]/(F[1]-F[0])));var x=t.getFixedTickY(),L=F[1];isNaN(x)||(L=x<F[0]?x+(Math.floor((F[0]-x)/X)+1)*X:x>F[1]?x-(Math.floor((x-F[1])/X)+1)*X:x);var J=Math.abs((F[0]-L)%X),w=Math.abs(J-X);(J<.001||w<.001)&&(J=0);var q=Math.abs(l[1]*J/(F[1]-F[0])),v=g-S,P=g+S,D=c+d,I=c-d;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(v,D,P,I,q,B,-1,function(e,t){h+=" M "+e+" "+t},function(e,t){h+=" L "+e+" "+t})}}p.length>0&&(o.setAttribute("d",p),o.setAttribute("shapeRendering",t.getShapeRenderingX()),o.setAttribute("stroke",t.getLineColorX()),o.setAttribute("stroke-width",t.getLineWidthX())),h.length>0&&(a.setAttribute("d",h),a.setAttribute("shapeRendering",t.getShapeRenderingY()),a.setAttribute("stroke",t.getLineColorY()),a.setAttribute("stroke-width",t.getLineWidthY()));var K=t.getStyle().getAttributes();for(var $ in K)o.setAttribute($,K[$]),a.setAttribute($,K[$]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.group=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());return null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),r.appendChild(i)),i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.histogram=function(e,t){function r(e,t,r,n,i,o){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+n+" L "+r+" "+n+" L "+r+" "+i+" z"),o.getDrawFill()?e.setAttribute("fill",o.getFillColor()):e.setAttribute("fill","none"),o.getDrawLines()?(e.setAttribute("stroke",o.getLineColor()),e.setAttribute("stroke-width",o.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",o.getShapeRendering())}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());if(null===o)o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),n.appendChild(o);else{var a=e.getElementById(t.getName()+".bars");o.removeChild(a)}var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("id",t.getName()+".bars"),o.appendChild(a);for(var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,d=l[1]/2,f=t.getStyle(),E=t.getDiscrete(),p=t.getBinWidth()/2,h=t.getBars(),m=t.getGroupPanel().getPixelPositionWorldOrigin()[1],A=0;A<h.length;A++){var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("id",t.getName()+".bar"+A),a.appendChild(y);var v,P,D=h[A][0];E?v=P=g-S+D*l[0]:(v=g-S+(D-p)*l[0],P=g-S+(D+p)*l[0]);var I=c-d+h[A][1]*l[1];r(y,v,P,I,m,f)}var _=f.getAttributes();for(var C in _)o.setAttribute(C,_[C]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.image=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2),S=i.getAttributeNS("http://www.w3.org/1999/xlink","href");if(!S||t.getChangedImage()){var d=t.getEncode();d.length>0?i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","data:png;base64,"+d):i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.getImageUrl()),t.setChangedImage(!1)}i.setAttribute("preserveAspectRatio","none"),i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(a[0])),i.setAttribute("height",Math.abs(a[1]));var f=t.getStyle();f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)i.setAttribute(p,E[p]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.mesh=function(e,t){function r(e,t,r,n,i,o){var a=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.appendChild(a);for(var s="",l=0;l<n;l++)s+=t[l]+","+r[l]+" ";s+=t[0]+","+r[0]+" ",a.setAttribute("points",s);var u=i.indexToColor(o);a.setAttribute("fill",u),a.setAttribute("stroke",u),a.setAttribute("stroke-width",1.25)}function n(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o);for(var a="",s=t.length-1,l=0;l<s;l++)a+=0==l?" M "+t[l]+" "+r[l]:" L "+t[l]+" "+r[l];a+=" L "+t[l]+" "+r[l]+" Z",o.setAttribute("d",a),n&&i.getDrawFill()?o.setAttribute("fill",i.getFillColor()):o.setAttribute("fill","none"),i.getDrawLines()?(o.setAttribute("stroke",i.getLineColor()),o.setAttribute("stroke-width",i.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",i.getShapeRendering())}function i(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o);for(var a="",s=t.length-1,l=0;l<s;l++)a+=0==l?" M "+t[l]+" "+r[l]:" L "+t[l]+" "+r[l];a+=" L "+t[l]+" "+r[l]+" Z",o.setAttribute("d",a),o.setAttribute("fill","none"),o.setAttribute("stroke",n),o.setAttribute("stroke-width",i+.5)}function o(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","g");
e.appendChild(o);for(var a=0;a<t.length;a++){var s=document.createElementNS("http://www.w3.org/2000/svg","g");o.appendChild(s);var l=document.createElementNS("http://www.w3.org/2000/svg","path");s.appendChild(l);var u=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.appendChild(u);var g=t[a],c=r[a],S=n[a][0],d=n[a][1],f=EJSS_TOOLS.Mathematics.norm([S,d]),E=S*i/f,p=d*i/f,h="M "+g+" "+c+" L "+(g+E)+" "+(c+p);if(l.setAttribute("d",h),0!=E||0!=p){var m,A=12,y=.3,f=EJSS_TOOLS.Mathematics.norm([E,p]);m=f*y,m>A&&(m=A);var v=g+E,P=c+p,D=v+","+P+" "+(v-m)+","+(P+m/3)+" "+(v-m)+","+(P-m/3);u.setAttribute("points",D);var I=Math.atan2(E,-p);I=180*I/Math.PI,u.setAttribute("transform","rotate("+(I-90)+" "+v+" "+P+")")}s.setAttribute("stroke","black"),s.setAttribute("stroke-width",.5)}}var a,s,l,u,g,c=t.getGroup();g=null!==c?e.getElementById(c.getName()):e;var S=document.createElementNS("http://www.w3.org/2000/svg","g");S.setAttribute("id",t.getName());var d=e.getElementById(t.getName());null!==d?d.parentNode.replaceChild(S,d):g.appendChild(S);var f=t.getPixelPosition(),E=t.getPixelSizes(),p=t.getRelativePositionOffset(E),h=f[0]+p[0],m=f[1]+p[1],A=E[0]/2,y=E[1]/2,v=t.getPoints();if(null!=v){var P=v.length;a=new Array(P),s=new Array(P);for(var D=0;D<P;D++)a[D]=h-A+v[D][0]*E[0],s[D]=m-y+v[D][1]*E[1];var I=t.getCells(),_=t.getFieldAtPoints();if(_?l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,I,_,!1):(_=t.getFieldAtCells(),l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,I,_,!0)),null!=I){var C=t.getStyle();if(null!=_){var R=t.getColorCoded();EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,R,function(e,t){n(S,e,t,!1,C)},function(e,t,n,i,o){r(S,e,t,n,i,o)})}else EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,R,function(e,t){n(S,e,t,!0,C)},function(e,t,r,n,i){})}var T=t.getBoundary();if(t.getDrawBoundary()&&null!=T){var N=t.getBoundaryLabels(),O=t.getBoundaryColors(),M=t.getBoundaryLineWidth();u=EJSS_GRAPHICS.GraphicsUtils.buildBoundary(a,s,T),EJSS_GRAPHICS.GraphicsUtils.drawBoundary(u,N,O,function(e,t,r){i(S,e,t,r,M)})}if(t.getDataType()>=4&&null!=_)for(var b=t.getVectorLength()*E[0],D=0,G=I.length;D<G;D++)o(S,mCellA[D],mCellB[D],_[D],b);var x=t.getStyle().getAttributes();for(var L in x)S.setAttribute(L,x[L]);return S}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.pipe=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o));var a=e.getElementById(t.getName()+":container");null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()+":container"),o.appendChild(a));var s=e.getElementById(t.getName()+":liquid");null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+":liquid"),o.appendChild(s));var l=t.getPoints();if(l&&!(l.length<=0)){var u,g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),d=g[0]+S[0],f=g[1]+S[1],E=Math.abs(c[0]),p=Math.abs(c[1]),h=d-E/2,m=f+p/2,A=t.getStyle(),y="crispEdges"==A.getShapeRendering(),v="",P="";u=y?"M "+n.crispValue(h)+" "+n.crispValue(m):"M "+h+" "+m,v=u,P=u;for(var D=0,I=l.length;D<I;D++){var _=l[D],d=Math.round(_[0]*E),f=Math.round(-_[1]*p);u=y?" l "+n.crispValue(d)+" "+n.crispValue(f):" l "+d+" "+f,v+=u,P+=u}a.setAttribute("d",v),s.setAttribute("d",P),A.getDrawFill()?(s.setAttribute("stroke",A.getFillColor()),s.setAttribute("stroke-width",t.getPipeWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("fill","none"),s.setAttribute("shapeRendering",A.getShapeRendering()),A.getDrawLines()?(a.setAttribute("stroke",A.getLineColor()),a.setAttribute("stroke-width",2*A.getLineWidth()+t.getPipeWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("fill","none"),a.setAttribute("shapeRendering",A.getShapeRendering());var C=A.getAttributes();for(var R in C)s.setAttribute(R,C[R]),a.setAttribute(R,C[R]);return o}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.point=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1];i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",2),i.setAttribute("ry",2);var g=t.getStyle();i.setAttribute("fill",g.getFillColor());var c=g.getAttributes();for(var S in c)i.setAttribute(S,c[S]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.polygon=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","polygon"),i.setAttribute("id",t.getName()),r.appendChild(i));for(var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getPoints(),d="",f=0;f<S.length;f++){var E=S[f],p=l-g+E[0]*a[0],h=u-c+E[1]*a[1];d+=p+","+h+" "}if(""!==d){i.setAttribute("points",d);var m=t.getStyle();m.getDrawFill()?i.setAttribute("fill",m.getFillColor()):i.setAttribute("fill","none"),m.getDrawLines()?(i.setAttribute("stroke",m.getLineColor()),i.setAttribute("stroke-width",m.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",m.getShapeRendering());var A=m.getAttributes();for(var y in A)i.setAttribute(y,A[y])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.rectangle=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),r.appendChild(o));var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2,d=t.getStyle();"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" z"):o.setAttribute("d","M "+(u-c)+" "+(g+S)+" L "+(u+c)+" "+(g+S)+" L "+(u+c)+" "+(g-S)+" L "+(u-c)+" "+(g-S)+" z"),d.getDrawFill()?o.setAttribute("fill",d.getFillColor()):o.setAttribute("fill","none"),d.getDrawLines()?(o.setAttribute("stroke",d.getLineColor()),o.setAttribute("stroke-width",d.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)o.setAttribute(E,f[E]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.roundRectangle=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2),S=Math.abs(t.getCornerRadius());i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(a[0])),i.setAttribute("height",Math.abs(a[1])),i.setAttribute("rx",S),i.setAttribute("ry",S);var d=t.getStyle();d.getDrawFill()?i.setAttribute("fill",d.getFillColor()):i.setAttribute("fill","none"),d.getDrawLines()?(i.setAttribute("stroke",d.getLineColor()),i.setAttribute("stroke-width",d.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)i.setAttribute(E,f[E]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.segment=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()),r.appendChild(o));var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2,d=t.getStyle();"crispEdges"==d.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)):o.setAttribute("d","M "+(u-c)+" "+(g-S)+" L "+(u+c)+" "+(g+S)),d.getDrawFill()?o.setAttribute("fill",d.getFillColor()):o.setAttribute("fill","none"),d.getDrawLines()?(o.setAttribute("stroke",d.getLineColor()),o.setAttribute("stroke-width",d.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",d.getShapeRendering());var f=d.getAttributes();for(var E in f)o.setAttribute(E,f[E]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.spring=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0],d="";if(EJSS_GRAPHICS.GraphicsUtils.drawSpring(t.getLoops(),t.getPointsPerLoop(),S,t.getSolenoid(),t.getThinExtremes(),l-g,u-c,a[0],a[1],function(e,t){d+=" M "+e+" "+t},function(e,t){d+=" L "+e+" "+t}),""!==d){i.setAttribute("d",d);var f=t.getStyle();f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)i.setAttribute(p,E[p])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.tank=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","g"),o.setAttribute("id",t.getName()),r.appendChild(o));var a=e.getElementById(t.getName()+":container");null===a&&(a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()+":container"),o.appendChild(a));var s=e.getElementById(t.getName()+":liquid");null===s&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+":liquid"),o.appendChild(s));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],d=Math.abs(u[0]/2),f=Math.abs(u[1]/2),E=t.getPixelSizeOf(0,t.getLevel()),p=c-d,h=c+d,m=S+f,A=S-f,y=m+E[1],v=t.getStyle();"crispEdges"==v.getShapeRendering()?(s.setAttribute("d","M "+n.crispValue(xlevel)+" "+n.crispValue(y)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(xlevel)+" "+n.crispValue(y)+" Z"),v.getDrawFill()?a.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A)+" Z"):a.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A))):(s.setAttribute("d","M "+(p+E[0])+" "+y+" L "+p+" "+m+" L "+h+" "+m+" L "+(h+E[0])+" "+y+" Z"),v.getDrawFill()?a.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A+" Z"):a.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A)),s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0),s.setAttribute("fill",t.getLevelColor()),s.setAttribute("shapeRendering",v.getShapeRendering()),v.getDrawFill()?a.setAttribute("fill",v.getFillColor()):a.setAttribute("fill","none"),a.setAttribute("stroke",v.getLineColor()),a.setAttribute("stroke-width",v.getLineWidth()),a.setAttribute("shapeRendering",v.getShapeRendering());var P=v.getAttributes();for(var D in P)s.setAttribute(D,P[D]),a.setAttribute(D,P[D]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.text=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,a,s=e.getElementById(t.getName());null===s?(s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s),i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()+".inner"),s.appendChild(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",t.getName()+".box"),i.appendChild(a),o=document.createElementNS("http://www.w3.org/2000/svg","text"),o.setAttribute("id",t.getName()+".text"),i.appendChild(o)):(i=e.getElementById(t.getName()+".inner"),o=e.getElementById(t.getName()+".text"),a=e.getElementById(t.getName()+".box"));var l=t.getFont();o.setAttribute("font-style",l.getFontStyle()),o.setAttribute("font-weight",l.getFontWeight()),o.setAttribute("font-size",l.getFontSizeString()),o.setAttribute("font-family",l.getFontFamily()),o.setAttribute("fill",l.getFillColor()),o.setAttribute("stroke",l.getOutlineColor()),o.setAttribute("letterSpacing",l.getLetterSpacing()),o.textContent=t.getText();var u=t.getPixelPosition(),g=t.getFramed()?4:0,c=[1.15*o.getComputedTextLength()+2*g,l.getFontSize()+2*g],S=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),c[0],c[1]),d=t.getMarginX(),f=t.getMarginY(),E=u[0]+S[0]+d+g,p=u[1]+S[1]+f-g;if(o.setAttribute("x",E),o.setAttribute("y",p),t.getFramed()){var h=g,m=g,A=c[0]-2*g,y=c[1]-2*g;if(A>0){var v=p+h,P=p-y-h,D=E-m,I=E+A+h;a.setAttribute("d","M "+D+" "+v+" L "+I+" "+v+" L "+I+" "+P+" L "+D+" "+P+" z");var _=t.getStyle();_.getDrawFill()?a.setAttribute("fill",_.getFillColor()):a.setAttribute("fill","none"),_.getDrawLines()?(a.setAttribute("stroke",_.getLineColor()),a.setAttribute("stroke-width",_.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0));var C=_.getAttributes();for(var R in C)mShape.setAttribute(R,C[R])}else a.setAttribute("stroke","none"),a.setAttribute("fill","none")}var T=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:T=90;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:T=180;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:T=270;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:T=0}return i.setAttribute("transform","rotate("+T+" "+(u[0]+d)+" "+(u[1]+f)+")"),s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trace=function(e,t){function r(e,t,r,n,i){for(var o="",a=0;a<e.length;a++){var s=e[a],l=t+s[0]*n,u=r+s[1]*i,g=s[2];o+=0==a||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}function n(e,t,r,n,i){var o=t,a=r,s=Math.abs(n[0]/2),l=Math.abs(n[1]/2);e.setAttribute("cx",o),e.setAttribute("cy",a),e.setAttribute("rx",s),e.setAttribute("ry",l),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function i(e,t,r,n,i){var o=t,a=r,s=Math.abs(n[0]/2),l=Math.abs(n[1]/2);O.setAttribute("d","M "+(o-s)+" "+(a+l)+" L "+(o+s)+" "+(a+l)+" L "+(o+s)+" "+(a-l)+" L "+(o-s)+" "+(a-l)+" z"),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function o(e,t,r,n,i,o,a){O.setAttribute("d","M "+t+" "+o+" L "+t+" "+r+" L "+n+" "+i+" L "+n+" "+o+" z"),a.getDrawFill()?e.setAttribute("fill",a.getFillColor()):e.setAttribute("fill","none"),a.getDrawLines()?(e.setAttribute("stroke",a.getLineColor()),e.setAttribute("stroke-width",a.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",a.getShapeRendering())}var a,s=t.getGroup();a=null!==s?e.getElementById(s.getName()):e;var l,u=e.getElementById(t.getName());if(null===u)u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",t.getName()),a.appendChild(u),l=document.createElementNS("http://www.w3.org/2000/svg","path"),l.setAttribute("id",t.getName()+".trail"),u.appendChild(l);else{l=e.getElementById(t.getName()+".trail");var g=e.getElementById(t.getName()+".marks");u.removeChild(g)}var g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("id",t.getName()+".marks"),u.appendChild(g);var c=t.getPixelPosition(),S=t.getPixelSizes(),d=t.getRelativePositionOffset(S),f=c[0]+d[0],E=c[1]+d[1],p=S[0]/2,h=S[1]/2,m=r(t.getPoints(),f-p,E-h,S[0],S[1]);if(""!==m){l.setAttribute("d",m);var A=t.getStyle();A.getDrawFill()?l.setAttribute("fill",A.getFillColor()):l.setAttribute("fill","none"),A.getDrawLines()?(l.setAttribute("stroke",A.getLineColor()),l.setAttribute("stroke-width",A.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",A.getShapeRendering());for(var y,v,P=t.getPoints(),D=0;D<P.length;D++){var I=P[D],_=f-p+I[0]*S[0],C=E-h+I[1]*S[1],R=I[3],T=I[4],N=[I[5],I[6]];if(R==EJSS_DRAWING2D.Trace.ELLIPSE){var O=document.createElementNS("http://www.w3.org/2000/svg","ellipse");O.setAttribute("id",t.getName()+".mark"+D),g.appendChild(O),n(O,_,C,N,T)}else if(R==EJSS_DRAWING2D.Trace.RECTANGLE){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+D),g.appendChild(O),i(O,_,C,N,T)}else if(R==EJSS_DRAWING2D.Trace.BAR){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+D),g.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1];N[1]=M-C,C+=N[1]/2,i(O,_,C,N,T)}else if(R==EJSS_DRAWING2D.Trace.AREA){if(0!=D){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+D),g.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1],b=f-p+y*S[0],G=E-h+v*S[1];o(O,b,G,_,C,M,T)}y=I[0],v=I[1]}}var x=A.getAttributes();for(var L in x)u.setAttribute(L,x[L])}return u};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail=function(e,t){function r(e,t,r,n,i,o,a,s){if(!(r<=0)){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);for(var u="",g=0;g<r;g++){var c=t[g],S=i+c[0]*a,d=o+c[1]*s,f=c[2];u+=0==g||0==f?" M "+S+" "+d:" L "+S+" "+d}l.setAttribute("d",u),n.getDrawFill()?l.setAttribute("fill",n.getFillColor()):l.setAttribute("fill","none"),n.getDrawLines()?(l.setAttribute("stroke",n.getLineColor()),l.setAttribute("stroke-width",n.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",n.getShapeRendering());var E=n.getAttributes();for(var p in E)l.setAttribute(p,E[p])}}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=document.createElementNS("http://www.w3.org/2000/svg","g");n.appendChild(o);var a=e.getElementById(t.getName());null!==a&&(n.insertBefore(o,a),n.removeChild(a)),o.setAttribute("id",t.getName());var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,d=l[1]/2,f=g-S,E=c-d,p=l[0],h=l[1],m=t.getSegmentsCount();if(m>0)for(var A=0;A<m;A++){var y=t.getSegmentPoints(A).length;r(o,t.getSegmentPoints(A),y,t.getSegmentStyle(A),f,E,p,h)}var y=t.getCurrentPoints().length;return r(o,t.getCurrentPoints(),y,t.getStyle(),f,E,p,h),o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.Utils={},EJSS_SVGGRAPHICS.Utils.crispValue=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.crispTop=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.round=function(e){return+e.toFixed(4)},EJSS_SVGGRAPHICS.Utils.hsl2rgb=function(e){var t,r,n,i=e[0],o=e[1],a=e[2],s=(1-Math.abs(2*a-1))*o,l=i/60,u=s*(1-Math.abs(l%2-1));void 0===i||isNaN(i)||null===i?t=r=n=0:l>=0&&l<1?(t=s,r=u,n=0):l>=1&&l<2?(t=u,r=s,n=0):l>=2&&l<3?(t=0,r=s,n=u):l>=3&&l<4?(t=0,r=u,n=s):l>=4&&l<5?(t=u,r=0,n=s):l>=5&&l<6&&(t=s,r=0,n=u);var g,c,S,d=a-s/2;return g=255*(t+d),c=255*(r+d),S=255*(n+d),g=Math.round(g),c=Math.round(c),S=Math.round(S),{r:g,g:c,b:S}},EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker=function(e){function t(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function r(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function n(e,t,r,n,i,o,a){u=4*(t+r*e.width),e.data[u+0]=n,e.data[u+1]=i,e.data[u+2]=o,e.data[u+3]=a}for(var i=e.data.params.imageData,o=e.data.params.width,a=e.data.params.height,s=(e.data.params.depth,e.data.params.data),l=e.data.params.colors,u=e.data.id,g=l[0],c=l[l.length-1],S=0;S<o;S++)for(var d=0;d<a;d++){var u=s[S][a-d-1],f=u<0?g:u<l.length?l[u]:c;"undefined"==typeof f&&(f=g),"rgb"==f.substring(0,3)?rgb=t(f):"hsl"==f.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(r(f))),n(i,S,d,rgb.r,rgb.g,rgb.b,255)}self.postMessage({result:i,id:u})},EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker=function(e,t,r,n,i,o){function a(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function s(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function l(e,t,r,n,i,o,a){d=4*(t+r*e.width),e.data[d+0]=n,e.data[d+1]=i,e.data[d+2]=o,e.data[d+3]=a}for(var u=o[0],g=o[o.length-1],c=0;c<t;c++)for(var S=0;S<r;S++){var d=i[c][r-S-1],f=d<0?u:d<o.length?o[d]:g;"undefined"==typeof f&&(f=u),"rgb"==f.substring(0,3)?rgb=a(f):"hsl"==f.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(s(f))),l(e,c,S,rgb.r,rgb.g,rgb.b,255)}},EJSS_SVGGRAPHICS.Utils.PNGCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d"),l=s.createImageData(e,t);EJSS_TOOLS.Worker.runFunction?EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){s.putImageData(e.result,0,0),o(a.toDataURL())}):(EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker(l,e,t,r,n,i),s.putImageData(l,0,0),o(a.toDataURL()))},EJSS_SVGGRAPHICS.Utils.ImageDataCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d"),l=s.createImageData(e,t);EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){o(e)})};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.video=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?(o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),o.setAttribute("id",t.getName()),r.appendChild(o),i=document.createElement("video"),i.setAttribute("id",t.getName()+".video"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&t.getWebCam()?navigator.getUserMedia({video:!0},function(e){i.src=window.URL.createObjectURL(e)},function(e){}):i.src=t.getVideoUrl(),o.appendChild(i)):i=document.getElementById(t.getName()+".video");var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=Math.abs(s[0]/2),S=Math.abs(s[1]/2);i.loop=t.getLoop(),i.type=t.getType(),i.poster=t.getPoster(),i.autoplay=t.getAutoPlay(),i.controls=t.getControls(),!isNaN(i.duration)&&i.duration>=t.getCurrentTime()&&(i.currentTime=t.getCurrentTime()),i.width=Math.abs(s[0]),i.height=Math.abs(s[1]),o.setAttribute("x",u-c),o.setAttribute("y",g-S),t.isPlay()?i.play():i.pause();var d=t.getStyle().getAttributes();for(var f in d)o.setAttribute(f,d[f]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.wheel=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,a=e.getElementById(t.getName());null===a?(a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("id",t.getName()),r.appendChild(a),i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()+".circle"),a.appendChild(i),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".cross"),a.appendChild(o)):(i=e.getElementById(t.getName()+".circle"),o=e.getElementById(t.getName()+".cross"));var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,d=l[1]/2;i.setAttribute("cx",g),i.setAttribute("cy",c),i.setAttribute("rx",Math.abs(S)),i.setAttribute("ry",Math.abs(d)),o.setAttribute("d","M "+(g-S)+" "+c+" L "+(g+S)+" "+c+" M "+g+" "+(c-d)+" L "+g+" "+(c+d));var f=t.getStyle();f.getDrawFill()?a.setAttribute("fill",f.getFillColor()):a.setAttribute("fill","none"),f.getDrawLines()?(a.setAttribute("stroke",f.getLineColor()),a.setAttribute("stroke-width",f.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var p in E)a.setAttribute(p,E[p]);return a};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.SvgGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.svgGraphics=function(e){var t=EJSS_INTERFACE.svgGraphics(e),r=t.getDOMElement();return t.getEventContext=function(){return r},t.getBox=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);return e.width-=1,e.height-=1,e},t.remove=function(e){var t=r.getElementById(e);return null!==t&&(r.removeChild(t),!0)},t.reset=function(){for(;r.firstChild;)r.removeChild(r.firstChild);var e=document.createElementNS("http://www.w3.org/2000/svg","defs");r.appendChild(e)},t.draw=function(e,n){for(var i=0,o=e.length;i<o;i++){var a=e[i];if(a.getElements)for(var s=a.getLastElements(),l=0,u=s.length;l<u;l++){var g=r.getElementById(s[l].getName());g&&g.parentNode.removeChild(g)}if(n||a.isChanged()||a.isGroupChanged()||a.isMustProject()){var c=t.drawElement(a);"undefined"!=typeof c&&null!=c&&t.transformElement(a,c)}}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape,n=null;switch(e.getClass()){case"ElementCustom":var i=e.getFunction();i&&(n=i(r,e));break;case"ElementGroup":n=EJSS_SVGGRAPHICS.group(r,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:n=EJSS_SVGGRAPHICS.ellipse(r,e);break;case t.RECTANGLE:n=EJSS_SVGGRAPHICS.rectangle(r,e);break;case t.ROUND_RECTANGLE:n=EJSS_SVGGRAPHICS.roundRectangle(r,e);break;case t.WHEEL:n=EJSS_SVGGRAPHICS.wheel(r,e);break;case t.NONE:case t.POINT:n=EJSS_SVGGRAPHICS.point(r,e)}break;case"ElementSegment":n=EJSS_SVGGRAPHICS.segment(r,e);break;case"ElementImage":n=EJSS_SVGGRAPHICS.image(r,e);break;case"ElementVideo":n=EJSS_SVGGRAPHICS.video(r,e);break;case"ElementArrow":n=EJSS_SVGGRAPHICS.arrow(r,e);break;case"ElementText":n=EJSS_SVGGRAPHICS.text(r,e);break;case"ElementSpring":n=EJSS_SVGGRAPHICS.spring(r,e);break;case"ElementTrail":n=EJSS_SVGGRAPHICS.trail(r,e);break;case"ElementTrace":n=EJSS_SVGGRAPHICS.trace(r,e);break;case"ElementGrid":n=EJSS_SVGGRAPHICS.grid(r,e);break;case"ElementAxis":n=EJSS_SVGGRAPHICS.axis(r,e);break;case"ElementCursor":n=EJSS_SVGGRAPHICS.cursor(r,e);break;case"ElementPolygon":n=EJSS_SVGGRAPHICS.polygon(r,e);break;case"ElementAnalyticCurve":n=EJSS_SVGGRAPHICS.analyticCurve(r,e);break;case"ElementCellLattice":n=EJSS_SVGGRAPHICS.cellLattice(r,e);break;case"ElementByteRaster":n=EJSS_SVGGRAPHICS.byteRaster(r,e);break;case"ElementMesh":n=EJSS_SVGGRAPHICS.mesh(r,e);break;case"ElementTank":n=EJSS_SVGGRAPHICS.tank(r,e);break;case"ElementPipe":n=EJSS_SVGGRAPHICS.pipe(r,e);break;case"ElementHistogram":n=EJSS_SVGGRAPHICS.histogram(r,e)}return n&&(e.isGroupVisible()?n.setAttribute("visibility","visible"):n.setAttribute("visibility","hidden")),n},t.transformElement=function(e,t){var r,n=e.getTransformation();if(Array.isArray(n))r="matrix("+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" "+n[4]+" "+n[5]+")";else if("string"==typeof n)r=n;else if("number"==typeof n){var i=e.getPixelPosition(),o=EJSS_TOOLS.Mathematics.degrees(-n);r="rotate("+o+" "+i[0]+" "+i[1]+")"}r&&t.setAttribute("transform",r)},t.drawGutters=function(e){var n=e.getGutters();if(n.visible){var i=EJSS_SVGGRAPHICS.Utils,o=r.getElementById(".myGutters"),a=r.getElementById(".myOuterBorder"),s=r.getElementById(".myInnerBorder");null===o&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",".myGutters"),o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0),r.appendChild(o),a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("id",".myOuterBorder"),a.setAttribute("fill","none"),r.appendChild(a),s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",".myInnerBorder"),s.setAttribute("fill","none"),r.appendChild(s));var l=e.getInnerRect(),u=.5,g=.5,c=t.getBox(),S=c.width,d=c.height,f=e.getGuttersStyle(),E=e.getStyle();"crispEdges"==E.getShapeRendering()?(o.setAttribute("d","M "+i.crispValue(u)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g+d)+" L "+i.crispValue(u+S)+" "+i.crispValue(g+d)+" L "+i.crispValue(u+S)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g)+" M "+i.crispValue(l.x)+" "+i.crispValue(l.y)+" L "+i.crispValue(l.x+l.width)+" "+i.crispValue(l.y)+" L "+i.crispValue(l.x+l.width)+" "+i.crispValue(l.y+l.height)+" L "+i.crispValue(l.x)+" "+i.crispValue(l.y+l.height)+" L "+i.crispValue(l.x)+" "+i.crispValue(l.y)+" z"),a.setAttribute("d","M "+i.crispValue(u)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g+d)+" L "+i.crispValue(u+S)+" "+i.crispValue(g+d)+" L "+i.crispValue(u+S)+" "+i.crispValue(g)+" L "+i.crispValue(u)+" "+i.crispValue(g)+" z"),s.setAttribute("d","M "+i.crispValue(l.x)+" "+i.crispValue(l.y)+" L "+i.crispValue(l.x+l.width)+" "+i.crispValue(l.y)+" L "+i.crispValue(l.x+l.width)+" "+i.crispValue(l.y+l.height)+" L "+i.crispValue(l.x)+" "+i.crispValue(l.y+l.height)+" L "+i.crispValue(l.x)+" "+i.crispValue(l.y)+" z")):(o.setAttribute("d","M "+u+" "+g+" L "+u+" "+(g+d)+" L "+(u+S)+" "+(g+d)+" L "+(u+S)+" "+g+" L "+u+" "+g+" M "+l.x+" "+l.y+" L "+(l.x+l.width)+" "+l.y+" L "+(l.x+l.width)+" "+(l.y+l.height)+" L "+l.x+" "+(l.y+l.height)+" L "+l.x+" "+l.y+" z"),a.setAttribute("d","M "+u+" "+g+" L "+u+" "+(g+d)+" L "+(u+S)+" "+(g+d)+" L "+(u+S)+" "+g+" L "+u+" "+g+" z"),s.setAttribute("d","M "+l.x+" "+l.y+" L "+(l.x+l.width)+" "+l.y+" L "+(l.x+l.width)+" "+(l.y+l.height)+" L "+l.x+" "+(l.y+l.height)+" L "+l.x+" "+l.y+" z")),f.getDrawFill()?o.setAttribute("fill",f.getFillColor()):o.setAttribute("fill","none"),f.getDrawLines()?(a.setAttribute("stroke",f.getLineColor()),a.setAttribute("stroke-width",f.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),E.getDrawLines()?(s.setAttribute("stroke",E.getLineColor()),s.setAttribute("stroke-width",E.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",E.getShapeRendering()),a.setAttribute("shapeRendering",f.getShapeRendering()),s.setAttribute("shapeRendering",E.getShapeRendering())}},t.drawPanel=function(e){var n=EJSS_SVGGRAPHICS.Utils,i=r.getElementById(".myPanel");null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),
i.setAttribute("id",".myPanel"),r.appendChild(i));var o=.5,a=.5,s=t.getBox(),l=s.width,u=s.height,g=e.getStyle();"crispEdges"==g.getShapeRendering()?i.setAttribute("d","M "+n.crispValue(o)+" "+n.crispValue(a)+" L "+n.crispValue(o)+" "+n.crispValue(a+u)+" L "+n.crispValue(o+l)+" "+n.crispValue(a+u)+" L "+n.crispValue(o+l)+" "+n.crispValue(a)+" z"):i.setAttribute("d","M "+o+" "+a+" L "+o+" "+(a+u)+" L "+(o+l)+" "+(a+u)+" L "+(o+l)+" "+a+" z"),g.getDrawFill()?i.setAttribute("fill",g.getFillColor()):i.setAttribute("fill","none"),g.getDrawLines()?(i.setAttribute("stroke",g.getLineColor()),i.setAttribute("stroke-width",g.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",g.getShapeRendering())},t.importSVG=function(e){var r=(new XMLSerializer).serializeToString(t.getDOMElement()),n=document.createElement("canvas"),i=t.getBox();n.width=i.width+1,n.height=i.height+1;var o=n.getContext("2d"),a=new Image;return a.src="data:image/svg+xml;utf8,"+r,a.onload=function(){o.drawImage(a,0,0),e&&e(n.toDataURL("image/png"))},a.src},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InfoText={registerProperties:function(e,t){EJSS_DRAWING2D.Text.registerProperties(e,t),t.registerProperty("Info",e.setInfo),t.registerProperty("Format",e.setFormat)}},EJSS_DRAWING2D.infoText=function(e){function t(e,t){if(!Array.isArray(t)||"undefined"==typeof n)return t;for(var r="",i=e,o=e.match(/[0-9]*\.(\^|#)+/g),a=0;a<o.length;a++){var s=o[a].split("#").length-1;r=isNaN(t[a])?t[a]:t[a].toFixed(s),i=i.replace(o[a],r)}return i}var r,n,i=EJSS_DRAWING2D.text(e),o=i.getText;return i.setInfo=function(e){r=e},i.getText=function(){if("undefined"==typeof r){var e=o();return t(n,e)}return r.getInfo?r.getInfo():"function"==typeof r?r():void 0},i.setFormat=function(e){n=e},i.isChanged=function(){return!0},i.registerProperties=function(e){EJSS_DRAWING2D.InfoText.registerProperties(i,e)},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Mesh={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData),t.registerProperty("DataType",e.setDataType),t.registerProperty("Mesh",e.setMesh),t.registerProperty("Points",e.setPoints),t.registerProperty("Cells",e.setCells),t.registerProperty("FieldAtPoints",e.setFieldAtPoints),t.registerProperty("FieldAtCells",e.setFieldAtCells),t.registerProperty("VectorLength",e.setVectorLength),t.registerProperty("Boundary",e.setBoundary),t.registerProperty("BoundaryLabels",e.setBoundaryLabels),t.registerProperty("BoundaryColors",e.setBoundaryColors),t.registerProperty("BoundaryWidth",e.setBoundaryLineWidth),t.registerProperty("DrawBoundary",e.setDrawBoundary)}},EJSS_DRAWING2D.mesh=function(e){var t,r,n,i,o,a,s=EJSS_DRAWING2D.element(e),l=-1,u=!0,g=.03,c=null,S=1,d=!0,f=EJSS_DRAWING2D.colorCoded(16,EJSS_DRAWING2D.ColorMapper.SPECTRUM);return s.getClass=function(){return"ElementMesh"},s.setDataType=function(e){switch(e){case"MESH_2D":l=0;break;case"MESH_3D":l=1;break;case"SCALAR_2D_FIELD":l=2;break;case"SCALAR_3D_FIELD":l=3;break;case"VECTOR_2D_FIELD":l=4;break;case"VECTOR_3D_FIELD":l=5;break;default:l=e}s.setChanged(!0)},s.getDataType=function(){return l},s.setData=function(e){if(!e)return!1;switch((l<0||l>5)&&s.setDataType(e.type),l){case 0:case 1:return s.setMesh(e.problem_mesh),!0;case 2:case 3:case 4:case 5:return s.setMesh(e.solution_mesh),s.setFieldAtCells(e.solution_values),!0}return!1},s.setMesh=function(e){s.setPoints(e.points),s.setCells(e.cells),s.setBoundary(e.boundary),s.setBoundaryLabels(e.boundary_labels),s.setChanged(!0)},s.setPoints=function(e){t=e,s.setChanged(!0)},s.getPoints=function(){return t},s.setFieldAtPoints=function(e){r=e,n=null,null!=r&&f.setAutoscaleArray2(r),s.setChanged(!0)},s.getFieldAtPoints=function(){return r},s.setCells=function(e){i=e,s.setChanged(!0)},s.getCells=function(){return i},s.setFieldAtCells=function(e){n=e,r=null,null!=n&&f.setAutoscaleArray3(n),s.setChanged(!0)},s.getFieldAtCells=function(){return n},s.setVectorLength=function(e){g!==e&&(g=e,s.setChanged(!0))},s.getVectorLength=function(){return g},s.setBoundary=function(e){o=e,s.setChanged(!0)},s.getBoundary=function(){return o},s.setBoundaryLabels=function(e){a=e,s.setChanged(!0)},s.getBoundaryLabels=function(){return a},s.setBoundaryColors=function(e){c=e,s.setChanged(!0)},s.getBoundaryColors=function(){return c},s.setBoundaryLineWidth=function(e){S=Math.max(1,e),s.setChanged(!0)},s.getBoundaryLineWidth=function(){return S},s.setBoundaryStroke=function(e){S=e,s.setChanged(!0)},s.getBoundaryStroke=function(){return S},s.setDrawBoundary=function(e){d=e,s.setChanged(!0)},s.getDrawBoundary=function(){return d},s.getColorCoded=function(){return f},s.setAutoscaleZ=function(e,t,i){u=e,u?null!=r?f.setAutoscaleArray2(r):null!=n&&f.setAutoscaleArray3(n):f.setScale(t,i),s.setChanged(!0)},s.isAutoscaleZ=function(){return u},s.getBounds=function(e){var t=0,r=0,n=0,i=0,o=s.getPoints();if(o&&o.length>0){var a=o.length;r=t=o[0][0],i=n=o[0][1];for(var l=1;l<a;l++){var u=o[l][0],g=o[l][1];u>r&&(r=u),g>i&&(i=g),u<t&&(t=u),g<n&&(n=g)}}var u=s.getX(),g=s.getY(),c=s.getSizeX(),S=s.getSizeY(),d=c/2,f=S/2,E=s.getRelativePositionOffset(c,S),p={left:u+E[0]-d+t*c,right:u+E[0]-d+r*c,top:g+E[1]-f+i*S,bottom:g+E[1]-f+n*S};return p},s.registerProperties=function(e){EJSS_DRAWING2D.Mesh.registerProperties(s,e)},s.setSize([1,1]),s.setRelativePosition("SOUTH_WEST"),s};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Pipe={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PipeWidth",e.setPipeWidth,e.getPipeWidth)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints()),t.setPipeWidth(e.getPipeWidth())}},EJSS_DRAWING2D.pipe=function(e){var t=EJSS_DRAWING2D.element(e),r=[[.1,.2],[.1,.3]],n=5;return t.getClass=function(){return"ElementPipe"},t.setPoints=function(e){r=e,t.setChanged(!0)},t.getPoints=function(){return r},t.setPipeWidth=function(e){n=e,t.setChanged(!0)},t.getPipeWidth=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Pipe.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Pipe.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t.getStyle().setLineWidth(1),t.getStyle().setFillColor("Blue"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PlottingPanel={registerProperties:function(e,t){EJSS_DRAWING2D.DrawingPanel.registerProperties(e,t),t.registerProperty("Title",e.getTitle().setText),t.registerProperty("TitleFont",e.getTitle().getFont().setFont),t.registerProperty("TitleColor",e.getTitle().getFont().setFillColor),t.registerProperty("TitleMargin",e.getTitle().setMarginY),t.registerProperty("TitleX",e.getTitleX().setText),t.registerProperty("TitleXFont",e.getTitleX().getFont().setFont),t.registerProperty("TitleXColor",e.getTitleX().getFont().setFillColor),t.registerProperty("TitleXMargin",e.getTitleX().setMarginY),t.registerProperty("TitleY",e.getTitleY().setText),t.registerProperty("TitleYFont",e.getTitleY().getFont().setFont),t.registerProperty("TitleYColor",e.getTitleY().getFont().setFillColor),t.registerProperty("TitleYMargin",e.getTitleY().setMarginX),t.registerProperty("GridXShow",e.getGrid().setShowX,e.getGrid().getShowX),t.registerProperty("GridXTicks",e.getGrid().setTicksX,e.getGrid().getTicksX),t.registerProperty("GridXStep",e.getGrid().setStepX,e.getGrid().getStepX),t.registerProperty("GridXAutoStepMin",e.getGrid().setAutoStepXMin,e.getGrid().getAutoStepXMin),t.registerProperty("GridXAutoTicksRange",e.getGrid().setAutoTicksXRange,e.getGrid().getAutoTicksXRange),t.registerProperty("GridXScale",e.getGrid().setScaleX,e.getGrid().getScaleX),t.registerProperty("GridXScalePrecision",e.getGrid().setScalePrecisionX,e.getGrid().getScalePrecisionX),t.registerProperty("GridXFixedTick",e.getGrid().setFixedTickX,e.getGrid().getFixedTickX),t.registerProperty("GridXAutoTicks",e.getGrid().setAutoTicksX,e.getGrid().getAutoTicksX),t.registerProperty("GridXLineColor",e.getGrid().setLineColorX),t.registerProperty("GridXLineWidth",e.getGrid().setLineWidthX),t.registerProperty("GridXShapeRendering",e.getGrid().setShapeRenderingX),t.registerProperty("GridYShow",e.getGrid().setShowY,e.getGrid().getShowY),t.registerProperty("GridYTicks",e.getGrid().setTicksY,e.getGrid().getTicksY),t.registerProperty("GridYStep",e.getGrid().setStepY,e.getGrid().getStepY),t.registerProperty("GridYAutoStepMin",e.getGrid().setAutoStepYMin,e.getGrid().getAutoStepYMin),t.registerProperty("GridYAutoTicksRange",e.getGrid().setAutoTicksYRange,e.getGrid().getAutoTicksYRange),t.registerProperty("GridYScale",e.getGrid().setScaleY,e.getGrid().getScaleY),t.registerProperty("GridYScalePrecision",e.getGrid().setScalePrecisionY,e.getGrid().getScalePrecisionY),t.registerProperty("GridYFixedTick",e.getGrid().setFixedTickY,e.getGrid().getFixedTickY),t.registerProperty("GridYAutoTicks",e.getGrid().setAutoTicksY,e.getGrid().getAutoTicksY),t.registerProperty("GridYLineColor",e.getGrid().setLineColorY),t.registerProperty("GridYLineWidth",e.getGrid().setLineWidthY),t.registerProperty("GridYShapeRendering",e.getGrid().setShapeRenderingY),t.registerProperty("AxisXShow",e.getAxisX().setShow),t.registerProperty("AxisXLineColor",e.getAxisX().getStyle().setLineColor),t.registerProperty("AxisXLineWidth",e.getAxisX().getStyle().setLineWidth),t.registerProperty("AxisXShapeRendering",e.getAxisX().getStyle().setShapeRendering),t.registerProperty("AxisXFixedTick",e.getAxisX().setFixedTick,e.getAxisX().getFixedTick),t.registerProperty("AxisXAutoTicks",e.getAxisX().setAutoTicks,e.getAxisX().getAutoTicks),t.registerProperty("AxisXTicks",e.getAxisX().setTicks,e.getAxisX().getTicks),t.registerProperty("AxisXStep",e.getAxisX().setStep,e.getAxisX().getStep),t.registerProperty("AxisXTickStep",e.getAxisX().setTickStep,e.getAxisX().getTickStep),t.registerProperty("AxisXAutoStepMin",e.getAxisX().setAutoStepMin,e.getAxisX().getAutoStepMin),t.registerProperty("AxisXAutoTicksRange",e.getAxisX().setAutoTicksRange,e.getAxisX().getAutoTicksRange),t.registerProperty("AxisXScale",e.getAxisX().setScale,e.getAxisX().getScale),t.registerProperty("AxisXScalePrecision",e.getAxisX().setScalePrecision,e.getAxisX().getScalePrecision),t.registerProperty("AxisXFont",e.getAxisX().getFont().setFont),t.registerProperty("AxisXFontColor",e.getAxisX().getFont().setFillColor),t.registerProperty("AxisYShow",e.getAxisY().setShow),t.registerProperty("AxisYLineColor",e.getAxisY().getStyle().setLineColor),t.registerProperty("AxisYLineWidth",e.getAxisY().getStyle().setLineWidth),t.registerProperty("AxisYShapeRendering",e.getAxisY().getStyle().setShapeRendering),t.registerProperty("AxisYFixedTick",e.getAxisY().setFixedTick,e.getAxisY().getFixedTick),t.registerProperty("AxisYAutoTicks",e.getAxisY().setAutoTicks,e.getAxisY().getAutoTicks),t.registerProperty("AxisYTicks",e.getAxisY().setTicks,e.getAxisY().getTicks),t.registerProperty("AxisYStep",e.getAxisY().setStep,e.getAxisY().getStep),t.registerProperty("AxisYTickStep",e.getAxisY().setTickStep,e.getAxisY().getTickStep),t.registerProperty("AxisYAutoStepMin",e.getAxisY().setAutoStepMin,e.getAxisY().getAutoStepMin),t.registerProperty("AxisYAutoTicksRange",e.getAxisY().setAutoTicksRange,e.getAxisY().getAutoTicksRange),t.registerProperty("AxisYScale",e.getAxisY().setScale,e.getAxisY().getScale),t.registerProperty("AxisYScalePrecision",e.getAxisY().setScalePrecision,e.getAxisY().getScalePrecision),t.registerProperty("AxisYFont",e.getAxisY().getFont().setFont),t.registerProperty("AxisYFontColor",e.getAxisY().getFont().setFillColor),t.registerProperty("XFixedTick",function(t){e.getAxisX().setFixedTick(t),e.getGrid().setFixedTickX(t)}),t.registerProperty("YFixedTick",function(t){e.getAxisY().setFixedTick(t),e.getGrid().setFixedTickY(t)}),t.registerProperty("XTicks",function(t){e.getAxisX().setTicks(t),e.getGrid().setTicksX(t)}),t.registerProperty("YTicks",function(t){e.getAxisY().setTicks(t),e.getGrid().setTicksY(t)}),t.registerProperty("XStep",function(t){e.getAxisX().setStep(t),e.getGrid().setStepX(t)}),t.registerProperty("YStep",function(t){e.getAxisY().setStep(t),e.getGrid().setStepY(t)}),t.registerProperty("XTickStep",function(t){e.getAxisX().setTickStep(t),e.getGrid().setTickStepX(t)}),t.registerProperty("YTickStep",function(t){e.getAxisY().setTickStep(t),e.getGrid().setTickStepY(t)}),t.registerProperty("XAutoStepMin",function(t){e.getAxisX().setAutoStepMin(t),e.getGrid().setAutoStepXMin(t)}),t.registerProperty("YAutoStepMin",function(t){e.getAxisY().setAutoStepMin(t),e.getGrid().setAutoStepYMin(t)}),t.registerProperty("XAutoTicksRange",function(t){e.getAxisX().setAutoTicksRange(t),e.getGrid().setAutoTicksXRange(t)}),t.registerProperty("YAutoTicksRange",function(t){e.getAxisY().setAutoTicksRange(t),e.getGrid().setAutoTicksyRange(t)}),t.registerProperty("XScale",function(t){e.getAxisX().setScale(t),e.getGrid().setScaleX(t)}),t.registerProperty("YScale",function(t){e.getAxisY().setScale(t),e.getGrid().setScaleY(t)}),t.registerProperty("XScalePrecision",function(t){e.getAxisX().setScalePrecision(t),e.getGrid().setScalePrecisionX(t)}),t.registerProperty("YScalePrecision",function(t){e.getAxisY().setScalePrecision(t),e.getGrid().setScalePrecisionY(t)}),t.registerProperty("XAutoTicks",function(t){e.getAxisX().setAutoTicks(t),e.getGrid().setAutoTicksX(t)}),t.registerProperty("YAutoTicks",function(t){e.getAxisY().setAutoTicks(t),e.getGrid().setAutoTicksY(t)})}},EJSS_DRAWING2D.plottingPanel=function(e,t){var r=EJSS_DRAWING2D.drawingPanel(e,t);r.getGrid=function(){return i},r.getAxisX=function(){return a},r.getAxisY=function(){return s},r.getTitleX=function(){return l},r.getTitleY=function(){return u},r.getTitle=function(){return g},r.registerProperties=function(e){EJSS_DRAWING2D.PlottingPanel.registerProperties(r,e)};var n=EJSS_DRAWING2D.group(e+".bottomgroup");n.setRelativePosition("SOUTH_WEST"),n.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),i=r.getRealWorldXMax(),o=r.getRealWorldYMin(),a=r.getRealWorldYMax(),s=Math.abs(i-t),l=Math.abs(a-o);return n.setSize([s,l]),n.setPosition([t,o]),!0}},n.panelChangeListener("bounds");var i=EJSS_DRAWING2D.grid(e+".grid");i.setGroup(n),i.setRelativePosition("SOUTH_WEST"),i.setLineColorX("lightgray"),i.setShapeRenderingX("RENDER_CRISPEDGES"),i.setLineColorY("lightgray"),i.setShapeRenderingY("RENDER_CRISPEDGES"),i.setSize([1,1]),i.setPosition([0,0]),i.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax();i.setScaleX([t,n]),i.setTicksXMode(r.getTypeScaleX());var o=r.getRealWorldYMin(),a=r.getRealWorldYMax();return i.setScaleY([o,a]),i.setTicksYMode(r.getTypeScaleY()),!0}};var o=EJSS_DRAWING2D.group(e+".topgroup");o.setRelativePosition("SOUTH_WEST"),o.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax(),i=r.getRealWorldYMin(),a=r.getRealWorldYMax(),s=Math.abs(n-t),l=Math.abs(a-i);return o.setSize([s,l]),o.setPosition([t,i]),!0}},o.panelChangeListener("bounds");var a=EJSS_DRAWING2D.axis(e+".axisX");a.setGroup(o),a.setRelativePosition("WEST"),a.getStyle().setLineColor("black"),a.getStyle().setShapeRendering("RENDER_CRISPEDGES"),a.getFont().setFontSize(10),a.setSize([1,1]),a.setPosition([0,0]),a.setOrient("AXIS_HORIZONTAL"),a.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax();return a.setScale([t,n]),a.setTicksMode(r.getTypeScaleX()),r.getInvertedScaleY()?(a.setTextPosition("TICKS_DOWN"),l.setMarginY(-30),g.setMarginY(20)):(a.setTextPosition("TICKS_UP"),l.setMarginY(30),g.setMarginY(-20)),!0}},a.setTicksMode(r.getTypeScaleX());var s=EJSS_DRAWING2D.axis(e+".axisY");s.setGroup(o),s.setRelativePosition("SOUTH"),s.getStyle().setLineColor("black"),s.getStyle().setShapeRendering("RENDER_CRISPEDGES"),s.getFont().setFontSize(10),s.setSize([1,1]),s.setPosition([0,0]),s.setOrient("AXIS_VERTICAL"),s.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldYMin(),n=r.getRealWorldYMax();return s.setScale([t,n]),s.setTicksMode(r.getTypeScaleY()),s.setInvertedScaleY(r.getInvertedScaleY()),!0}},s.setTicksMode(r.getTypeScaleY());var l=EJSS_DRAWING2D.text(e+".titleX");l.setGroup(o),l.setRelativePosition("CENTER"),l.getFont().setFontSize(12),l.setPosition([.5,0]),l.setMarginY(30),l.setText("x");var u=EJSS_DRAWING2D.text(e+".titleY");u.setGroup(o),u.setRelativePosition("CENTER"),u.getFont().setFontSize(12),u.setWritingMode("MODE_DOWNTOP"),u.setPosition([0,.5]),u.setMarginX(-40),u.setText("y");var g=EJSS_DRAWING2D.text(e+".title");return g.setGroup(o),g.setRelativePosition("CENTER"),g.getFont().setFontSize(12),g.setPosition([.5,1]),g.setMarginY(-20),g.setText("Plot"),r.getStyle().setLineColor("black"),r.getStyle().setFillColor("white"),r.getStyle().setShapeRendering("RENDER_CRISPEDGES"),r.setGutters([50,50,50,50]),r.getGuttersStyle().setLineColor("black"),r.getGuttersStyle().setFillColor("rgb(211,216,255)"),r.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),r.addDecoration(n),r.addDecoration(i),r.addDecoration(o,-1,!0),r.addDecoration(a,-1,!0),r.addDecoration(s,-1,!0),r.addDecoration(l,-1,!0),r.addDecoration(u,-1,!0),r.addDecoration(g,-1,!0),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Polygon={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PointsX",e.setPointsX),t.registerProperty("PointsY",e.setPointsY),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint)}},EJSS_DRAWING2D.polygon=function(e){function t(e,t){isNaN(e)||isNaN(t)||(n[n.length]=[e,t])}var r=EJSS_DRAWING2D.element(e),n=[],i=null,o=null;return r.getClass=function(){return"ElementPolygon"},r.addPoint=function(e,n){e instanceof Array?t(e[0],e[1]):t(e,n),r.setChanged(!0)},r.addPoints=function(e,n){if(void 0!=e&&null!=e&&void 0!=e[0]){if(e[0]instanceof Array)for(var i=0,o=e.length;i<o;i++)t(e[i][0],e[i][1]);else for(var o=Math.min(e.length,n.length),i=0;i<o;i++)t(e[i],n[i]);r.setChanged(!0)}},r.setPoints=function(e,t){r.clear(),r.addPoints(e,t),r.setChanged(!0)},r.setPointsX=function(e){null==o?i=e:(r.setPoints(e,o),o=null)},r.setPointsY=function(e){null==i?o=e:(r.setPoints(i,e),i=null)},r.getPoints=function(){return n},r.getLastPoint=function(){return n.length>0?n[n.length-1]:[]},r.clear=function(){n=[],r.setChanged(!0)},r.getBounds=function(e){var t,n,i,o,a=r.getPoints(),s=a.length;if(0==s)t=n=i=o=0;else{n=t=a[0][0],o=i=a[0][1];for(var l=1;l<s;l++){var u=a[l][0],g=a[l][1];u>n&&(n=u),g>o&&(o=g),u<t&&(t=u),g<i&&(i=g)}}var u=r.getX(),g=r.getY(),c=r.getSizeX(),S=r.getSizeY(),d=S/2,f=S/2,E=r.getRelativePositionOffset(c,S);return{left:u+E[0]-d+t*c,right:u+E[0]+d+n*c,top:g+E[1]+f+o*c,bottom:g+E[1]-f+i*c}},r.registerProperties=function(e){EJSS_DRAWING2D.Polygon.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Polygon.copyTo(r,e)},r.setSize([1,1]),r.setRelativePosition("SOUTH_WEST"),r},EJSS_DRAWING2D.PolygonSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)})}},EJSS_DRAWING2D.polygonSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.polygon,e),r=EJSS_DRAWING2D.PolygonSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Segment={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition)}},EJSS_DRAWING2D.segment=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING2D.Segment.registerProperties(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.SegmentSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)})}},EJSS_DRAWING2D.segmentSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.segment,e);return t.registerProperties=function(e){EJSS_DRAWING2D.SegmentSet.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Shape={NONE:0,ELLIPSE:1,RECTANGLE:2,ROUND_RECTANGLE:3,WHEEL:4,POINT:5,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ShapeType",e.setShapeType),t.registerProperty("CornerRadius",e.setCornerRadius)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setShapeType(e.getShapeType()),t.setCornerRadius(e.getCornerRadius())}},EJSS_DRAWING2D.shape=function(e){var t=EJSS_DRAWING2D.element(e),r=10,n=EJSS_DRAWING2D.Shape.ELLIPSE;return t.setShapeType=function(e){n="string"==typeof e?EJSS_DRAWING2D.Shape[e.toUpperCase()]:e},t.getShapeType=function(){return n},t.setCornerRadius=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getCornerRadius=function(){return r},t.getClass=function(){return"ElementShape"},t.registerProperties=function(e){EJSS_DRAWING2D.Shape.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Shape.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t},EJSS_DRAWING2D.ShapeSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("ShapeType",function(t){e.setToEach(function(e,t){e.setShapeType(t)},t)}),t.registerProperty("CornerRadius",function(t){e.setToEach(function(e,t){e.setCornerRadius(t)},t)})}},EJSS_DRAWING2D.shapeSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.shape,e),r=EJSS_DRAWING2D.ShapeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SimplePanel={GRAPHICS2D_SVG:"SVG",GRAPHICS2D_CANVAS:"Canvas",registerProperties:function(e,t){t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS)}},EJSS_DRAWING2D.simplePanel=function(e){var t={},r=EJSS_GRAPHICS.svgGraphics(e),n=EJSS_DRAWING2D.style(e),i=[],o=!1,a=[],s={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,xorigin:0,yorigin:0,xscale:1,yscale:1},l=!0,u=!0;return t.getName=function(){return e},t.getGraphics=function(){return r},t.importGraphics=function(e){return r.importSVG(e)},t.getStyle=function(){return n},t.setGraphics=function(t){t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_CANVAS?console.log("WARNING: setGraphics() - Canvas not supported"):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==s.xminPreferred&&(s.xminPreferred=e,u=!0)},t.getWorldXMin=function(){return s.xminPreferred},t.setWorldXMax=function(e){e!==s.xmaxPreferred&&(s.xmaxPreferred=e,u=!0)},t.getWorldXMax=function(){return s.xmaxPreferred},t.setWorldYMin=function(e){e!==s.yminPreferred&&(s.yminPreferred=e,u=!0)},t.getWorldYMin=function(){return s.yminPreferred},t.setWorldYMax=function(e){e!==s.ymaxPreferred&&(s.ymaxPreferred=e,u=!0)},t.getWorldYMax=function(){return s.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.addElement=function(e,r){EJSS_TOOLS.addToArray(i,e,r),e.setPanel(t),e.dataCollected&&a.push(e),o=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(i,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(a,e),o=!0},t.getElements=function(){return i},t.indexOfElement=function(e){return i.indexOf(e)},t.toPixelAxisY=function(e){return s.yorigin-e-s.yscale*s.yminPreferred},t.toPixelAxisX=function(e){return s.xorigin+e-s.xscale*s.xminPreferred},t.toPixelPosition=function(e){var t=[];return t[0]=s.xorigin+s.xscale*(e[0]-s.xminPreferred),t[1]=s.yorigin+s.yscale*(e[1]-s.yminPreferred),t},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*s.xscale,t[1]=e[1]*s.yscale,t},t.toPanelPosition=function(e){var t=[];return t[0]=s.xminPreferred+(e[0]-s.xorigin)/s.xscale,t[1]=s.yminPreferred+(e[1]-s.yorigin)/s.yscale,t},t.toPanelMod=function(e){var t=[];return t[0]=0==s.xscale?0:e[0]/s.xscale,t[1]=0==s.yscale?0:e[1]/s.yscale,t},t.getPixelPositionWorldOrigin=function(){return[s.xorigin,s.yorigin]},t.recomputeScales=function(){var e=r.getWidth(),t=r.getHeight(),n=e/(s.xmaxPreferred-s.xminPreferred),i=t/(s.ymaxPreferred-s.yminPreferred);s.xscale=n,s.yscale=-i,s.xorigin=.5,s.yorigin=t+.5,u=!1},t.reset=function(){r.reset()},t.render=function(){var e=!1;o&&(r.reset(),e=!0,o=!1);for(var n=0,s=a.length;n<s;n++)a[n].dataCollected();u&&t.recomputeScales(),(l||e)&&r.drawPanel(t),r.draw(i,e),l=!1;for(var n=0,s=i.length;n<s;n++)i[n].setChanged(!1)},t.registerProperties=function(e){EJSS_DRAWING2D.SimplePanel.registerProperties(t,e)},n.setLineColor("black"),n.setFillColor("rgb(239,239,255)"),n.setChangeListener(function(e){l=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Spring={DEF_RADIUS:.05,DEF_LOOPS:8,DEF_PPL:15,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setSolenoid(e.getSolenoid()),t.setThinExtremes(e.getThinExtremes()),t.setLoops(e.getLoops()),t.setPointsPerLoop(e.getPointsPerLoop())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("Solenoid",e.setSolenoid,e.getSolenoid),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("Loops",e.setLoops,e.getLoops),t.registerProperty("PointsPerLoop",e.setPointsPerLoop,e.getPointsPerLoop)}},EJSS_DRAWING2D.spring=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i=EJSS_DRAWING2D.Spring.DEF_RADIUS,o=0,a=!0;return n.getClass=function(){return"ElementSpring"},n.setRadius=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getRadius=function(){return i},n.setSolenoid=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getSolenoid=function(){return o},n.setThinExtremes=function(e){a!=e&&(a=e,n.setChanged(!0))},n.getThinExtremes=function(){return a},n.setLoops=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getLoops=function(){return t},n.setPointsPerLoop=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getPointsPerLoop=function(){return r},n.registerProperties=function(e){EJSS_DRAWING2D.Spring.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Spring.copyTo(n,e)},n.setSize([.1,.1]),n.setLoops(EJSS_DRAWING2D.Spring.DEF_LOOPS),n.setPointsPerLoop(EJSS_DRAWING2D.Spring.DEF_PPL),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SpringSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("Solenoid",function(t){e.setToEach(function(e,t){e.setSolenoid(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("Loops",function(t){e.setToEach(function(e,t){e.setLoops(t)},t)}),t.registerProperty("PointsPerLoop",function(t){e.setToEach(function(e,t){e.setPointsPerLoop(t)},t)})}},EJSS_DRAWING2D.springSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.spring,e),r=EJSS_DRAWING2D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Tank={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("LevelColor",e.setLevelColor),t.registerProperty("Level",e.setLevel),t.registerProperty("Closed",e.setClosed)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setLevel(e.getLevel()),t.setLevelColor(e.getLevelColor())}},EJSS_DRAWING2D.tank=function(e){var t=EJSS_DRAWING2D.element(e),r=0,n="blue",i=EJSS_DRAWING2D.Tank;return t.getClass=function(){return"ElementTank"},t.setLevel=function(e){r=e,t.setChanged(!0)},t.getLevel=function(){return r},t.setLevelColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=n&&(n=e,t.setChanged(!0)),t},t.getLevelColor=function(){return n},t.registerProperties=function(e){i.registerProperties(t,e)},t.copyTo=function(e){i.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("White"),t.getStyle().setLineColor("Black"),t.getStyle().setDrawFill(!1),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Text={MODE_TOPDOWN:0,MODE_RIGTHLEFT:1,MODE_DOWNTOP:2,MODE_LEFTRIGHT:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setWritingMode(e.getWritingMode())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Framed",e.setFramed),t.registerProperty("WritingMode",e.setWritingMode),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("OutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FillColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle),t.registerProperty("MarginX",e.getMarginX().setMarginX),t.registerProperty("MarginY",e.getMarginY().setMarginY)}},EJSS_DRAWING2D.text=function(e){var t=EJSS_DRAWING2D.element(e),r="",n=EJSS_DRAWING2D.Text.MODE_LEFTRIGHT,i=EJSS_DRAWING2D.font(e),o=!1,a=0,s=0;return t.getClass=function(){return"ElementText"},t.setText=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getText=function(){return r},t.setMarginX=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarginX=function(){return a},t.setMarginY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarginY=function(){return s},t.getSizeX=function(){var e=r?r.length:0;return e*i.getFontSize()+e*i.getNumberLetterSpacing()},t.getSizeY=function(){return i.getFontSize()},t.getFont=function(){return i},t.setFramed=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getFramed=function(){return o},t.setWritingMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Text[e.toUpperCase()]),
n!=e&&(n=e,t.setChanged(!0))},t.getWritingMode=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Text.copyTo(t,e)},i.setChangeListener(function(e){t.setChanged(!0)}),t.setPixelSize(!0),t},EJSS_DRAWING2D.TextSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Framed",function(t){e.setToEach(function(e,t){e.setFramed(t)},t)}),t.registerProperty("WritingMode",function(t){e.setToEach(function(e,t){e.setWritingMode(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("LetterSpacing",function(t){e.setToEach(function(e,t){e.getFont().setLetterSpacing(t)},t)}),t.registerProperty("OutlineColor",function(t){e.setToEach(function(e,t){e.getFont().setOutlineColor(t)},t)}),t.registerProperty("FontWeight",function(t){e.setToEach(function(e,t){e.getFont().setFontWeight(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)})}},EJSS_DRAWING2D.textSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.text,e),r=EJSS_DRAWING2D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trace={ELLIPSE:0,RECTANGLE:1,AREA:2,BAR:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Trail.copyTo(e,t),EJSS_DRAWING2D.Style.copyTo(e.getMarkStyle(),t.getMarkStyle()),t.setMarkType(e.getMarkType()),t.setMarkSize(e.getMarkSize())},registerProperties:function(e,t){EJSS_DRAWING2D.Trail.registerProperties(e,t),t.registerProperty("MarkType",e.setMarkType,e.getMarkType),t.registerProperty("MarkSize",e.setMarkSize,e.getMarkSize),t.registerProperty("MarkLineColor",e.getMarkStyle().setLineColor),t.registerProperty("MarkLineWidth",e.getMarkStyle().setLineWidth),t.registerProperty("MarkDrawLines",e.getMarkStyle().setDrawLines),t.registerProperty("MarkFillColor",e.getMarkStyle().setFillColor),t.registerProperty("MarkDrawFill",e.getMarkStyle().setDrawFill)}},EJSS_DRAWING2D.trace=function(e){var t=EJSS_DRAWING2D.trail(e),r=EJSS_DRAWING2D.Trace.ELLIPSE,n=EJSS_DRAWING2D.style(e),i=EJSS_DRAWING2D.Element.CENTER,o=0,a=0;return t.getClass=function(){return"ElementTrace"},t.setMarkRelativePosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Element[e.toUpperCase()]),i!=e&&(i=e,t.setChanged(!0))},t.getMarkRelativePosition=function(){return i},t.getMarkStyle=function(){return n},t.setMarkSize=function(e){o==e[0]&&a==e[1]||(o=e[0],a=e[1],t.setChanged(!0))},t.getMarkSize=function(){return[o,a]},t.setMarkType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trace[e.toUpperCase()]),r!=e&&(r=e,t.setChanged(!0))},t.getMarkType=function(){return r},t.formatPoint=function(e){var t=e.length;return e[t++]=r,e[t]=EJSS_DRAWING2D.style(),EJSS_DRAWING2D.Style.copyTo(n,e[t++]),e[t++]=o,e[t]=a,e},t.registerProperties=function(e){EJSS_DRAWING2D.Trace.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trace.copyTo(t,e)},t},EJSS_DRAWING2D.TraceSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.TrailSet;r.registerProperties(e,t),t.registerProperty("MarkType",function(t){e.setToEach(function(e,t){e.setMarkType(t)},t)}),t.registerProperty("MarkSize",function(t){e.setToEach(function(e,t){e.setMarkSize(t)},t)}),t.registerProperty("MarkLineColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineColor(t)},t)}),t.registerProperty("MarkLineWidth",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineWidth(t)},t)}),t.registerProperty("MarkDrawLines",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawLines(t)},t)}),t.registerProperty("MarkFillColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setFillColor(t)},t)}),t.registerProperty("MarkDrawFill",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawFill(t)},t)}),t.registerProperty("MarkRelativePosition",function(t){e.setToEach(function(e,t){e.setMarkRelativePosition(t)},t)})}},EJSS_DRAWING2D.traceSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trace,e),r=EJSS_DRAWING2D.TraceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints)}},EJSS_DRAWING2D.trail=function(e){function t(e,t,n){return isNaN(e)||isNaN(t)?void(c=!0):void(i&&S[0]==e&&S[1]==t||("undefined"!=typeof n&&null!==n||(n=u),d=0,S=r.formatPoint([e,t,n]),a>0&&(g>0&&(d=r.formatPoint([e,t,n])),++g>=a&&(g=0)),0==d&&(l>2&&f.length>=l&&f.splice(0,1),f[f.length]=r.formatPoint([e,t,n]),c=!1)))}var r=EJSS_DRAWING2D.element(e),n=!0,i=!1,o=!1,a=0,s=["x","y"],l=0,u=EJSS_DRAWING2D.Trail.LINE_CONNECTION,g=0,c=!0,S=0,d=0,f=[],E=[],p=[],h=[],m=0,A=0;return r.getClass=function(){return"ElementTrail"},r.setActive=function(e){n!=e&&(n=e,r.setChanged(!0))},r.getActive=function(){return n},r.setNoRepeat=function(e){i!=e&&(i=e,r.setChanged(!0))},r.getNoRepeat=function(){return i},r.setClearAtInput=function(e){o!=e&&(o=e,r.setChanged(!0))},r.getClearAtInput=function(){return o},r.setSkip=function(e){a!=e&&(a=e,g=0,r.setChanged(!0))},r.getSkip=function(){return a},r.setInputLabels=function(e){s[0]==e[0]&&s[1]==e[1]||(s[0]=e[0],s[1]=e[1],r.setChanged(!0))},r.getInputLabels=function(){return s},r.setMaximumPoints=function(e){var t=Math.max(e,2);l!=t&&(l=t,r.setChanged(!0))},r.getMaximumPoints=function(){return l},r.setConnected=function(e){e?r.setConnectionType(EJSS_DRAWING2D.Trail.LINE_CONNECTION):r.setConnectionType(EJSS_DRAWING2D.Trail.NO_CONNECTION)},r.isConnected=function(){return u===EJSS_DRAWING2D.Trail.LINE_CONNECTION},r.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trail[e.toUpperCase()]),u!=e&&(u=e,r.setChanged(!0))},r.getConnectionType=function(){return u},r.addPoint=function(e,i,a){n&&(o&&r.initialize(),e instanceof Array?t(e[0],e[1],a):t(e,i,a),r.setChanged(!0))},r.addPoints=function(e,i){if(n){if(o&&r.initialize(),"undefined"==typeof i||null===i)if(e[0]instanceof Array)for(var a=0,s=e.length;a<s;a++)t(e[a][0],e[a][1],u);else t(e[0],e[1],u);else for(var s=Math.min(e.length,i.length),a=0;a<s;a++)t(e[a],i[a],u);r.setChanged(!0)}},r.addXPoints=function(e){if(n){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)h[t]?h[t]=[e[t],h[t][1],h[t][2]]:h[t]=[e[t],A,u];m=e[t]}else h[t]?h[t]=[e,h[t][1],h[t][2]]:h[t]=[e,A,u],t++,m=e;for(;h[t];)h[t]=[m,h[t][1],h[t][2]],t++}},r.addYPoints=function(e){if(n){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)h[t]?h[t]=[h[t][0],e[t],h[t][2]]:h[t]=[m,e[t],u];A=e[t]}else h[t]?h[t]=[h[t][0],e,h[t][2]]:h[t]=[m,e,u],t++,A=e;for(;h[t];)h[t]=[h[t][0],A,h[t][2]],t++}},r.dataCollected=function(){h.length>0&&(r.addPoints(h),h=[],r.setChanged(!0))},r.setPoints=function(e,t,i){n&&(r.clear(),r.addPoints(e,t,i),r.setChanged(!0))},r.moveToPoint=function(e,i){n&&(o&&r.initialize(),e instanceof Array?t(e[0],e[1],EJSS_DRAWING2D.Trail.NO_CONNECTION):t(e,i,EJSS_DRAWING2D.Trail.NO_CONNECTION),r.setChanged(!0))},r.getSegmentsCount=function(){return E.length},r.getSegmentPoints=function(e){return E[e]},r.getSegmentStyle=function(e){return p[e]},r.getCurrentPoints=function(){return f},r.getPoints=function(){for(var e=[],t=E.length,r=0;r<t;r++)e=e.concat(E[r]);return e=e.concat(f)},r.getLastPoint=function(){return S},r.reset=function(){r.clear()},r.clear=function(){E=[],p=[],mCurrentSegment=0,r.initialize()},r.initialize=function(){f=[],d=0,c=!0,g=0,S=0,r.setChanged(!0)},r.newSegment=function(){if(0!=d){var e=f.length;f[e]=r.formatPoint(d)}var e=E.length;E[e]=f;var t=EJSS_DRAWING2D.style(r.getName()+" #"+e);EJSS_DRAWING2D.Style.copyTo(r.getStyle(),t),p[e]=t,r.initialize()},r.getBounds=function(e){var t,n,i,o,a=r.getPoints(),s=a.length;if(0==s)t=n=i=o=0;else{n=t=a[0][0],o=i=a[0][1];for(var l=1;l<s;l++){var u=a[l][0],g=a[l][1];u>n&&(n=u),g>o&&(o=g),u<t&&(t=u),g<i&&(i=g)}}var u=r.getX(),g=r.getY(),c=r.getSizeX(),S=r.getSizeY(),d=c/2,f=S/2,E=r.getRelativePositionOffset(c,S);return{left:u+E[0]-d+t*c,right:u+E[0]-d+n*c,top:g+E[1]-f+o*S,bottom:g+E[1]-f+i*S}},r.formatPoint=function(e){return e},r.registerProperties=function(e){EJSS_DRAWING2D.Trail.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(r,e)},r.setSize([1,1]),r.setRelativePosition("SOUTH_WEST"),r},EJSS_DRAWING2D.TrailSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.ElementSet;r.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)})}},EJSS_DRAWING2D.trailSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trail,e),r=EJSS_DRAWING2D.TrailSet;return t.reset=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].reset()},t.initialize=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].initialize()},t.clear=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].clear()},t.newSegment=function(e){t.getElements()[e].newSegment()},t.moveToPoint=function(e,r,n){t.getElements()[e].moveToPoint(r,n)},t.addPoint=function(e,r,n,i){t.getElements()[e].addPoint(r,n,i)},t.addPoints=function(e,r,n){t.getElements()[e].addPoints(r,n)},t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.colorCoded=function(e,t){var r=EJSS_DRAWING2D.colorMapper(e,t),n=!1;return r.setSymmetricZ=function(e){n=e},r.isSymmetricZ=function(){return n},r.setAutoscale=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++){var s=e[o];i=Math.max(i,s),t=Math.min(t,s)}var l=i,u=t;n&&(l=Math.max(Math.abs(t),Math.abs(i)),u=-l),r.setScale(u,l)},r.setAutoscaleArray2=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++)for(var s=0,l=e[o].length;s<l;s++){var u=e[o][s];i=Math.max(i,u),t=Math.min(t,u)}var g=i,c=t;n&&(g=Math.max(Math.abs(t),Math.abs(i)),c=-g),r.setScale(c,g)},r.setAutoscaleArray3=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++)for(var s=0,l=e[o].length;s<l;s++)for(var u=0,g=e[o][s].length;u<g;u++){var c=e[o][s][u];i=Math.max(i,c),t=Math.min(t,c)}var S=i,d=t;n&&(S=Math.max(Math.abs(t),Math.abs(i)),d=-S),r.setScale(d,S)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ColorMapper={CUSTOM:-1,SPECTRUM:0,GRAYSCALE:1,DUALSHADE:2,RED:3,GREEN:4,BLUE:5,BLACK:6,WIREFRAME:7,NORENDER:8,REDBLUE_SHADE:9,getColorPalette:function(e,t){function r(e,t,r){var n={h:Math.round(360*e),s:t,b:r},i={r:0,g:0,b:0};if(0===n.s)return i.r=i.g=i.b=n.h,i;var o=Math.floor(n.h/60),a=n.h/60-o,s=n.b*(1-n.s),l=n.b*(1-a*n.s),u=n.b*(1-(1-a)*n.s);switch(o){case 0:i.r=n.b,i.g=u,i.b=s;break;case 1:i.r=l,i.g=n.b,i.b=s;break;case 2:i.r=s,i.g=n.b,i.b=u;break;case 3:i.r=s,i.g=l,i.b=n.b;break;case 4:i.r=u,i.g=s,i.b=n.b;break;case 5:i.r=n.b,i.g=s,i.b=l}return i.r=Math.round(255*i.r),i.g=Math.round(255*i.g),i.b=Math.round(255*i.b),i}var n=EJSS_DRAWING2D.ColorMapper,i=[];e<2&&(e=2);for(var o=0;o<e;o++){var a=o/(e-1)*.8,s=1,l=1,u=0,g=0,c=0;switch(t){case n.REDBLUE_SHADE:u=Math.floor(255*Math.max(0,-e-1+2*o)/(e-1)),c=Math.floor(255*Math.max(0,e-1-2*o)/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.SPECTRUM:a=.8-a;var S=r(a,s,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")";break;case n.GRAYSCALE:case n.BLACK:u=g=c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.RED:u=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.GREEN:g=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.BLUE:c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.DUALSHADE:default:var d=o/(e-1);a=.8*(1-d),l=.2+1.6*Math.abs(.5-d);var S=r(a,s,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")"}}return i}},EJSS_DRAWING2D.colorMapper=function(e,t){var r,n,i,o=EJSS_DRAWING2D.ColorMapper,a={},s=[],l="darkgray",u="lightgray",g=-1,c=1;return a.setChangeListener=function(e){r=e},a.setPaletteType=function(t){"string"==typeof t&&(t=EJSS_DRAWING2D.ColorMapper[t.toUpperCase()]),n=t,l="darkgray",u="lightgray",n!=EJSS_DRAWING2D.ColorMapper.GRAYSCALE&&n!=EJSS_DRAWING2D.ColorMapper.BLACK||(l="rgb(64,64,128)",u="rgb(255,191,191)"),e=Math.max(2,e),s=o.getColorPalette(e,n),r&&r("palette")},a.getColors=function(){return s},a.getFloorColor=function(){return l},a.getCeilColor=function(){return u},a.getNumColors=function(){return e},a.setFloorCeilColor=function(e,t){l=e,u=t},a.setScale=function(e,t){g=e,c=t,i=new Array(s.length+1);for(var r=(c-g)/s.length,n=0,o=s.length;n<o;n++)i[n]=g+n*r;i[s.length]=c},a.getPaletteType=function(){return n},a.setColorPalette=function(t){l="darkgray",u="lightgray",s=t,e=t.length,n=EJSS_DRAWING2D.ColorMapper.CUSTOM,r&&r("colors")},a.setNumberOfColors=function(t){if(t!=e){if(e=t,n==EJSS_DRAWING2D.ColorMapper.CUSTOM){for(var i=[],o=0,s=Math.min(colors.length,e);o<s;o++)i[o]=colors[o];for(var o=colors.length;o<numColors;o++)i[o]=colors[colors.length-1];colors=i}else a.setPaletteType(n);r&&r("numColors")}},a.getNumberOfColors=function(){return e},a.doubleToIndex=function(e){if(g-e>Number.MIN_VALUE)return-1;if(e-c>Number.MIN_VALUE)return s.length;var t=0;return c!=g&&(t=Math.floor(s.length*(e-g)/(c-g))),t=Math.max(0,t),Math.min(t,s.length-1)},a.indexToColor=function(e){return e<0?l:e>=s.length?u:s[e]},a.getColorThresholds=function(){return i},a.setPaletteType(t),a.setScale(-1,1),a};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Font={FONTSTYLES:["normal","italic","oblique","initial"],FONTWEIGHTS:["normal","lighter","bold","bolder","initial","100","200","300","400","500","600","700","800","900"],copyTo:function(e,t){t.setFontFamily(e.getFontFamily()),t.setFontSize(e.getFontSizeString()),t.setLetterSpacing(e.getLetterSpacing()),t.setOutlineColor(e.getOutlineColor()),t.setFontWeight(e.getFontWeight()),t.setFillColor(e.getFillColor())}},EJSS_DRAWING2D.font=function(e){var t,r={},n="Arial",i="20",o="normal",a="none",s="normal",l="black",u="none";return r.setChangeListener=function(e){t=e},r.setFontFamily=function(e){n!=e&&(n=e,t&&t("fontFamily"))},r.getFontFamily=function(){return n},r.setFontSize=function(e){i!=e&&(i=e,t&&t("fontSize"))},r.getFontSize=function(){var e;return e=isNaN(i)?i.indexOf("em")!=-1?10*+i.substr(0,i.indexOf("em")):i.indexOf("px")!=-1?+i.substr(0,i.indexOf("px")):0:+i},r.getFontSizeString=function(){return i},r.setLetterSpacing=function(e){o!=e&&(o=e,t&&t("letterSpacing"))},r.getLetterSpacing=function(){return o},r.getNumberLetterSpacing=function(){var e;return e=isNaN(o)?o.indexOf("px")!=-1?+o.substr(0,o.indexOf("px")):1:+o},r.setOutlineColor=function(e){a!=e&&(a=e,t&&t("lineColor"))},r.getOutlineColor=function(){return a},r.setFontWeight=function(e){s!=e&&FONTWEIGHTS.indexOf(e)>-1&&(s=e,t&&t("fontWeight"))},r.getFontWeight=function(){return s},r.setFillColor=function(e){l!=e&&(l=e,t&&t("fillColor"))},r.getFillColor=function(){return l},r.setFontStyle=function(e){u!=e&&FONTSTYLES.indexOf(e)>-1&&(u=e,t&&t("fontstyle"))},r.getFontStyle=function(){return u},r.getFont=function(){return u+" "+mLineWidth+" "+i+" "+n},r.setFont=function(e){if(!("string"!=typeof e||e.length<=0)){var t=e.split(" ");u=t[0],s=t[1];var r=t[2].split("/");i=r[0],t[3]&&(n=e.substring(e.indexOf(t[3])))}},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.functionsParser=function(){function e(e){function t(){}return t.prototype=e,new t}function t(e,t,r,n){this.type_=e,this.index_=t||0,this.prio_=r||0,this.number_=void 0!==n&&null!==n?n:0,this.toString=function(){switch(this.type_){case m:return this.number_;case A:case y:case v:return this.index_;case P:return"CALL";default:return"Invalid Token"}}}function r(e,t,r,n){this.tokens=e,this.ops1=t,this.ops2=r,this.functions=n}function n(e){return"string"==typeof e?(D.lastIndex=0,D.test(e)?"'"+e.replace(D,function(e){var t=I[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+e+"'"):e}function i(e,t){return Number(e)+Number(t)}function o(e,t){return e-t}function a(e,t){return e*t}function s(e,t){return e/t}function l(e,t){return e%t}function u(e,t){return""+e+t}function g(e){return-e}function c(e){return Math.random()*(e||1)}function S(e){e=Math.floor(e);for(var t=e;e>1;)t*=--e;return t}function d(e,t){return Math.sqrt(e*e+t*t)}function f(e){return e<0?0:1}function E(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:(e=e.slice(),e.push(t),e)}function p(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":g,exp:Math.exp},this.ops2={"+":i,"-":o,"*":a,"/":s,"%":l,"^":Math.pow,",":E,"||":u},this.functions={random:c,fac:S,min:Math.min,max:Math.max,pyt:d,step:f,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,pi:Math.PI,PI:Math.PI}}var h={},m=0,A=1,y=2,v=3,P=4,D=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,I={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};r.prototype={simplify:function(n){n=n||{};var i,o,a,s,l=[],u=[],g=this.tokens.length,c=0;for(c=0;c<g;c++){s=this.tokens[c];var S=s.type_;if(S===m)l.push(s);else if(S===v&&s.index_ in n)s=new t(m,0,0,n[s.index_]),l.push(s);else if(S===y&&l.length>1)o=l.pop(),i=l.pop(),a=this.ops2[s.index_],s=new t(m,0,0,a(i.number_,o.number_)),l.push(s);else if(S===A&&l.length>0)i=l.pop(),a=this.ops1[s.index_],s=new t(m,0,0,a(i.number_)),l.push(s);else{for(;l.length>0;)u.push(l.shift());u.push(s)}}for(;l.length>0;)u.push(l.shift());return new r(u,e(this.ops1),e(this.ops2),e(this.functions))},substitute:function(n,i){i instanceof r||(i=(new p).parse(String(i)));var o,a=[],s=this.tokens.length,l=0;for(l=0;l<s;l++){o=this.tokens[l];var u=o.type_;if(u===v&&o.index_===n)for(var g=0;g<i.tokens.length;g++){var c=i.tokens[g],S=new t(c.type_,c.index_,c.prio_,c.number_);a.push(S)}else a.push(o)}var d=new r(a,e(this.ops1),e(this.ops2),e(this.functions));return d},evaluate:function(e){e=e||{};var t,r,n,i,o=[],a=this.tokens.length,s=0;for(s=0;s<a;s++){i=this.tokens[s];var l=i.type_;if(l===m)o.push(i.number_);else if(l===y)r=o.pop(),t=o.pop(),n=this.ops2[i.index_],o.push(n(t,r));else if(l===v)if(i.index_ in e)o.push(e[i.index_]);else{if(!(i.index_ in this.functions))throw new Error("undefined variable: "+i.index_);o.push(this.functions[i.index_])}else if(l===A)t=o.pop(),n=this.ops1[i.index_],o.push(n(t));else{if(l!==P)throw new Error("invalid Expression");if(t=o.pop(),n=o.pop(),!n.apply||!n.call)throw new Error(n+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?o.push(n.apply(void 0,t)):o.push(n.call(void 0,t))}}if(o.length>1)throw new Error("invalid Expression (parity)");return o[0]},toString:function(e){var t,r,i,o,a=[],s=this.tokens.length,l=0;for(l=0;l<s;l++){o=this.tokens[l];var u=o.type_;if(u===m)a.push(n(o.number_));else if(u===y)r=a.pop(),t=a.pop(),i=o.index_,e&&"^"==i?a.push("Math.pow("+t+","+r+")"):a.push("("+t+i+r+")");else if(u===v)a.push(o.index_);else if(u===A)t=a.pop(),i=o.index_,"-"===i?a.push("("+i+t+")"):a.push(i+"("+t+")");else{if(u!==P)throw new Error("invalid Expression");t=a.pop(),i=a.pop(),a.push(i+"("+t+")")}}if(a.length>1)throw new Error("invalid Expression (parity)");return a[0]},variables:function(){for(var e=this.tokens.length,t=[],r=0;r<e;r++){var n=this.tokens[r];n.type_===v&&t.indexOf(n.index_)==-1&&t.push(n.index_)}return t},toJSFunction:function(e,t){var r=new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }");return r}},h.parse=function(e){return(new p).parse(e)},h.evaluate=function(e,t){return p.parse(e).evaluate(t)},p.Expression=r,p.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:c,fac:S,exp:Math.exp,min:Math.min,max:Math.max,pyt:d,step:f,pow:Math.pow,atan2:Math.atan2,E:Math.E,pi:Math.PI,PI:Math.PI};var _=1,C=2,R=4,T=8,N=16,O=32,M=64,b=128,G=256;return p.prototype={parse:function(n){this.errormsg="",this.success=!0;var i=[],o=[];this.tmpprio=0;var a=_|T|R|M,s=0;for(this.expression=n,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&a&M?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",s++,this.addfunc(o,i,A)),a=_|T|R|M):this.isComment()||(0===(a&C)&&this.error_parsing(this.pos,"unexpected operator"),s+=2,this.addfunc(o,i,y),a=_|T|R|M);else if(this.isNumber()){0===(a&_)&&this.error_parsing(this.pos,"unexpected number");var l=new t(m,0,0,this.tokennumber);o.push(l),a=C|N|O}else if(this.isString()){0===(a&_)&&this.error_parsing(this.pos,"unexpected string");var l=new t(m,0,0,this.tokennumber);o.push(l),a=C|N|O}else if(this.isLeftParenth())0===(a&T)&&this.error_parsing(this.pos,'unexpected "("'),a&b&&(s+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(o,i,P)),a=_|T|R|M|G;else if(this.isRightParenth()){if(a&G){var l=new t(m,0,0,[]);o.push(l)}else 0===(a&N)&&this.error_parsing(this.pos,'unexpected ")"');a=C|N|O|T|b}else if(this.isComma())0===(a&O)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(o,i,y),s+=2,a=_|T|R|M;else if(this.isConst()){0===(a&_)&&this.error_parsing(this.pos,"unexpected constant");var u=new t(m,0,0,this.tokennumber);o.push(u),a=C|N|O}else if(this.isOp2())0===(a&R)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,y),s+=2,a=T;else if(this.isOp1())0===(a&R)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,A),s++,a=T;else if(this.isVar()){0===(a&_)&&this.error_parsing(this.pos,"unexpected variable");var g=new t(v,this.tokenindex,0,0);o.push(g),a=C|N|O|T|b}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');i.length>0;){var c=i.pop();o.push(c)}return s+1!==o.length&&this.error_parsing(this.pos,"parity"),new r(o,e(this.ops1),e(this.ops2),e(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,r,n){for(var i=new t(n,this.tokenindex,this.tokenprio+this.tmpprio,0);r.length>0&&i.prio_<=r[r.length-1].prio_;)e.push(r.pop());r.push(i)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var r=this.expression.charCodeAt(this.pos);if(!(r>=48&&r<=57||46===r))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e.charAt(i);if(n){switch(o){case"'":r.push("'");break;case"\\":r.push("\\");break;case"/":r.push("/");break;case"b":r.push("\b");break;case"f":r.push("\f");break;case"n":r.push("\n");break;case"r":r.push("\r");break;case"t":r.push("\t");break;case"u":var a=parseInt(e.substring(i+1,i+5),16);r.push(String.fromCharCode(a)),i+=4;break;default:throw this.error_parsing(t+i,"Illegal escape sequence: '\\"+o+"'")}n=!1}else"\\"==o?n=!0:r.push(o)}return r.join("")},isString:function(){var e=!1,t="",r=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){var n=this.expression.charAt(this.pos);if("'"==n&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,r),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}return e},isConst:function(){var e;for(var t in this.consts){var r=t.length;if(e=this.expression.substr(this.pos,r),t===e)return this.tokennumber=this.consts[t],this.pos+=r,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else{if(94!==e)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e},isPositiveSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 43===e},isNegativeSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e},isLeftParenth:function(){var e=this.expression.charCodeAt(this.pos);return 40===e&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){var e=this.expression.charCodeAt(this.pos);return 41===e&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){var e=this.expression.charCodeAt(this.pos);return 44===e&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return(32===e||9===e||10===e||13===e)&&(this.pos++,!0)},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&e in this.ops1&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&e in this.ops2&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0)},isComment:function(){var e=this.expression.charCodeAt(this.pos-1);return 47===e&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},h};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InteractionTarget={ENABLED_FIXED:0,ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,SENSITIVITY_BOTH:0,SENSITIVITY_HORIZONTAL:1,SENSITIVITY_VERTICAL:2,SENSITIVITY_ANY:3,copyTo:function(e,t){t.setMotionEnabled(e.getMotionEnabled()),t.setAffectsGroup(e.getAffectsGroup()),t.setActionCommand(e.getActionCommand()),t.setDataObject(e.getDataObject()),t.setSensitivity(e.getSensitivity())}},EJSS_DRAWING2D.interactionTarget=function(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i={},o=EJSS_DRAWING2D.Element,a=n.ENABLED_NONE,s=!1,l=null,u=null,g=20,c=n.SENSITIVITY_BOTH;return i.getElement=function(){return e},i.getType=function(){return t},i.setMotionEnabled=function(e){"string"==typeof e?(value=n[e.toUpperCase()],a="undefined"==typeof value?n.ENABLED_NONE:value):a=e},i.getMotionEnabled=function(){return a},i.setSensitivityType=function(e){c="string"==typeof e?n[e.toUpperCase()]:e},i.getSensitivityType=function(){return c},i.isEnabled=function(){return a!=n.ENABLED_NONE},i.setPositionOffset=function(e){r=e},i.getPixelPosition=function(){var t=e.getPixelPosition(),n=e.getPixelSizes(),i=e.getRelativePositionOffset(n),a=t[0]+i[0],s=t[1]+i[1],l=e.getPanel().getInvertedScaleY(),u=o.getRelativePositionOffset(r,n[0],n[1],l);return[a-u[0],s-u[1]]},i.getPosition=function(){var t=e.getAbsolutePosition(),n=e.getAbsoluteSize(),i=e.getPanel().getInvertedScaleY(),a=o.getRelativePositionOffset(r,n[0],n[1],i),s=e.getRelativePositionOffset(n),l=t[0]+s[0]-a[0],u=t[1]+s[1]-a[1];return[l,u]},i.setAffectsGroup=function(e){s=e},i.getAffectsGroup=function(){return s},i.setSensitivity=function(e){g=e},i.getSensitivity=function(){return g},i.setActionCommand=function(e){l=e},i.getActionCommand=function(){return l},i.setDataObject=function(e){u=e},i.getDataObject=function(){return u},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PanelInteraction={TARGET_POSITION:0,TARGET_SIZE:1},EJSS_DRAWING2D.panelInteraction=function(e){function t(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i=EJSS_DRAWING2D.PanelInteraction;if(t.getType()===i.TARGET_POSITION){var o=t.getPosition(),a=r[0]-o[0],s=r[1]-o[1];switch(t.getMotionEnabled()){case n.ENABLED_ANY:e.setX(e.getX()+a),e.setY(e.getY()+s),e.getController().propertiesChanged("Position","X","Y");break;case n.ENABLED_X:e.setX(e.getX()+a),e.getController().propertiesChanged("Position","X");break;case n.ENABLED_Y:e.setY(e.getY()+s),e.getController().propertiesChanged("Position","Y")}}else if(t.getType()===i.TARGET_SIZE){var o=t.getPosition(),a=r[0]-o[0],s=r[1]-o[1],l=t.getElement(),u=l.getAbsoluteSize();0===u[0]&&(u[0]=1e-5),0===u[1]&&(u[1]=1e-5);var g=[a/u[0],s/u[1]],c=e.getSize();switch(0===c[0]&&0!==g[0]&&(c[0]=1e-5),0===c[1]&&0!==g[0]&&(c[1]=1e-5),t.getMotionEnabled()){case n.ENABLED_ANY:e.setSizeX(c[0]+c[0]*g[0]),e.setSizeY(c[1]+c[1]*g[1]),e.getController().propertiesChanged("Size","SizeX","SizeY");break;case n.ENABLED_X:e.setSizeX(c[0]+c[0]*g[0]),e.getController().propertiesChanged("Size","SizeX");break;case n.ENABLED_Y:e.setSizeY(c[1]+c[1]*g[1]),e.getController().propertiesChanged("Size","SizeY")}}}function r(t){var r=e.getGraphics().getBox(),n=r.left,i=r.top,o=[];if("undefined"!=typeof t.changedTouches)for(var a=0;a<t.changedTouches.length;a++)o[a]=[],o[a][0]=t.changedTouches[a].pageX-window.pageXOffset-n,
o[a][1]=t.changedTouches[a].pageY-window.pageYOffset-i;else o[0]=[],o[0][0]=(t.clientX||t.x)-n,o[0][1]=(t.clientY||t.y)-i;return o}var n={},i=EJSS_DRAWING2D.PanelInteraction,o=!1,a=!1,s=!1,l=[],u=[],g=null,c=!1,S=!1,d=0,f="move",E=0;n.reload=function(){l=[],u=[],g=null,S=!1,d=0,E=0,o=!o,n.setEnabled(!o),a=!a,n.setStopGestures(!a)},n.getPanel=function(){return e},n.getEnabled=function(){return o},n.setStopMoveEvents=function(e){s!=e&&(s=e,s?n.setHandler("move",function(){return!0}):n.setHandler("move",n.handleMouseMoveEvent))},n.setStopGestures=function(e){a!=e&&(a=e,a?(n.setHandler("gesturestart",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gesturechange",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gestureend",function(e){return e.preventDefault(),e.stopPropagation(),!1})):(n.setHandler("gesturestart",function(){return!0}),n.setHandler("gesturechange",function(){return!0}),n.setHandler("gestureend",function(){return!0})))},n.setEnabled=function(e){o!=e&&(o=e,o?(s||n.setHandler("move",n.handleMouseMoveEvent),n.setHandler("down",n.handleMouseDownEvent),n.setHandler("up",n.handleMouseUpEvent)):(n.setHandler("move",function(){return!0}),n.setHandler("down",function(){return!0}),n.setHandler("up",function(){return!0})))},n.setCursorTypeForMove=function(e){f=e},n.getInteractionPoint=function(){return l},n.getInteractionBounds=function(){return 0==u.length||0==l.length?[]:[u[0],l[0],u[1],l[1]]},n.getInteractionElement=function(){return g},n.getOrientation=function(){return window.orientation},n.handleMouseMoveEvent=function(i){a&&(i.preventDefault(),i.stopPropagation());var s=r(i);if(l=e.toPanelPosition(s[s.length-1]),S)if(null!=g){var u=g.getAffectsGroup()?g.getElement().getGroup():g.getElement();t(u,g,l),u.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else if(c)o&&e.getController().invokeAction("OnDrag");else for(var d=0;d<s.length;d++){var E=n.findInteractionTarget(e.getElements(),s[d]);if(null!=E){var u=E.getAffectsGroup()?E.getElement().getGroup():E.getElement(),p=e.toPanelPosition(s[d]);t(u,E,p),u.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else o&&e.getController().invokeAction("OnDrag")}else{var E=n.findInteractionTarget(e.getElements(),s[0]);null===E?(null!=g&&g.getElement().getController().invokeAction("OnExit"),o&&e.getController().invokeAction("OnMove"),i.target.style.cursor="default"):(g!=E&&(null!=g&&g.getElement().getController().invokeAction("OnExit"),E.getElement().getController().invokeAction("OnEnter")),E.isEnabled()?i.target.style.cursor=f:i.target.style.cursor="default"),g=E}return e.getController().reportInteractions(),!1},n.handleMouseDownEvent=function(t){S=!0,s&&n.setHandler("move",n.handleMouseMoveEvent),a&&(t.preventDefault(),t.stopPropagation());var i=r(t);u=e.toPanelPosition(i[0]),l=e.toPanelPosition(i[i.length-1]);for(var d=!1,E=null,p=0;p<i.length;p++)E=n.findInteractionTarget(e.getElements(),i[p]),null!==E?(E.getElement().getController().invokeAction("OnPress"),t.target.style.cursor=f):o&&(e.getController().invokeAction("OnPress"),d=!0);var h="undefined"!=typeof t.touches?t.touches.length:1;return 1==i.length&&1==h?(g=E,c=d):(g=null,c=!1),e.getController().reportInteractions(),!1},n.handleMouseUpEvent=function(t){S=!1,s&&n.setHandler("move",function(){return!0}),a&&(t.preventDefault(),t.stopPropagation());var i=r(t);if(l=e.toPanelPosition(i[i.length-1]),null!=g)g.getElement().getController().invokeAction("OnRelease");else for(var u=0;u<i.length;u++){var c=n.findInteractionTarget(e.getElements(),i[u]);null!==c?c.getElement().getController().invokeAction("OnRelease"):o&&e.getController().invokeAction("OnRelease")}return t.timeStamp-d<500&&e.getController().invokeAction("OnDoubleClick"),d=t.timeStamp,t.target.style.cursor="default",e.getController().reportInteractions(),!1},n.findInteractionTarget=function(t,r){for(var o=EJSS_DRAWING2D.InteractionTarget,a=null,s=t.length-1;s>=0;s--){var l=t[s];if(l.isGroupVisible())if(l.getElements){if(a=n.findInteractionTarget(l.getElements(),r),null!==a)return a}else{for(var u=l.getInteractionTargets(),g=0;g<u.length;g++)if(u[g].isEnabled()){var c=u[g].getSensitivity();if(c>0){var S=u[g].getPixelPosition(),d=!1;switch(u[g].getSensitivityType()){case o.SENSITIVITY_HORIZONTAL:d=Math.abs(S[1]-r[1])<c;break;case o.SENSITIVITY_VERTICAL:d=Math.abs(S[0]-r[0])<c;break;case o.SENSITIVITY_ANY:d=Math.abs(S[0]-r[0])<c||Math.abs(S[1]-r[1])<c;break;default:d=Math.abs(S[0]-r[0])<c&&Math.abs(S[1]-r[1])<c}if(d)return E=s,u[g]}}if(a=l.getInteractionTarget(i.TARGET_POSITION),a.isEnabled()&&!a.getSensitivity()){var f=l.getBounds(),p=e.toPanelPosition(r);if(f.left<p[0]&&f.right>p[0]&&f.bottom<p[1]&&f.top>p[1])return E=s,a}}}return null},n.getIndexElement=function(){return E},n.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"gesturestart":i.addEventListener("gesturestart",r,!1);break;case"gesturechange":i.addEventListener("gesturechange",r,!1);break;case"gestureend":i.addEventListener("gestureend",r,!1)}return!1};var p=window.onorientationchange;window.onorientationchange=function(){p&&p(),e.getController().invokeAction("OnOrientationChange"),e.getController().reportInteractions()};var h=window.onresize;return window.onresize=function(){h&&h(),e.getController().invokeAction("OnResize"),e.getController().reportInteractions()},n.setStopGestures(!0),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Style={RENDER_AUTO:"auto",RENDER_OPTSPEED:"optimizeSpeed",RENDER_CRISPEDGES:"crispEdges",RENDER_GEOPRECISION:"geometricPrecision",copyTo:function(e,t){t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setAttributes(e.getAttributes()),t.setShapeRendering(e.getShapeRendering())}},EJSS_DRAWING2D.style=function(e){var t,r=EJSS_DRAWING2D.Style,n={},i=!0,o="black",a=.5,s=!0,l="none",u=r.RENDER_AUTO,g={};return n.setChangeListener=function(e){t=e},n.setDrawLines=function(e){e!=i&&(i=e,t&&t("drawlines"))},n.getDrawLines=function(){return i},n.setLineColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=o&&(o=e,t&&t("linecolor")),n},n.getLineColor=function(){return o},n.setLineWidth=function(e){e!=a&&(a=e,t&&t("linewidth"))},n.getLineWidth=function(){return a},n.setDrawFill=function(e){e!=s&&(s=e,t&&t("drawfill"))},n.getDrawFill=function(){return s},n.setFillColor=function(e){"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=l&&(l=e,t&&t("fillcolor"))},n.getFillColor=function(){return l},n.setShapeRendering=function(e){"RENDER"==e.substring(0,6)&&(e=r[e.toUpperCase()]),u!=e&&(u=e,t&&t("shaperendering"))},n.getShapeRendering=function(){return u},n.setAttributes=function(e){e!=g&&(g=e,t&&t("attributes"))},n.getAttributes=function(){return g},n.serialize=function(){return{mDrawLines:i,mLineColor:o,mLineWidth:a,mDrawFill:s,mFillColor:l,mShapeRendering:u,mAttributes:g}},n.unserialize=function(e){i=e.mDrawLines,o=e.mLineColor,a=e.mLineWidth,s=e.mDrawFill,l=e.mFillColor,u=e.mShapeRendering,g=e.mAttributes},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Transformation={compare:function(e,t){return e.radians==t.radians&&e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.e==t.e&&e.f==t.f}},EJSS_DRAWING2D.transformation=function(e){e=e||{a:1,b:0,c:0,d:1,e:0,f:0};var t={a:e.a,c:e.c,e:e.e,b:e.b,d:e.d,f:e.f,radians:0};return t.toString=function(){return"a="+t.a+", c="+t.c+", e="+t.e+"\nb="+t.b+", d="+t.d+", f="+t.f},t.setToIdentity=function(){t.a=1,t.c=0,t.e=0,t.b=0,t.d=1,t.f=0,radians=0},t.setTransform=function(e){Array.isArray(e)&&e.length>5?(t.a=e[0],t.c=e[2],t.e=e[4],t.b=e[1],t.d=e[3],t.f=e[5]):(t.a=e.a,t.c=e.c,t.e=e.e,t.b=e.b,t.d=e.d,t.f=e.f,t.radians=e.radians)},t.setToTranslation=function(e,r){t.a=1,t.c=0,t.e=e,t.b=0,t.d=1,t.f=r},t.setToRotation=function(e){var r=Math.cos(e),n=Math.sin(e);t.a=r,t.c=-n,t.e=0,t.b=n,t.d=r,t.f=0,t.radians=e},t.getRotation=function(){return t.radians},t.translate=function(e,r){t.e+=e,t.f+=r},t.scale=function(e,r){t.a*=e,t.b*=e,t.c*=r,t.d*=r},t.concatenate=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f;t.a=r*e.a+i*e.b,t.b=n*e.a+o*e.b,t.c=r*e.c+i*e.d,t.d=n*e.c+o*e.d,t.e=r*e.e+i*e.f+a,t.f=n*e.e+o*e.f+s,t.radians+=e.radians},t.transform=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n+t.e,e[1]=t.b*r+t.d*n+t.f,e},t.transformVector=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n,e[1]=t.b*r+t.d*n,e},t.inverseTransform=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f,l=r*o-n*i;if(0===l)return null;var u=e[0],g=e[1];return e[0]=(o*u-i*g+(i*s-o*a))/l,e[1]=(-n*u+r*g+(n*a-r*s))/l,e},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Video={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("VideoUrl",e.setVideoUrl),t.registerProperty("CurrentTime",e.setCurrentTime),t.registerProperty("ShowControls",e.setControls),t.registerProperty("AutoPlay",e.setAutoPlay),t.registerProperty("Type",e.setType),t.registerProperty("Poster",e.setPoster),t.registerProperty("Loop",e.setLoop),t.registerProperty("WebCam",e.setWebCam)}},EJSS_DRAWING2D.video=function(e){var t,r=EJSS_DRAWING2D.element(e),n=!1,i=!1,o="",a="",s=!0,l=0,u=!0,g=!0;return r.getClass=function(){return"ElementVideo"},r.setLoop=function(e){n!=e&&(n=e,r.setChanged(!0))},r.getLoop=function(){return n},r.setPoster=function(e){a!=e&&(a=e,r.setChanged(!0))},r.getPoster=function(){return a},r.setType=function(e){o!=e&&(o=e,r.setChanged(!0))},r.getType=function(){return o},r.setAutoPlay=function(e){s!=e&&(s=e,g=e,r.setChanged(!0))},r.getAutoPlay=function(){return s},r.setWebCam=function(e){i!=e&&(i=e,r.setChanged(!0))},r.getWebCam=function(){return i},r.setVideoUrl=function(e){t!=e&&(t=e,r.setChanged(!0))},r.getVideoUrl=function(){return t},r.setCurrentTime=function(e){l!=e&&(l=e,r.setChanged(!0))},r.getCurrentTime=function(){return l},r.setControls=function(e){u!=e&&(u=e,r.setChanged(!0))},r.getControls=function(){return u},r.play=function(){g||(g=!0,r.setChanged(!0))},r.stop=function(){g&&(g=!1,s=!1,r.setChanged(!0))},r.isPlay=function(){return g},r.registerProperties=function(e){EJSS_DRAWING2D.Video.registerProperties(r,e)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.WebCamImage={registerProperties:function(e,t){EJSS_DRAWING2D.Image.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("On",e.setOnOff,e.isOnOff)}},EJSS_DRAWING2D.webCamImage=function(e){var t=EJSS_DRAWING2D.image(e);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var r,n,i=!0;return t.setUrl=function(e){r=e},t.getUrl=function(){return r},t.setOnOff=function(e){e?i||t.play():i&&t.pause()},t.isOnOff=function(){return i},t.play=function(){r&&r!=t.getImageUrl()&&(n=t.getImageUrl(),"local:"==r?navigator.getUserMedia?navigator.getUserMedia({video:!0},function(e){window.webkitURL?t.forceImageUrl(window.webkitURL.createObjectURL(e)):t.forceImageUrl(e)},errorCallback):t.setImageUrl(n):t.setImageUrl(r)),i=!0},t.pause=function(){i=!1,n&&t.setImageUrl(n)},t.registerProperties=function(e){EJSS_DRAWING2D.WebCamImage.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticCurve={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints),t.registerProperty("MinValue",e.setMinValue),t.registerProperty("MaxValue",e.setMaxValue),t.registerProperty("Variable",e.setVariable),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticCurve=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.functionsParser(),n="t",i="t",o="0",a=screen.width/10,s=0,l=0,u="t";return t.getClass=function(){return"ElementAnalyticCurve"},t.setNumPoints=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMinValue=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMaxValue=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints=function(){return a},t.getMinValue=function(){return s},t.getMaxValue=function(){return l},t.getVariable=function(){return u},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticCurve.registerProperties(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticSurface={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints1",e.setNumPoints1),t.registerProperty("MinValue1",e.setMinValue1),t.registerProperty("MaxValue1",e.setMaxValue1),t.registerProperty("Variable1",e.setVariable1),t.registerProperty("NumPoints2",e.setNumPoints2),t.registerProperty("MinValue2",e.setMinValue2),t.registerProperty("MaxValue2",e.setMaxValue2),t.registerProperty("Variable2",e.setVariable2),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticSurface=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.functionsParser(),n="u",i="v",o="0",a=100,s=0,l=0,u="u",g=100,c=0,S=0,d="v";return t.getClass=function(){return"ElementAnalyticSurface"},t.setNumPoints1=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMinValue1=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMaxValue1=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable1=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setNumPoints2=function(e){g!=e&&(g=e,t.setMeshChanged(!0))},t.setMinValue2=function(e){c!=e&&(c=e,t.setMeshChanged(!0))},t.setMaxValue2=function(e){S!=e&&(S=e,t.setMeshChanged(!0))},t.setVariable2=function(e){d!=e&&(d=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints1=function(){return a},t.getMinValue1=function(){return s},t.getMaxValue1=function(){return l},t.getVariable1=function(){return u},t.getNumPoints2=function(){return g},t.getMinValue2=function(){return c},t.getMaxValue2=function(){return S},t.getVariable2=function(){return d},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticSurface.registerProperties(t,e)},t.setSize([1,1,1]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Arrow={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setHeadHeight(e.getHeadHeight()),t.setHeadWidth(e.getHeadWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("HeadHeight",e.setHeadHeight),t.registerProperty("HeadWidth",e.setHeadWidth)}},EJSS_DRAWING3D.arrow=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=0,i=0,o=1,a=1,s=1,l=8,u=20;return t.getClass=function(){return"ElementArrow"},t.setHeadHeight=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.getHeadHeight=function(){return l},t.setHeadWidth=function(e){u!=e&&(u=wh,t.setMeshChanged(!0))},t.getHeadWidth=function(){return u},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getY=function(){return n},t.setZ=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getZ=function(){return i},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,n,i]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return a},t.getSizeZ=function(){return s},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.registerProperties=function(e){EJSS_DRAWING3D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Arrow.copyTo(t,e)},t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!0),t.getStyle().setLineWidth(3),t.setResolution([10,2]),t},EJSS_DRAWING3D.ArrowSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("HeadHeight",function(t){e.setToEach(function(e,t){e.setHeadHeight(t)},t)}),t.registerProperty("HeadWidth",function(t){e.setToEach(function(e,t){e.setHeadWidth(t)},t)})}},EJSS_DRAWING3D.arrowSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.arrow,e),r=EJSS_DRAWING3D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Basic={object_files:{},copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setVertices(e.getVertices()),t.setTriangles(e.getTriangles()),t.setNormals(e.getNormals()),t.setColors(e.getColors())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Description",e.setDescription),t.registerProperty("Vertices",e.setVertices),t.registerProperty("Triangles",e.setTriangles),t.registerProperty("Normals",e.setNormals),t.registerProperty("Colors",e.setColors)}},EJSS_DRAWING3D.basic=function(e){var t=EJSS_DRAWING3D.element(e),r=[],n=[],i=[],o=[];return t.getClass=function(){return"ElementBasic"},t.setDescription=function(e){var r=t.getPanel();if(r&&r.supportsWebGL()){if("string"==typeof e){var n="Object3D_"+EJSS_TOOLS.File.plainName(e);return void t.setDescription(window[n])}e.vertices&&t.setVertices(e.vertices),e.triangles&&t.setTriangles(e.triangles),e.normals&&t.setNormals(e.normals),e.colors&&t.setColors(e.colors)}},t.setVertices=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getVertices=function(){return r},t.setTriangles=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getTriangles=function(){return n},t.setNormals=function(e){EJSS_TOOLS.compareArrays(i,e)||(i=e.slice(),t.setMeshChanged(!0))},t.getNormals=function(){return i},t.setColors=function(e){EJSS_TOOLS.compareArrays(o,e)||(o=e.slice(),t.setMeshChanged(!0))},t.getColors=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Basic.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Basic.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BasicSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Description",function(t){e.setToEach(function(e,t){e.setDescription(t)},t)}),t.registerProperty("Vertices",function(t){e.setToEach(function(e,t){e.setVertices(t)},t)}),t.registerProperty("Triangles",function(t){e.setToEach(function(e,t){e.setTriangles(t)},t)}),t.registerProperty("Normals",function(t){e.setToEach(function(e,t){e.setNormals(t)},t)}),t.registerProperty("Colors",function(t){e.setToEach(function(e,t){e.setColors(t)},t)})}},EJSS_DRAWING3D.basicSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.basic,e),r=EJSS_DRAWING3D.BasicSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Box={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setReduceZby(e.getReduceZby())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("ReduceZby",e.setReduceZby)}},EJSS_DRAWING3D.box=function(e){var t=EJSS_DRAWING3D.element(e),r=0;return t.getClass=function(){return"ElementBox"},t.setReduceZby=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getReduceZby=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Box.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Box.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BoxSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("ReduceZby",function(t){e.setToEach(function(e,t){e.setReduceZby(t)},t)})}},EJSS_DRAWING3D.boxSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.box,e),r=EJSS_DRAWING3D.BoxSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cone={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.cone=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementCone"},t.registerProperties=function(e){EJSS_DRAWING3D.Cone.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cone.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t},EJSS_DRAWING3D.ConeSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.coneSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cone,e),r=EJSS_DRAWING3D.ConeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cylinder={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU)}},EJSS_DRAWING3D.cylinder=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=1,o=1;return t.getClass=function(){return"ElementCylinder"},t.setOriginAndEnd=function(e,r){var n=(e[0]+r[0])/2,i=(e[1]+r[1])/2,o=(e[2]+r[2])/2,a=r[0]-e[0],s=r[1]-e[1],l=r[2]-e[2],u=Math.sqrt(a*a+s*s+l*l),g=Math.acos(l/u);t.setPosition([n,i,o]),t.setSizeZ(u),t.setFirstTransformation([[g,-s,a,0,n,i,o]])},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Cylinder.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cylinder.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.CylinderSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.cylinderSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cylinder,e),r=EJSS_DRAWING3D.CylinderSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Disk={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t),t.setBaseDetail(e.getBaseDetail())},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.disk=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementDisk"},t.registerProperties=function(e){EJSS_DRAWING3D.Disk.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Disk.copyTo(t,e)},t.setSize([1,1,0]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.DrawingPanel={GRAPHICS3D_WEBGL:"WebGL",registerProperties:function(e,t){e.setController(t),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("MinimumZ",e.setWorldZMin,e.getWorldZMin),t.registerProperty("MaximumZ",e.setWorldZMax,e.getWorldZMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("CameraAzimuth",e.setCamAzimuth,e.getCamAzimuth),t.registerProperty("CameraAltitude",e.setCamAltitude,e.getCamAltitude),t.registerProperty("CameraX",e.setCamLocX,e.getCamLocX),t.registerProperty("CameraY",e.setCamLocY,e.getCamLocY),t.registerProperty("CameraZ",e.setCamLocZ,e.getCamLocZ),t.registerProperty("CameraLocation",e.setCamLoc,e.getCamLoc),t.registerProperty("CameraFocusX",e.setCamFocusX,e.getCamFocusX),t.registerProperty("CameraFocusY",e.setCamFocusY,e.getCamFocusY),t.registerProperty("CameraFocusZ",e.setCamFocusZ,e.getCamFocusZ),t.registerProperty("CameraFocus",e.setCamFocus,e.getCamFocus),t.registerProperty("Perspective",e.setFOV,e.getFOV),t.registerProperty("FieldOfView",e.setFOV,e.getFOV),t.registerProperty("CameraNear",e.setNear,e.getNear),t.registerProperty("CameraFar",e.setFar,e.getFar),t.registerProperty("AmbientLight",e.setAmbientLight,e.getAmbientLight),t.registerProperty("Lights",e.setLights,e.getLights),t.registerProperty("DecorationType",e.setDecorationType),t.registerProperty("VisibleDecorationBox",e.setVisibleDecorationBox),t.registerProperty("VisibleDecorationAxis",e.setVisibleDecorationAxis),t.registerProperty("VisibleDecorationBasicAxis",e.setVisibleDecorationBasicAxis),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Draggable",e.setDraggable),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineColor",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineWidth",e.getGraphics().getStyle().setBorderWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint),t.registerAction("OnPress",e.getInteraction().getInteractionPoint),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds),t.registerAction("OnZoom",e.getInteraction().getZoomDelta,e.getOnZoomHandler)}},EJSS_DRAWING3D.drawingPanel=function(e){var t,r={},n=EJSS_GRAPHICS.webGLGraphics(e),i=EJSS_DRAWING3D.style(e),o=[],a=[],s=!0,l=1,u=!1,g=[],c={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,zminPreferred:-1,zmaxPreferred:1},S=!0,d=!0,f={location:new Vector(4,0,0),focus:new Vector(0,0,0),azimuth:0,altitude:0},E=45,p=1,h=1e4,m=1,A=1,y=1,v=[[1,2,3]],P=[.7,.7,.7],D=!0,I=!0,_={propertiesChanged:function(){},invokeAction:function(){}};r.getName=function(){return e},r.getGraphics=function(){return n},r.supportsWebGL=function(){return n.supportsWebGL()},r.getStyle=function(){return i},r.setGraphics=function(t){t==EJSS_DRAWING3D.DrawingPanel.GRAPHICS3D_WEBGL?n=EJSS_GRAPHICS.webGLGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported")},r.setWorldXMin=function(e){e!==c.xminPreferred&&(c.xminPreferred=e,I=!0)},r.getWorldXMin=function(){return c.xminPreferred},r.setWorldXMax=function(e){e!==c.xmaxPreferred&&(c.xmaxPreferred=e,I=!0)},r.getWorldXMax=function(){return c.xmaxPreferred},r.setWorldYMin=function(e){e!==c.yminPreferred&&(c.yminPreferred=e,I=!0)},r.getWorldYMin=function(){return c.yminPreferred},r.setWorldYMax=function(e){e!==c.ymaxPreferred&&(c.ymaxPreferred=e,I=!0)},r.getWorldYMax=function(){return c.ymaxPreferred},r.setWorldZMin=function(e){e!==c.zminPreferred&&(c.zminPreferred=e,I=!0)},r.getWorldZMin=function(){return c.zminPreferred},r.setWorldZMax=function(e){e!==c.zmaxPreferred&&(c.zmaxPreferred=e,I=!0)},r.getWorldZMax=function(){return c.zmaxPreferred},r.setWorldCoordinates=function(e){r.setWorldXMin(e[0]),r.setWorldXMax(e[1]),r.setWorldYMin(e[2]),r.setWorldYMax(e[3]),r.setWorldZMin(e[4]),r.setWorldZMax(e[5])},r.getWorldCoordinates=function(){return[r.getWorldXMin(),r.getWorldXMax(),r.getWorldYMin(),r.getWorldYMax(),r.getWorldZMin(),r.getWorldZMax()]},r.getCamLocX=function(){return f.location.getx()},r.getCamLocY=function(){return f.location.gety()},r.getCamLocZ=function(){return f.location.getz()},r.getCamLoc=function(){f.location.toArray()},r.setCamLocX=function(e){f.location.getx()!=e&&(f.location.setx(e),S=!0),d=!1},r.setCamLocY=function(e){f.location.gety()!=e&&(f.location.sety(e),S=!0),d=!1},r.setCamLocZ=function(e){f.location.getz()!=e&&(f.location.setz(e),S=!0),d=!1},r.setCamLoc=function(e){r.setCamLocX(e[0]),r.setCamLocY(e[1]),r.setCamLocZ(e[2])},r.setCamAzimuth=function(e){f.azimuth!=e&&(f.azimuth=e,S=!0)},r.getCamAzimuth=function(){return f.azimuth},r.setCamAltitude=function(e){f.altitude!=e&&(f.altitude=e,S=!0)},r.getCamAltitude=function(){return f.altitude},r.getCamFocusX=function(){return f.focus.getx()},r.getCamFocusY=function(){return f.focus.gety()},r.getCamFocusZ=function(){return f.focus.getz()},r.getCamFocus=function(){f.focus.toArray()},r.setCamFocusX=function(e){f.focus.getx()!=e&&(f.focus.setx(e),S=!0),d=!1},r.setCamFocusY=function(e){f.focus.gety()!=e&&(f.focus.sety(e),S=!0),d=!1},r.setCamFocusZ=function(e){f.focus.getz()!=e&&(f.focus.setz(e),S=!0),d=!1},r.setCamFocus=function(e){r.setCamFocusX(e[0]),r.setCamFocusY(e[1]),r.setCamFocusZ(e[2])},r.setLights=function(e){v=e,I=!0},r.getLights=function(){return v},r.setAmbientLight=function(e){P=e,I=!0},r.getAmbientLight=function(){return P},r.setSizeX=function(e){m!==e&&(m=e,I=!0)},r.getSizeX=function(){return m},r.setSizeY=function(e){A!==e&&(A=e,I=!0)},r.getSizeY=function(){return A},r.setSizeZ=function(e){y!==e&&(y=e,I=!0)},r.getSizeZ=function(){return y},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setImageUrl=function(e){u=!0,null!=r.getResourcePath?e=r.getResourcePath(e):console.log("No getResourcePath function for panel. Texture = "+e),r.getGraphics().getStyle().setBackgroundImage(e)},r.isImageUrl=function(){return u},r.addDecoration=function(e,t){return EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(r),r},r.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),
e.setPanel&&e.setPanel(null),r},r.setVisibleDecorationBasicAxis=function(e){O.setVisible(e),M.setVisible(e),b.setVisible(e)},r.setVisibleDecorationAxis=function(e){R.setVisible(e),T.setVisible(e),N.setVisible(e)},r.setVisibleDecorationBox=function(e){C.setVisible(e)},r.setDecorationType=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"AXES":e=1;break;case"CUBE":e=2;break;case"CENTERED_AXES":e=3}switch(e){case 0:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 1:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!0);break;default:case 2:r.setVisibleDecorationBox(!0),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 3:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!0),r.setVisibleDecorationAxis(!1)}},r.addElement=function(e,t){EJSS_TOOLS.addToArray(a,e,t),e.setPanel(r),e.dataCollected&&g.push(e),s=!0},r.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(g,e),s=!0},r.getElements=function(){return a},r.indexOfElement=function(e){return a.indexOf(e)},r.getFOV=function(){return E},r.setFOV=function(e){E!==e&&(E=e,I=!0)},r.getFar=function(){return h},r.setFar=function(e){h!==e&&(h=e,I=!0)},r.getNear=function(){return p},r.setNear=function(e){p!==e&&(p=e,I=!0)},r.reset=function(){n.reset(E,p,h)},r.render=function(){s&&n.reset(E,p,h);for(var e=0,t=g.length;e<t;e++)g[e].dataCollected();if((D||s)&&n.drawPanel(r),I){for(e=0,t=o.length;e<t;e++)o[e].panelChangeListener&&o[e].panelChangeListener("bounds");if(d){var i=new Vector(m,A,y),l=new Vector(c.xminPreferred,c.yminPreferred,c.zminPreferred),u=new Vector(c.xmaxPreferred,c.ymaxPreferred,c.zmaxPreferred);f.focus=u.add(l).divide(2).multiply(i);var v=new Vector(c.xmaxPreferred,c.yminPreferred,c.zminPreferred),P=n.getAspect(),_=(c.ymaxPreferred-c.yminPreferred)*A/P,C=(c.zmaxPreferred-c.zminPreferred)*y*P,R=_>C?_:C,T=1.5*(R/4)/Math.tan(E*Math.PI/360),N=v.subtract(l).unit().multiply(T);f.location=f.focus.add(N)}}n.putCamera(f),n.draw(o),n.draw(a),I=!1,D=!1,S=!1,s=!1;for(var e=0,t=a.length;e<t;e++)a[e].setProjChanged(!1),a[e].setMeshChanged(!1)},r.setEnabled=function(e){t.setEnabled(e)},r.setDraggable=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"ANY":e=1;break;case"AZIMUTH":e=2;break;case"ALTITUDE":e=3}l=e},r.getPanelInteraction=function(){return t},r.getController=function(){return _},r.setController=function(e){_=e},r.getInteraction=function(){return t},r.registerProperties=function(e){EJSS_DRAWING3D.DrawingPanel.registerProperties(r,e)},r.getOnDragHandler=function(){if(l>0){var e=r.getPanelInteraction().getInteractionDeltas();if(2!=l&&1!=l||(f.azimuth+=e[0]),3==l||1==l){var t=Math.abs(f.azimuth%360);t>=270||t<=90?f.altitude+=e[1]:f.altitude-=e[1]}}r.getController().propertiesChanged("CameraAzimuth","CameraAltitude"),S=!0},r.getOnZoomHandler=function(){var e=r.getPanelInteraction().getInteractionZoomDelta(),t=f.focus.subtract(f.location);e>0?f.location=f.focus.subtract(t.multiply(1.1)):f.location=f.focus.subtract(t.divide(1.1)),r.getController().propertiesChanged("CameraLocation","CameraX","CameraY","CameraZ"),S=!0},i.setFillColor([.83,.85,1]),i.setMeshChangeListener(function(e){D=!0}),i.setProjChangeListener(function(e){D=!0});var C=EJSS_DRAWING3D.box(e+"box");C.getStyle().setDrawFill(!1),C.getStyle().setDrawLines(!0),C.getStyle().setLineWidth(2),C.getStyle().setLineColor("black"),C.setVisible(!0),C.setSize([2,2,2]),C.panelChangeListener=function(e){if("bounds"==e)var t=(c.xmaxPreferred+c.xminPreferred)/2;var r=(c.ymaxPreferred+c.yminPreferred)/2,n=(c.zmaxPreferred+c.zminPreferred)/2,i=Math.abs(c.xmaxPreferred-c.xminPreferred),o=Math.abs(c.ymaxPreferred-c.yminPreferred),a=Math.abs(c.zmaxPreferred-c.zminPreferred);C.setPosition([t,r,n]),C.setSize([i,o,a])},r.addDecoration(C,0);var R=EJSS_DRAWING3D.arrow(e+"axisX");R.getStyle().setLineWidth(2),R.setColor("red"),R.setVisible(!1),R.panelChangeListener=function(e){"bounds"==e&&R.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.xmaxPreferred-c.xminPreferred);R.setSize([t,0,0])},r.addDecoration(R,0);var T=EJSS_DRAWING3D.arrow(e+"axisY");T.setPosition([0,0,0]),T.setSize([0,1,0]),T.getStyle().setLineWidth(2),T.setColor("green"),T.setVisible(!1),T.panelChangeListener=function(e){"bounds"==e&&T.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.ymaxPreferred-c.yminPreferred);T.setSize([0,t,0])},r.addDecoration(T,0);var N=EJSS_DRAWING3D.arrow(e+"axisZ");N.setPosition([0,0,0]),N.setSize([0,0,1]),N.getStyle().setLineWidth(2),N.setColor("blue"),N.setVisible(!1),N.panelChangeListener=function(e){"bounds"==e&&N.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.zmaxPreferred-c.zminPreferred);N.setSize([0,0,t])},r.addDecoration(N,0);var O=EJSS_DRAWING3D.arrow(e+"baxisX");O.setPosition([0,0,0]),O.setSize([1,0,0]),O.getStyle().setLineWidth(2),O.setColor("red"),O.setVisible(!1),O.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.xmaxPreferred-c.xminPreferred)/2;O.setSize([t,0,0])},r.addDecoration(O,0);var M=EJSS_DRAWING3D.arrow(e+"baxisY");M.setPosition([0,0,0]),M.setSize([0,1,0]),M.getStyle().setLineWidth(2),M.setColor("green"),M.setVisible(!1),M.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.ymaxPreferred-c.yminPreferred)/2;M.setSize([0,t,0])},r.addDecoration(M,0);var b=EJSS_DRAWING3D.arrow(e+"baxisZ");return b.setPosition([0,0,0]),b.setSize([0,0,1]),b.getStyle().setLineWidth(2),b.setColor("blue"),b.setVisible(!1),b.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.zmaxPreferred-c.zminPreferred)/2;b.setSize([0,0,t])},r.addDecoration(b,0),t=EJSS_DRAWING3D.panelInteraction(r),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Element={copyTo:function(e,t){EJSS_DRAWING3D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setSize(e.getSize()),t.setTransformation(e.getTransformation()),t.setExtraTransformation(e.getExtraTransformation()),t.setTextureUrl(e.getTextureUrl()),t.setResolution(e.getResolution()),t.setParent(e.getParent())},registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Z",e.setZ,e.getZ),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("TextureUrl",e.setTextureUrl,e.getTextureUrl),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("AlwaysUpdated",e.setAlwaysUpdated,e.isAlwaysUpdated),t.registerProperty("Transparency",e.getStyle().setTransparency,e.getStyle().getTransparency),t.registerProperty("LineColor",e.getStyle().setLineColor,e.getStyle().getLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth,e.getStyle().getLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines,e.getStyle().getDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor,e.getStyle().getFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill,e.getStyle().getDrawFill),t.registerProperty("ClosedTop",e.getStyle().setClosedTop,e.getStyle().getClosedTop),t.registerProperty("ClosedBottom",e.getStyle().setClosedBottom,e.getStyle().getClosedBottom),t.registerProperty("ClosedLeft",e.getStyle().setClosedLeft,e.getStyle().getClosedLeft),t.registerProperty("ClosedRight",e.getStyle().setClosedRight,e.getStyle().getClosedRight),t.registerProperty("Resolution",e.setResolution),t.registerProperty("Color",e.setColor),t.registerProperty("EnabledPosition",function(e){}),t.registerProperty("MovesGroup",function(e){}),t.registerProperty("EnabledSize",function(e){}),t.registerProperty("ResizesGroup",function(e){}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition),t.registerAction("OnLoadTexture",null,null,function(){e.setProjChanged(!0)})}},EJSS_DRAWING3D.element=function(e){function t(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i.length>4?t.push(i):t.push(i.concat(r.getPosition()))}return t}var r={},n=EJSS_DRAWING3D.Element,i=EJSS_DRAWING3D.style(e),o=!0,a=!0,s="",l=0,u=0,g=0,c=1,S=1,d=1,f=[],E=[],p=[],h=null,m=null,A=null,y=-1,v=!0,P=!0,D=!1,I=20,_=20,C=0,R={propertiesChanged:function(){},invokeAction:function(){}};return r.copyTo=function(e){n.copyTo(r,e)},r.getName=function(){return e.replace(/\[|\]/g,"")},r.setTextureUrl=function(e){var t=null!=A?A.getResourcePath:r.getResourcePath;null!=t?e=t(e):console.log("No getResourcePath function for "+r.getName()+". Texture = "+e),s=e},r.getTextureUrl=function(){return s},r.setVisible=function(e){o=e},r.isVisible=function(){return o},r.isGroupVisible=function(){for(var e=m;"undefined"!=typeof e&&null!==e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},r.getStyle=function(){return i},r.setMeasured=function(e){a=e},r.isMeasured=function(){return a},r.setColor=function(e){r.getStyle().setFillColor(e),r.getStyle().setLineColor(e)},r.setResolution=function(e){Array.isArray(e)?(r.setResolutionU(e[0]),r.setResolutionV(e[1]),e[2]&&r.setResolutionR(e[2])):(r.setResolutionU(e),r.setResolutionV(e))},r.getResolution=function(){return[I,_,C]},r.setResolutionU=function(e){I!=e&&(I=e,v=!0)},r.getResolutionU=function(){return I},r.setResolutionV=function(e){_!=e&&(_=e,v=!0)},r.getResolutionV=function(){return _},r.setResolutionR=function(e){C!=e&&(C=e,v=!0)},r.getResolutionR=function(){return C},r.setX=function(e){l!=e&&(l=e,P=!0)},r.getX=function(){return l},r.setY=function(e){u!=e&&(u=e,P=!0)},r.getY=function(){return u},r.setZ=function(e){g!=e&&(g=e,P=!0)},r.getZ=function(){return g},r.setPosition=function(e){r.setX(e[0]),r.setY(e[1]),r.setZ(e[2])},r.getPosition=function(){return[l,u,g]},r.setSizeX=function(e){c!=e&&(c=e,P=!0)},r.getSizeX=function(){return c},r.setSizeY=function(e){S!=e&&(S=e,P=!0)},r.getSizeY=function(){return S},r.setSizeZ=function(e){d!=e&&(d=e,P=!0)},r.getSizeZ=function(){return d},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setPanel=function(e){h=e,P=!0},r.getPanel=function(){return h},r.getGroupPanel=function(){for(var e=r;e.getGroup();)e=e.getGroup();return e.getPanel()},r.setGroup=function(e){m=e,P=!0},r.getGroup=function(){return m},r.setSet=function(e,t){A=e,y=t},r.getSetIndex=function(){return y},r.setParent=function(e){e.render?(r.setGroup(null),e.addElement(r),r.setPanel(e)):"ElementGroup"==e.getClass()?(r.setGroup(e),r.getGroupPanel().addElement(r),r.setPanel(r.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},r.getParent=function(){var e;return e=null!==m?r.getGroup():r.getPanel()},r.setTransformation=function(e){"undefined"!=typeof e&&null!==e||(e=[]),EJSS_TOOLS.compareArrays(f,e)||(f=e,P=!0)},r.setFirstTransformation=function(e){"undefined"!=typeof e&&null!==e||(e=[]),EJSS_TOOLS.compareArrays(f,e)||(p=e,P=!0)},r.setExtraTransformation=function(e){E=e},r.getExtraTransformation=function(){return E},r.addExtraTransformation=function(e){"undefined"!=typeof e&&null!==e&&(E.push(e),P=!0)},r.removeExtraTransformation=function(e){if("undefined"!=typeof e&&null!==e)for(var t=0;t<E.length;t++){var r=E[t];if(r===e)return E.splice(t,1),void(P=!0)}},r.getFullTransformation=function(){for(var e=t(p).concat(t(f)),r=0;r<E.length;r++)e.push(E[r].getArray());return e},r.getTransformation=function(){return f},r.getGroupTransformation=function(){for(var e=EJSS_DRAWING3D.transformation(),t=r;"undefined"!=typeof t&&null!==t;)e.concatenate(t.getFullTransformation()),t=t.getGroup();return e},r.isAlwaysUpdated=function(){return D},r.setAlwaysUpdated=function(e){D=e},r.isMeshChanged=function(){return v},r.setMeshChanged=function(e){v=e},r.isProjChanged=function(){return P},r.setProjChanged=function(e){P=e},r.isGroupChanged=function(){for(var e=r.getGroup();"undefined"!=typeof e&&null!==e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},r.getController=function(){return R},r.setController=function(e){R=e},r.registerProperties=function(e){n.registerProperties(r,e)},i.setMeshChangeListener(function(e){v=!0}),i.setProjChangeListener(function(e){P=!0}),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.ElementSet={registerProperties:function(e,t){e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Z",function(t){e.setToEach(function(e,t){e.setZ(t)},t)},function(){return e.getFromEach(function(e){return e.getZ()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("SizeZ",function(t){e.setToEach(function(e,t){e.setSizeZ(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeZ()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("TextureUrl",function(t){e.setToEach(function(e,t){e.setTextureUrl(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("ClosedTop",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedBottom",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedLeft",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedRight",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Resolution",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Color",function(t){e.setToEach(function(e,t){e.setColor(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){},t)});var r=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",r),t.registerAction("OnExit",r),t.registerAction("OnPress",r),t.registerAction("OnDrag",r),t.registerAction("OnRelease",r),t.registerAction("OnLoadTexture",null,null,function(){element.setProjChanged(!0)})}},EJSS_DRAWING3D.elementSet=function(e,t){var r=EJSS_DRAWING3D.group(t),n=EJSS_DRAWING3D.ElementSet,i=[],o=-1,a=[];r.setNumberOfElements=function(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){a=i.splice(t,o);for(var s=0;s<a.length;s++){var l=a[s].getPanel();l&&l.removeElement(a[s])}}else if(o<0){a=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;c<t;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}},r.getElements=function(){return i},r.getLastElements=function(){var e=a.slice();return a=[],e},r.setElementInteracted=function(e){o=e},r.getElementInteracted=function(){return o};var s=r.setPanel;r.setPanel=function(e){s(e);for(var t=0,r=i.length;t<r;t++)i[t].setPanel(e)},r.setProjChanged=function(e){for(var t=0,r=i.length;t<r;t++)i[t].setProjChanged(e)},r.setToEach=function(e,t){if(Array.isArray(t)){1==i.length&&r.setNumberOfElements(t.length);for(var n=0,o=Math.min(i.length,t.length);n<o;n++)e(i[n],t[n])}else for(var n=0,o=i.length;n<o;n++)e(i[n],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;r<n;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var l=e(t+"[0]");return l.setController(r.getController()),l.setSet(r,0),i.push(l),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Ellipsoid={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setMinAngleU(e.getMinAngleU()),t.setMaxAngleU(e.getMaxAngleU()),t.setMinAngleV(e.getMinAngleV()),t.setMaxAngleV(e.getMaxAngleV())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU),t.registerProperty("MinAngleV",e.setMinAngleV),t.registerProperty("MaxAngleV",e.setMaxAngleV)}},EJSS_DRAWING3D.ellipsoid=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=-90,o=90;return t.getClass=function(){return"ElementEllipsoid"},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setMinAngleV=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMinAngleV=function(){return i},t.setMaxAngleV=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getMaxAngleV=function(){return o},t.copyTo=function(e){EJSS_DRAWING3D.Ellipsoid.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Ellipsoid.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.EllipsoidSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("MinAngleV",function(t){e.setToEach(function(e,t){e.setMinAngleV(t)},t)}),t.registerProperty("MaxAngleV",function(t){e.setToEach(function(e,t){e.setMaxAngleV(t)},t)})}},EJSS_DRAWING3D.ellipsoidSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.ellipsoid,e),r=EJSS_DRAWING3D.EllipsoidSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Group={},EJSS_DRAWING3D.group=function(e){var t=EJSS_DRAWING3D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.panelInteraction=function(e){function t(t){var r,n;"undefined"!=typeof t.changedTouches&&1===t.changedTouches.length?(r=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(r=t.x||t.clientX,n=t.y||t.clientY);var i=e.getGraphics().getOffsetLeft(),o=e.getGraphics().getOffsetTop();return[r-i,n-o]}var r={},n=!1,i=[0,0],o=0,a=0,s=!1,l=0,u=0,g=0;return r.getPanel=function(){return e},r.getEnabled=function(){return n},r.setEnabled=function(e){n!=e&&(n=e,n?(r.setHandler("move",r.handleMouseMoveEvent),r.setHandler("down",r.handleMouseDownEvent),r.setHandler("up",r.handleMouseUpEvent),r.setHandler("mousewheel",r.handleMouseWheelEvent),r.setHandler("pinch",r.handlePinchGesture)):(r.setHandler("move",function(){}),r.setHandler("down",function(){}),r.setHandler("up",function(){}),r.setHandler("mousewheel",function(){}),r.setHandler("pinch",function(){})))},r.getInteractionPoint=function(){return i},r.getInteractionDeltas=function(){return[o,a]},r.getInteractionZoomDelta=function(){return u/3},r.handleMouseWheelEvent=function(t){var r="undefined"!=typeof t.touches?t.touches.length:0;0==r&&(t.preventDefault(),u=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},r.handlePinchGesture=function(t){t.timeStamp-l>100&&(t.preventDefault(),t.scale<g?u=1:t.scale>=g&&(u=-1),g=t.scale,e.getController().invokeAction("OnZoom"),e.getController().reportInteractions(),l=t.timeStamp)},r.handleMouseMoveEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;if(1==n){var l=i[0],u=i[1];i=t(r),o=i[0]-l,a=i[1]-u,s?(e.getController().invokeAction("OnDrag"),r.target.style.cursor="move"):r.target.style.cursor="default",e.getController().reportInteractions()}},r.handleMouseDownEvent=function(n){var o="undefined"!=typeof n.touches?n.touches.length:1;1==o&&(s=!0,i=t(n),e.getController().invokeAction("OnPress"),r.pick(i[0],i[1]),n.preventDefault(),e.getController().reportInteractions())},r.handleMouseUpEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;1==n&&(s=!1,i=t(r),e.getController().invokeAction("OnRelease"),r.target.style.cursor="default",r.timeStamp-l<500&&e.getController().invokeAction("OnDoubleClick"),l=r.timeStamp,e.getController().reportInteractions())},r.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;default:case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"mousewheel":i.addEventListener("mousewheel",r,!1);break;case"pinch":i.addEventListener("gesturestart",function(e){g=1},!1),i.addEventListener("gesturechange",r,!1)}return!1},r.pick=function(t,r){var n=t-1,i=r-1,o=1,a=1,s=e.getGraphics().getContext();if(s){var l=new Uint8Array(o*a*4);s.readPixels(n,i,o,a,s.RGBA,s.UNSIGNED_BYTE,l),l.data&&(l=l.data)}},r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Style={copyTo:function(e,t){t.setClosedTop(e.getClosedTop()),t.setClosedBottom(e.getClosedBottom()),t.setClosedLeft(e.getClosedLeft()),t.setClosedRight(e.getClosedRight()),t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setTransparency(e.getTransparency())}},EJSS_DRAWING3D.style=function(e){var t,r,n={},i=!0,o=!0,a=!0,s=!0,l=[0,0,0],u=[0,0,0],g=.5,c=!1,S=!0,d=0;return n.setProjChangeListener=function(e){t=e},n.setMeshChangeListener=function(e){r=e},n.setClosedTop=function(e){e!=i&&(i=e,r&&r("closedtop"))},n.getClosedTop=function(){return i},n.setClosedBottom=function(e){e!=o&&(o=e,r&&r("closedbottom"))},n.getClosedBottom=function(){return o},n.setClosedLeft=function(e){e!=a&&(a=e,r&&r("closedleft"))},n.getClosedLeft=function(){return a},n.setClosedRight=function(e){e!=s&&(s=e,r&&r("closedright"))},n.getClosedRight=function(){return s},n.setDrawLines=function(e){e!=c&&(c=e,t&&t("drawlines"))},n.getDrawLines=function(){return c},n.setLineColor=function(e){return"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,l)||(l=e.slice(),t&&t("linecolor")),n},n.getLineColor=function(){return l},n.setLineWidth=function(e){e!=g&&(g=e,t&&t("linewidth"))},n.getLineWidth=function(){return g},n.setDrawFill=function(e){e!=S&&(S=e,t&&t("drawfill"))},n.getDrawFill=function(){return S},n.setFillColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,u)||(u=e.slice(),t&&t("fillcolor"))},n.getFillColor=function(){return u},n.setTransparency=function(e){e!=d&&(d=e,t&&t("transparency"))},n.getTransparency=function(){return d},n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Transformation={registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("Axis",e.setAxis,e.getAxis),t.registerProperty("Angle",e.setAngle,e.getAngle),t.registerProperty("Origin",e.setOrigin,e.getOrigin)}},EJSS_DRAWING3D.rotationX=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([1,0,0]),t},EJSS_DRAWING3D.rotationY=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,1,0]),t},EJSS_DRAWING3D.rotationZ=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,0,1]),t},EJSS_DRAWING3D.transformation=function(e){var t={},r=null,n=[0,0,0,1,0,0,0],i={propertiesChanged:function(){},invokeAction:function(){}};return t.getArray=function(){return n},t.setChanged=function(e){e&&r.setProjChanged(!0)},t.setParent=function(e){r&&r.removeExtraTransformation(t),r=e,r&&r.addExtraTransformation(t)},t.getParent=function(){return r},t.setAngle=function(e){n[0]=e},t.getAngle=function(){return n[0]},t.setAxis=function(e){n[1]=e[0],n[2]=e[1],n[3]=e[2]},t.getAxis=function(){return n.slice(1,4)},t.setOrigin=function(e){n[4]=e[0],n[5]=e[1],n[6]=e[2]},t.getOrigin=function(){return n.slice(5)},t.getController=function(){return i},t.setController=function(e){i=e},t.registerProperties=function(e){EJSS_DRAWING3D.Transformation.registerProperties(t,e)},t};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticCurve=function(e,t){evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getNumPoints(),i=t.getMinValue(),o=t.getMaxValue(),a=Math.abs((o-i)/(n-1)),s=t.getExpressionX(),l=t.getExpressionY(),u=t.getExpressionZ(),g=t.getVariable(),c=i,S=0;S<n;S++){var d=evaluate(s,g,c),f=evaluate(l,g,c),E=evaluate(u,g,c);r.vertices.push([d,f,E]),0!=S&&r.lines.push([S-1,S]),c+=a}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticSurface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;i<e-1;i++)for(var o=0;o<t-1;o++){var a=r[o+i*t],s=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(a),n.vertices.push(s),n.vertices.push(l),n.vertices.push(u)}for(var g=(e-1)*(t-1)/2,i=0;i<8*g;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])},evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=t.getNumPoints1(),n=t.getMinValue1(),i=t.getMaxValue1(),o=t.getNumPoints2(),a=t.getMinValue2(),s=t.getMaxValue2(),l=Math.abs((i-n)/(r-1)),u=Math.abs((s-a)/(o-1)),g=t.getExpressionX(),c=t.getExpressionY(),S=t.getExpressionZ(),d=t.getVariable1(),f=t.getVariable2(),E=new Array,p=0,h=n,m=0;m<r;m++){for(var A=a,y=0;y<o;y++){var v=evaluate(g,d,h,f,A),P=evaluate(c,d,h,f,A),D=evaluate(S,d,h,f,A);E[p]=[v,P,D],p++,A+=u}h+=l}var I=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());return createSurfaceBuffers(r,o,E,I),I.computeNormals(),I.compile(),e.addElement(t.getName()+".mesh",I),I};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.arrow=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=new Vector(t.getSize()),i=(new Vector(t.getPosition()),n.length()),o=t.getResolutionV(),a=t.getResolutionU()+1,s=t.getHeadWidth(),l=t.getHeadHeight(),u=[],g=0;g<o;g++)for(var c=g/(o-1),S=c/s*i,d=0;d<a;d++){var f=d/(a-1),E=S*Math.sin(f*Math.PI*2),p=S*Math.cos(f*Math.PI*2),h=-c/l*i;u.push(new Vector(E,p,h))}var m=n.cross(new Vector(0,0,1));0==m.length()&&(m.y=1);var A=n.angle(new Vector(0,0,1)),y=new Matrix;Matrix.rotate(-A,m.x,m.y,m.z,0,0,0,y);for(var v=0;v<u.length;v++){var P=y.transformPoint(u[v]);r.vertices.push(P.add(n).toArray())}r.vertices.push(n.toArray()),r.vertices.push([0,0,0]),r.lines.push([r.vertices.length-1,r.vertices.length-2]);for(var g=0;g<o-1;g++)for(var d=0;d<a-1;d++){var D=g*a+d,I=(g+1)*a+d,_=(g+1)*a+d+1,C=g*a+d+1;r.triangles.push([_,I,D]),r.triangles.push([C,_,D]),r.lines.push([_,I]),r.lines.push([C,_]),r.lines.push([D,C])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.basic=function(e,t){return mesh=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),mesh.setVertices(t.getVertices()),mesh.setCoords(t.getVertices()),mesh.setTriangles(t.getTriangles()),mesh.setColors(t.getColors()),0!=t.getNormals().length?mesh.setNormals(t.getNormals()):mesh.computeNormals(),mesh.computeWireframe(),mesh.compile(),e.addElement(t.getName()+".mesh",mesh),mesh};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.box=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],i=[[0,0],[1,0],[0,1],[1,1]],o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],a=[[0,2,4,6],[1,3,5,7],[0,4,1,5],[2,6,3,7],[0,2,1,3],[4,6,5,7]],s=t.getStyle().getClosedTop(),l=t.getStyle().getClosedBottom(),u=t.getStyle().getClosedRight(),g=t.getStyle().getClosedLeft(),c=t.getReduceZby(),S=0;S<a.length;S++){for(var d=a[S],f=4*S,E=0;E<4;E++){var p=d[E];6==p||7==p?r.vertices.push([n[p][0],n[p][1],n[p][2]-2*c]):r.vertices.push(n[p]),r.coords.push(i[E]),r.normals.push(o[S])}2==S&&!g||3==S&&!u||4==S&&!s||5==S&&!l||(r.triangles.push([f,f+1,f+2]),r.triangles.push([f+2,f+1,f]),r.triangles.push([f+2,f+1,f+3]),r.triangles.push([f+3,f+1,f+2])),r.lines.push([f,f+1]),r.lines.push([f,f+2]),r.lines.push([f+2,f+3]),r.lines.push([f+1,f+3])}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.cylinder=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getResolutionV(),i=t.getResolutionU()+1,o=t.getRadiusTop(),a=t.getRadiusBottom(),s=t.getMinAngleU(),l=t.getMaxAngleU(),u=0,g=0,c=0;c<n;c++){var S=c/(n-1),d=S*(a-o)+o;g=Math.floor(s*i/360),u=Math.floor(l*i/360);for(var f=g;f<u;f++){var E=f/(i-1),p=d*Math.sin(E*Math.PI*2),h=d*Math.cos(E*Math.PI*2),m=2*-S+1;r.vertices.push([p,h,m]),r.coords.push([E,S])}}for(var c=0;c<n;c++){var m=-1+c*(2/(n-1));r.vertices.push([0,0,m]),r.coords.push([1,c/(n-1)])}for(var A=u-g,c=0;c<n-1;c++){for(var f=0;f<A-1;f++){var y=c*A+f,v=(c+1)*A+f,P=(c+1)*A+f+1,D=c*A+f+1;r.triangles.push([P,v,y]),r.triangles.push([D,P,y]),r.lines.push([P,v]),r.lines.push([D,P]),r.lines.push([y,D])}if(0!=s||360!=l){var I=r.vertices.length-(c+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([P,D,I-1]),r.triangles.push([D,I,I-1]),r.lines.push([P,I-1]),r.lines.push([D,I]),r.lines.push([I,I-1])),t.getStyle().getClosedRight()){var _=c*A,C=(c+1)*A;r.triangles.push([I-1,_,C]),r.triangles.push([I-1,I,_]),r.lines.push([C,_]),r.lines.push([C,I-1]),r.lines.push([_,I]),r.lines.push([I,I-1])}}}var R=t.getStyle().getClosedTop();if(R&&o>0){r.vertices.push([0,0,1]);
for(var T=0;T<A-1;T++)r.triangles.push([r.vertices.length-1,T+1,T]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}var N=t.getStyle().getClosedBottom();if(N&&a>0){r.vertices.push([0,0,-1]);for(var T=(n-1)*A;T<A*n;T++)r.triangles.push([T,T+1,r.vertices.length-1]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}return 0==s&&360==l?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.ellipsoid=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=(EJSS_WEBGLGRAPHICS.indexer(),t.getResolutionV()),i=t.getResolutionU(),o=0;o<=n;o++)for(var a=o*Math.PI/n,s=Math.sin(a),l=Math.cos(a),u=0;u<=i;u++){var g=2*u*Math.PI/i,c=Math.sin(g),S=Math.cos(g),d=S*s,f=-l,E=-c*s,p=1-u/i,h=o/n;r.vertices.push([-E,d,f]),r.coords.push([p,h])}for(var o=0;o<=n;o++){var h=o/n,a=o*Math.PI/n,f=-Math.cos(a);r.vertices.push([0,0,f]),r.coords.push([0,h])}var o,m=t.getMinAngleU(),A=t.getMaxAngleU(),y=t.getMinAngleV()+90,v=t.getMaxAngleV()+90,P=Math.floor(y*n/180),D=Math.floor(v*n/180);for(o=P;o<D;o++){var u,I,_,C=Math.floor(m*i/360),R=Math.floor(A*i/360);for(u=C;u<R;u++)I=o*(i+1)+u,_=I+i+1,r.triangles.push([I,_,I+1]),r.triangles.push([_,_+1,I+1]),r.lines.push([I,_]),r.lines.push([I,I+1]),r.lines.push([_,_+1]);if(0!=m||360!=A){var T=r.vertices.length-(n-o+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([I+1,_+1,T]),r.triangles.push([_+1,T+1,T]),r.lines.push([I+1,_+1]),r.lines.push([I+1,T]),r.lines.push([_+1,T+1]),r.lines.push([T,T+1])),t.getStyle().getClosedRight()){var N=o*(i+1)+C,O=N+i+1;r.triangles.push([T,O,N]),r.triangles.push([T,T+1,O]),r.lines.push([N,O]),r.lines.push([N,T]),r.lines.push([O,T+1]),r.lines.push([T,T+1])}}}if(t.getStyle().getClosedBottom()&&y>0){var I,u,M;for(u=C;u<R;u++)I=P*(i+1)+u,M=r.vertices.length-(n-P+1),r.triangles.push([I+1,M,I]),r.lines.push([I+1,M]),r.lines.push([I,I+1])}if(t.getStyle().getClosedTop()&&v<180){var I,u,M;for(u=C;u<R;u++)I=D*(i+1)+u,M=r.vertices.length-(n-D+1),r.triangles.push([I,M,I+1]),r.lines.push([I+1,M]),r.lines.push([I,I+1])}return 0==m&&360==A?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var hasFloat32Array="undefined"!=typeof Float32Array;Matrix.prototype={inverse:function(){return Matrix.inverse(this,new Matrix)},transpose:function(){return Matrix.transpose(this,new Matrix)},multiply:function(e){return Matrix.multiply(this,e,new Matrix)},transformPoint:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11]).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},Matrix.inverse=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;n[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],n[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],n[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],n[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],n[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],n[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],n[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],n[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],n[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],n[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],n[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],n[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],n[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],n[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],n[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],n[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var i=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12],o=0;o<16;o++)n[o]/=i;return t},Matrix.transpose=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;return n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],t},Matrix.multiply=function(e,t,r){r=r||new Matrix;var n=e.m,i=t.m,o=r.m;return o[0]=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],o[1]=n[0]*i[1]+n[1]*i[5]+n[2]*i[9]+n[3]*i[13],o[2]=n[0]*i[2]+n[1]*i[6]+n[2]*i[10]+n[3]*i[14],o[3]=n[0]*i[3]+n[1]*i[7]+n[2]*i[11]+n[3]*i[15],o[4]=n[4]*i[0]+n[5]*i[4]+n[6]*i[8]+n[7]*i[12],o[5]=n[4]*i[1]+n[5]*i[5]+n[6]*i[9]+n[7]*i[13],o[6]=n[4]*i[2]+n[5]*i[6]+n[6]*i[10]+n[7]*i[14],o[7]=n[4]*i[3]+n[5]*i[7]+n[6]*i[11]+n[7]*i[15],o[8]=n[8]*i[0]+n[9]*i[4]+n[10]*i[8]+n[11]*i[12],o[9]=n[8]*i[1]+n[9]*i[5]+n[10]*i[9]+n[11]*i[13],o[10]=n[8]*i[2]+n[9]*i[6]+n[10]*i[10]+n[11]*i[14],o[11]=n[8]*i[3]+n[9]*i[7]+n[10]*i[11]+n[11]*i[15],o[12]=n[12]*i[0]+n[13]*i[4]+n[14]*i[8]+n[15]*i[12],o[13]=n[12]*i[1]+n[13]*i[5]+n[14]*i[9]+n[15]*i[13],o[14]=n[12]*i[2]+n[13]*i[6]+n[14]*i[10]+n[15]*i[14],o[15]=n[12]*i[3]+n[13]*i[7]+n[14]*i[11]+n[15]*i[15],r},Matrix.identity=function(e){e=e||new Matrix;var t=e.m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},Matrix.perspective=function(e,t,r,n,i){var o=Math.tan(e*Math.PI/360)*r,a=o*t;return Matrix.frustum(-a,a,-o,o,r,n,i)},Matrix.frustum=function(e,t,r,n,i,o,a){a=a||new Matrix;var s=a.m;return s[0]=2*i/(t-e),s[1]=0,s[2]=(t+e)/(t-e),s[3]=0,s[4]=0,s[5]=2*i/(n-r),s[6]=(n+r)/(n-r),s[7]=0,s[8]=0,s[9]=0,s[10]=-(o+i)/(o-i),s[11]=-2*o*i/(o-i),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,a},Matrix.ortho=function(e,t,r,n,i,o,a){a=a||new Matrix;var s=a.m;return s[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=-(t+e)/(t-e),s[4]=0,s[5]=2/(n-r),s[6]=0,s[7]=-(n+r)/(n-r),s[8]=0,s[9]=0,s[10]=-2/(o-i),s[11]=-(o+i)/(o-i),s[12]=0,s[13]=0,s[14]=0,s[15]=1,a},Matrix.scale=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.translate=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=e,i[4]=0,i[5]=1,i[6]=0,i[7]=t,i[8]=0,i[9]=0,i[10]=1,i[11]=r,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.rotate=function(e,t,r,n,i,o,a,s){if(!e||!t&&!r&&!n)return Matrix.identity(s);s=s||new Matrix;var l=s.m,u=Math.sqrt(t*t+r*r+n*n);t/=u,r/=u,n/=u;var g=Math.cos(e),c=Math.sin(e),S=1-g;return l[0]=t*t*S+g,l[1]=t*r*S-n*c,l[2]=t*n*S+r*c,l[3]=i-l[0]*i-l[1]*o-l[2]*a,l[4]=r*t*S+n*c,l[5]=r*r*S+g,l[6]=r*n*S-t*c,l[7]=o-l[4]*i-l[5]*o-l[6]*a,l[8]=n*t*S-r*c,l[9]=n*r*S+t*c,l[10]=n*n*S+g,l[11]=a-l[8]*i-l[9]*o-l[10]*a,l[12]=0,l[13]=0,l[14]=0,l[15]=1,s},Matrix.lookAt=function(e,t,r,n,i,o,a,s,l,u){u=u||new Matrix;var g=u.m,c=new Vector(e,t,r),S=new Vector(n,i,o),d=new Vector(a,s,l),f=c.subtract(S).unit(),E=d.cross(f).unit(),p=f.cross(E).unit();return g[0]=E.x,g[1]=E.y,g[2]=E.z,g[3]=-E.dot(c),g[4]=p.x,g[5]=p.y,g[6]=p.z,g[7]=-p.dot(c),g[8]=f.x,g[9]=f.y,g[10]=f.z,g[11]=-f.dot(c),g[12]=0,g[13]=0,g[14]=0,g[15]=1,u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.mesh=function(e,t,r){var n={};r=r||{coords:!0,normals:!0,triangles:!0,lines:!0,colors:!0},t=t||"mesh";var i={},o={};return n.getId=function(){return t},n.getVertexBuffers=function(){return i},n.getIndexBuffers=function(){return o},n.setVertices=function(e){n.vertices=e},n.getVertices=function(){return n.vertices},n.setCoords=function(e){n.coords=e},n.getCoords=function(){return n.coords},n.setNormals=function(e){n.normals=e},n.getNormals=function(){return n.normals},n.setColors=function(e){n.colors=e},n.getColors=function(){return n.colors},n.setTriangles=function(e){n.triangles=e},n.getTriangles=function(){return n.triangles},n.setLines=function(e){n.lines=e},n.getLines=function(){return n.lines},n.setBuffer=function(e,t){n[e]=t},n.addVertexBuffer=function(t,r){var o=i[r]=EJSS_WEBGLGRAPHICS.buffer(e,e.ARRAY_BUFFER,Float32Array);o.setName(t),n[t]=[]},n.addIndexBuffer=function(t){o[t]=EJSS_WEBGLGRAPHICS.buffer(e,e.ELEMENT_ARRAY_BUFFER,Uint16Array);n[t]=[]},n.compile=function(){for(var e in i){var t=i[e];t.setData(n[t.getName()]),t.compile()}for(var r in o){var t=o[r];t.setData(n[r]),t.compile()}},n.transform=function(e){if(n.vertices=n.vertices.map(function(t){return e.transformPoint(Vector.fromArray(t)).toArray()}),n.normals){var t=e.inverse().transpose();n.normals=n.normals.map(function(e){return t.transformVector(Vector.fromArray(e)).unit().toArray()})}return n.compile(),n},n.computeNormals=function(){n.normals||n.addVertexBuffer("normals","gl_Normal");for(var e=0;e<n.vertices.length;e++)n.normals[e]=new Vector;for(var e=0;e<n.triangles.length;e++){var t=n.triangles[e],r=Vector.fromArray(n.vertices[t[0]]),i=Vector.fromArray(n.vertices[t[1]]),o=Vector.fromArray(n.vertices[t[2]]),a=i.subtract(r).cross(o.subtract(r)).unit();n.normals[t[0]]=n.normals[t[0]].add(a),n.normals[t[1]]=n.normals[t[1]].add(a),n.normals[t[2]]=n.normals[t[2]].add(a)}for(var e=0;e<n.vertices.length;e++)n.normals[e]=n.normals[e].unit().toArray();return n.compile(),n},n.computeWireframe=function(){for(var e=EJSS_WEBGLGRAPHICS.indexer(),t=0;t<n.triangles.length;t++)for(var r=n.triangles[t],i=0;i<r.length;i++){var o=r[i],a=r[(i+1)%r.length];e.add([Math.min(o,a),Math.max(o,a)])}return n.lines||n.addIndexBuffer("lines"),n.lines=e.getUnique(),n.compile(),n},n.getAABB=function(){var e={min:new Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<n.vertices.length;t++){var r=Vector.fromArray(n.vertices[t]);e.min=Vector.min(e.min,r),e.max=Vector.max(e.max,r)}return e},n.getBoundingSphere=function(){for(var e=n.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0},r=0;r<n.vertices.length;r++)t.radius=Math.max(t.radius,Vector.fromArray(n.vertices[r]).subtract(t.center).length());return t},n.addVertexBuffer("vertices","gl_Vertex"),r.coords&&n.addVertexBuffer("coords","gl_TexCoord"),r.normals&&n.addVertexBuffer("normals","gl_Normal"),r.colors&&n.addVertexBuffer("colors","gl_Color"),"triangles"in r&&!r.triangles||n.addIndexBuffer("triangles"),r.lines&&n.addIndexBuffer("lines"),n},EJSS_WEBGLGRAPHICS.indexer=function(){var e={},t=[],r={};return e.getUnique=function(){return t},e.add=function(e){var n=JSON.stringify(e);return n in r||(r[n]=t.length,t.push(e)),r[n]},e},EJSS_WEBGLGRAPHICS.buffer=function(e,t,r){var n={},i=null,t=t,r=r,o="",a=[];return n.setData=function(e){a=e},n.setName=function(e){o=e},n.getBuffer=function(){return i},n.getName=function(){return o},n.compile=function(n){for(var o=[],s=0,l=1e4;s<a.length;s+=l)o=Array.prototype.concat.apply(o,a.slice(s,s+l));var u=a.length?o.length/a.length:0;if(u!=Math.round(u))throw"buffer elements not of consistent size, average size is "+u;i=i||e.createBuffer(),i.length=o.length,i.spacing=u,e.bindBuffer(t,i),e.bufferData(t,new r(o),n||e.STATIC_DRAW)},n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.plane=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getDirectionA(),i=t.getDirectionB(),o=t.getSizeA(),a=t.getSizeB(),s=Vector.cross(new Vector(n),new Vector(i),new Vector),l=s.unit().toArray(),u=new Matrix([n[0],i[0],l[0],0,n[1],i[1],l[1],0,n[2],i[2],l[2],0,0,0,0,1]),g=t.getResolutionU(),c=0;c<=g;c++)for(var S=c/g*a,d=0;d<=g;d++){var f=d/g*o,E=new Vector([2*f-1,2*S-1,0]),p=u.transformVector(E);if(r.vertices.push(p.toArray()),r.coords.push([f,S]),r.normals.push([0,0,1]),d<g&&c<g){var h=d+c*(g+1);r.triangles.push([h+g+1,h+1,h]),r.triangles.push([h+g+2,h+1,h+g+1]),r.lines.push([h+g+1,h]),r.lines.push([h+1,h]),r.lines.push([h+g+2,h+1]),r.lines.push([h+g+2,h+g+1])}}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.segment=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1});return r.vertices.push([0,0,0]),r.vertices.push([2,2,2]),r.lines.push([0,1]),r.compile(),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Shader={BasicVS:"void main() {  gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",BasicFS:"uniform vec3 color;uniform float opacity;void main() {    gl_FragColor = vec4(color, opacity);}",ColorVS:"varying vec4 color;void main() { color = gl_Color; gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",ColorFS:"varying vec4 color;void main() { gl_FragColor = color;}",LightVS:"uniform vec3 color;uniform vec3 light[10];uniform int numlight;uniform vec3 ambient;varying vec3 tmpcolor;void main() {  vec3 normal = normalize(gl_NormalMatrix * gl_Normal);  tmpcolor = vec3(0);\tfor(int i = 0; i < 10; i++) { \t\tif(i == numlight) break;\t\tvec3 nlight = normalize((gl_ViewMatrix * vec4(light[i], 0.0)).xyz); \t\tfloat diffuse = max(0.0, dot(nlight, normal)); \t\tfloat specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse); \t\ttmpcolor += mix(color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);\t}  gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",LightFS:"uniform float opacity;varying vec3 tmpcolor;void main() {  gl_FragColor = vec4(tmpcolor, opacity);}",LightAndColorVS:"uniform vec3 color;uniform vec3 light[10];uniform int numlight;uniform vec3 ambient;varying vec3 tmpcolor;void main() {  vec3 normal = normalize(gl_NormalMatrix * gl_Normal);  tmpcolor = vec3(0);\tfor(int i = 0; i < 10; i++) { \t\tif(i == numlight) break;\t\tvec3 nlight = normalize(light[i]); \t\tfloat diffuse = max(0.0, dot(nlight, normal)); \t\tfloat specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse); \t\ttmpcolor += mix(gl_Color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);\t}  gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",LightAndColorFS:"uniform float opacity;varying vec3 tmpcolor;void main() {  gl_FragColor = vec4(tmpcolor, opacity);}",BasicVSwithTex:"varying vec2 coord;void main() {  coord = gl_TexCoord.xy;  gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",BasicFSwithTex:"uniform sampler2D texture;varying vec2 coord;void main() {  gl_FragColor = texture2D(texture, coord);}"},EJSS_WEBGLGRAPHICS.shader=function(e,t,r,n){function i(e,r){var n=e+r,i={};return EJSS_WEBGLGRAPHICS.Utils.regexMap(/\b(gl_[^;]*)\b;/g,l,function(e){var r=e[1];if(n.indexOf(r)!=-1){var o=r.replace(/[a-z_]/g,"");i[o]=t+r}}),i}function o(e,r){var n={},i=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(r);return r=i?i[1]+e+r.substr(i[1].length):e+r,EJSS_WEBGLGRAPHICS.Utils.regexMap(/\bgl_\w+\b/g,e,function(e){e in n||(r=r.replace(new RegExp("\\b"+e+"\\b","g"),t+e),n[e]=!0)}),r}function a(t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(n);return n}var s={},l="uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelMatrix;uniform mat4 gl_ViewMatrix;uniform mat4 gl_ProjectionMatrix;",u=l+"attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;",g="precision highp float;"+l,c={},S={};s.uniforms=function(t){e.useProgram(d);for(var r in t){var n=S[r]||e.getUniformLocation(d,r);if(n){S[r]=n;var i=t[r];if(i instanceof Vector?i=[i.x,i.y,i.z]:i instanceof Matrix&&(i=i.m),EJSS_WEBGLGRAPHICS.Utils.isArray(i))if(EJSS_WEBGLGRAPHICS.Utils.isArray(i[0])){for(var o=[],a=0;a<i.length;a++)o.push(i[a][0]),o.push(i[a][1]),o.push(i[a][2]);e.uniform3fv(n,new Float32Array(o))}else switch(i.length){case 1:e.uniform1fv(n,new Float32Array(i));break;case 2:e.uniform2fv(n,new Float32Array(i));break;case 3:e.uniform3fv(n,new Float32Array(i));break;case 4:e.uniform4fv(n,new Float32Array(i));break;case 9:e.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw"don't know how to load uniform \""+r+'" of length '+i.length}else{if(!EJSS_WEBGLGRAPHICS.Utils.isNumber(i))throw'attempted to set uniform "'+r+'" to invalid value '+i;(r.indexOf("texture")!=-1||r.indexOf("num")!=-1?e.uniform1i:e.uniform1f).call(e,n,i)}}}},s.setLineWidth=function(e){lineWidth=e},s.draw=function(t,r){s.drawBuffers(t.getVertexBuffers(),t.getIndexBuffers()[r==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:r)},s.drawBuffers=function(o,a,l){var u=i(r,n),g=e.modelMatrix,S=e.viewMatrix,f=e.projectionMatrix,E={};if(u.MM&&(E[u.MM]=g),u.VM&&(E[u.VM]=S),u.PM&&(E[u.PM]=f),u.NM){var p=S.multiply(g).inverse().m;E[u.NM]=[p[0],p[4],p[8],p[1],p[5],p[9],p[2],p[6],p[10]]}s.uniforms(E);var h=0;for(var m in o){var A=o[m],y=c[m]||e.getAttribLocation(d,m.replace(/^(gl_.*)$/,t+"$1"));y!=-1&&A.getBuffer()&&(c[m]=y,e.bindBuffer(e.ARRAY_BUFFER,A.getBuffer()),e.enableVertexAttribArray(y),e.vertexAttribPointer(y,A.getBuffer().spacing,e.FLOAT,!1,0,0),h=A.getBuffer().length/A.getBuffer().spacing)}for(var m in c)m in o||e.disableVertexAttribArray(c[m]);l==e.LINES&&e.lineWidth(lineWidth),!h||a&&!a.getBuffer()||(a?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.getBuffer()),e.drawElements(l,a.getBuffer().length,e.UNSIGNED_SHORT,0)):e.drawArrays(l,0,h))};var d=e.createProgram();if(e.attachShader(d,a(e.VERTEX_SHADER,o(u,r))),e.attachShader(d,a(e.FRAGMENT_SHADER,o(g,n))),e.linkProgram(d),!e.getProgramParameter(d,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(d);return s};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.spring=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=element.getRadius(),i=t.getResolutionV(),o=t.getResolutionU()+1,a=t.getRadiusTop(),s=t.getRadiusBottom(),l=(t.getThinExtremes(),2*Math.PI/o,0),u=0;u<i;u++)for(var g=u/(i-1),n=g*(s-a)+a,c=0;c<o;c++){var S=c/(o-1),d=n*Math.sin(S*Math.PI*2),f=n*Math.cos(S*Math.PI*2),E=-2*l/(i*o)+1;r.vertices.push([d,f,E]),0!=l&&r.lines.push([l-1,l]),l++}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.surface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;i<e-1;i++)for(var o=0;o<t-1;o++){var a=r[o+i*t],s=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(a),n.vertices.push(s),n.vertices.push(l),n.vertices.push(u)}for(var g=(e-1)*(t-1)/2,i=0;i<8*g;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])};var r=t.getData();if(r||r.length>0){for(var n=r.length,i=r[0].length,o=new Array,a=0,s=0;s<n;s++)for(var l=0;l<i;l++)o[a]=r[s][l],a++;var u=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());createSurfaceBuffers(n,i,o,u),u.computeNormals(),u.compile(),e.addElement(t.getName()+".mesh",u)}return u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.text=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getFont(),i=t.getBackground(),o=t.getText(),a=n.getFillColor(),s=n.getFontSize(),l=n.getFontStyle(),u=n.getFontFamily(),g=n.getFontWeight(),c=document.createElement("canvas"),S=c.getContext("2d");S=c.getContext("2d"),S.font=l+" "+g+" "+s+"pt "+u,i&&(S.fillStyle=i,S.fillRect(0,0,c.width,c.height)),S.textAlign="center",S.textBaseline="middle",S.fillStyle=a,S.fillText(o,c.width/2,c.height/2);var d=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,c);e.addElement(t.getName()+".texture",d);for(var f=1,E=0;E<=f;E++)for(var p=E/f,h=0;h<=f;h++){var m=h/f;if(r.vertices.push([0,2*p-1,2*m-1]),r.coords.push([p,m]),h<f&&E<f){var A=h+E*(f+1);r.triangles.push([A,A+1,A+f+1]),r.triangles.push([A+f+1,A+1,A+f+2])}}return r.computeNormals(),r.computeWireframe(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Texture={fromImage:function(e,t,r){r=r||{};var n=EJSS_WEBGLGRAPHICS.texture(e,t.width,t.height,r);try{e.texImage2D(e.TEXTURE_2D,0,n.getFormat(),n.getFormat(),n.getType(),t)}catch(e){throw"file:"==location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return r.minFilter&&r.minFilter!=e.NEAREST&&r.minFilter!=e.LINEAR&&e.generateMipmap(e.TEXTURE_2D),n},fromURL:function(e,t,r,n){checkerboardCanvas=function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var r=0;r<e.canvas.width;r+=16)e.fillStyle=16&(r^t)?"#FFF":"#DDD",e.fillRect(r,t,16,16);return e.canvas}();var i=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,checkerboardCanvas,r),o=new Image;return o.onload=function(){EJSS_WEBGLGRAPHICS.Texture.fromImage(e,o,r).swapWith(i),n()},o.src=t,i}},EJSS_WEBGLGRAPHICS.texture=function(e,t,r,n){var i={};n=n||{};var o,a,s=e.createTexture(),l=n.format||e.RGBA,u=n.type||e.UNSIGNED_BYTE;return i.getId=function(){return s},i.setId=function(e){s=e},i.getFormat=function(){return l},i.setFormat=function(e){l=e},i.getType=function(){return u},i.setType=function(e){u=e},i.getWidth=function(){return t},i.setWidth=function(e){t=e},i.getHeight=function(){return r},i.setHeight=function(e){r=e},i.bind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,s)},i.unbind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},i.drawTo=function(n){var i=e.getParameter(e.VIEWPORT);o=o||e.createFramebuffer(),a=a||e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,o),e.bindRenderbuffer(e.RENDERBUFFER,a),t==a.width&&r==a.height||(a.width=t,a.height=r,e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),e.viewport(0,0,t,r),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.viewport(i[0],i[1],i[2],i[3])},i.swapWith=function(e){var n;n=e.getId(),e.setId(s),s=n,n=e.getWidth(),e.setWidth(t),t=n,n=e.getHeight(),e.setHeight(r),r=n},e.bindTexture(e.TEXTURE_2D,s),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.filter||n.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.filter||n.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap||n.wrapS||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap||n.wrapT||e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,l,t,r,0,l,u,null),i};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.trail=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getPoints(),i=[],o=[],a=0,s=0;s<n.length;s++)i[s]=[n[s][0],n[s][1],n[s][2]],0!=s&&1==n[s][3]&&(o[a++]=[s-1,s]);return r.setVertices(i),o.length>0&&r.setLines(o),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Utils={},EJSS_WEBGLGRAPHICS.Utils.regexMap=function(e,t,r){for(;null!=(result=e.exec(t));)r(result)},EJSS_WEBGLGRAPHICS.Utils.isArray=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"==t||"[object Float32Array]"==t},EJSS_WEBGLGRAPHICS.Utils.isNumber=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t},Vector.prototype={setx:function(e){this.x=e},sety:function(e){this.y=e},setz:function(e){this.z=e},getx:function(){return this.x},gety:function(){return this.y},getz:function(){return this.z},negative:function(){return new Vector((-this.x),(-this.y),(-this.z))},add:function(e){return e instanceof Vector?new Vector(this.x+e.x,this.y+e.y,this.z+e.z):new Vector(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof Vector?new Vector(this.x-e.x,this.y-e.y,this.z-e.z):new Vector(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof Vector?new Vector(this.x*e.x,this.y*e.y,this.z*e.z):new Vector(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof Vector?new Vector(this.x/e.x,this.y/e.y,this.z/e.z):new Vector(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},angle:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new Vector(this.x,this.y,this.z)},init:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},Vector.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Vector.add=function(e,t,r){return t instanceof Vector?(r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z):(r.x=e.x+t,r.y=e.y+t,r.z=e.z+t),r},Vector.subtract=function(e,t,r){return t instanceof Vector?(r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z):(r.x=e.x-t,r.y=e.y-t,r.z=e.z-t),r},Vector.multiply=function(e,t,r){return t instanceof Vector?(r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z):(r.x=e.x*t,r.y=e.y*t,r.z=e.z*t),r},Vector.divide=function(e,t,r){return t instanceof Vector?(r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z):(r.x=e.x/t,r.y=e.y/t,r.z=e.z/t),r},Vector.cross=function(e,t,r){return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},Vector.unit=function(e,t){var r=e.length();return t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,t},Vector.fromAngles=function(e,t){return new Vector(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},Vector.randomDirection=function(){return Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},Vector.min=function(e,t){return new Vector(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},Vector.max=function(e,t){return new Vector(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},Vector.lerp=function(e,t,r){return t.subtract(e).multiply(r).add(e)},Vector.fromArray=function(e){return new Vector(e[0],e[1],e[2])};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.WebGLGraphics={},EJSS_GRAPHICS.webGLGraphics=function(e){function t(){i.MODEL=1|o,i.VIEW=2|o,i.PROJECTION=3|o;var e=new Matrix,t=new Matrix;i.modelMatrix=new Matrix,i.viewMatrix=new Matrix,i.projectionMatrix=new Matrix;var r,n,a=[],s=[],l=[];i.elements={},i.addElement=function(e,t){i.elements[e]=t},i.getElement=function(e){return i.elements[e]},i.removeElement=function(e){delete i.elements[e]},i.matrixMode=function(e){switch(e){case i.MODEL:r="modelMatrix",n=a;break;case i.VIEW:r="viewMatrix",n=s;break;case i.PROJECTION:r="projectionMatrix",n=l;break;default:throw"invalid matrix mode "+e}},i.loadIdentity=function(){Matrix.identity(i[r])},i.loadMatrix=function(e){for(var t=e.m,n=i[r].m,o=0;o<16;o++)n[o]=t[o]},i.multMatrix=function(e){i.loadMatrix(Matrix.multiply(i[r],e,t))},i.perspective=function(t,r,n,o){i.multMatrix(Matrix.perspective(t,r,n,o,e))},i.frustum=function(t,r,n,o,a,s){i.multMatrix(Matrix.frustum(t,r,n,o,a,s,e))},i.ortho=function(t,r,n,o,a,s){i.multMatrix(Matrix.ortho(t,r,n,o,a,s,e))},i.scale=function(t,r,n){i.multMatrix(Matrix.scale(t,r,n,e))},i.translate=function(t,r,n){i.multMatrix(Matrix.translate(t,r,n,e))},i.applyMatrix=function(e){i.multMatrix(new Matrix(e))},i.rotate=function(t,r,n,o,a,s,l){a=a||0,s=s||0,l=l||0,i.multMatrix(Matrix.rotate(t,r,n,o,a,s,l,e))},i.lookAt=function(t,r,n,o,a,s,l,u,g){i.multMatrix(Matrix.lookAt(t,r,n,o,a,s,l,u,g,e))},i.pushMatrix=function(){n.push(Array.prototype.slice.call(i[r].m))},i.popMatrix=function(){var e=n.pop();i[r].m=hasFloat32Array?new Float32Array(e):e},i.matrixMode(i.MODEL)}var r=EJSS_INTERFACE.webGLCanvas(e),n=r.getDOMElement(),i=r.getContext();r.supportsWebGL=function(){return i},r.getEventContext=function(){return n},r.getWidth=function(){return+n.width},r.getHeight=function(){return+n.height},r.getOffsetLeft=function(){return n.offsetLeft},r.getOffsetTop=function(){return n.offsetTop},r.getAspect=function(){var e=r.getWidth(),t=Math.max(1,r.getHeight());return e/t},r.getAspect=function(){var e=r.getWidth(),t=Math.max(1,r.getHeight());return e/t},r.remove=function(e){},r.reset=function(e,n,o){if(i){t();var a=r.getWidth(),s=Math.max(1,r.getHeight());i.viewport(0,0,a,s),i.matrixMode(i.PROJECTION),i.loadIdentity(),i.perspective(e,a/s,n,o),i.matrixMode(i.VIEW),i.disable(i.CULL_FACE),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)}},r.putCamera=function(e){i&&(i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.loadIdentity(),i.lookAt(e.location.x,e.location.y,e.location.z,e.focus.x,e.focus.y,e.focus.z,0,0,1),i.rotate(EJSS_TOOLS.Mathematics.radians(e.altitude),0,1,0,e.focus.x,e.focus.y,e.focus.z),i.rotate(EJSS_TOOLS.Mathematics.radians(e.azimuth),0,0,1,e.focus.x,e.focus.y,e.focus.z))},r.draw=function(e,t){if(i)for(var n=0,o=e.length;n<o;n++)if(element=e[n],element.getElements){for(var a=element.getLastElements(),s=0,l=a.length;s<l;s++)i.removeElement(a[s].getName()+".mesh");r.draw(element.getElements(),t)}else r.drawElement(element,t)},r.drawElement=function(e,t){var n=null;if(e.isGroupVisible()){var n=i.getElement(e.getName()+".mesh");if(!n||e.isMeshChanged()||e.isAlwaysUpdated())switch(e.getClass()){case"ElementArrow":n=EJSS_WEBGLGRAPHICS.arrow(i,e);break;case"ElementSegment":n=EJSS_WEBGLGRAPHICS.segment(i,e);break;case"ElementSphere":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementEllipsoid":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementBox":n=EJSS_WEBGLGRAPHICS.box(i,e);break;case"ElementCylinder":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementCone":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementTetrahedron":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementDisk":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementBasic":n=EJSS_WEBGLGRAPHICS.basic(i,e);break;case"ElementPlane":n=EJSS_WEBGLGRAPHICS.plane(i,e);break;case"ElementSurface":n=EJSS_WEBGLGRAPHICS.surface(i,e);break;case"ElementAnalyticSurface":n=EJSS_WEBGLGRAPHICS.analyticSurface(i,e);break;case"ElementText":n=EJSS_WEBGLGRAPHICS.text(i,e);break;case"ElementTrail":n=EJSS_WEBGLGRAPHICS.trail(i,e);break;case"ElementAnalyticCurve":n=EJSS_WEBGLGRAPHICS.analyticCurve(i,e);break;case"ElementSpring":n=EJSS_WEBGLGRAPHICS.spring(i,e)}if(n){i.matrixMode(i.MODEL),i.loadIdentity();for(var o=[],a=e;a.getGroup();)a=a.getGroup(),o.unshift(a);for(var s=0;s<o.length;s++){a=o[s];var l=a.getFullTransformation();if(l&&l.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(l[0]))for(var u=0;u<l.length;u++)i.rotate(l[u][0],l[u][1],l[u][2],l[u][3],l[u][4],l[u][5],l[u][6]);else i.rotate(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);i.translate(a.getX()*e.getPanel().getSizeX(),a.getY()*e.getPanel().getSizeY(),a.getZ()*e.getPanel().getSizeZ()),i.scale(a.getSizeX(),a.getSizeY(),a.getSizeZ());
}var g=e.getFullTransformation();if(g&&g.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(g[0]))for(var u=0;u<g.length;u++)i.rotate(g[u][0],g[u][1],g[u][2],g[u][3],g[u][4],g[u][5],g[u][6]);else 16==g.length?i.applyMatrix(g):i.rotate(g[0],g[1],g[2],g[3],g[4],g[5],g[6]);i.translate(e.getX()*e.getPanel().getSizeX(),e.getY()*e.getPanel().getSizeY(),e.getZ()*e.getPanel().getSizeZ()),"ElementArrow"==e.getClass()?i.scale(e.getPanel().getSizeX(),e.getPanel().getSizeY(),e.getPanel().getSizeZ()):"ElementTrail"==e.getClass()?i.scale(e.getPanel().getSizeX()*e.getSizeX(),e.getPanel().getSizeY()*e.getSizeY(),e.getPanel().getSizeZ()*e.getSizeZ()):i.scale(e.getPanel().getSizeX()*e.getSizeX()/2,e.getPanel().getSizeY()*e.getSizeY()/2,e.getPanel().getSizeZ()*e.getSizeZ()/2),e.getStyle().getTransparency()>0&&(i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.DEPTH_TEST)),r.drawMesh(i,e,n),e.getStyle().getTransparency()>0&&(i.disable(i.BLEND),i.enable(i.DEPTH_TEST)),i.matrixMode(i.VIEW)}}return n},r.drawPanel=function(e){if(i){var t=e.getStyle();if(e.isImageUrl())i.clearColor(0,0,0,0);else{var n=t.getFillColor();i.clearColor(n[0],n[1],n[2],void 0!==typeof n[3]?n[3]:1)}return r}},r.drawMesh=function(e,t,r){var n=1-t.getStyle().getTransparency()/255,i=t.getTextureUrl();if("ElementText"==t.getClass()||i&&i.length>0){var o=e.getElement(r.getId()+".shader_tex"),a=e.getElement(r.getId()+".texture");if(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_tex",EJSS_WEBGLGRAPHICS.Shader.BasicVSwithTex,EJSS_WEBGLGRAPHICS.Shader.BasicFSwithTex),a)a.bind(),o.uniforms({texture:0}),o.draw(r),a.unbind(),e.addElement(r.getId()+".texture",a);else{var s=EJSS_WEBGLGRAPHICS.Texture.fromURL(e,i,{},function(e){t.getController().invokeAction("OnLoadTexture"),t.getController().reportInteractions()});s.bind(),o.uniforms({texture:0}),o.draw(r),s.unbind(),e.addElement(r.getId()+".texture",s)}e.addElement(r.getId()+".shader_tex",o)}else{var l=t.getStyle().getDrawLines();if(l){var o=e.getElement(r.getId()+".shader_lines");o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_lines",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getLineColor(),opacity:n}),o.setLineWidth(t.getStyle().getLineWidth()),o.draw(r,e.LINES),e.addElement(r.getId()+".shader_lines",o)}var u=t.getStyle().getDrawFill();if(u){var o=e.getElement(r.getId()+".shader_fill"),g=t.getColors&&t.getColors().length>0,c=t.getGroupPanel().getLights().length>0;c?g?o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightAndColorVS,EJSS_WEBGLGRAPHICS.Shader.LightAndColorFS):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightVS,EJSS_WEBGLGRAPHICS.Shader.LightFS),o.uniforms({color:t.getStyle().getFillColor()})):g?o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.ColorVS,EJSS_WEBGLGRAPHICS.Shader.ColorFS):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getFillColor()}));var S=t.getGroupPanel().getLights(),d=S.length,f=t.getGroupPanel().getAmbientLight();o.uniforms({numlight:d,ambient:f,light:S,opacity:n}),o.draw(r,e.TRIANGLES),e.addElement(r.getId()+".shader_fill",o)}}};var o=305397760;return r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Plane={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setDirectionA(e.getDirectionA()),t.setDirectionB(e.getDirectionB()),t.setSizeA(e.getSizeA()),t.setSizeB(e.getSizeB())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("DirectionA",e.setDirectionA),t.registerProperty("DirectionB",e.setDirectionB),t.registerProperty("SizeA",e.setSizeA),t.registerProperty("SizeB",e.setSizeB)}},EJSS_DRAWING3D.plane=function(e){var t=EJSS_DRAWING3D.element(e),r=[1,0,0],n=[0,1,0],i=1,o=1;return t.getClass=function(){return"ElementPlane"},t.setDirectionA=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getDirectionA=function(){return r},t.setDirectionB=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getDirectionB=function(){return n},t.setSizeA=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getSizeA=function(){return i},t.setSizeB=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getSizeB=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Plane.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Plane.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.PlaneSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("DirectionA",function(t){e.setToEach(function(e,t){e.setDirectionA(t)},t)}),t.registerProperty("DirectionB",function(t){e.setToEach(function(e,t){e.setDirectionB(t)},t)}),t.registerProperty("SizeA",function(t){e.setToEach(function(e,t){e.setSizeA(t)},t)}),t.registerProperty("SizeB",function(t){e.setToEach(function(e,t){e.setSizeB(t)},t)})}},EJSS_DRAWING3D.planeSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.plane,e),r=EJSS_DRAWING3D.PlaneSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Segment={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t)}},EJSS_DRAWING3D.segment=function(e){var t=EJSS_DRAWING3D.element(e);return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING3D.Segment.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Segment.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t},EJSS_DRAWING3D.SegmentSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.segmentSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.segment,e),r=EJSS_DRAWING3D.SegmentSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Sphere={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Ellipsoid.copyTo(e,t),t.setRadius(e.getRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Ellipsoid.registerProperties(e,t),t.registerProperty("Radius",e.setRadius)}},EJSS_DRAWING3D.sphere=function(e){var t=EJSS_DRAWING3D.ellipsoid(e),r=.5;return t.getClass=function(){return"ElementSphere"},t.setRadius=function(e){r=e,t.setSize([2*e,2*e,2*e])},t.getRadius=function(){return r},t.copyTo=function(e){EJSS_DRAWING3D.Sphere.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Sphere.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.SphereSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)})}},EJSS_DRAWING3D.sphereSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.sphere,e),r=EJSS_DRAWING3D.SphereSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Spring={DEF_RADIUS:1,copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setThinExtremes(e.getThinExtremes()),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop)}},EJSS_DRAWING3D.spring=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING3D.Spring.DEF_RADIUS,n=!0,i=1,o=1;return t.getClass=function(){return"ElementSpring"},t.setRadius=function(e){r=e,t.setSize([e,e,e])},t.getRadius=function(){return r},t.setThinExtremes=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getThinExtremes=function(){return n},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Spring.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Spring.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t.setResolution([50,8]),t},EJSS_DRAWING3D.SpringSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.springSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.spring,e),r=EJSS_DRAWING3D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Surface={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setData(e.getData())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData)}},EJSS_DRAWING3D.surface=function(e){var t=EJSS_DRAWING3D.element(e),r=[];return t.getClass=function(){return"ElementSurface"},t.setData=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getData=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Surface.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Surface.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.SurfaceSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Data",function(t){e.setToEach(function(e,t){e.setData(t)},t)})}},EJSS_DRAWING3D.surfaceSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.surface,e),r=EJSS_DRAWING3D.SurfaceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Tetrahedron={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedron=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementTetrahedron"},t.registerProperties=function(e){EJSS_DRAWING3D.Tetrahedron.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Tetrahedron.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t.setResolutionU(4),t},EJSS_DRAWING3D.TetrahedronSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedronSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.tetrahedron,e),r=EJSS_DRAWING3D.TetrahedronSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Text={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setTextBackground(e.getTextBackground()),t.setTextMargin(e.getTextMargin())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Background",e.setBackground),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("FontColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle)}},EJSS_DRAWING3D.text=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.font(e),n="",i="rgba(255,255,255,0)";return t.getClass=function(){return"ElementText"},t.setBackground=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setMeshChanged(!0)),t},t.getBackground=function(){return i},t.setText=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getText=function(){return n},t.getFont=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Text.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setTransparency(255),t},EJSS_DRAWING3D.TextSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Background",function(t){e.setToEach(function(e,t){e.setBackground(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("FontColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)}),t.registerProperty("FontStyle",function(t){e.setToEach(function(e,t){e.getFont().setFontStyle(t)},t)})}},EJSS_DRAWING3D.textSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.text,e),r=EJSS_DRAWING3D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints),t.registerProperty("InputZ",e.addZPoints)}},EJSS_DRAWING3D.trail=function(e){function t(e,t,n,o){return isNaN(e)||isNaN(t)?void(c=!0):void(i&&S[0]==e&&S[1]==t&&S[2]==n||("undefined"!=typeof o&&null!==o||(o=u),d=0,S=r.formatPoint([e,t,n,o]),a>0&&(g>0&&(d=r.formatPoint([e,t,n,o])),++g>=a&&(g=0)),0==d&&(l>2&&f.length>=l&&f.splice(0,1),f[f.length]=r.formatPoint([e,t,n,o]),c=!1)))}var r=EJSS_DRAWING3D.element(e),n=!0,i=!1,o=!1,a=0,s=["x","y","z"],l=0,u=EJSS_DRAWING3D.Trail.LINE_CONNECTION,g=0,c=!0,S=0,d=0,f=[],E=[],p=[],h=0,m=0,A=0;return r.getClass=function(){return"ElementTrail"},r.setActive=function(e){n!=e&&(n=e,r.setMeshChanged(!0))},r.getActive=function(){return n},r.setNoRepeat=function(e){i!=e&&(i=e,r.setMeshChanged(!0))},r.getNoRepeat=function(){return i},r.setClearAtInput=function(e){o!=e&&(o=e,r.setMeshChanged(!0))},r.getClearAtInput=function(){return o},r.setSkip=function(e){a!=e&&(a=e,g=0,r.setMeshChanged(!0))},r.getSkip=function(){return a},r.setInputLabels=function(e){s[0]==e[0]&&s[1]==e[1]&&s[2]==e[2]||(s[0]=e[0],s[1]=e[1],s[2]=e[2],r.setMeshChanged(!0))},r.getInputLabels=function(){return s},r.setMaximumPoints=function(e){var t=Math.max(e,2);l!=t&&(l=t,r.setMeshChanged(!0))},r.getMaximumPoints=function(){return l},r.setConnected=function(e){e?r.setConnectionType(EJSS_DRAWING3D.Trail.LINE_CONNECTION):r.setConnectionType(EJSS_DRAWING3D.Trail.NO_CONNECTION)},r.isConnected=function(){return u===EJSS_DRAWING3D.Trail.LINE_CONNECTION},r.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING3D.Trail[e.toUpperCase()]),u!=e&&(u=e,r.setMeshChanged(!0))},r.getConnectionType=function(){return u},r.addPoint=function(e,n,i,a){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],a):t(e,n,i,a),r.setMeshChanged(!0)},r.addPoints=function(e,n,i){if(o&&r.initialize(),e[0]instanceof Array)for(var a=0,s=e.length;a<s;a++)t(e[a][0],e[a][1],e[a][2],u);else if(e&&n&&i)for(var s=Math.min(e.length,n.length,i.length),a=0;a<s;a++)t(e[a],n[a],i[a],u);r.setMeshChanged(!0)},r.addXPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)p[t]?p[t]=[e[t],p[t][1],p[t][2],p[t][3]]:p[t]=[e[t],m,A,u];h=e[t]}else p[t]?p[t]=[e,p[t][1],p[t][2],p[t][3]]:p[t]=[e,m,A,u],t++,h=e;for(;p[t];)p[t]=[h,p[t][1],p[t][2],p[t][3]],t++},r.addYPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)p[t]?p[t]=[p[t][0],e[t],p[t][2],p[t][3]]:p[t]=[h,e[t],A,u];m=e[t]}else p[t]?p[t]=[p[t][0],e,p[t][2],p[t][3]]:p[t]=[h,e,A,u],t++,m=e;for(;p[t];)p[t]=[p[t][0],m,p[t][2],p[t][3]],t++},r.addZPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)p[t]?p[t]=[p[t][0],p[t][1],e[t],p[t][3]]:p[t]=[h,m,e[t],u];A=e[t]}else p[t]?p[t]=[p[t][0],p[t][1],e,p[t][3]]:p[t]=[h,m,e,u],t++,A=e;for(;p[t];)p[t]=[p[t][0],p[t][1],A,p[t][3]],t++},r.dataCollected=function(){p.length>0&&(r.addPoints(p),p=[],r.setMeshChanged(!0))},r.setPoints=function(e,t,n,i){r.clear(),r.addPoints(e,t,n,i),r.setMeshChanged(!0)},r.moveToPoint=function(e,n,i){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],EJSS_DRAWING3D.Trail.NO_CONNECTION):t(e,n,i,EJSS_DRAWING3D.Trail.NO_CONNECTION),r.setMeshChanged(!0)},r.getPoints=function(){for(var e=[],t=E.length,r=0;r<t;r++)e=e.concat(E[r]);return e=e.concat(f)},r.getLastPoint=function(){return S},r.reset=function(){r.clear()},r.clear=function(){E=[],mCurrentSegment=0,r.initialize()},r.initialize=function(){f=[],d=0,c=!0,g=0,S=0,r.setMeshChanged(!0)},r.newSegment=function(){if(0!=d){var e=f.length;f[e]=r.formatPoint(d)}var e=E.length;E[e]=f,r.initialize()},r.formatPoint=function(e){return e},r.registerProperties=function(e){EJSS_DRAWING3D.Trail.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(r,e)},r.setSize([1,1,1]),r.getStyle().setDrawFill(!1),r.getStyle().setDrawLines(!0),r},EJSS_DRAWING3D.TrailSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)}),t.registerProperty("InputZ",function(t){e.setToEach(function(e,t){e.addZPoints(t)},t)})}},EJSS_DRAWING3D.trailSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.trail,e),r=EJSS_DRAWING3D.TrailSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ArrayPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Editable",e.setEditable,e.getEditable),t.registerProperty("Transpose",e.setTranspose,e.getTranspose),t.registerProperty("DataArray",e.setDataArray,e.getDataArray),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight),t.registerProperty("EditableBkgd",e.setEditableBkgd,e.getEditableBkgd),t.registerProperty("NonEditableBkgd",e.setNonEditableBkgd,e.getNonEditableBkgd),t.registerAction("OnChange",e.getElementInteracted)}},EJSS_INTERFACE.arrayPanel=function(e){function t(){if(v.innerHTML="",P.innerHTML="",o){var e=document.createElement("tr");e.style.border="inherit";for(var t=o.length,r=0;r<t;r++){var E=document.createElement("th");i&&i[r]&&("number"==typeof i[r]?E.style.width=i[r]+"px":"string"==typeof i[r]&&(E.style.width[r]=i[r])),s&&s[r]&&EJSS_INTERFACE.Style.setCSS(E,s[r]),E.innerHTML=o[r],e.appendChild(E)}1==t&&(E.colSpan="100%"),P.appendChild(e)}if(u){var p=0,h=0;if(S){h=u.length;for(var r=0;r<h;r++)p=Math.max(p,u[r].length)}else{p=u.length;for(var r=0;r<p;r++)h=Math.max(h,u[r].length)}if(p<=0||h<=0)return;for(var r=0;r<p;r++){var e=document.createElement("tr");e.style.border="inherit";for(var m=0;m<h;m++){var A=document.createElement("td");i&&i[m]&&("number"==typeof i[m]?A.style.width=i[m]+"px":"string"==typeof i[m]&&(A.style.width=i[m]));var y;a&&(y=a instanceof Array?a[m]:a);var D;D=g instanceof Array?g[m]:"undefined"==typeof g||g,S?r>=u[m].length?D=!1:A.innerHTML=n(u[m][r],y):m>=u[r].length?D=!1:A.innerHTML=n(u[r][m],y),D?(A.contentEditable=!0,A.onblur=c.handleOnBlur,A.onfocus=c.handleOnFocus,A.onkeydown=c.handleOnKeydown,A.style.backgroundColor=d):A.style.backgroundColor=f,l&&l[m]&&EJSS_INTERFACE.Style.setCSS(A,l[m]),e.appendChild(A)}v.appendChild(e)}}}function r(e){var t=/(<([^>]+)>)/gi,r=e.innerHTML.replace(t,""),n=parseFloat(r);if(!isNaN(n)&&isFinite(r)){if(e.style.backgroundColor=A,m!=r){var i=e.cellIndex,a=e.parentNode.rowIndex;o&&(a-=1),S?u[i][a]=n:u[a][i]=n;var s=c.getController();s&&(s.propertiesChanged("DataArray"),S?(E.row=i,E.column=a):(E.row=a,E.column=i),s.invokeAction("OnChange"),s.reportInteractions())}}else e.style.backgroundColor="red"}function n(e,t){if("undefined"!=typeof t&&t.length>0){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(n==-1){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}var i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return e}var i,o,a,s,l,u,g,c=EJSS_INTERFACE.element(e),S=!1,d="White",f="LightGrey",E={row:-1,column:-1},p=!0,h=!1,m="",A="";c.enableEPub=function(){c.getDOMElement().disabled&&(c.getDOMElement().disabled=!1)},c.setTranspose=function(e){S!=e&&(S=e,p=!0)},c.getTranspose=function(){return S},c.setEditable=function(e){g=e,p=!0},c.getEditable=function(){return g},c.setDataArray=function(e){u=e,p=!0},c.getDataArray=function(){return u},c.setColumnsWidth=function(e){i=e,p=!0},c.getColumnsWidth=function(){return i},c.setHeadersText=function(e){o=e,p=!0},c.getHeadersText=function(){return o},c.setCellsFormat=function(e){a=e,p=!0},c.getCellsFormat=function(){return a},c.setHeadersCSS=function(e){s=e,p=!0},c.getHeadersCSS=function(){return s},c.setCellsCSS=function(e){l=e,p=!0},c.getCellsCSS=function(){return l},c.setEditableBkgd=function(e){d!=e&&(d=e,p=!0)},c.getEditableBkgd=function(e){return d},c.setNonEditableBkgd=function(e){f!=e&&(f=e,p=!0)},c.getNonEditableBkgd=function(e){return f},c.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),v.style.height=e},c.getBodyHeight=function(){return v.style.height},c.getElementInteracted=function(){return E},c.registerProperties=function(e){EJSS_INTERFACE.ArrayPanel.registerProperties(c,e)},c.enableEPub=function(){c.getDOMElement().disabled&&(c.getDOMElement().disabled=!1)},c.render=function(){p&&!h&&(t(),p=!1),"undefined"!=typeof _isEPub&&_isEPub&&c.enableEPub()},c.handleOnBlur=function(e){var t=e.target||e.srcElement;h&&(h=!1,r(t))},c.handleOnFocus=function(e){var t=e.target||e.srcElement;m=t.innerHTML,A=t.style.backgroundColor},c.handleOnKeydown=function(e){var t=e||window.event,n=t.which?t.which:t.keyCode,i=t.target||t.srcElement;13==n?(h=!1,r(i),m=i.innerHTML):27==n?i.innerHTML=m:(i.style.backgroundColor="yellow",h=!0)};var y=document.createElement("table"),v=document.createElement("tbody"),P=document.createElement("thead");return y.style.display="inline-block",y.appendChild(P),y.appendChild(v),y.id=e,document.body.appendChild(y),y.className="ArrayPanel",c.setDOMElement(y),c};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Audio={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("AudioUrl",e.setUrl)}},EJSS_INTERFACE.audio=function(e){var t=EJSS_INTERFACE.media(e);t.registerProperties=function(e){EJSS_INTERFACE.Audio.registerProperties(t,e)};var r=document.createElement("audio");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.BoxPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t)},showOkDialog:function(e,t,r){var n=document.getElementById(".myBoxPanelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelOk").getDOMElement(),i=document.getElementById(".myBoxPanelOk.back"),o=document.getElementById(".myBoxPanelOk.msg");o.style.visibility="visible",o.innerHTML=e+"<br/>";var a=document.getElementById(".myBoxPanelOk.okbt");a.onclick=t,a.style.display="inline",n.style.width=r||"200px",n.style.marginLeft=parseFloat(n.style.width)/-2+"px",n.style.visibility="visible",i.style.visibility="visible"},showOkCancelDialog:function(e,t,r,n){var i=document.getElementById(".myBoxPanelCancelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelCancelOk").getDOMElement(),o=document.getElementById(".myBoxPanelCancelOk.back"),a=document.getElementById(".myBoxPanelCancelOk.msg");a.style.visibility="visible",a.innerHTML=e+"<br/>";var s=document.getElementById(".myBoxPanelCancelOk.okbt");s.onclick=t,s.style.display="inline";var l=document.getElementById(".myBoxPanelCancelOk.cancelbt");l.onclick=r,l.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showInputDialog:function(e,t,r,n){var i=document.getElementById(".BoxPanelInput")||EJSS_INTERFACE.boxPanel(".BoxPanelInput").getDOMElement(),o=document.getElementById(".BoxPanelInput.back"),a=document.getElementById(".BoxPanelInput.msg");a.style.visibility="visible",a.innerHTML=e;var s=document.getElementById(".BoxPanelInput.input");s.style.display="inline";var l=document.getElementById(".BoxPanelInput.okbt");l.onclick=function(){t(s.value)},l.style.display="inline";var u=document.getElementById(".BoxPanelInput.cancelbt");u.onclick=r,u.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showSelectDialog:function(e,t,r,n,i,o){var a=document.getElementById(".BoxPanelSelect")||EJSS_INTERFACE.boxPanel(".BoxPanelSelect").getDOMElement(),s=document.getElementById(".BoxPanelSelect.back"),l=document.getElementById(".BoxPanelSelect.msg");l.style.visibility="visible",l.innerHTML=e;var u=document.getElementById(".BoxPanelSelect.select");u.innerHTML="";for(var g=0;g<t.text.length;g++){var c=document.createElement("option");c.value&&c.value[g]&&c.setAttribute("value",t.value[g]),c.innerHTML=t.text[g],u.appendChild(c)}i&&(u.size=i),u.style.display="block",u.style.margin="0 auto";var S=document.getElementById(".BoxPanelSelect.okbt");S.onclick=function(){r(t.value[u.selectedIndex])},S.style.display="inline";var d=document.getElementById(".BoxPanelSelect.cancelbt");d.onclick=n,d.style.display="inline",a.style.width=o||"200px",a.style.marginLeft=parseFloat(a.style.width)/-2+"px",a.style.visibility="visible",s.style.visibility="visible"}},EJSS_INTERFACE.boxPanel=function(e){var t=EJSS_INTERFACE.panel(e);t.setVisibility=function(e){mElement.style.visibility=e,t.getStyle().setVisibility(e)},t.registerProperties=function(e){EJSS_INTERFACE.BoxPanel.registerProperties(t,e)};var r=document.createElement("div");document.body.appendChild(r),r.className="myBoxPanelBackground",r.id=e+".back",r.style.backgroundColor="rgba(255, 255, 255, 0.3)",r.style.position="fixed",r.style.top="1%",r.style.left="1%",r.style.width="98%",r.style.height="98%",r.style.zIndex="99998",r.style.visibility="hidden";var n=document.createElement("span");n.id=e+".msg",n.style.visibility="hidden",t.getDOMElement().appendChild(n);var i=document.createElement("input");i.id=e+".input",i.type="text",i.style.display="none",i.size="20",t.getDOMElement().appendChild(i);var o=document.createElement("select");o.id=e+".select",o.style.display="none",o.size="4",t.getDOMElement().appendChild(o);var a=document.createElement("button");a.id=e+".okbt",a.innerHTML="Ok",a.style.verticalAlign="middle",a.style.display="none",a.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(a);var s=document.createElement("button");return s.id=e+".cancelbt",s.innerHTML="Cancel",s.style.verticalAlign="middle",s.style.display="none",s.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(s),t.getDOMElement().className="BoxPanel",t.getStyle().setCSS({position:"fixed",top:"25%",left:"50%"}),t.getStyle().setCSS({zIndex:"99999",visibility:"hidden"}),t.getStyle().setCSS({marginLeft:"-250px",width:"500px"}),t.getStyle().setCSS({background:"lightgray"}),t.getStyle().setCSS({borderWidth:"1px"}),t.getStyle().setCSS({borderStyle:"solid"}),t.getStyle().setCSS({borderColor:"red"}),t.getStyle().setCSS({overflow:"hidden",wordWrap:"break-word"}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Button={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease")}},EJSS_INTERFACE.button=function(e){function t(){r.getDOMElement().innerHTML="",n.length>0&&(r.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+n+'"/>'),i.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+i.toString()+"</span>")}var r=EJSS_INTERFACE.element(e),n="",i="";r.setDisabled=function(e){r.getDOMElement().disabled=e},r.getDisabled=function(){return r.getDOMElement().disabled},r.setText=function(e){i!=e&&(i=e,t())},r.getText=function(){return i},r.setImageUrl=function(e){var i=r.getResourcePath(e);i!=n&&(n=i,t())},r.getImageUrl=function(){return n},r.registerProperties=function(e){EJSS_INTERFACE.Button.registerProperties(r,e)};var o=document.createElement("button");
return o.id=e,o.style.verticalAlign="middle",document.body.appendChild(o),r.setDOMElement(o),r.getDOMElement().onmousedown=function(){var e=r.getController();e&&e.invokeAction("OnPress").reportInteractions()},r.getDOMElement().addEventListener("touchstart",function(){var e=r.getController();e&&e.invokeAction("OnPress").reportInteractions()}),r.getDOMElement().onmouseup=function(){var e=r.getController();e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions())},r.getDOMElement().addEventListener("touchend",function(){var e=r.getController();e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions())}),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Canvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth),t.registerProperty("ImageData",e.setImageData),t.registerProperty("Enabled",e.setEnabled,e.isEnabled),t.registerAction("OnPress",e.getInteractionPoint),t.registerAction("OnDrag",e.getInteractionPoint),t.registerAction("OnRelease",e.getInteractionPoint),t.registerAction("OnEnter",e.getInteractionPoint),t.registerAction("OnExit",e.getInteractionPoint),t.registerAction("OnMove",e.getInteractionPoint)}},EJSS_INTERFACE.canvas=function(e){function t(e){var t=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(u),r=[];if("undefined"!=typeof e.changedTouches)for(var n=0;n<e.changedTouches.length;n++)r[n]=[],r[n][0]=e.changedTouches[n].pageX-window.pageXOffset-t.left,r[n][1]=e.changedTouches[n].pageY-window.pageYOffset-t.top;else r[0]=[],r[0][0]=(e.clientX||e.x)-t.left,r[0][1]=(e.clientY||e.y)-t.top;return r[0]}function r(e){e.preventDefault();var r=u.getController();return r&&(S=t(e),r.invokeAction("OnPress").reportInteractions()),d=!0,!1}function n(e){e.preventDefault();var r=u.getController();return d&&r&&(S=t(e),r.invokeAction("OnRelease").reportInteractions()),d=!1,!1}function i(e){e.preventDefault();var r=u.getController();return d=!1,r&&(S=t(e),r.invokeAction("OnEnter").reportInteractions()),!1}function o(e){e.preventDefault();var r=u.getController();return d=!1,r&&(S=t(e),r.invokeAction("OnExit").reportInteractions()),!1}function a(e){e.preventDefault();var r=u.getController();return r&&(S=t(e),d?r.invokeAction("OnDrag").reportInteractions():r.invokeAction("OnMove").reportInteractions()),!1}var s,l,u=EJSS_INTERFACE.element(e),g=0,c=0,S=[0,0],d=!1;u.render=function(){s&&E.putImageData(s,0,0)},u.setImageData=function(e){s||(s=E.createImageData(c,g)),e.data&&(e=e.data);for(var t=0;t<e.length;t++)s.data[t]=e[t]},u.clear=function(){E.clearRect(0,0,c,g)},u.setWidth=function(e){var t=u.getDOMElement();return c!=e&&(c=e,"string"==typeof e&&e.indexOf("%")!=-1&&t.parentNode&&t.parentNode.offsetWidth?e=t.parentNode.offsetWidth*parseFloat(e)/100:"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e&&t.setAttribute("width",e),!0)},u.getWidth=function(){var e=u.getDOMElement();if("string"==typeof c&&c.indexOf("%")!=-1&&e.parentNode&&e.parentNode.offsetWidth){var t=e.parentNode.offsetWidth*parseFloat(c)/100;if("number"==typeof t){var r=e.getAttribute("width");t!=r&&e.setAttribute("width",t)}}return c},u.setHeight=function(e){var t=u.getDOMElement();return g!=e&&(g=e,"string"==typeof e&&e.indexOf("%")!=-1&&t.parentNode&&t.parentNode.offsetHeight?e=t.parentNode.offsetHeight*parseFloat(e)/100:"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e&&t.setAttribute("height",e),!0)},u.getHeight=function(){var e=u.getDOMElement();if("string"==typeof g&&g.indexOf("%")!=-1&&e.parentNode&&e.parentNode.offsetHeight&&(value=e.parentNode.offsetHeight*parseFloat(g)/100,"number"==typeof value)){var t=e.getAttribute("height");value!=t&&e.setAttribute("height",value)}return g},u.getContext=function(){return E},u.registerProperties=function(e){EJSS_INTERFACE.Canvas.registerProperties(u,e)},u.setEnabled=function(e){l=e;var t=u.getDOMElement();l?(t.onmousedown=r,t.onmouseup=n,t.onmouseover=i,t.onmouseout=o,t.onmousemove=a,t.addEventListener("touchstart",r,!1),t.addEventListener("touchend",n,!1),t.addEventListener("touchmove",a,!1)):(t.onmousedown=void 0,t.onmouseup=void 0,t.onmouseover=void 0,t.onmouseout=void 0,t.onmousemove=void 0,t.removeEventListener("touchstart",r),t.removeEventListener("touchend",n),t.removeEventListener("touchmove",a))},u.isEnabled=function(){return l},u.getInteractionPoint=u.getMousePosition=function(){return S};var f=document.createElement("canvas");f.setAttribute("id",e),f.style.overflow="hidden";var E=f.getContext("2d");return document.body.appendChild(f),u.setDOMElement(f),u.setEnabled(!0),u.setWidth(500),u.setHeight(500),u};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.CheckBox={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.checkBox=function(e){function t(){c.innerHTML="",g.checked?i.src.length>0?c.appendChild(i):s.length>0?c.innerHTML=s.toString():n.src.length>0?c.appendChild(n):a.length>0&&(c.innerHTML=a.toString()):o.src.length>0?c.appendChild(o):l.length>0?c.innerHTML=l.toString():n.src.length>0?c.appendChild(n):a.length>0&&(c.innerHTML=a.toString())}var r=EJSS_INTERFACE.element(e),n=new Image,i=new Image,o=new Image,a="",s="",l="";r.setText=function(e){a=e,t()},r.setImageUrl=function(e){n.src=r.getResourcePath(e),t()},r.setTextOff=function(e){l=e,t()},r.getTextOff=function(){return l},r.setImageOffUrl=function(e){o.src=r.getResourcePath(e),t()},r.getImageUrlOff=function(){return o.src},r.setTextOn=function(e){s=e,t()},r.getTextOn=function(){return s},r.setImageOnUrl=function(e){i.src=r.getResourcePath(e),t()},r.getImageUrlOn=function(){return i.src},r.setChecked=function(e){g.checked!=e&&(g.checked=e,t())},r.getChecked=function(){return g.checked},r.setValue=function(e){g.value=e},r.getValue=function(){return g.value},r.registerProperties=function(e){EJSS_INTERFACE.CheckBox.registerProperties(r,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),r.setDOMElement(u);var g=document.createElement("input");g.id=e+".checkbox",g.type="checkbox",u.appendChild(g),g.onchange=function(){t();var e=r.getController();e&&(e.propertiesChanged("Checked"),e.invokeAction("OnChange"),g.checked?e.invokeAction("OnCheckOn"):e.invokeAction("OnCheckOff"),e.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",u.appendChild(c),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ComboBox={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Options",e.setOptions,e.getOptions),t.registerProperty("SelectedOptions",e.setSelectedOptions,e.getSelectedOptions),t.registerProperty("Multiple",e.setMultiple),t.registerProperty("Size",e.setSize),t.registerAction("OnChange"),t.registerAction("OnFocus")}},EJSS_INTERFACE.comboBox=function(e){var t=EJSS_INTERFACE.element(e),r=[];t.registerProperties=function(e){EJSS_INTERFACE.ComboBox.registerProperties(t,e)},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setSelectedOptions=function(e){for(var r=t.getDOMElement(),n=0;n<r.options.length;n++){r.options[n].selected=!1;for(var i=0;i<e.length;i++)if(r.options[n].value==e[i]){r.options[n].selected=!0;break}}},t.getSelectedOptions=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=r.options[i].value);return e},t.getSelectedOptionsIndexes=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=i);return e},t.setOptions=function(e){if(!EJSS_TOOLS.compareArrays(r,e)){r=[];var n=t.getSelectedOptions(),i=t.getDOMElement();i.innerHTML="";for(var o=0;o<e.length;o++){var a=document.createElement("option");a.setAttribute("value",e[o]),a.innerHTML=e[o],i.appendChild(a),r[o]=e[o]}t.setSelectedOptions(n)}},t.getOptions=function(){for(var e=[],r=t.getDOMElement(),n=0;n<r.options.length;n++)e[n]=r.options[n].value;return e},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly};var n=document.createElement("select");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onfocus=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("Options"),e.invokeAction("OnFocus"),e.reportInteractions())},t.getDOMElement().onchange=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("SelectedOptions"),e.invokeAction("OnChange"),e.reportInteractions())},t.getDOMElement().onkeydown=function(){t.getStyle().setBackgroundColor("yellow")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.DataTable={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.isActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.isNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.isClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("AddToTop",e.setAddToTop,e.isAddToTop),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("Input",e.appendRow),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("Width",e.setWidth,e.getStyle().getWidth),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight)}},EJSS_INTERFACE.dataTable=function(e){function t(){if(I.innerHTML="",_.innerHTML="","undefined"!=typeof d&&d.length>0){var e=document.createElement("tr");e.style.border="inherit";for(var t=0,r=d.length;t<r;t++){var n=document.createElement("th");S[t]&&("string"!=typeof S[t]?n.style.width=S[t]+"px":n.style.width=S[t]),E[t]&&EJSS_INTERFACE.Style.setCSS(n,E[t]),n.innerHTML=d[t],e.appendChild(n)}_.appendChild(e)}A=0,v=!1}function r(e){var t=document.createElement("tr");t.style.border="inherit";for(var r=0;r<e;r++){var n=document.createElement("td");S[r]&&("string"!=typeof S[r]?n.style.width=S[r]+"px":n.style.width=S[r]),p[r]&&EJSS_INTERFACE.Style.setCSS(n,p[r]),t.appendChild(n)}I.appendChild(t),A++}function n(){P=!1;for(var e="undefined"!=typeof f,t=0,n=h.length;t<n;t++){var o=h[t];t>=A&&r(o.length);var a=I.rows[t];if(e)for(var l=0,u=o.length;l<u;l++)a.cells[l].innerHTML=i(o[l],f[l]);else for(var l=0,u=o.length;l<u;l++)a.cells[l].innerHTML=i(o[l])}if(s){if(h.length>=0){var g=I.rows[0];I.scrollTop=g.offsetBottom}}else if(h.length>0){var c=I.rows[h.length-1];I.scrollTop=c.offsetTop}}function i(e,t){if("number"!=typeof e)return e;if("undefined"!=typeof t){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(n==-1){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}var i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return parseFloat(e).toFixed(3)}var o=EJSS_INTERFACE.element(e),a=!0,s=!1,l=!1,u=!1,g=0,c=0,S=[],d=[],f=[],E=[],p=[],h=[],m=[],A=0,y=0,v=!0,P=!0;o.setActive=function(e){a=e},o.isActive=function(){return a},o.setAddToTop=function(e){s=e},o.isAddToTop=function(){return s},o.setNoRepeat=function(e){l=e},o.isNoRepeat=function(){return norepeat},o.setClearAtInput=function(e){u=e},o.isClearAtInput=function(){return u},o.setSkip=function(e){g=e},o.getSkip=function(){return g},o.setMaximumPoints=function(e){c=e,h.length>c&&(s?h=h.slice(0,c):h.splice(0,h.length-c),v=!0)},o.getMaximumPoints=function(){return c},o.setColumnsWidth=function(e){EJSS_TOOLS.compareArrays(S,e)||(S=e,v=!0)},o.getColumnsWidth=function(){return S},o.setHeadersText=function(e){EJSS_TOOLS.compareArrays(d,e)||(d=e,v=!0)},o.getHeadersText=function(){return d},o.setCellsFormat=function(e){EJSS_TOOLS.compareArrays(f,e)||(f=e,P=!0)},o.getCellsFormat=function(){return f},o.setHeadersCSS=function(e){EJSS_TOOLS.compareArrays(E,e)||(E=e,v=!0)},o.getHeadersCSS=function(){return E},o.setCellsCSS=function(e){EJSS_TOOLS.compareArrays(p,e)||(p=e,v=!0)},o.getCellsCSS=function(){return p},o.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),I.style.height=e},o.getBodyHeight=function(){return I.style.height},o.setWidth=function(e){"string"!=typeof e&&(e+="px"),I.style.width=e,_.style.width=e,o.getStyle().setWidth(e)},o.registerProperties=function(e){EJSS_INTERFACE.DataTable.registerProperties(o,e)},o.reset=function(){o.clear()},o.initialize=function(){o.clear()},o.clear=function(e){h=[],y=0,v=!0},o.appendRow=function(e){if(a)if(u&&o.clear(),e[0]instanceof Array)for(var t=0,r=e.length;t<r;t++)o.addPoint(e[t]);else o.addPoint(e)},o.addPoint=function(e){if(g>0){if(y<g)return void y++;y=0}l&&EJSS_TOOLS.compareArrays(e,m)||(m=e.slice(0),s?(c>0&&h.length>=c&&h.pop(),h.unshift(m)):(c>0&&h.length>=c&&h.shift(),h.push(m)),P=!0)},o.dataCollected=function(){},o.render=function(){v?(t(),n()):P&&n()};var D=document.createElement("table"),I=document.createElement("tbody"),_=document.createElement("thead");return D.style.display="inline-block",D.appendChild(_),D.appendChild(I),D.className="DataTable",D.id=e,document.body.appendChild(D),o.setDOMElement(D),o};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Element={registerProperties:function(e,t){e.setController(t),t.registerProperty("Tooltip",e.setTitle),t.registerProperty("Foreground",e.getStyle().setColor),t.registerProperty("Background",e.getStyle().setBackgroundColor),t.registerProperty("BackgroundImage",e.getStyle().setBackgroundImage),t.registerProperty("BorderWidth",e.getStyle().setBorderWidth),t.registerProperty("BorderColor",e.getStyle().setBorderColor),t.registerProperty("BorderStyle",e.getStyle().setBorderStyle),t.registerProperty("Padding",e.getStyle().setPadding),t.registerProperty("Width",e.getStyle().setWidth,e.getStyle().getWidth),t.registerProperty("Height",e.getStyle().setHeight,e.getStyle().getHeight),t.registerProperty("LineHeight",e.getStyle().setLineHeight,e.getStyle().getLineHeight),t.registerProperty("TextAlign",e.getStyle().setTextAlign),t.registerProperty("VerticalAlign",e.getStyle().setVerticalAlign),t.registerProperty("Visibility",e.getStyle().setVisibility),t.registerProperty("Display",e.getStyle().setDisplay),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("Float",e.getStyle().setFloat),t.registerProperty("Position",e.getStyle().setPosition),t.registerProperty("Left",e.getStyle().setLeft),t.registerProperty("Top",e.getStyle().setTop),t.registerProperty("Bottom",e.getStyle().setBottom),t.registerProperty("Overflow",e.getStyle().setOverflow),t.registerProperty("BoxShadow",e.getStyle().setShadow),t.registerProperty("Margin",e.getStyle().setMargin),t.registerProperty("Parent",e.setParent),t.registerProperty("ClassName",e.setClassName),t.registerProperty("CSS",e.getStyle().setCSS),t.registerProperty("Font",e.getStyle().setFont),t.registerProperty("FontFamily",e.getStyle().setFontFamily),t.registerProperty("FontSize",e.getStyle().setFontSize),t.registerProperty("LetterSpacing",e.getStyle().setLetterSpacing),t.registerProperty("OutlineColor",e.getStyle().setOutlineColor),t.registerProperty("FontWeight",e.getStyle().setFontWeight),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("FontStyle",e.getStyle().setFontStyle),t.registerProperty("Transform",e.getStyle().setTransform),t.registerProperty("WhiteSpace",e.getStyle().setWhiteSpace)}},EJSS_INTERFACE.element=function(e){var t,r,n={},i=EJSS_INTERFACE.style(e),o=null;return n.getDOMElement=function(){return t},n.setDOMElement=function(e){t=e},n.setParent=function(e){if(r=e,"string"==typeof e){var t=document.getElementById(e);t.appendChild(n.getDOMElement())}else e.getDOMElement?e.appendChild(n):e.appendChild(n.getDOMElement())},n.getParent=function(){return r},n.getName=function(){return e},n.getResourcePath=function(e){return e},n.setClassName=function(e){n.getDOMElement().className=e},n.getClassName=function(){return n.getDOMElement().className},n.setDisabled=function(e){n.getDOMElement().disabled=e},n.getDisabled=function(){return n.getDOMElement().disabled},n.setTitle=function(e){n.getDOMElement().title=e},n.getTitle=function(){return n.getDOMElement().title},n.getStyle=function(){return i},n.getController=function(){return o},n.setController=function(e){o=e},n.registerProperties=function(e){EJSS_INTERFACE.Element.registerProperties(n,e)},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FunctionField={registerProperties:function(e,t){EJSS_INTERFACE.TextField.registerProperties(e,t),t.registerAction("OnError")}},EJSS_INTERFACE.functionField=function(e){var t,r=EJSS_INTERFACE.textField(e),n=EJSS_DRAWING2D.functionsParser(),i=n.parse("0"),o=r.setValue,a={},s=r.getStyle().getBackgroundColor();return r.registerProperties=function(e){EJSS_INTERFACE.FunctionField.registerProperties(r,e)},r.setParameters=function(e){for(var t in e)a[t]=e[t]},r.parseValue=function(e){if(e){if(e!=t){try{i=n.parse(e),r.getStyle().setBackgroundColor(s)}catch(t){r.getController().invokeAction("OnError"),console.log('FunctionField: Error parsing function "'+e+'" : '+t.message+"\n"),r.getStyle().setBackgroundColor("red")}t=e}}else t="0",i=n.parse("0"),r.getStyle().setBackgroundColor(s)},r.setValue=function(e){o(e),r.parseValue(e)},r.evaluate=function(e){var t={};for(var n in a)t[n]=a[n];for(var o in e)t[o]=e[o];try{return i.evaluate(t)}catch(e){return r.getController().invokeAction("OnError"),NaN}},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Html={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml),t.registerProperty("Url",e.setUrl)}},EJSS_INTERFACE.html=function(e){var t=EJSS_INTERFACE.element(e);t.setHtml=function(e){var r=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;r.write(e)},t.getHtml=function(){var e=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;return e.body.innerHTML},t.setUrl=function(e){0==e.indexOf("http:")||0==e.indexOf("https:")||(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.registerProperties=function(e){EJSS_INTERFACE.Html.registerProperties(t,e)};var r=document.createElement("iframe");return r.id=e,r.src="about:blank",r.width="100%",document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setBorderStyle("none"),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Image={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl)}},EJSS_INTERFACE.image=function(e){var t=EJSS_INTERFACE.element(e);t.setImageUrl=function(e){t.getDOMElement().src=e.toString()},t.getImageUrl=function(){return t.getDOMElement().src},t.registerProperties=function(e){EJSS_INTERFACE.Image.registerProperties(t,e)};var r=document.createElement("img");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ImageAndTextButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick")}},EJSS_INTERFACE.imageAndTextButton=function(e){var t=EJSS_INTERFACE.element(e),r="",n="";t.setText=function(e){r=e.toString(),t.getDOMElement().innerHTML=n+r},t.getText=function(){return r},t.setImageUrl=function(e){n='<img src="'+t.getResourcePath(e)+'"/>',t.getDOMElement().innerHTML=n+r},t.getImageUrl=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.ImageAndTextButton.registerProperties(t,e)};var i=document.createElement("button");return i.id=e,i.style.borderStyle="none",i.style.background="inherit",i.style.cursor="inherit",i.style.webkitBoxShadow="inset 0 0px 0 rgba(255,255,255,0),0 0px 0px rgba(0,0,0,0)",document.body.appendChild(i),t.setDOMElement(i),t.getDOMElement().onclick=function(){var e=t.getController();e&&e.invokeAction("OnClick").reportInteractions()},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Label={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText)}},EJSS_INTERFACE.label=function(e){var t=EJSS_INTERFACE.element(e);t.setText=function(e){t.getDOMElement().innerHTML='<span style="white-space:pre;">'+e.toString()+"</span>"},t.getText=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Label.registerProperties(t,e)};var r=document.createElement("label");return r.id=e,r.style.display="inline-block",document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MathML={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Content",e.setContent,e.getContent)}},EJSS_INTERFACE.mathML=function(e){var t=EJSS_INTERFACE.element(e);t.setContent=function(e){t.getDOMElement().innerHTML=e},t.getContent=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.MathML.registerProperties(t,e)};var r=document.createElement("math");return r.setAttribute("id",e),document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Media={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("Controls",e.setControls),t.registerProperty("Loop",e.setLoop),t.registerProperty("CurrentTime",e.setCurrentTime,e.getCurrentTime),t.registerProperty("Volume",e.setVolume),t.registerProperty("Autoplay",e.setAutoplay),t.registerProperty("Type",e.setType),t.registerAction("OnEnded"),t.registerAction("OnLoadedData"),t.registerAction("OnPlay"),t.registerAction("OnPause")}},EJSS_INTERFACE.media=function(e){var t=EJSS_INTERFACE.element(e);return t.setUrl=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.getUrl=function(){return t.getDOMElement().src},t.setType=function(e){t.getDOMElement().type=e},t.getType=function(){return t.getDOMElement().type},t.setControls=function(e){e?t.getDOMElement().setAttribute("controls","controls"):t.getDOMElement().removeAttribute("controls")},t.play=function(){t.getDOMElement().play()},t.pause=function(){t.getDOMElement().pause()},t.getCurrentTime=function(){return t.getDOMElement().currentTime},t.setCurrentTime=function(e){t.getDOMElement().currentTime=e},t.setLoop=function(e){t.getDOMElement().loop=e},t.getVolume=function(){return t.getDOMElement().volume},t.setVolume=function(e){t.getDOMElement().volume=e},t.getAutoplay=function(){return t.getDOMElement().autoplay},t.setAutoplay=function(e){t.getDOMElement().autoplay=e},t.isPaused=function(){return t.getDOMElement().paused},t.isEnded=function(){return t.getDOMElement().ended},t.getDuration=function(){return t.getDOMElement().duration},t.addDOMEvents=function(){t.getDOMElement().onended=function(){var e=t.getController();e&&e.invokeAction("OnEnded").reportInteractions()},t.getDOMElement().onloadeddata=function(){var e=t.getController();e&&e.invokeAction("OnLoadedData").reportInteractions()},t.getDOMElement().onplay=function(){var e=t.getController();e&&e.invokeAction("OnPlay").reportInteractions()},t.getDOMElement().onpause=function(){var e=t.getController();e&&e.invokeAction("OnPause").reportInteractions()}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MotionJPEG={registerProperties:function(e,t){EJSS_INTERFACE.Canvas.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("AsBackground",e.setAsBackground,e.isAsBackground),t.registerProperty("On",e.setOnOff,e.isOnOff),t.registerProperty("UseWebCam",e.useWebCam)}},EJSS_INTERFACE.motionJPEG=function(e){var t,r=EJSS_INTERFACE.canvas(e),n=new Image,i=document.createElement("video"),o=!1,a=!0,s=!1;return r.useWebCam=function(e){function n(e){t=window.webkitURL?window.webkitURL.createObjectURL(e):e,a&&(i.src=t),console.log("Success = "+t)}function o(e){console.log("Error = "+e)}s!=e&&(s=e,s?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},n,o)):(t=null,r.pause()))},r.setUrl=function(e){r.getResourcePath&&(e=r.getResourcePath(e)),t=e,t&&a&&(n.src=t,n.crossOrigin="Anonymous"),s=!1},r.getUrl=function(){return t},r.setOnOff=function(e){e?a||r.play():a&&r.pause()},r.isOnOff=function(){return a},r.play=function(){t&&(s?i.src=t:n.src=t),a=!0},r.pause=function(){a=!1,r.clear()},r.getCanvasContext=function(){return r.getContext()},r.getSnapshot=function(){return r.getContext().getImageData(0,0,r.getWidth(),r.getHeight())},r.isAsBackground=function(){return o},r.setAsBackground=function(e){e!=o&&(o=e,o?r.getStyle().setCSS({position:"absolute","z-index":"-100"}):r.getStyle().setCSS({position:" ","z-index":" "}))},r.render=function(){if(a&&t){var e=r.getDOMElement();s?i.readyState===i.HAVE_ENOUGH_DATA&&r.getContext().drawImage(i,0,0,i.width,i.height,0,0,e.width,e.height):r.getContext().drawImage(n,0,0,n.width,n.height,0,0,e.width,e.height)}},r.registerProperties=function(e){EJSS_INTERFACE.MotionJPEG.registerProperties(r,e)},i.autoplay="true",i.style="display:none;",r.getStyle().setBackgroundColor("rgb(239,239,255)"),r.setEnabled(!1),r.setWidth(500),r.setHeight(500),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.NumberField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Format",e.setFormat),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.numberField=function(e){function t(){var e=r.getDOMElement().value;if(!isNaN(parseFloat(e))&&isFinite(e)){if(r.getStyle().setBackgroundColor("white"),a!=e){var t=r.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}else{if("∞"!==e&&"-∞"!==e&&"∅"!==e)return r.getStyle().setBackgroundColor("red"),!1;r.getStyle().setBackgroundColor("white")}return!0}var r=EJSS_INTERFACE.element(e),n=3,i=!1,o=!1,a="";r.registerProperties=function(e){EJSS_INTERFACE.NumberField.registerProperties(r,e)},r.enableEPub=function(){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(r.render=function(){r.enableEPub()}),r.setValue=function(e){o||("undefined"==typeof e?r.getDOMElement().value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)?i?r.getDOMElement().value=parseFloat(e).toExponential(n):r.getDOMElement().value=parseFloat(e).toFixed(n):e===Number.POSITIVE_INFINITY?r.getDOMElement().value="∞":e===Number.NEGATIVE_INFINITY?r.getDOMElement().value="-∞":isNaN(e)&&(r.getDOMElement().value="∅"))},r.getValue=function(){var e=r.getDOMElement().value;return!isNaN(parseFloat(e))&&isFinite(e)?e=parseFloat(e):"∞"===e?e=Number.POSITIVE_INFINITY:"-∞"===e?e=Number.NEGATIVE_INFINITY:"∅"===e&&(e=Number.NaN),e},r.setEditable=function(e){r.getDOMElement().readOnly=!e},r.getEditable=function(){return!r.getDOMElement().readOnly},r.setSize=function(e){r.getDOMElement().size=e},r.getSize=function(){return r.getDOMElement().size},r.setFormat=function(e){var t=e.indexOf("."),o=e.toUpperCase().indexOf("E");if(o==-1){var a=0;t>=0&&(a=Number(e.length-t-1)),(i||n!=a)&&(n=a,i=!1,r.setValue(r.getValue()))}else{var a=0;t>=0&&(a=Number(o-t-1)),i&&n==a||(n=a,i=!0,r.setValue(r.getValue()))}};var s=document.createElement("input");return s.type="tel",s.id=e,s.value=0,document.body.appendChild(s),r.setDOMElement(s),r.getDOMElement().onkeydown=function(e){var n=r.getDOMElement();if(!n.readOnly){var i=e||window.event,s=i.which?i.which:i.keyCode;13==s?(o=!1,t()&&(a=r.getDOMElement().value)):27==s?r.getDOMElement().value=a:(r.getStyle().setBackgroundColor("yellow"),o=!0)}},r.getDOMElement().onfocus=function(e){a=r.getDOMElement().value},r.getDOMElement().onblur=function(e){!e.readOnly&&o&&(o=!1,t())},r.getDOMElement().ontouchstart=function(e){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1),r.getDOMElement().focus(),e.stop()},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Panel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml,e.getHtml)}},EJSS_INTERFACE.panel=function(e){var t=EJSS_INTERFACE.element(e);t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)},t.setHtml=function(e){t.getDOMElement().innerHTML=e},t.getHtml=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Panel.registerProperties(t,e)};var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({display:"block","margin-left":"auto","margin-right":"auto"}),t.getDOMElement().ontouchstart=function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.PasswordField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.passwordField=function(e){var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.PasswordField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return mValue},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size};var r=document.createElement("input");return r.id=e,r.type="password",document.body.appendChild(r),t.setDOMElement(r),t.getDOMElement().onkeydown=function(e){var r=t.getDOMElement();if(!r.readOnly){var n=e||window.event,i=n.which?n.which:n.keyCode;if(13==i){t.getStyle().setBackgroundColor("white");var o=t.getController();o&&(o.propertiesChanged("Value"),o.invokeAction("OnChange"),o.reportInteractions())}else t.getStyle().setBackgroundColor("yellow")}},t.getDOMElement().onblur=function(e){e.readOnly||t.getStyle().setBackgroundColor("white")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.RadioButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),
t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Parent",function(t){e.setParent(t),e.setKey(e.getDOMElement().parentNode.id)}),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.radioButton=function(e){function t(){c.innerHTML="",g.checked?i.src.length>0?c.appendChild(i):s.length>0?c.innerHTML=s.toString():n.src.length>0?c.appendChild(n):a.length>0&&(c.innerHTML=a.toString()):o.src.length>0?c.appendChild(o):l.length>0?c.innerHTML=l.toString():n.src.length>0?c.appendChild(n):a.length>0&&(c.innerHTML=a.toString())}var r=EJSS_INTERFACE.element(e),n=new Image,i=new Image,o=new Image,a="",s="",l="";r.setKey=function(e){g.name=e},r.getKey=function(){return g.name},r.setText=function(e){a=e,t()},r.setImageUrl=function(e){n.src=r.getResourcePath(e),t()},r.setTextOff=function(e){l=e,t()},r.getTextOff=function(){return l},r.setImageOffUrl=function(e){o.src=r.getResourcePath(e),t()},r.getImageUrlOff=function(){return o.src},r.setTextOn=function(e){s=e,t()},r.getTextOn=function(){return s},r.setImageOnUrl=function(e){i.src=r.getResourcePath(e),t()},r.getImageUrlOn=function(){return i.src},r.setChecked=function(e){g.checked!=e&&(g.checked=e,t())},r.getChecked=function(){return g.checked},r.setValue=function(e){g.value=e},r.getValue=function(){return g.value},r.registerProperties=function(e){EJSS_INTERFACE.RadioButton.registerProperties(r,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),r.setDOMElement(u);var g=document.createElement("input");g.id=e+".radio",g.type="radio",u.appendChild(g),g.onchange=function(){g.remoteonchange();for(var e=document.getElementsByTagName("fieldset"),t=0;t<e.length;t++)if(e[t].childNodes&&e[t].childNodes[0]){var r=e[t].childNodes[0];"radio"==r.type&&r.remoteonchange&&r.name==g.name&&r.id!=g.id&&r.remoteonchange()}},g.remoteonchange=function(e){t();var n=r.getController();n&&(n.propertiesChanged("Checked"),n.invokeAction("OnChange"),g.checked?n.invokeAction("OnCheckOn"):n.invokeAction("OnCheckOff"),n.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",u.appendChild(c),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Separator={HORIZONTAL:0,VERTICAL:1,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Orientation",e.setOrientation),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.separator=function(e){var t=EJSS_INTERFACE.element(e),r=EJSS_INTERFACE.Separator.HORIZONTAL,n="100%",i="2px";t.setOrientation=function(e){"string"==typeof e&&(e=EJSS_INTERFACE.Separator[e.toUpperCase()]),r!=e&&(r=e,r==EJSS_INTERFACE.Separator.VERTICAL?(t.getDOMElement().style.display="inline",t.getDOMElement().style.height=t.getDOMElement().style.width,t.getDOMElement().style.width=i):(t.getDOMElement().style.display="none",t.getDOMElement().style.width=t.getDOMElement().style.height,t.getDOMElement().style.height=i))},t.getOrientation=function(){return r},t.setWidth=function(e){n!=e&&(n=e,r==EJSS_INTERFACE.Separator.VERTICAL?t.getDOMElement().style.height=n:t.getDOMElement().style.width=n)},t.getWidth=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.Separator.registerProperties(t,e)};var o=document.createElement("hr");return o.id=e,o.style.height=i,o.style.width=n,document.body.appendChild(o),t.setDOMElement(o),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Slider={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMin),t.registerProperty("Maximum",e.setMax),t.registerProperty("Step",e.setStep),t.registerProperty("TextWidth",e.setTextWidth),t.registerProperty("ShowText",e.setShowText),t.registerProperty("Format",e.setFormat),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("RangeCSS",e.setRangeCSS),t.registerAction("OnChange",e.getValue),t.registerAction("OnRelease",e.getValue)}},EJSS_INTERFACE.slider=function(e){var t=EJSS_INTERFACE.element(e),r=!1,n=3;t.registerProperties=function(e){EJSS_INTERFACE.Slider.registerProperties(t,e)},t.setValue=function(e){"undefined"==typeof e?s.value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)&&(s.value=parseFloat(e),r&&(o.innerHTML=parseFloat(e).toFixed(n)))},t.getValue=function(){var e=s.value;return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):e},t.setFormat=function(e){var r=e.indexOf("."),i=0;r>=0&&(i=Number(e.length-r-1)),n!=i&&(n=i,t.setValue(t.getValue()))},t.setStep=function(e){s.step=e},t.getStep=function(){return s.step},t.setMax=function(e){s.max=e,0==s.step.length&&s.min.length>0&&(s.step=(e-s.min)/100)},t.getMax=function(){return s.max},t.setMin=function(e){s.min=e,0==s.step.length&&s.max.length>0&&(s.step=(s.max-e)/100)},t.getMin=function(){return s.min},t.setShowText=function(e){r=e,r&&(o.innerHTML="")},t.getShowText=function(){return r},t.setTextWidth=function(e){o.style.width=e},t.getTextWidth=function(e){return o.style.width},t.setDisabled=function(e){s.disabled=e},t.getDisabled=function(){return s.disabled},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(o,e)},t.setRangeCSS=function(e){EJSS_INTERFACE.Style.setCSS(s,e)};var i=document.createElement("div");i.id=e,i.style.display="inline-block",i.style.overflow="hidden",i.style.textAlign="left",i.style.verticalAlign="middle",document.body.appendChild(i),t.setDOMElement(i);var o=document.createElement("label");o.id=e+".label",o.style.float="left",i.appendChild(o);var a=document.createElement("div");a.id=e+".div2",a.style.overflow="hidden",i.appendChild(a);var s=document.createElement("input");return s.style.verticalAlign="middle",s.style.width="98%",s.style.height="98%",s.type="range",s.id=e+".slider",s.value=0,a.appendChild(s),s.oninput=function(){var e=t.getController();e&&(e.propertiesChanged("Value"),e.invokeAction("OnChange"),e.reportInteractions())},s.onmouseup=function(){var e=t.getController();e&&(e.invokeAction("OnRelease"),e.reportInteractions())},s.ontouchend=function(){var e=t.getController();e&&(e.invokeAction("OnRelease"),e.reportInteractions())},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Style={BORDER_SOLID:"solid",BORDER_DOTTED:"dotted",BORDER_DASHED:"dashed",TEXTA_LEFT:"left",TEXTA_RIGHT:"right",TEXTA_CENTER:"center",TEXTA_JUSTIFY:"justify",VISIB_VISIBLE:"visible",VISIB_HIDDEN:"hidden",FLOAT_LEFT:"left",FLOAT_RIGHT:"right",FLOAT_NONE:"none",FLOAT_CENTER:"none",POSITION_STATIC:"static",POSITION_ABSOLUTE:"absolute",POSITION_FIXED:"fixed",POSITION_RELATIVE:"relative",POSITION_INHERIT:"inherit",OVERFLOW_VISIBLE:"visible",OVERFLOW_HIDDEN:"hidden",OVERFLOW_SCROLL:"scroll",OVERFLOW_AUTO:"auto",setCSS:function(e,t){var r=/-([\da-z])/gi,n=function(e,t){return(t+"").toUpperCase()},i=e.style;if("object"!=typeof t){var o=t.trim().split("{");if(o[0]&&o[0].length>0){var a,s=o[0].trim(),l=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(a=0;a<l.length&&l[a].selectorText!=s;a++);var u=l[a].cssText?l[a].cssText:l[a].style.cssText;u=u.match(/{.*}/g)[0];var g=u.slice(1,u.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),d=c[1].trim(),f=S.replace(r,n);i[f]=d}}}if(o[1]){var E=o[1].trim(),g=E.slice(0,E.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),d=c[1].trim(),f=S.replace(r,n);i[f]=d}}}}else for(var p in t){var f=p.replace(r,n);i[f]=t[p]}}},EJSS_INTERFACE.style=function(e){var t=EJSS_INTERFACE.Style,r={},n="white",i=0,o=t.BORDER_SOLID;return r.setCSS=function(r){t.setCSS(document.getElementById(e),r)},r.setVisibility=function(t){document.getElementById(e).style.visibility=t?"visible":"hidden"},r.getVisibility=function(){return"visible"==document.getElementById(e).style.visibility},r.setVerticalAlign=function(t){document.getElementById(e).style.verticalAlign=t},r.getVerticalAlign=function(){return document.getElementById(e).style.verticalAlign},r.setTextAlign=function(r){"TEXTA_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.textAlign=r},r.getTextAlign=function(){return document.getElementById(e).style.textAlign},r.setLineHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.lineHeight=t},r.getLineHeight=function(){return document.getElementById(e).style.lineHeight},r.setHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.height=t},r.getHeight=function(){return document.getElementById(e).style.height},r.setWidth=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.width=t},r.getWidth=function(){return document.getElementById(e).style.width},r.setOverflow=function(r){"OVERFL"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.overflow=r},r.getOverflow=function(){return document.getElementById(e).style.overflow},r.setPosition=function(r){"POSITI"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.position=r},r.getPosition=function(){return document.getElementById(e).style.position},r.setFloat=function(r){"FLOAT_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.float=r},r.getFloat=function(){return document.getElementById(e).style.float},r.setDisplay=function(t){document.getElementById(e).style.display=t},r.getDisplay=function(){return document.getElementById(e).style.display},r.setTop=function(t){document.getElementById(e).style.top=t},r.getTop=function(){return document.getElementById(e).style.top},r.setBottom=function(t){document.getElementById(e).style.bottom=t},r.getBottom=function(){return document.getElementById(e).style.bottom},r.setLeft=function(t){document.getElementById(e).style.left=t},r.getLeft=function(){return document.getElementById(e).style.left},r.setBorderStyle=function(r){"BORDER"==r.substring(0,6)&&(r=t[r.toUpperCase()]),o=r,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderStyle=function(){return o},r.setBorderWidth=function(t){i=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderWidth=function(){return i},r.setBorderColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),n=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderColor=function(){return n},r.setPadding=function(t){document.getElementById(e).style.padding=t},r.getPadding=function(){return document.getElementById(e).style.padding},r.setShadow=function(t){t?document.getElementById(e).style.boxShadow=t:document.getElementById(e).style.boxShadow=""},r.getShadow=function(){return""!=document.getElementById(e).style.boxShadow},r.setMargin=function(t){document.getElementById(e).style.margin=t},r.getMargin=function(){return document.getElementById(e).style.margin},r.setBackgroundImage=function(t){document.getElementById(e).style.backgroundImage="url("+t+")",document.getElementById(e).style.backgroundSize="100% 100%"},r.getBackgroundImage=function(){return document.getElementById(e).style.backgroundImage},r.setBackgroundColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.backgroundColor=t},r.getBackgroundColor=function(){return document.getElementById(e).style.backgroundColor},r.setColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.color=t},r.getColor=function(){return document.getElementById(e).style.color},r.getFont=function(){return document.getElementById(e).style.font},r.setFont=function(t){var r=document.getElementById(e).style,n=t.split(" ");r.fontStyle=n[0],r.fontWeight=n[1];var i=n[2].split("/");r.fontSize=i[0],i[1]&&(r.lineHeight=i[1]),n[3]&&(r.fontFamily=t.substring(t.indexOf(n[3])))},r.setFontStyle=function(t){document.getElementById(e).style.fontStyle=t},r.getFontStyle=function(){return document.getElementById(e).style.fontStyle},r.setFontFamily=function(t){document.getElementById(e).style.fontFamily=t},r.getFontFamily=function(){return document.getElementById(e).style.fontFamily},r.setFontSize=function(t){document.getElementById(e).style.fontSize=t},r.getFontSize=function(){return document.getElementById(e).style.fontSize},r.setLetterSpacing=function(t){document.getElementById(e).style.letterSpacing=t},r.getLetterSpacing=function(){return document.getElementById(e).style.letterSpacing},r.setOutlineColor=function(t){document.getElementById(e).style.stroke=t},r.getOutlineColor=function(){return document.getElementById(e).style.stroke},r.setFontWeight=function(t){document.getElementById(e).style.fontWeight=t},r.getFontWeight=function(){return document.getElementById(e).style.fontWeight},r.setFillColor=function(t){document.getElementById(e).style.fill=t},r.getFillColor=function(){return document.getElementById(e).style.fill},r.setTransform=function(t){document.getElementById(e).style.transform=t,document.getElementById(e).style["-ms-transform"]=t,document.getElementById(e).style["-webkit-transform"]=t},r.getTransform=function(){return document.getElementById(e).style.transform},r.setWhiteSpace=function(t){document.getElementById(e).style.whiteSpace=t},r.getWhiteSpace=function(){return document.getElementById(e).style.whiteSpace},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.SvgGraphics={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.svgGraphics=function(e){var t=EJSS_INTERFACE.element(e),r=0,n=0;t.setWidth=function(e){if(n!=e){n=e;var r="string"==typeof n&&n.indexOf("%")!=-1?n:parseFloat(n);return t.getDOMElement().setAttribute("width",r),!0}return!1},t.getWidth=function(){return n},t.setHeight=function(e){if(r!=e){r=e;var n="string"==typeof r&&r.indexOf("%")!=-1?r:parseFloat(r);return t.getDOMElement().setAttribute("height",n),!0}return!1},t.getHeight=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.SvgGraphics.registerProperties(t,e)};var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("id",e),i.style.overflow="hidden",i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(i),t.setDOMElement(i),t.setWidth(500),t.setHeight(500),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextArea={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Rows",e.setRows),t.registerProperty("Columns",e.setCols),t.registerProperty("ChangeColorOnEdit",e.setChangeColorOnEdit),t.registerAction("OnChange")}},EJSS_INTERFACE.textArea=function(e){var t=EJSS_INTERFACE.element(e),r=!0;t.registerProperties=function(e){EJSS_INTERFACE.TextArea.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setChangeColorOnEdit=function(e){r=e},t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setCols=function(e){t.getDOMElement().cols=e},t.getCols=function(){return t.getDOMElement().cols},t.setRows=function(e){t.getDOMElement().rows=e},t.getRows=function(){return t.getDOMElement().rows};var n=document.createElement("textarea");return n.id=e,n.style.verticalAlign="middle",document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onkeydown=function(e){var n=t.getDOMElement();n.readOnly||r&&t.getStyle().setBackgroundColor("yellow")},t.getDOMElement().onblur=function(e){if(!e.readOnly){r&&t.getStyle().setBackgroundColor("white");var n=t.getController();n&&(n.propertiesChanged("Value"),n.invokeAction("OnChange"),n.reportInteractions())}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.textField=function(e){function t(){var e=r.getDOMElement().value;if(r.getStyle().setBackgroundColor("white"),r.parseValue&&r.parseValue(e),i!=e){var t=r.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}var r=EJSS_INTERFACE.element(e),n=!1,i="";r.registerProperties=function(e){EJSS_INTERFACE.TextField.registerProperties(r,e)},r.enableEPub=function(){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(r.render=function(){r.enableEPub()}),r.setValue=function(e){n||("undefined"==typeof e?r.getDOMElement().value="value undefined":r.getDOMElement().value=e)},r.getValue=function(){return r.getDOMElement().value},r.setEditable=function(e){r.getDOMElement().readOnly=!e},r.getEditable=function(){return!r.getDOMElement().readOnly},r.setSize=function(e){r.getDOMElement().size=e},r.getSize=function(){return r.getDOMElement().size};var o=document.createElement("input");return o.id=e,o.type="text",document.body.appendChild(o),r.setDOMElement(o),r.getDOMElement().onkeydown=function(e){var o=r.getDOMElement();if(!o.readOnly){var a=e||window.event,s=a.which?a.which:a.keyCode;13==s?(n=!1,t(),i=r.getDOMElement().value):27==s?r.getDOMElement().value=i:(r.getStyle().setBackgroundColor("yellow"),n=!0)}},r.getDOMElement().onfocus=function(e){i=r.getDOMElement().value},r.getDOMElement().onblur=function(e){!e.readOnly&&n&&(t(),n=!1)},r.getDOMElement().ontouchstart=function(e){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1),r.getDOMElement().focus(),e.stop()},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TwoStateButton={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageUrlOn),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageUrlOff),t.registerProperty("State",e.setState,e.getState),t.registerAction("OnClick"),t.registerAction("OffClick")}},EJSS_INTERFACE.twoStateButton=function(e){function t(){n.getDOMElement().innerHTML="",l?(i.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+i+'"/>'),a.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+a.toString()+"</span>")):(o.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+o+'"/>'),s.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+s.toString()+"</span>"))}var r=EJSS_INTERFACE.TwoStateButton,n=EJSS_INTERFACE.element(e),i="",o="",a="",s="",l=-1;n.setTextOff=function(e){s=e,t()},n.getTextOff=function(){return s},n.setImageUrlOff=function(e){var r=n.getResourcePath(e);r!=o&&(o=r,t())},n.getImageUrlOff=function(){return o},n.setTextOn=function(e){a=e,t()},n.getTextOn=function(){return a},n.setImageUrlOn=function(e){var r=n.getResourcePath(e);r!=i&&(i=r,t())},n.getImageUrlOn=function(){return i},n.setState=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),e!=l&&(l=e,t())},n.getState=function(){return l},n.registerProperties=function(e){EJSS_INTERFACE.TwoStateButton.registerProperties(n,e)};var u=document.createElement("button");return u.id=e,u.style.verticalAlign="middle",document.body.appendChild(u),n.setDOMElement(u),n.getDOMElement().onclick=function(){var e=n.getState();n.setState(!e);var t=n.getController();t&&(t.propertiesChanged("State"),e?t.invokeAction("OnClick"):t.invokeAction("OffClick"),t.reportInteractions())},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Video={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("VideoUrl",e.setUrl),t.registerProperty("Background",e.setBackground,e.getBackground),t.registerProperty("PosterUrl",e.setPoster)}},EJSS_INTERFACE.video=function(e){var t=EJSS_INTERFACE.media(e),r=!1;t.setPoster=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().poster=e},t.getPoster=function(){return t.getDOMElement().poster},t.getBackground=function(){return r},t.setBackground=function(e){e!=r&&(r=e,r?(t.getStyle().setWidth("100%"),t.getStyle().setHeight("100%"),t.getStyle().setCSS({position:"absolute","z-index":"-100"})):(t.getStyle().setWidth(" "),t.getStyle().setHeight(" "),t.getStyle().setCSS({position:" ","z-index":" "})))},t.registerProperties=function(e){EJSS_INTERFACE.Video.registerProperties(t,e)};var n=document.createElement("video");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WebGLCanvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.webGLCanvas=function(e){var t,r=EJSS_INTERFACE.element(e),n=0,i=0;r.setWidth=function(e){return i!=e&&(i=e,r.getDOMElement().setAttribute("width",i),!0)},r.getWidth=function(){return i},r.setHeight=function(e){return n!=e&&(n=e,r.getDOMElement().setAttribute("height",n),!0)},r.getHeight=function(){return n},r.getContext=function(){return t},r.registerProperties=function(e){EJSS_INTERFACE.WebGLCanvas.registerProperties(r,e)};var o=document.createElement("canvas");o.setAttribute("id",e),o.setAttribute("width",500),o.setAttribute("height",500),document.body.appendChild(o),r.setDOMElement(o),r.getStyle().setBorderColor("black"),r.getStyle().setBorderWidth(2);try{t=o.getContext("webgl")}catch(e){}try{t=t||o.getContext("experimental-webgl")}catch(e){}try{t=t||o.getContext("webkit-3d")}catch(e){}try{t=t||o.getContext("moz-webgl")}catch(e){}if(!t){r.getStyle().setBackgroundColor("rgb(239,239,255)");var a=o.getContext("2d");a.font="bold 16px Arial",a.fillText("WebGL not supported!",100,100)}return r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WrappedPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Parent",e.setDoubleParent)}},EJSS_INTERFACE.wrappedPanel=function(e){if("undefined"==typeof _isEPub||!_isEPub)return EJSS_INTERFACE.panel(e);var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.WrappedPanel.registerProperties(t,e)},t.adjustPosition=function(){r.style.height=n.getBoundingClientRect().height+"px",r.style.width=n.getBoundingClientRect().width+"px";var e=r.getBoundingClientRect().top,t=r.getBoundingClientRect().left,i=document.body,o=document.documentElement,a=window.pageYOffset||o.scrollTop||i.scrollTop,s=window.pageXOffset||o.scrollLeft||i.scrollLeft;n.style.top=e+a+"px",n.style.left=t+s+"px"},t.setDoubleParent=function(e){if("string"==typeof e){var n=document.getElementById(e);n.appendChild(r)}else e.getDOMElement?e.getDOMElement().appendChild(r):e.appendChild(r);t.setParent(e)},t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)};var r=document.createElement("div");EJSS_INTERFACE.Style.setCSS(r,{display:"block","margin-left":"auto","margin-right":"auto","page-break-inside":"avoid"}),document.body.appendChild(r);var n=document.createElement("div");return n.id=e,n.contenteditable=!0,document.body.appendChild(n),t.setDOMElement(n),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({"page-break-inside":"avoid",display:"inline-block","margin-left":"auto","margin-right":"auto",position:"absolute"}),t.getDOMElement().ontouchstart=function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1},t};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Model={MODE_JAVA_STYLE:1,MODE_RESPECT_TIME:2,MODE_RESPECT_DELAY:3},EJSS_CORE.createAnimation=function(){function e(e){for(var t=0,r=e.length;t<r;t++)if(S=!1,e[t](),S)return}var t,r,n={},i=1,o="Choose a name for the file",a="Select a file to read",s=i,l=1,u=!1,g=!0,c=!1,S=!1,d=+new Date,f=!1,E=null,p=NaN,h=s,m=0,A=10,y=!0,v=!1,P=[],D=EJSS_CORE.Model.MODE_JAVA_STYLE;n.setView=function(e){E=e,E._setReportInteractionMethod(function(){f||E._readInteractions(b,r,f)&&(n.automaticResetSolvers(),n.update())})},n.getView=function(){return E},n.serialize=function(){var e={};n._userSerialize&&(e=n._userSerialize());var t=E.serialize(),r={model:e,view:t};return JSON.stringify(r,function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})},n.unserialize=function(e){var t=JSON.parse(e,function(e,t){return"__NaN"==t?t=NaN:"__Infinity"==t&&(t=1/0),t});if(t.model){var r=t.model;n._userUnserialize&&n._userUnserialize(r)}if(t.view){var i=t.view;E.unserialize(i)}};var I,_,C,R,T;n.sendCallback=function(){},n.setStatusParams=function(e,t,r,i,o,a){I=e,_=t,C=r,R=i,T=o,a&&(n.sendCallback=a)},n.sendSnapshot=function(e,t,r,n){if(R){var i=t.split(".").pop();i==t.split(".")[0]&&(i="");var o=t.split(".")[0]+"_context_id_"+I+"_user_id_"+_+"_ejsapp_id_"+C+i;e.importGraphics(function(e){var t=new XMLHttpRequest,i="user_file="+o+"&file="+encodeURIComponent(e)+"&type=png";t.open("POST",R,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&200==t.status?r&&r():n&&n()},t.send(i)})}},n.sendState=function(e,t,r){if(R){var i=e.split(".").pop();i==e.split(".")[0]&&(i="");var o=e.split(".")[0]+"_context_id_"+I+"_user_id_"+_+"_ejsapp_id_"+C+i,a=n.serialize(),s=new XMLHttpRequest,l="user_file="+o+"&file="+encodeURIComponent(a)+"&type=json";s.open("POST",R,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200==s.status?t&&t():r&&r()},s.send(l)}},n.sendText=function(e,t,r,n,i){if(R){if(r)o="."+r;else{r="txt";var o="."+e.split(".").pop();o=="."+e.split(".")[0]&&(o="")}var a=e.split(".")[0]+"_context_id_"+I+"_user_id_"+_+"_ejsapp_id_"+C+o,s=new XMLHttpRequest,l="user_file="+a+"&file="+encodeURIComponent(t)+"&type="+r;s.open("POST",R,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200==s.status?n&&n():i&&i()},s.send(l)}},n.getState=function(e,t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Cache-Control","no-cache"),i.onreadystatechange=function(){4==i.readyState&&200==i.status?(n.unserialize(i.responseText),t&&t()):r&&r()},i.send()},n.getText=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?t&&t(n.responseText):r&&r()},n.send()},n.getStateFiles=function(e,t,r){if(C){var n=new XMLHttpRequest,i=T+"?ejsapp_id="+C+"&type="+e;n.open("GET",i,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=n.responseText.split(";"),i={};i.name=[],i.url=[];for(var o=0;o+1<e.length;o++)i.name.push(e[o]),i.url.push(e[++o]);t&&t(i)}else r&&r()},n.send()}},n.saveText=function(e,t,r){if(!r){var r=t;t=null}I?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendText(e,r,t,function(){n.sendCallback()})}):n.sendText(e,r,t,function(){n.sendCallback()})},n.saveState=function(e){I?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendState(e,function(){n.sendCallback()})}):n.sendState(e,function(){n.sendCallback()})},n.saveImage=function(e,t){I?EJSS_INTERFACE.BoxPanel.showInputDialog(o,function(e){n.sendSnapshot(E[t],e,function(){n.sendCallback()})}):n.sendSnapshot(E[t],e,function(){n.sendCallback()})},n.readState=function(e,t){if(e)n.getState(e);else{var r="undefined"!=typeof t?t:".json";n.getStateFiles(r,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(a,t,function(e){n.getState(e)})})}},n.readText=function(e,t,r){e?n.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,n._userUnserialize(t)}}):n.getStateFiles(t,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(a,t,function(e){n.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,n._userUnserialize(t)}})})})};var N,O,M=[],b=0,G={},x=!1;n.getEventInteractionsStream=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:+new Date};n.runCount=b,n.runTime=r,n.event="mouse",N.send(JSON.stringify(n))},n.startCaptureStream=function(e,t,i,o,a){var s=window.location,l="https:"===s.protocol?"wss:":"ws:";l+="//"+s.host+":"+e;try{N=new WebSocket(l),"undefined"!=typeof t&&t(),N.onopen=function(){b=0,r=+new Date,E.registerInteractions(N),document.addEventListener("mousemove",n.getEventInteractionsStream),document.addEventListener("touchmove",n.getEventInteractionsStream),document.addEventListener("mousedown",n.getEventInteractionsStream),document.addEventListener("touchstart",n.getEventInteractionsStream)},N.onclose=function(e){n.stopCaptureStream(),a(e)},N.onmessage=function(e){console.log("Message is received: "+e.data)}}catch(e){return void("undefined"!=typeof i&&i(e))}},n.stopCaptureStream=function(){try{N.close()}catch(e){}E.unregisterInteractions(),document.removeEventListener("mousemove",n.getEventInteractionsStream),document.removeEventListener("touchmove",n.getEventInteractionsStream),document.removeEventListener("mousedown",n.getEventInteractionsStream),document.removeEventListener("touchstart",n.getEventInteractionsStream)},n.playCaptureStream=function(e,t,n,i,o){var a=10;if(!x){x=!0;var s=[];try{O=new EventSource(e),"undefined"!=typeof t&&t(),O.onopen=i,O.onclose=function(e){var t=document.getElementById("_my_mouse");t&&document.body.removeChild(t),o(e)},O.onmessage=function(e){var t=JSON.parse(e.data);console.log("Now: "+Date.now()+"-"+t.timeStamp),s=s.concat(t.interactions)}}catch(e){return void("undefined"!=typeof n&&n(e))}setTimeout(function(){b=0,r=+new Date,k=[];var e=0,t=b,n=0,i=0,o=0,l=0,u=setInterval(function(){for(var r=e;r<s.length;){var g=s[r++];if("undefined"!=typeof g.isPlaying&&g.isPlaying)k.push(g),e++;else if(g.runCount==t&&n>=g.timeStamp-g.runTime&&i<=g.timeStamp-g.runTime){e++,i=g.timeStamp-g.runTime;for(var c in G){var S=E[c];S.getDOMElement().style.border=G[c]}if(G={},"undefined"!=typeof g.event){var d=g.pageX,f=g.pageY,p=g.target;if("undefined"!=typeof p&&p.length>0){var S=document.getElementById(p);null!=S&&(o=g.offsetLeft-S.offsetLeft,l=g.offsetTop-S.offsetTop)}d-=o,f+=l;var h=document.getElementById("_my_mouse");if(!h){var h=document.createElement("div");h.id="_my_mouse",h.style.position="absolute",h.style.margin="0",h.style.border="3px solid red",document.body.appendChild(h)}h.style.left=d+"px",h.style.top=f+"px"}else if("undefined"!=typeof g.property){var S=E[g.element];S.propertyChanged(g.property,g.data).reportInteractions()}else if("undefined"!=typeof g.action){var S=E[g.element];S.invokeAction(g.action).reportInteractions(),"undefined"==typeof G[S.getName()]&&(G[S.getName()]=S.getDOMElement().style.border),S.getDOMElement().style.border="1px solid red"}}}t!=b?(t=b,n=0,i=0):n+=a,x||clearInterval(u)},a)},1e3)}},n.pauseCaptureStream=function(){try{O.close()}catch(e){}x=!1},n.getEventInteractions=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:e.timeStamp};n.runCount=b,n.runTime=r,n.event="mouse",M.push(n)},n.startCapture=function(){b=0,r=+new Date,E.registerInteractions(),M=[],document.addEventListener("mousemove",n.getEventInteractions),
document.addEventListener("touchmove",n.getEventInteractions),document.addEventListener("mousedown",n.getEventInteractions),document.addEventListener("touchstart",n.getEventInteractions)},n.stopCapture=function(){E.unregisterInteractions(),document.removeEventListener("mousemove",n.getEventInteractions),document.removeEventListener("touchmove",n.getEventInteractions),document.removeEventListener("mousedown",n.getEventInteractions),document.removeEventListener("touchstart",n.getEventInteractions);var e={interactions:E.getRegInteractions(),events:M};return e},n._readCapturedInteractions=function(){for(var e=k.length,t=0;t<e;t++){var r=k[t];if(r.runCount==b&&r.isPlaying){if("undefined"!==r.property){var n=E[r.element];n.propertyChanged(r.property,r.data).reportInteractions()}if("undefined"!==r.action){var n=E[r.element];n.invokeAction(r.action).reportInteractions(),"undefined"==typeof G[n.getName()]&&(G[n.getName()]=n.getDOMElement().style.border),n.getDOMElement().style.border="1px solid red"}r.runCount=-1}}};var L=!1,J=!1,w=1,W=!1,k=[];n.playCapture=function(e,t,i){var o=10,a=e.interactions,l=a.length,u=0,g=e.events,c=g.length,S=0;if(!L){L=!0,J=!1,n.reset(),"undefined"!=typeof i&&(w=i),s/=w,b=0,r=+new Date,k=a;var d=b,f=0,p=0,h=0,m=setInterval(function(){for(var e in G){var r=E[e];r.getDOMElement().style.border=G[e]}if(G={},L){for(;u<l&&a[u].runCount<=d&&f>=a[u].timeStamp-a[u].runTime;){if(!a[u].isPlaying){if("undefined"!==a[u].property){var r=E[a[u].element];r.propertyChanged(a[u].property,a[u].data).reportInteractions()}if("undefined"!==a[u].action){var r=E[a[u].element];r.invokeAction(a[u].action).reportInteractions(),"undefined"==typeof G[r.getName()]&&(G[r.getName()]=r.getDOMElement().style.border),r.getDOMElement().style.border="1px solid red"}}u++}for(;S<c&&g[S].runCount<=d&&f>=g[S].timeStamp-g[S].runTime;){var n=g[S].pageX,i=g[S].pageY,A=g[S].target;if("undefined"!=typeof A&&A.length>0){var r=document.getElementById(A);null!=r&&(p=g[S].offsetLeft-r.offsetLeft,h=g[S].offsetTop-r.offsetTop)}n-=p,i+=h;var y=document.getElementById("_my_mouse");if(!y){var y=document.createElement("div");y.id="_my_mouse",y.style.position="absolute",y.style.margin="0",y.style.border="3px solid red",document.body.appendChild(y)}y.style.left=n+"px",y.style.top=i+"px",S++}if(d!=b?(d=b,f=0):f+=o*w,S>=c&&u>=l){var y=document.getElementById("_my_mouse");y&&document.body.removeChild(y),clearInterval(m),L=!1,s*=w,k=[],t()}}J&&(clearInterval(m),L=!1,s*=w,k=[],t())},o)}},n.pauseCapture=function(){W=f,n.pause(),L=!1},n.resumeCapture=function(){W&&n.play(),L=!0},n.resetCapture=function(){J=!0},n.changeCaptureStep=function(e){s*=w,w=e,s/=w},n.setMode=function(e){n.setRunningMode(e)},n.setRunningMode=function(e){D="string"==typeof e?EJSS_CORE.Model[e.toUpperCase()]:e},n.getMode=function(){return D},n.setRunAlways=function(e){v=e},n.setPauseOnPageExit=function(e){v=!e},n.setFPS=function(e){s=Math.max(1e3/e,i)},n.getFPS=function(){return Math.int(1e3/s)},n.setDelay=function(e){s=Math.max(e,0)},n.setMinimumDelay=function(e){A=Math.max(e,0)},n.setStepsPerDisplay=function(e){e>=1&&(l=e)},n.setUpdateView=function(e){g=e},n.setAutoplay=function(e){c=e},n.isPlaying=function(){return f},n.isPaused=function(){return!f},n.resetRealTime=function(){var e=+Date();p=1e3*n.getRealTime()-e},n.play=function(){f||(d=+new Date,h=s,f=!0,t=window.setTimeout(n.run,A))},n.pause=function(){f=!1,u=!0,0!=t&&(window.clearTimeout(t),t=0)},n.run=function(){b++,r=+new Date;var e,i=1;if(f){if(y||v){switch(D){default:case EJSS_CORE.Model.MODE_JAVA_STYLE:n.step(),d=+new Date,e=d-r,i=Math.max(A,s-e);break;case EJSS_CORE.Model.MODE_RESPECT_DELAY:n.step(),i=s,d=+new Date;break;case EJSS_CORE.Model.MODE_RESPECT_TIME:if(e=r-d,e>=h-m){var o=0;h&&(o=Math.floor((e+m)/h),m=e+m-o*h);var a=n.step(o);h&&a>e&&o>100&&(alert("Imposible running with delay "+h+" ms."),f=!1,m=0),h=s,d=r}}var l=t;if(n._readCapturedInteractions(),E._readInteractions(b,r,f)&&(n.automaticResetSolvers(),n.update()),l!=t)return}else d=+new Date;t=window.setTimeout(n.run,i)}},n.onExit=function(){n.pause(),E._readInteractions(b,r,f),n.freeMemory()},n.reset=function(e){e||(n.pause(),n.resetModel()),E._setReportNeeded(!1),E._reset(),e||(E._initValues(),E._initialize(),n.initializeModel()),n.updateModel(),g?(E._update(),E._render()):E._collectData(),E._setReportNeeded(!0),c&&n.play(),E._resized(window.innerWidth,window.innerHeight)},n.initialize=function(){E._initialize(),n.initializeModel(),n.updateModel(),g?(E._update(),E._render()):E._collectData()},n.update=function(){(y||v)&&(n.updateModel(),g?(E._update(),E._render()):E._collectData())},n.step=function(e){var t=+new Date;e||(e=1);var r=Math.max(e,l);if(r>1){u=!1;for(var i=1;i<r;i++){if(u)return void n.update();n.stepModel(),n.updateModel(),E._collectData()}}n.stepModel();var o=+new Date-t;return n.update(),o},n.setShouldBreak=function(e){S=e},n.getShouldBreak=function(){return S},n._autoSelectView=function(e){for(var t=screen.height,r=screen.width,n=[],i=Number.MAX_VALUE,o=0;o<e.length;o++){var a=r-e[o].width;a>=0&&(a<i?(i=a,n=[o]):a==i&&n.push(o))}var s=-1;i=Number.MAX_VALUE;for(var o=0;o<n.length;o++){var a=Math.abs(t-e[n[o]].height);a<i&&(i=a,s=n[o])}return s},n.addToOnload=function(e){P.push(e)},n.onload=function(){for(var e=0,t=P.length;e<t;e++)P[e]()};var F=[],V=[],B=[],H=[];return n.getRealTime=function(){return NaN},n.automaticResetSolvers=function(){},n.freeMemory=function(){},n.addToReset=function(e){F.push(e)},n.addToInitialization=function(e){V.push(e)},n.addToEvolution=function(e){B.push(e)},n.addToFixedRelations=function(e){H.push(e)},n.resetModel=function(){e(F)},n.initializeModel=function(){e(V)},n.stepModel=function(){e(B)},n.updateModel=function(){e(H)},window.onblur=function(){y=!1},window.onfocus=function(){y=!0},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Bootstrap2IntervalData={},EJSS_ODE_INTERPOLATION.bootstrap2IntervalData=function(e,t,r,n,i){var o,a,s,l,u=EJSS_ODE_INTERPOLATION.bootstrapIntervalData(e,t,r,n,i);u.interpolate=function(e,t){var r=u.getDeltaTime(),n=u.getLeftState(),i=u.getLeftRate(),g=(e-u.getLeft())/r;return n[t]+g*(r*i[t]+g*(o[t]+g*(a[t]+g*(s[t]+g*l[t]))))},u.interpolateState=function(e,t,r,n){return u.bootstrap2((e-u.getLeft())/u.getDeltaTime(),t,r,n),t},u.bootstrap2=function(e,t,r,n){for(var i=u.getDeltaTime(),g=u.getLeftState(),c=u.getLeftRate(),S=r,d=0;d<n;d++)t[d]=g[S]+e*(i*c[S]+e*(o[S]+e*(a[S]+e*(s[S]+e*l[S])))),S++};var g=.7,c=.85,S=2*g*(g-1)*c*(c-1)*(c-g)*(10*g*c-5*c-5*g+3),d=g*(-3*g+2),f=g*(-3*g+4)-1,E=6*g*(g-1),p=c*(-3*c+2),h=c*(-3*c+4)-1,m=6*c*(c-1),A=g*(2+g*(-6+4*g)),y=c*(2+c*(-6+4*c)),v=g*(4+g*(-9+5*g*g)),P=c*(4+c*(-9+5*c*c)),D=e.length,I=D-1,_=u.getDeltaTime(),C=new Array(D),R=new Array(D),T=new Array(D);o=new Array(D),a=new Array(D),s=new Array(D),l=new Array(D),u.bootstrap1(g,C,0,I),C[I]=u.getLeft()+g*_,i.getRate(C,R),u.bootstrap1(c,C,0,I),C[I]=u.getLeft()+c*_,i.getRate(C,T);for(var N=0;N<D;N++){var O=r[N]-e[N],M=_*t[N],b=_*n[N],G=_*R[N]+d*b+f*M+E*O,x=_*T[N]+p*b+h*M+m*O,L=(P*G-v*x)/S,J=(A*x-y*G)/S,w=b+M-2*O-2*L-3*J;l[N]=J,s[N]=L,a[N]=w,o[N]=O-M-w-L-J}return u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.BootstrapIntervalData={},EJSS_ODE_INTERPOLATION.bootstrapIntervalData=function(e,t,r,n,i){var o,a,s,l=EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,n);l.interpolate=function(e,t){var r=l.getDeltaTime(),n=l.getLeftState(),i=l.getLeftRate(),u=(e-l.getLeft())/r;return n[t]+u*(r*i[t]+u*(o[t]+u*(a[t]+u*s[t])))},l.interpolateState=function(e,t,r,n){return l.bootstrap1((e-l.getLeft())/l.getDeltaTime(),t,r,n),t},l.bootstrap1=function(e,t,r,n){for(var i=l.getDeltaTime(),u=l.getLeftState(),g=l.getLeftRate(),c=r,S=0;S<n;S++)t[S]=u[c]+e*(i*g[c]+e*(o[c]+e*(a[c]+e*s[c]))),c++};var u=.25,g=u*(u-1)*(4*u-2),c=u*(-3*u+2),S=u*(-3*u+4)-1,d=6*u*(u-1),f=e.length,E=l.getDeltaTime(),p=new Array(f),h=new Array(f);o=new Array(f),a=new Array(f),s=new Array(f),l.hermite(u,p,0,f-1),p[f-1]=l.getLeft()+u*E,i.getRate(p,h);for(var m=0;m<f;m++){var A=r[m]-e[m],y=E*t[m],v=E*n[m],P=(E*h[m]+c*v+S*y+d*A)/g,D=v+y-2*A-2*P;s[m]=P,a[m]=D,o[m]=A-y-D-P}return l};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ConstantConditionData={},EJSS_ODE_INTERPOLATION.constantConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(e,r){return t[r]},r.interpolateState=function(e,r,n,i){for(var o=n,a=0;a<i;a++)r[a]=t[o],o++;return r};var n=e.length;t=new Array(n);for(var i=0;i<n;i++)t[i]=e[i];return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri5IntervalData={},EJSS_ODE_INTERPOLATION.dopri5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*o[4][t])))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;u<i;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*s[4][l]))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri853IntervalData={},EJSS_ODE_INTERPOLATION.dopri853IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*(o[4][t]+r*(o[5][t]+i*(o[6][t]+r*o[7][t]))))))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;u<i;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*(s[4][l]+o*(s[5][l]+a*(s[6][l]+o*s[7][l])))))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerIntervalData={},EJSS_ODE_INTERPOLATION.eulerIntervalData=function(e,t,r){var n,i,o=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);o.interpolate=function(e,t){var r=e-o.getLeft();return n[t]+r*i[t]},o.interpolateState=function(e,t,r,a){for(var s=e-o.getLeft(),l=r,u=0;u<a;u++)t[u]=n[l]+s*i[l],l++;return t};var a=e.length;n=new Array(a),i=new Array(a);for(var s=0;s<a;s++)n[s]=e[s],i[s]=t[s];return o};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerRichardsonIntervalData={},EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData=function(e,t,r,n){var i,o,a,s,l,u=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);u.interpolate=function(e,t){var r=(e-u.getLeft())/o,n=r*r*o,i=o*r-n;return a[t]+i*s[t]+n*l[t]},u.interpolateState=function(e,t,r,n){for(var i=(e-u.getLeft())/o,g=i*i*o,c=o*i-g,S=r,d=0;d<n;d++)t[d]=a[S]+c*s[S]+g*l[S],S++;return t};var g=e.length;a=new Array(g),s=new Array(g),l=new Array(g);for(var c=0;c<g;c++)a[c]=e[c],s[c]=t[c],l[c]=n[c];return i=g-1,o=r-e[i],u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ExtraStepsIntervalData={},EJSS_ODE_INTERPOLATION.extraStepsIntervalData=function(e,t,r){var n,i,o,a=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],t[t.length-1]);a.getTimeIndex=function(){return n},a.getDeltaTime=function(){return i},a.getCoeffs=function(){return o};var s=e.length;n=s-1,i=t[n]-e[n];var l=r.length;o=new Array(l);for(var u=0;u<l;u++){o[u]=new Array(s);for(var g=0;g<s;g++)o[u][g]=r[u][g]}return a};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.HermiteIntervalData={},EJSS_ODE_INTERPOLATION.hermiteIntervalData=function(e,t,r,n){var i,o,a,s,l,u,g=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r[r.length-1]);g.getTimeIndex=function(){return i},g.getDeltaTime=function(){return o},g.getLeftState=function(){return a},g.getLeftRate=function(){return s},g.interpolate=function(e,t){var r=(e-g.getLeft())/o,n=r-1,i=r*n,c=i*(1-2*r),S=-n-c,d=r+c,f=i*n*o,E=i*r*o;return S*a[t]+d*l[t]+f*s[t]+E*u[t]},g.interpolateState=function(e,t,r,n){return g.hermite((e-g.getLeft())/o,t,r,n),t},g.hermite=function(e,t,r,n){for(var i=e-1,g=e*i,c=g*(1-2*e),S=-i-c,d=e+c,f=g*i*o,E=g*e*o,p=r,h=0;h<n;h++)t[h]=S*a[p]+d*l[p]+f*s[p]+E*u[p],p++};var c=e.length;a=new Array(c),s=new Array(c),l=new Array(c),u=new Array(c);for(var S=0;S<c;S++)a[S]=e[S],s[S]=t[S],l[S]=r[S],u[S]=n[S];return i=c-1,o=r[i]-e[i],g};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.InitialConditionData={},EJSS_ODE_INTERPOLATION.initialConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(r,n){return e.getInitialCondition(r,t),t[n]},r.interpolateState=function(r,n,i,o){e.getInitialCondition(r,t);for(var a=i,s=0;s<o;s++)n[s]=t[a],a++;return n};var n=e.getState(),i=n.length;return t=new Array(i),r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.IntervalData={},EJSS_ODE_INTERPOLATION.intervalData=function(e,t){var r={};return r.getLeft=function(){return e},r.getRight=function(){return t},r.setRight=function(e){t=e},r.interpolate=function(e,t){return Number.NaN},r.interpolateState=function(e,t,r,n){return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Radau5IntervalData={},EJSS_ODE_INTERPOLATION.radau5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r),i=bState[bState.length-1];return n.interpolate=function(e,t){var r=(e-i)/n.getDeltaTime(),o=n.getCoeffs(),a=EJSS_ODE_SOLVERS.Radau5.c1m1,s=EJSS_ODE_SOLVERS.Radau5.c2m1;return o[0][t]+r*(o[1][t]+(r-s)*(o[2][t]+(r-a)*o[3][t]))},n.interpolateState=function(e,t,r,o){for(var a=(e-i)/mDeltaTime,s=n.getCoeffs(),l=EJSS_ODE_SOLVERS.Radau5.c1m1,u=EJSS_ODE_SOLVERS.Radau5.c2m1,g=r,c=0;c<o;c++)t[c]=s[0][g]+a*(s[1][g]+(a-u)*(s[2][g]+(a-l)*s[3][g])),g++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.StateHistory={},EJSS_ODE_INTERPOLATION.stateHistory=function(e){var t,r={},n=[],i=!0,o=0,a=0,s=0;return r.setLength=function(e){a=Math.abs(e),s=Math.max(o,a)},r.setMinimumLength=function(e){o=Math.abs(e),s=Math.max(o,a)},r.addIntervalData=function(e){i=e.getLeft()<=e.getRight();n.length;if(n.length>0){var t=n.length-1,r=n[t],o=0;if(i){for(;null!=r&&r.getLeft()>=e.getLeft();)o++,t--,r=t<0?null:n[t];null!=r&&e.getLeft()<r.getRight()&&r.setRight(e.getLeft())}else{for(;null!=r&&r.getLeft()<=e.getLeft();)o++,t--,r=t<0?null:n[t];null!=r&&e.getLeft()>r.getRight()&&r.setRight(e.getLeft())}o>0&&n.splice(t,o)}n.push(e)},r.toString=function(){for(var e="History has now "+n.length+" intervals: ",t=0,r=n.length;t<r;t++){var i=n[t];t>0&&(e+=", "),e+=" ["+i.getLeft()+","+i.getRight()+")"}return e},r.clearAll=function(){n=[]},r.clean=function(e){if(isFinite(s)){if(0==s)return void clearAll();var t=0,r=n.length;if(i){e-=s;for(var o=0;o<r;o++){var a=n[o];if(a.getRight()>e)break;t++}}else{e+=s;for(var o=0;o<r;o++){var a=n[o];if(a.getRight()<e)break;t++}}t>0&&n.splice(0,t)}},r.findInterval=function(e){var r=n.length;if(i)for(var o=r-1;o>=0;o--){var a=n[o];if(a.getLeft()<=e)return a}else for(var o=r-1;o>=0;o--){var a=n[o];if(a.getLeft()>=e)return a}return t},r.interpolate=function(e,t){var n=r.findInterval(e);return n.interpolate(e,t)},r.interpolateState=function(e,t,n,i){var o=r.findInterval(e);return i||(i=t.length),n||(n=0),o.interpolateState(e,t,n,i)},e.getInitialCondition?(t=EJSS_ODE_INTERPOLATION.initialConditionData(e),e.setStateHistory(r)):t=EJSS_ODE_INTERPOLATION.constantConditionData(e.getState()),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EVENT_TYPE={STATE_EVENT:0,POSITIVE_EVENT:1,CROSSING_EVENT:2},EJSS_ODE_SOLVERS.EVENT_METHOD={BISECTION:0,SECANT:1},EJSS_ODE_SOLVERS.ERROR={NO_ERROR:0,INTERNAL_SOLVER_ERROR:1,EVENT_NOT_FOUND:2,ILLEGAL_EVENT_STATE:3,ZENO_EFFECT:4,TOO_MANY_STEPS_ERROR:5,DISCONTINUITY_PRODUCED_ERROR:6,DID_NOT_CONVERGE:7},EJSS_ODE_SOLVERS.DISCONTINUITY_CODE={DISCONTINUITY_PRODUCED_ERROR:0,NO_DISCONTINUITY_ALONG_STEP:1,DISCONTINUITY_ALONG_STEP:2,DISCONTINUITY_JUST_PASSED:3,DISCONTINUITY_EXACTLY_ON_STEP:4},EJSS_ODE_SOLVERS.InterpolatorEventSolver={},EJSS_ODE_SOLVERS.interpolatorEventSolver=function(e,t){function r(t,r){h?e.bestInterpolate(t,r):e.interpolate(t,r)}function n(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];if(o+i[S]==o)return 0;var a=e.getMaximumTime(!1);return isNaN(a)?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]):o==a&&(a=e.internalStep(!1),isNaN(a))?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at max step at "+n[S]):(r(a,n),a-o)}function i(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];if(o+i[S]==o)return 0;var a=n[S]+m,s=e.getMaximumTime(!1);if(isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);var l=0;if(C)for(;s<a;){if(s=e.internalStep(!1),isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);if(++l>_){var u=n[S],g=e.bestInterpolate(a,new Array(c))[S];return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the maximum of "+_+" internal steps\nat "+g+", starting from "+u+" for an step of "+m)}}else for(;s>a;){if(s=e.internalStep(!1),isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver backwards at "+n[S]);if(++l>_)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S])}return r(a,n),m}function o(){var n=t.getState();if(P>0&&L>P&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var a=e.getMaximumTime(k);if(isNaN(a))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);if(i==a&&(a=e.internalStep(k),isNaN(a)))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);null!=x&&(isNaN(x.getMaxAdvance())||(a=C?Math.min(a,x.getMaxAdvance()):Math.max(a,x.getMaxAdvance())));for(var u=C?Math.min(i+v,a):Math.max(i-v,a);;){var g=null;if(w=null,r(u,d),g=E.findFirstEvent(n,u,d),null==g&&null!=F&&F.getTime()<=u&&(g=F),null!=g){if(w=g,h)e.bestInterpolate(g.getTime(),n);else for(var f=0;f<c;f++)n[f]=d[f];var p=n[S];return g.action(),E.reinitialize(),n=t.getState(),p!=n[S]?(L=0,x=null,w=null,g.reset(n),g.getTime()-i):(null!=x&&(Math.abs(G-g.getTime())<D?L++:L=0),x=g,G=g.getTime(),g.getTime()-i)}if(u==a){for(var f=0;f<c;f++)n[f]=d[f];return s(n[S]),a-i}u=C?Math.min(u+v,a):Math.max(u-v,a)}}function a(){var n=t.getState();if(P>0&&L>P&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var a=i+m,u=e.getMaximumTime(k);if(isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);for(var g=C?Math.min(i+v,a):Math.max(i-v,a),f=0;;){var p=null;w=null;var A=C?u<g:u>g;if(A){if(e.bestInterpolate(u,d),p=E.findFirstEvent(n,u,d),null==p&&(p=F),null==p){for(var y=0;y<c;y++)n[y]=d[y];if(s(n[S]),u=e.internalStep(k),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver looking for an event at "+n[S]);if(++f>_)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S]);continue}}else if(r(g,d),p=E.findFirstEvent(n,g,d),null==p&&null!=F&&F.time<=g&&(p=F),null==p){if(g==a){for(var y=0;y<c;y++)n[y]=d[y];return s(n[S]),a-i}g=C?Math.min(g+v,a):Math.max(g-v,a);continue}if(w=p,h)e.bestInterpolate(p.getTime(),n);else for(var y=0;y<c;y++)n[y]=d[y];var R=n[S],T=p.action();if(E.reinitialize(),f=0,n=t.getState(),R!=n[S])return L=0,x=null,w=null,p.reset(n),p.getTime()-i;if(null!=x&&(Math.abs(G-p.getTime())<D?(L++,I&&(T=!1)):L=0),x=p,G=p.getTime(),T)return p.getTime()-i;if(P>0&&L>P&&l(n))return p.getTime()-i;if(F=null,u=e.getMaximumTime(k),isNaN(p.getMaxAdvance())||(u=C?Math.min(u,p.getMaxAdvance()):Math.max(u,p.getMaxAdvance())),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver after an event at "+n[S])}}function s(e){var t,r;for(r=O.length,t=0;t<r;t++){var n=O[t];n.findPosition(e,n.getH())}for(r=V.length,t=0;t<r;t++){var n=V[t];n.findPosition(e,n.getH())}}function l(e){if(J.length<=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ZENO_EFFECT,"A Zeno-like effect has been detected.\nLast event was "+x.getProblem()+" which took place at "+G),!0;var t,r=!1,n=J.length;for(t=0;t<n;t++){var i=J[t];i.zenoEffectAction(x.getProblem(),e)&&(r=!0)}return L=0,r}function u(e,t,r,n){r.splice(0,r.length);for(var i=O.length,o=0;o<i;o++){var a=O[o];switch(a.setH(a.getEvent().evaluate(t)),a.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:a.getH()<=0&&r.push(a);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(a.getH()<=0&&(a.hasPositiveFlag()||a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT))return a;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(a.getH()<0){if(a.hasPositiveFlag()||a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return a}else if(a.getH()>0&&a.hasNegativeFlag()&&a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)return a;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT){if(a.getH()<=-a.getEvent().getTolerance())return a}else if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT&&a.hasNegativeFlag()&&a.getH()>=0)return a;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)a.getH()>=0&&r.push(a);else if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e+" for the state event "+a.getEvent()),a}}return null}function g(e,t,r){var n,i,o=e.length,a=r,s=r-t,l=(t+r)/2;if(C)for(n=0;n<o;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.min(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.min(a,t-i*s/(u.getHAfter()-i))}}else for(n=0;n<o;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.max(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.max(a,t-i*s/(u.getHAfter()-i))}}return a}var c,S,d,f,E={},p=!0,h=!1,m=.1,A=Number.NaN,y=Number.NaN,v=Number.POSITIVE_INFINITY,P=500,D=2*Number.MIN_VALUE,I=!0,_=1e4,C=m>0,R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",N=0,O=[],M=[],b=[],G=Number.NaN,x=null,L=0,J=[],w=null,W=!1,k=!1,F=null,V=[],B=null,H=100,z=1e-8,Y=Number.NaN;return E.getEPSILON=function(){if(isNaN(Y)){for(Y=1;Y+1!=1;)Y/=2;Y*=2}return Y},E.setEnableExceptions=function(e){p=e},E.setBestInterpolation=function(e){h=e},E.setHistoryLength=function(t){e.getStateHistory().setLength(t)},E.setStepSize=function(t){m!=t&&(m=t,C=m>0,E.setInternalStepSize(e.getStepSize()))},E.getStepSize=function(){return m},E.setEstimateFirstStep=function(t){e.setEstimateFirstStep(t)},E.setInternalStepSize=function(t){e.setStepSize(C?Math.abs(t):-Math.abs(t))},E.setMaximumInternalStepSize=function(t){e.setMaximumStepSize(t)},E.setMaximumInternalSteps=function(e){_=e},E.setTolerances=function(t,r){e.setTolerances(A=Math.abs(t),y=Math.abs(r))},E.setTolerance=function(e){setTolerances(e,0)},E.getTolerance=function(){return Math.max(A,y)},E.setDDETolerance=function(e){z=e},E.getDDETolerance=function(){return z},E.setDDEIterations=function(e){H=e},E.getDDEIterations=function(){return H},E.addEvent=function(e){O.push(EJSS_ODE_SOLVERS.eventData(E,e,t.getState())),W=!0},E.removeEvent=function(e){for(var t=-1,r=O.length,n=0;n<r;n++){var i=O[n];if(i.getEvent()==e){t=n;break}}if(t>=0){var o=O[t];x==o&&(x=null,L=0),w==o&&(w=null),O.splice(t,1)}W=k||O.length>0},E.addDiscontinuity=function(e){V.push(EJSS_ODE_SOLVERS.discontinuityData(E,e,t.getState())),k=!0,W=!0},E.removeDiscontinuity=function(e){for(var t=-1,r=V.length,n=0;n<r;n++){var i=V[n];if(i.getDiscontinuity()==e){t=n;break}}t>=0&&V.splice(t,1),k=V.length>0,W=k||O.length>0},E.removeAllEvents=function(){O=[],V=[],k=!1,W=!1,null!=B&&E.addDiscontinuity(B)},E.setMaximumEventStep=function(e){v=Math.abs(e)},E.getMaximumEventStep=function(){return v},E.setCoalesceCloseEvents=function(e){I=e},E.isCoalesceCloseEvents=function(){return I},E.setEventProximityThreshold=function(e){D=e},E.getEventProximityThreshold=function(){return D},E.setZenoEffectDetection=function(e){P=e},E.getZenoEffectDetection=function(){return P},E.addZenoEffectListener=function(e){J.push(e)},E.removeZenoEffectListener=function(e){for(var t=J.length,r=0;r<t;r++)if(J[r]==e)return void J.splice(r,1)},E.setZeroZenoCounter=function(){L=0},E.getSolverEngine=function(){return e},E.getODE=function(){return t},E.getStateHistory=function(){return e.getStateHistory()},E.getErrorCode=function(){return R},E.getErrorMessage=function(){return T},E.getCounter=function(){return e.getCounter()},E.getNumberOfAttempts=function(){return N},E.getInternalStepSize=function(){return e.getInternalStepSize()},E.getIndependentVariableValue=function(){return t.getState()[S]},E.getCurrentTime=function(){return t.getState()[S]},E.getRunsForwards=function(){return C},E.getCurrentEventData=function(){return w},E.getLastEventData=function(){return x},E.getLastEventDataTime=function(){return G},E.initialize=function(r){var n,i,o;for(m=r,C=m>0,e.initialize(m),o=t.getState(),c=o.length,S=c-1,d=new Array(c),f=new Array(c),R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",L=0,x=null,w=null,null!==B&&(B.initialize(o),E.removeDiscontinuity(B),E.addDiscontinuity(B)),i=O.length,n=0;n<i;n++)O[n].reset(o);for(i=V.length,n=0;n<i;n++)V[n].reset(o)},E.step=function(){return W?a():i()},E.maxStep=function(){return W?o():n()},E.userReinitialize=function(){w=null,E.reinitialize()},E.reinitialize=function(){var r,n,i=t.getState();for(e.reinitialize(i),R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",null!=B&&B.reset(i),n=O.length,r=0;r<n;r++)O[r].reset(i);for(n=V.length,r=0;r<n;r++)V[r].reset(i);F=null},E.resetDiscontinuities=function(e){if(null!==B){B.reset(e);for(var t=V.length,r=0;r<t;r++)V[r].reset(e)}},E.checkDiscontinuity=function(e,t){for(var r=V.length,n=null,i=0;i<r;i++){var o=V[i],a=o.getDiscontinuity().evaluate(e);switch(o.setH(a),o.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:if(a<=0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;a<o.getDiscontinuity().getTolerance()&&(n=o);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(a<=0&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(a<0&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;if(a>0&&o.hasNegativeFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(o.hasNegativeFlag()&&a>=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(a>0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;a>-o.getDiscontinuity().getTolerance()&&(n=o)}}return null!=n?(t&&(F=n,F.setTime(e[S])),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP):EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},E.error=function(t,r){if(R=t,T=r,p)throw{name:"ODE Solver exception",solver:e,message:r};return Number.NaN},E.findFirstEvent=function(t,n,i){var o,a;N=0;var s=u(t[S],i,M,"at t1");if(null!=s){for(s.time=t[S],s.maxAdvance=n,o=0;o<c;o++)i[o]=t[o];return s}if(M.length<=0)return null;var l=!0;for(a=O.length,o=0;o<a;o++){var d=O[o];d.setHAfter(d.getH())}for(;l;){N++;var p=g(M,t[S],n);r(p,f);var h=u(t[S],f,b,"short");if(null!=h){for(h.time=t[S],h.maxAdvance=p,o=0;o<c;o++)i[o]=t[o];return h}if(b.length<=0){var m=null;for(a=M.length,o=0;o<a;o++){var d=M[o];if(d.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(d.getH()<d.getEvent().getTolerance()){m=d;break}}else if(d.getH()>-d.getEvent().getTolerance()){m=d;break}}if(null!=m){for(m.time=p,m.maxAdvance=n,o=0;o<c;o++)i[o]=f[o];return m}for(o=0;o<c;o++)t[o]=f[o];for(a=O.length,o=0;o<a;o++){var d=O[o];d.findPosition(t[S],d.getH())}var A=u(t[S],i,M,"at tTest");if(null!=A){for(A.time=t[S],A.maxAdvance=n,o=0;o<c;o++)i[o]=t[o];return A}}else{var y=!0,m=null;for(a=b.length,o=0;o<a;o++){var v=b[o];if(v.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(v.getH()<=-v.getEvent().getTolerance()){y=!1;break}m=v}else{if(v.getH()>=v.getEvent().getTolerance()){y=!1;break}m=v}}if(y&&null!=m){for(m.time=p,m.maxAdvance=n,o=0;o<c;o++)i[o]=f[o];return m}for(n=p,o=0;o<c;o++)i[o]=f[o];for(a=O.length,o=0;o<a;o++){var d=O[o];d.setHAfter(d.getH())}for(M=[],a=b.length,o=0;o<a;o++)M.push(b[o])}for(a=M.length,o=0;o<a;o++){var v=M[o];if(N>v.getEvent().getMaxIterations()){l=!1;break}}}var P=M[0];return E.error(EJSS_ODE_SOLVERS.ERROR.EVENT_NOT_FOUND,"Warning : Event not found after "+N+" attempts at t="+t[S]+" h = "+P.getH()+".\nPlease check the code of your event, decrease the initial step size, the tolerance of the solver,\nor the event maximum step, or increase the maximum number of attempts.\nFirst event remaining in the queue: "+P.getEvent()),P.setTime((t[S]+n)/2),P.setMaxAdvance(Number.NaN),e.bestInterpolate(P.time,i),P},t.getDelays&&(B=EJSS_ODE_SOLVERS.ddeDiscontinuity(E,t)),e.setODE(E,t),E};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.BogackiShampine23={B3_1:2/9,B3_2:1/3,B3_3:4/9,B2_1:7/24,B2_2:.25,B2_3:1/3,B2_4:1/8},EJSS_ODE_SOLVERS.bogackiShampine23=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(3),i=n.allocateOtherArrays;return n.getNumberOfEvaluations=function(){return 3},n.allocateOtherArrays=function(){i(),e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(r,i){var o,a=r/2,s=n.getODE(),l=n.getInitialState(),u=n.getInitialRate(),g=n.getDimension(),c=g-1,S=(u[c],EJSS_ODE_SOLVERS.BogackiShampine23);for(o=0;o<g;o++)i[o]=l[o]+a*u[o];s.getRate(i,e);var d=.75*r;for(o=0;o<g;o++)i[o]=l[o]+d*e[o];for(s.getRate(i,t),o=0;o<c;o++)i[o]=l[o]+r*(S.B3_1*u[o]+S.B3_2*e[o]+S.B3_3*t[o]);i[c]=n.getInitialTime()+r*u[c]},n.computeCarefulIntermediateStep=function(r,i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,d=(g[S],EJSS_ODE_SOLVERS.BogackiShampine23),f=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(a=0;a<c;a++)o[a]=u[a]+s*g[a];switch(r.checkDiscontinuity(o,!1)){case f.DISCONTINUITY_PRODUCED_ERROR:return f.DISCONTINUITY_PRODUCED_ERROR;case f.DISCONTINUITY_JUST_PASSED:return f.DISCONTINUITY_JUST_PASSED;case f.DISCONTINUITY_ALONG_STEP:return f.DISCONTINUITY_ALONG_STEP;case f.DISCONTINUITY_EXACTLY_ON_STEP:break;case f.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(o,e);var E=.75*i;for(a=0;a<c;a++)o[a]=u[a]+E*e[a];switch(r.checkDiscontinuity(o,!1)){case f.DISCONTINUITY_PRODUCED_ERROR:return f.DISCONTINUITY_PRODUCED_ERROR;case f.DISCONTINUITY_JUST_PASSED:return f.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case f.DISCONTINUITY_ALONG_STEP:return f.DISCONTINUITY_ALONG_STEP;case f.DISCONTINUITY_EXACTLY_ON_STEP:break;case f.NO_DISCONTINUITY_ALONG_STEP:}for(l.getRate(o,t),a=0;a<S;a++)o[a]=u[a]+i*(d.B3_1*g[a]+d.B3_2*e[a]+d.B3_3*t[a]);return o[S]=n.getInitialTime()+i*g[S],
r.checkDiscontinuity(o,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=(n.getODE(),n.getInitialState()),t=n.getInitialRate(),r=n.getFinalState(),i=n.getFinalRate();return EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,i)},n.computeApproximation=function(i){var o=n.getODE(),a=n.getTimeIndex(),s=n.getInitialState(),l=n.getInitialRate(),u=n.getFinalState(),g=n.getFinalRate();o.getRate(u,g);for(var c=EJSS_ODE_SOLVERS.BogackiShampine23,S=0;S<a;S++)r[S]=s[S]+i*(c.B2_1*l[S]+c.B2_2*e[S]+c.B2_3*t[S]+c.B2_4*g[S]);return r[a]=n.getInitialTime()+i*l[a],n.computeError(r)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.CashKarp45={A_11:.2,A_21:.075,A_22:.225,A_31:.3,A_32:-.9,A_33:1.2,A_41:-11/54,A_42:2.5,A_43:-70/27,A_44:35/27,A_51:1631/55296,A_52:175/512,A_53:575/13824,A_54:44275/110592,A_55:253/4096,B4_1:2825/27648,B4_2:0,B4_3:18575/48384,B4_4:13525/55296,B4_5:277/14336,B4_6:.25,B5_1:37/378,B5_2:0,B5_3:250/621,B5_4:125/594,B5_5:0,B5_6:512/1771},EJSS_ODE_SOLVERS.cashKarp45=function(){var e,t,r,n,i,o,a=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),s=a.allocateOtherArrays;return a.getNumberOfEvaluations=function(){return 6},a.allocateOtherArrays=function(){s(),e=new Array(a.getDimension()),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(o,s){var l,u=a.getODE(),g=a.getInitialState(),c=a.getInitialRate(),S=a.getDimension(),d=S-1,f=(c[d],EJSS_ODE_SOLVERS.CashKarp45);for(l=0;l<S;l++)s[l]=g[l]+o*f.A_11*c[l];for(u.getRate(s,e),l=0;l<S;l++)s[l]=g[l]+o*(f.A_21*c[l]+f.A_22*e[l]);for(u.getRate(s,t),l=0;l<S;l++)s[l]=g[l]+o*(f.A_31*c[l]+f.A_32*e[l]+f.A_33*t[l]);for(u.getRate(s,r),l=0;l<S;l++)s[l]=g[l]+o*(f.A_41*c[l]+f.A_42*e[l]+f.A_43*t[l]+f.A_44*r[l]);for(u.getRate(s,n),l=0;l<S;l++)s[l]=g[l]+o*(f.A_51*c[l]+f.A_52*e[l]+f.A_53*t[l]+f.A_54*r[l]+f.A_55*n[l]);for(u.getRate(s,i),l=0;l<d;l++)s[l]=g[l]+o*(f.B5_1*c[l]+f.B5_2*e[l]+f.B5_3*t[l]+f.B5_4*r[l]+f.B5_5*n[l]+f.B5_6*i[l]);s[d]=a.getInitialTime()+o*c[d]},a.computeCarefulIntermediateStep=function(o,s,l){var u,g=a.getODE(),c=a.getInitialState(),S=a.getInitialRate(),d=a.getDimension(),f=d-1,E=(S[f],EJSS_ODE_SOLVERS.CashKarp45),p=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(u=0;u<d;u++)l[u]=c[u]+s*E.A_11*S[u];switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,e),u=0;u<d;u++)l[u]=c[u]+s*(E.A_21*S[u]+E.A_22*e[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,t),u=0;u<d;u++)l[u]=c[u]+s*(E.A_31*S[u]+E.A_32*e[u]+E.A_33*t[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,r),u=0;u<d;u++)l[u]=c[u]+s*(E.A_41*S[u]+E.A_42*e[u]+E.A_43*t[u]+E.A_44*r[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,n),u=0;u<d;u++)l[u]=c[u]+s*(E.A_51*S[u]+E.A_52*e[u]+E.A_53*t[u]+E.A_54*r[u]+E.A_55*n[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,i),u=0;u<f;u++)l[u]=c[u]+s*(E.B5_1*S[u]+E.B5_2*e[u]+E.B5_3*t[u]+E.B5_4*r[u]+E.B5_5*n[u]+E.B5_6*i[u]);return l[f]=a.getInitialTime()+s*S[f],o.checkDiscontinuity(l,!0)},a.computeFinalRateAndCreateIntervalData=function(){var e=a.getODE(),t=a.getInitialState(),r=a.getInitialRate(),n=a.getFinalState(),i=a.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},a.computeApproximation=function(s){for(var l=a.getTimeIndex(),u=a.getInitialState(),g=a.getInitialRate(),c=EJSS_ODE_SOLVERS.CashKarp45,S=0;S<l;S++)o[S]=u[S]+s*(c.B4_1*g[S]+c.B4_2*e[S]+c.B4_3*t[S]+c.B4_4*r[S]+c.B4_5*n[S]+c.B4_6*i[S]);return o[l]=a.getInitialTime()+s*g[l],a.computeError(o)},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Euler={},EJSS_ODE_SOLVERS.euler=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return e.getNumberOfEvaluations=function(){return 1},e.computeIntermediateStep=function(t,r){for(var n=e.getDimension(),i=e.getInitialState(),o=e.getInitialRate(),a=0;a<n;a++)r[a]=i[a]+t*o[a]},e.computeCarefulIntermediateStep=function(t,r,n){return e.computeIntermediateStep(r,n),t.checkDiscontinuity(n,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),r=e.getInitialState(),n=e.getInitialRate(),i=e.getFinalState(),o=e.getFinalRate();return t.getRate(i,o),EJSS_ODE_INTERPOLATION.eulerIntervalData(r,n,i[e.getTimeIndex()])},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Radau5={c1:(4-Math.sqrt(6))/10,c2:(4+Math.sqrt(6))/10,c1m1:(4-Math.sqrt(6))/10-1,c2m1:(4+Math.sqrt(6))/10-1,c1mc2:(4-Math.sqrt(6))/10-(4+Math.sqrt(6))/10};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.RungeKutta4={},EJSS_ODE_SOLVERS.rungeKutta4=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return n.getNumberOfEvaluations=function(){return 4},n.allocateOtherArrays=function(){e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,d=g[S];for(a=0;a<c;a++)o[a]=u[a]+s*g[a];for(l.getRate(o,e),a=0;a<c;a++)o[a]=u[a]+s*e[a];for(l.getRate(o,t),a=0;a<c;a++)o[a]=u[a]+i*t[a];for(l.getRate(o,r),a=0;a<S;a++)o[a]=u[a]+i*(g[a]+2*e[a]+2*t[a]+r[a])/6;o[S]=n.getInitialTime()+i*d},n.computeCarefulIntermediateStep=function(i,o,a){var s,l=o/2,u=n.getODE(),g=n.getInitialState(),c=n.getInitialRate(),S=n.getDimension(),d=S-1,f=c[d],E=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(s=0;s<S;s++)a[s]=g[s]+l*c[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,e),s=0;s<S;s++)a[s]=g[s]+l*e[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,t),s=0;s<S;s++)a[s]=g[s]+o*t[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,r),s=0;s<d;s++)a[s]=g[s]+o*(c[s]+2*e[s]+2*t[s]+r[s])/6;return a[d]=n.getInitialTime()+o*f,i.checkDiscontinuity(a,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=n.getODE(),t=n.getInitialState(),r=n.getInitialRate(),i=n.getFinalState(),o=n.getFinalRate();return e.getRate(i,o),EJSS_ODE_INTERPOLATION.bootstrapIntervalData(t,r,i,o,e)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTime={},EJSS_ODE_SOLVERS.solverEngineDiscreteTime=function(){var e,t,r,n,i,o,a,s,l,u={},g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,c=0,S=.1,d=Number.POSITIVE_INFINITY,f=0,E=0;return u.getNumberOfEvaluations=function(){return 0},u.allocateOtherArrays=function(){},u.computeIntermediateStep=function(e,t){return null},u.computeCarefulIntermediateStep=function(e,t,r){return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},u.computeFinalRateAndCreateIntervalData=function(){return null},u.getODE=function(){return a},u.getEventSolver=function(){return s},u.getDimension=function(){return e},u.getTimeIndex=function(){return t},u.getInitialTime=function(){return f},u.getInitialState=function(){return r},u.getInitialRate=function(){return n},u.getFinalState=function(){return i},u.getFinalRate=function(){return o},u.setFinalTime=function(e){E=e},u.getFinalTime=function(){return E},u.setErrorCode=function(e){g=e},u.addToEvaluations=function(e){c+=e},u.setODE=function(r,n){s=r,a=n;var i=a.getState();e=i.length,t=e-1,l=EJSS_ODE_INTERPOLATION.stateHistory(n),a.getMaximumDelay&&l.setMinimumLength(a.getMaximumDelay())},u.initialize=function(s){S=s;var g=a.getState();null!=r&&r.length==g.length||(e=g.length,t=e-1,r=new Array(e),n=new Array(e),i=new Array(e),o=new Array(e),u.allocateOtherArrays()),c=0,l.clearAll(),a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(s))):l.setMinimumLength(s),u.reinitialize(g)},u.reinitialize=function(i){f=i[t];for(var o=0;o<e;o++)r[o]=i[o];a.getRate(r,n),E=Number.NaN,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR},u.getCurrentRate=function(){return n},u.setStepSize=function(e){S=e,a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(e))):l.setMinimumLength(e)},u.setMaximumStepSize=function(e){d=Math.abs(e)},u.getMaximumStepSize=function(){return d},u.getStepSize=function(){return S},u.getInternalStepSize=function(){return E-f},u.setEstimateFirstStep=function(e){},u.setTolerances=function(e,t){},u.getMaximumTime=function(e){return g!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR?Number.NaN:(isNaN(E)&&u.computeOneStep(e),E)},u.internalStep=function(t){var a;for(f=E,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,a=0;a<e;a++)r[a]=i[a];for(a=0;a<e;a++)n[a]=o[a];return u.computeOneStep(t),E},u.getCounter=function(){return c},u.getStateHistory=function(){return l},u.interpolate=function(e,t){return l.interpolateState(e,t)},u.bestInterpolate=function(t,n){var o;if(isNaN(E))return null;if(t==E){for(o=0;o<e;o++)n[o]=i[o];return n}if(t==f){for(o=0;o<e;o++)n[o]=r[o];return n}return u.computeIntermediateStep(t-f,n),n},u.getActualStepSize=function(){return S},u.findTheDiscontinuity=function(e){for(var r=0,n=0,o=e,a=0,l=s.getDDEIterations(),g=s.getEPSILON();r<l&&!(Math.abs(n-o)<g);){var c=(n+o)/2;switch(u.computeCarefulIntermediateStep(s,c,i)){default:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:a=i[t],n=c;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:return i[t];case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:o-=(o-n)/4;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:o=c}r++}return u.computeCarefulIntermediateStep(s,a,i),a},u.computeOneStep=function(e){var r=S;if(e){switch(u.computeCarefulIntermediateStep(s,r,i)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void(E=Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:E=i[t];break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E=u.findTheDiscontinuity(r)}if(isNaN(E))return void(g=EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else u.computeIntermediateStep(r,i),E=i[t];c+=u.getNumberOfEvaluations(),l.clean(f),l.addIntervalData(u.computeFinalRateAndCreateIntervalData())},u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive={FAC1:.33,FAC2:6,BETA:0,SAFE:.9},EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive=function(e){function t(e){var t=0;return 0!=e?(t=Math.pow(e,l),g=t/Math.exp(EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*Math.log(u)),g=Math.max(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2,Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE))):(t=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2),e<=1?(u=Math.max(e,1e-4),i/g):i/Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,t/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE)}function r(e){var t,r,n,i=s.getODE();if(e>=0){if(i.getDelays)for(t=i.getDelays(s.getInitialState()),n=t.length,r=0;r<n;r++)e=Math.min(e,t[r]/2);return Math.min(e,s.getMaximumStepSize())}if(i.getDelays)for(t=i.getDelays(s.getInitialState()),n=t.length,r=0;r<n;r++)e=Math.max(e,t[r]/2);return Math.max(e,-s.getMaximumStepSize())}function n(t){var r,n=s.getDimension(),i=s.getInitialState(),l=s.getInitialRate(),u=s.getODE(),g=t<0?-1:1;t=Math.abs(t);var c=0,S=0;for(r=0;r<n;r++){var d=o[r]+a[r]*Math.abs(i[r]),f=l[r]/d;c+=f*f,f=i[r]/d,S+=f*f}var E;if(E=c<=1e-10||S<=1e-10?1e-6:.01*Math.sqrt(S/c),E=g*Math.min(E,t),u.getDelays){var p=s.getEventSolver();p.resetDiscontinuities(i);for(var h=0,m=!1;!m;){for(r=0;r<n;r++)finalState[r]=i[r]+E*l[r];switch(p.checkDiscontinuity(finalState,!1)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E/=2;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:m=!0;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:m=!0}if(++h>100)return Number.NaN}}else for(r=0;r<n;r++)finalState[r]=i[r]+E*l[r];u.getRate(finalState,finalRate);var A=0;for(r=0;r<n;r++){var d=o[r]+a[r]*Math.abs(i[r]),f=(finalRate[r]-l[r])/d;A+=f*f}A=Math.sqrt(A)/E;var y,v=Math.max(Math.abs(A),Math.sqrt(c));return y=v<=1e-15?Math.max(1e-6,.001*Math.abs(E)):Math.exp(1/e*Math.log(.01/v)),E=g*Math.min(100*E,y),0!=t&&(E=g*Math.min(Math.abs(E),t)),E}var i,o,a,s=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),l=1/e-.75*EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA,u=1e-4,g=0,c=!1,S=Number.NaN,d=Number.NaN,f=s.reinitialize,E=s.setMaximumStepSize;return s.computeApproximation=function(e){},s.getAbsTol=function(){return o},s.getRelTol=function(){return a},s.allocateOtherArrays=function(){var e=s.getDimension();o=new Array(e),a=new Array(e),s.setTolerances(1e-6,1e-6)},s.reinitialize=function(e){f(e),i=r(c?n(s.getStepSize()):s.getStepSize())},s.setEstimateFirstStep=function(e){c=e},s.setMaximumStepSize=function(e){E(e),i=r(i)},s.setTolerances=function(e,t){var l,u=s.getDimension();if(e instanceof Array)for(S=d=Number.NaN,l=0;l<u;l++)o[l]=e[l],a[l]=t[l];else{if(S==e&&d==t)return;for(S=e,d=t,l=0;l<u;l++)o[l]=e,a[l]=t}mFinalTime=Number.NaN,mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,i=r(c?n(s.getStepSize()):s.getStepSize())},s.computeOneStep=function(e){var n=s.getEventSolver(),o=s.getFinalState();mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(var a=0;a<500;a++){if(e){switch(s.computeCarefulIntermediateStep(n,i,o)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void s.setFinalTime(Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:s.setFinalTime(o[s.getTimeIndex()]);break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:var l=s.findTheDiscontinuity(i);s.setFinalTime(l),i=l-s.getInitialTime()}if(isNaN(s.getFinalTime()))return void s.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else s.computeIntermediateStep(i,o),s.setFinalTime(o[s.getTimeIndex()]);var u=s.computeApproximation(i);if(s.addToEvaluations(s.getNumberOfEvaluations()),u<=1)return s.getStateHistory().clean(s.getInitialTime()),s.getStateHistory().addIntervalData(s.computeFinalRateAndCreateIntervalData()),void(i=r(a>0?i>0?Math.min(i,t(u)):Math.max(i,t(u)):t(u)));i=r(i>0?Math.min(i,t(u)):Math.max(i,t(u)))}s.setFinalTime(Number.NaN),s.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DID_NOT_CONVERGE)},s.getActualStepSize=function(){return i},s.computeError=function(e){for(var t=0,r=s.getDimension(),n=s.getInitialState(),i=s.getFinalState(),l=0;l<r;l++){var u=o[l]+a[l]*Math.max(Math.abs(i[l]),Math.abs(n[l])),g=(i[l]-e[l])/u;t+=g*g}return Math.sqrt(t/r)},s};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DDEDiscontinuity={},EJSS_ODE_SOLVERS.ddeDiscontinuity=function(e,t){function r(r){var n,s=t.getDelays(r),l=s.length,u=o.length,g=r.length-1;if(e.getRunsForwards())for(n=0;n<l;n++)for(var c=r[g]-s[n]+i.getTolerance(),S=a[n];S<u;S++){var d=o[S];if(d>c){a[n]=S;break}}else for(n=0;n<l;n++)for(var c=r[g]-s[n]-i.getTolerance(),S=a[n];S<u;S++){var d=o[S];if(d<c){a[n]=S;break}}}function n(r){var n,o=r.length,a=o-1,l=i.getTolerance()/20,u=e.getDDEIterations(),g=e.getStateHistory(),c=0;if(e.getRunsForwards())for(;++c<u;){for(t.getRate(r,s),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,s,r[a]+l)),n=0;n<o;n++)r[n]+=l*s[n];var S=i.evaluate(r);if(S<0)return r[a]}else for(;++c<u;){for(t.getRate(r,s),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,s,r[a]-l)),n=0;n<o;n++)r[n]-=l*s[n];var S=evaluate(r);if(S>0)return r[a]}return Number.NaN}var i={},o=[],a=[],s=[];return i.initialize=function(r){e.getRunsForwards()?o.push(Number.NEGATIVE_INFINITY):o.push(Number.POSITIVE_INFINITY);var n=t.getInitialConditionDiscontinuities();if(null!=n)for(var l=n.length,u=0;u<l;u++)o.push(n[u]);o.push(r[r.length-1]);var g=t.getDelays(r);a=new Array(g.length),i.reset(r),s=new Array(r.length)},i.reset=function(e){for(var t=a.length,n=0;n<t;n++)a[n]=0;r(e)},i.evaluate=function(r){var n,i=r[r.length-1],s=t.getDelays(r),l=s.length;if(e.getRunsForwards()){var u=Number.POSITIVE_INFINITY;for(n=0;n<l;n++){var g=o[a[n]];u=Math.min(u,s[n]+g-i)}return u}var c=Number.NEGATIVE_INFINITY;for(n=0;n<l;n++){var g=o[a[n]];c=Math.max(c,s[n]+g-i)}return c},i.action=function(){var r=t.getState(),i=n(r);o.push(i);var a=e.findFirstEvent(r,i,r);return null!=a&&(mCurrentEventData=a,a.action()),!0},i.getTolerance=function(){return e.getDDETolerance()},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ProblemData={POSITIVE:2,SMALL_POSITIVE:1,ZERO:0,SMALL_NEGATIVE:-1,NEGATIVE:-2},EJSS_ODE_SOLVERS.eventData=function(e,t,r){var n,i,o,a,s,l,u,g,c={},S=t.getTypeOfEvent(),d=r.length-1;return c.getEvent=function(){return t},c.getEventType=function(){return S},c.setH=function(e){l=e},c.getH=function(){return l},c.getTime=function(){return u},c.setTime=function(e){u=e},c.hasPositiveFlag=function(){return n},c.hasNegativeFlag=function(){return i},c.getHBefore=function(){return a},c.setHAfter=function(e){s=e},c.getHAfter=function(){return s},c.getCurrentPosition=function(){return o},c.getMaxAdvance=function(){return g},c.setMaxAdvance=function(e){g=e},c.action=function(){return t.action()},c.getProblem=function(){return t},c.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);c.findPosition(r[d],o),e.getCurrentEventData()!=c&&(S==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT?o>0?n=!0:o<0&&(i=!0):S==EJSS_ODE_SOLVERS.EVENT_TYPE.POSITIVE_EVENT&&o>0&&(n=!0))},c.findPosition=function(r,s){if(a=s,a>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0),S==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT&&o==EJSS_ODE_SOLVERS.ProblemData.NEGATIVE){var l="The state event "+t+" is in an illegal state: "+a+" at "+r;l+=null==e.getLastEventData()?"\nThere was no previous event":"\nLast previous event was "+e.getLastEventData().getProblem()+", which took place at "+e.getLastEventDataTime(),e.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,l)}},c.reset(r),c},EJSS_ODE_SOLVERS.discontinuityData=function(e,t,r){var n,i,o,a,s,l,u={},g=r.length-1;return u.getDiscontinuity=function(){return t},u.setH=function(e){s=e},u.getH=function(){return s},u.setTime=function(e){l=e},u.getTime=function(){return l},u.hasPositiveFlag=function(){return n},u.hasNegativeFlag=function(){return i},u.getHBefore=function(){return a},u.setHAfter=function(e){mHAfter=e},u.getHAfter=function(){return mHAfter},u.getCurrentPosition=function(){return o},u.getMaxAdvance=function(){return Number.NaN},u.action=function(){return t.action()},u.getProblem=function(){return t},u.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);u.findPosition(r[g],o),e.getCurrentEventData()!=u&&(o>0?n=!0:o<0&&(i=!0))},u.findPosition=function(e,r){a=r,a>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0)},u.reset(r),u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ODEMultistepSolver={NO_ERROR:0,DID_NOT_CONVERGE:1},EJSS_ODE_SOLVERS.createODEMultistepSolver=function(e){function t(){var e=g.getTolerance(),t=l;(g.getStepSize()<=0||g.getStepSize()>l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;t>e*l;){r++;var n=t;if(t<g.getStepSize()){var u=g.getStepSize();g.setStepSize(t);var c=g.step();t-=c,g.setStepSize(u)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10>g.getStepSize()||r>o){if(s="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,a)throw s;mMaxMessages>0&&(mMaxMessages--,console.log(s));break}}return t}function r(){var e=g.getTolerance(),t=l;(g.getStepSize()>=0||g.getStepSize()<l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;t<e*l;){r++;var n=t;if(t>g.getStepSize()){var a=g.getStepSize();g.setStepSize(t);var u=g.step();t-=u,g.setStepSize(a)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10<g.getStepSize()||r>o){if(s="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,enableExceptions)throw s;mMaxMessages>0&&(mMaxMessages--,console.log(s))}}return t}var n={},i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,o=200,a=!1,s="",l=.1,u=EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE(e),g=EJSS_ODE_SOLVERS.createCashKarp45(u);return n.enableRuntimeExceptions=function(e){a=e},n.setMaxIterations=function(e){o=Math.max(1,e)},n.setTolerance=function(e){e=Math.abs(e),g.setTolerance(e)},n.getTolerance=function(){return g.getTolerance()},n.getErrorCode=function(){return i},n.initialize=function(e){mMaxMessages=4,s="",i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=e,u.setInitialConditions(),g.initialize(e)},n.setStepSize=function(e){mMaxMessages=4,l=e,e<0?g.setStepSize(Math.max(-Math.abs(g.getStepSize()),e)):g.setStepSize(Math.min(g.getStepSize(),e))},n.setMaximumNumberOfErrorMessages=function(e){mMaxMessages=e},n.getStepSize=function(){return l},n.step=function(){i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,u.setInitialConditions();var e=0;return e=l>0?t():r(),u.update(),l-e},n},EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE=function(e){var t={},r=[];return t.getRate=function(t,r){e.getRate(t,r)},t.getState=function(){return r},t.setInitialConditions=function(){var t=e.getState();if(null!=t){null!=r&&r.length==t.length||(r=new Array(t.length));for(var n=0,i=t.length;n<i;n++)r[n]=t[n]}},t.update=function(){for(var t=e.getState(),n=0,i=t.length;n<i;n++)t[n]=r[n]},t.setInitialConditions(),t},EJSS_ODE_SOLVERS.createCashKarp45=function(e){var t,r={},n=[[.2],[.075,.225],[.3,-.9,1.2],[-11/54,2.5,-70/27,35/27],[1631/55296,175/512,575/13824,44275/110592,253/4096]],i=[37/378,0,250/621,125/594,0,512/1771],o=[277/64512,0,-6925/370944,6925/202752,277/14336,-277/7084],a=6,s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=.01,u=0,g=[],c=[],S=1e-6,d=!1;return r.enableRuntimeExpecptions=function(e){d=e},r.setStepSize=function(e){l=e},r.getStepSize=function(){return l},r.setTolerance=function(e){if(S=Math.abs(e),S<1e-12){var t="Error: Cash-Karp ODE solver tolerance cannot be smaller than 1.0e-12.";if(d)throw t;console.log(t),S=1e-12}},r.getTolerance=function(){return S},r.getErrorCode=function(){return s},r.initialize=function(t){l=t;var r=e.getState();if(null!=r&&u!=r.length){u=r.length,g=new Array(u),c=new Array(a);for(var n=0;n<a;n++)c[n]=new Array(u)}},r.step=function(){var r,f,E,p=10,h=l,m=0,A=e.getState();s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,e.getRate(A,c[0]);do{for(p--,h=l,E=1;E<a;E++){for(r=0;r<u;r++)for(g[r]=A[r],f=0;f<E;f++)g[r]=g[r]+l*n[E-1][f]*c[f][r];e.getRate(g,c[E])}for(m=0,r=0;r<u;r++){for(t=0,E=0;E<a;E++)t+=l*o[E]*c[E][r];m=Math.max(m,Math.abs(t))}if(m<=Number.MIN_VALUE&&(m=S/1e5),m>S){var y=.9*Math.pow(m/S,-.25);l*=Math.max(y,.1)}else if(m<S/10){var y=.9*Math.pow(m/S,-.2);y>1&&(l*=Math.min(y,10))}}while(m>S&&p>0);for(r=0;r<u;r++)for(E=0;E<a;E++)A[r]+=h*i[E]*c[E][r];if(0==p&&(s=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,d))throw"DormanPrince45 ODE solver did not converge.";return h},r.initialize(l),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createEulerODESolver=function(e){var t,r=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n=r.initialize;return r.initialize=function(e){n(e),t=new Array(r.getDimension())},r.computeIntermediateStep=function(r,n){e.getRate(n,t);for(var i=0,o=n.length;i<o;i++)n[i]=n[i]+r*t[i];return n},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createRungeKutta4ODESolver=function(e){var t,r,n,i,o,a=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),s=a.initialize;return a.initialize=function(e){s(e),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(a,s){e.getRate(s,r);for(var l=0,u=s.length;l<u;l++)t[l]=s[l],s[l]=t[l]+a*r[l]/2;e.getRate(s,n);for(var l=0,u=s.length;l<u;l++)s[l]=t[l]+a*n[l]/2;e.getRate(s,i);for(var l=0,u=s.length;l<u;l++)s[l]=t[l]+a*i[l];e.getRate(s,o);for(var l=0,u=s.length;l<u;l++)s[l]=t[l]+a*(r[l]+2*n[l]+2*i[l]+o[l])/6;return s},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverInterpolatorDiscreteTime={},EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime=function(e){var t,r={},n=.1,i=(Number.POSITIVE_INFINITY,0);return r.getNumberOfEvaluations=function(){return 0},r.allocateOtherArrays=function(){},r.computeIntermediateStep=function(e,t){return null},r.computeCarefulIntermediateStep=function(e,t,r){return 0},r.setTolerance=function(e){i=Math.abs(e)},r.getDimension=function(){return t},r.initialize=function(r){n=r;var i=e.getState();t=i.length},r.step=function(){var t=e.getState();return r.computeIntermediateStep(n,t),0},r.setStepSize=function(e){n=e},r.getStepSize=function(){return n},r};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createRemoteView=function(e,t,r,n){function i(e,t){if(c){void 0!==t?s.send(e+JSON.stringify(t)):s.send(e);var r=s.onmessage;s.onmessage=null,s.onmessage=r}}function o(e){var t;switch(e.charAt(0)){case"R":l._reset();break;case"I":l._initialize();break;case"U":d=JSON.parse(e.substring(1)),a(l._update);break;case"C":d=JSON.parse(e.substring(1)),a(l._collectData);break;case"M":t=JSON.parse(e.substring(1)),l[t.method]&&console.log("View function: <"+t.method+"> with data: <"+t.data+"> ignored. View function does not exist."),l[t.method](t.data);break;case"P":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element].setProperty(t.property,t.value):console.log("setProperty<"+t.property+"> with value: <"+t.value+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"E":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"F":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message with object <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;default:console.log("view process input error : Unrecognised command: "+e)}}function a(e){e(),l._render(),i("O")}var s,l=EJSS_CORE.createView(e),u=10,g=500,c=!1,S=0,d={},f=[],E=[],p=[],h=[],m="",A=!0,y=0,v="";if(l.getClass=function(){return"ConnectionWS"},l._connectToServer=function(){try{s=new WebSocket(v),console.log("Connecting... (readyState "+s.readyState+")"),s.onopen=function(e){c=!0,S=0,console.log("Openhd Event: "+e.type+" - Message: "+e.data),i("A",{variables:f,actions:E})},s.onclose=function(e){S<u&&(window.setTimeout(function(){l._connectToServer()},g),S++),c=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data+" - Reopen: "+S)},s.onerror=function(e){c=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},s.onmessage=function(e){o(e.data)}}catch(e){console.log(e)}l._update(),l._render()},l._getValue=function(e){return c?d[e]:l._getInitialValue(e)},super_registerVariable=l._registerVariable,super_registerAction=l._registerAction,super_startUp=l._startUp,l._startUp=function(){super_startUp(),l._connectToServer()},l._registerVariable=function(e,t,r){super_registerVariable(e,t),r?l._linkVariable(e,function(){return l._getValue(e)},null,t):(f.push(e),l._linkVariable(e,function(){return l._getValue(e)},function(t){p.push({name:e,value:t})},t))},l._registerAction=function(e){super_registerAction(e),E.push(e),l._setAction(e,function(t){h.push({name:e,argument:t})})},l._reportInteraction=function(){l._readInteractions(),i("I",{properties:p,actions:h}),p=[],h=[]},l._interactionsNumber=function(){return h.length},l.getLinkingURL=function(){return m},l.createLinkingButtons=function(){l._addElement(EJSS_INTERFACE.button,"_linkingButton_").setAction("OnClick",function(){var e=l.getLinkingURL();window.alert(e.toString())}).setProperties({Text:"@",FontSize:"8px"}),l._addElement(EJSS_INTERFACE.button,"_qrButton_").setAction("OnClick",function(){var e=encodeURIComponent(l.getLinkingURL()),t="https://chart.googleapis.com/chart?cht=qr&chl="+e+"&chs=400";window.open(t,"_blank")}).setProperties({Text:"QR",FontSize:"8px"})},l.hiddenLinkingButtons=function(){_view._linkingButton_.setVisibility("hidden"),_view._qrButton_.setVisibility("hidden")},l.showLinkingButtons=function(){_view._linkingButton_.setVisibility("visible"),_view._qrButton_.setVisibility("visible")},window.location.protocol.indexOf("file")!=-1)"undefined"!=typeof t&&null!==t&&0!=t||(t=8800),v="ws://localhost:"+t,A=!1;else{if(history.state&&(y=history.state.mServerModelPort,A=!1),"undefined"==typeof r||null===r||""==r){var P=window.location.host,D=window.location.protocol;r=D+"//"+P+"/ejsS_library/models"}if("undefined"==typeof n||null===n||""==n){var I=window.location.href.lastIndexOf("/_view");n=window.location.href.slice(r.length,I)}var _=new XMLHttpRequest;y>0?_.open("GET",r+"/broker.php?model="+n+"&port="+y,!0):_.open("GET",r+"/broker.php?model="+n,!0),_.onreadystatechange=function(){if(4==_.readyState&&200==_.status){var e=JSON.parse(_.responseText);v=e.webserver,m=r+"/linking.php?model="+n+"&port="+e.port,A&&l.createLinkingButtons(),
l._startUp()}else console.log("WARNING: server no response!")},_.send()}return l};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.addToArray=function(e,t,r){EJSS_TOOLS.removeFromArray(e,t),r>=0?e.splice(r,0,t):e.push(t)},EJSS_TOOLS.arrayObjectIndexOf=function(e,t){return e.indexOf(t)},EJSS_TOOLS.removeFromArray=function(e,t){var r=e.indexOf(t);r>=0&&e.splice(r,1)},EJSS_TOOLS.compareArrays=function(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!EJSS_TOOLS.compareArrays(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.ConnectionWS={},EJSS_TOOLS.connectionWS=function(e){function t(){try{s=new WebSocket(e),console.log("Connecting... (readyState "+s.readyState+")")}catch(e){console.log(e)}}function r(e,t){switch(e){case"onopen":s.onopen=function(e){t(e)};break;case"onmessage":s.onmessage=function(e){t(e)};break;case"onclose":s.onclose=function(e){t(e)};break;case"onerror":s.onerror=function(e){t(e)}}}function n(e){var t=e.data.split(" ");g[t[0]]=e.data.substring(t[0].length+1)}function i(e){l=!0,console.log("Openhd Event: "+e.type+" - Message: "+e.data)}function o(e){l=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data)}function a(e){l=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}var s,l,u={},g={};return u.getClass=function(){return"ConnectionWS"},u.get=function(e){var t=g[e];if("undefined"!=typeof t||null==t)return t},u.set=function(e,t){if(console.log("set:"+e+":"+t.toString()),console.log("set:is open="+l),l){var r=e+" "+t.toString();s.send(r),u.reset()}},u.reset=function(){var e=s.onmessage;s.onmessage=null,s.onmessage=e},t(),r("onopen",i),r("onclose",o),r("onerror",a),r("onmessage",n),u};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.DisplayColors={phaseColors:{},lineColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],markerColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],arrayColors:{black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,160],darkcyan:[0,240,240],darkgray:[64,64,64],darkgreen:[0,240,0],darkgrey:[64,64,64],darkyellow:[240,240,0],gray:[125,125,125],green:[0,255,0],grey:[125,125,125],lightblue:[173,216,230],lightgray:[192,192,192],lightgrey:[192,192,192],magenta:[255,0,255],maroon:[128,0,0],olive:[128,128,0],orange:[255,165,0],pink:[255,175,175],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]},getLineColor:function(e){var t=EJSS_TOOLS.DisplayColors.lineColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,50%)",EJSS_TOOLS.DisplayColors.lineColors[e]=t}return t},getMarkerColor:function(e){var t=EJSS_TOOLS.DisplayColors.markerColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,100%)",EJSS_TOOLS.DisplayColors.markerColors[e]=t}return t},getArrayColor:function(e){if(e=e.toLowerCase(),0==e.indexOf("rgb"))var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");else if(0==e.indexOf("#")){e=e.slice(1),e=e.toUpperCase();for(var r,n,i="0123456789ABCDEF",t=new Array(3),o=0,a=0;a<6;a+=2)r=i.indexOf(e.charAt(a)),n=i.indexOf(e.charAt(a+1)),t[o]=16*r+n,o++}else{var t=EJSS_TOOLS.DisplayColors.arrayColors[e];void 0===t&&(t=EJSS_TOOLS.DisplayColors.arrayColors.black)}return[t[0]/255,t[1]/255,t[2]/255]}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Worker=function(){function e(e,t){if(e){var r=new XMLHttpRequest;r.open("GET",e),r.onreadystatechange=function(){4==r.readyState&&200==r.status?t(r.responseText):console.log("Warning: impossible to read "+e)},r.send()}else t("")}var t={};if("undefined"==typeof Worker)return t;if(!window.Worker)return t;if(!window.URL)return t;if(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident")>0)return t;t.dummy=function(e){var e=e.data.params;t.postMessage({result:"dummy"})};var r=new Blob(['onmessage = function (oEvent) { \t\tpostMessage({ \t\t\t"id": oEvent.data.id, \t\t\t"evaluated": eval(oEvent.data.code) \t\t}); \t}   '],{type:"text/javascript"}),n=window.URL.createObjectURL(r),i=[],o=new Worker(n);o.onmessage=function(e){i[e.data.id]&&i[e.data.id](e.data.evaluated),delete i[e.data.id]},t.runCode=function(e,t){i.push(t||null),o.postMessage({id:i.length-1,code:e})};var a={};return t.runFunction=function(t,r,n,i,o){if("function"==typeof r)if("undefined"==typeof a[t])e(o,function(e){var o=e;o+=";onmessage = "+r.toString();var s=new Blob([o],{type:"text/javascript"}),l=window.URL.createObjectURL(s);a[t]=l;var u=new Worker(l);u.postMessage({id:t,params:n}),u.onmessage=function(e){i&&i(e.data)}});else{var s=a[t],l=new Worker(s);l.postMessage({id:t,params:n})}},t.runMultipleFunction=function(t,r,n,i,o,s){if("function"==typeof n&&i instanceof Array&&i.length>=r)if("undefined"==typeof a[t])e(s,function(e){var s=e;s+=";onmessage = "+n.toString();var l=new Blob([s],{type:"text/javascript"}),u=window.URL.createObjectURL(l);a[t]=u;for(var g=0;g<r;g++){var c=new Worker(u),e=[];c.onmessage=function(t){e.push(t.data),e.length==r&&o&&o(e)},c.postMessage({id:t,params:i[g]})}});else for(var l=a[t],u=0;u<r;u++){var g=new Worker(l),c=[];g.onmessage=function(e){c.push(e.data),c.length==r&&o&&o(c)},g.postMessage({id:t,params:i[u]})}},t}();var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.enumeration=function(e){var t=function(){throw"Can't Instantiate Enumerations"},r=t.prototype={constructor:t,toString:function(){return this.name},valueOf:function(){return this.value},toJSON:function(){return this.name}};t.values=[];for(var n in e){var i=inherit(r);i.name=n,i.value=e[n],t[n]=i,t.values.push(i)}return t.foreach=function(e,t){for(var r=0;r<this.values.length;r++)e.call(t,this.values[r])},t};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.File={JSLoaded:"",loadJSfile:function(e,t){if(EJSS_TOOLS.File.JSLoaded.indexOf("["+e+"]")!=-1)return console.log("File already loaded "+e),void t();EJSS_TOOLS.File.JSLoaded+="["+e+"]";var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),"undefined"!=typeof t&&(r.onload=t),document.getElementsByTagName("head")[0].appendChild(r)},plainName:function(e){var t=e.lastIndexOf("/");return t>=0&&(e=e.substring(t+1)),t=e.indexOf("."),t>0&&(e=e.substring(0,t)),e},download:function(e,t){var r=document.createElement("a");r.setAttribute("href","data:application/ejss;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.click()},loadScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJSONFile:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);t(e)}},r.open("GET",e,!0),r.send()},requestShortUrl:function(e,t){var r=escape("http://urlecho.appspot.com/echo?status=200&Content-Type=text/plain&body="+e);if(EJSS_TOOLS.File.CALLBACK=t,EJSS_TOOLS.File.callFunction=function(e){EJSS_TOOLS.File.CALLBACK(e.shortUrl)},null==document.getElementById("__rtShortUrl")){var n=document.createElement("script");n.type="text/javascript",n.id="__rtShortUrl",n.innerHTML="function rtShortUrl(data) { EJSS_TOOLS.File.callFunction(data); }",document.getElementsByTagName("head")[0].appendChild(n)}var i=document.getElementById("_requestShortUrl");null!=i&&document.getElementsByTagName("head")[0].removeChild(i),i=document.createElement("script"),i.id="_requestShortUrl",i.type="text/javascript",i.src="http://b1t.co/Site/api/External/MakeUrlWithGet?callback=rtShortUrl&url="+r,document.getElementsByTagName("head")[0].appendChild(i)}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcBuilder={template:{METHOD:"${METHOD}",PARAMS:"${PARAMS}",ID:"${ID}",REQUEST:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',RESPONSE_OK:'{jsonrpc: "2.0", result: ${RESULT}, params: ${PARAMS}, id: ${ID}}',RESPONSE_ERROR:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',ERROR:'{code: "2.0", message: ${MESSAGE}, data: ${DATA}}'},request:function(e,t,r){if(t&&!(t instanceof Array))throw new InvalidParamsException;var n={jsonrpc:"2.0",method:e};return t&&(n.params=t),r&&(n.id=r),n},response:function(e,t){return{jsonrpc:"2.0",result:e,id:t}},responseWithError:function(e,t){return{jsonrpc:"2.0",error:e,id:t}},error:function(e,t,r){return{code:e,message:t,data:r}},parseResponse:function(e){var t=null;try{t=JSON.parse(e)}catch(e){console.log(e)}return null!=t?t.result:null}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcClient={methods:{connect:"connect",open:"open",getMetadata:"getMetadata",getValue:"getValue",setValue:"setValue",close:"close",disconnect:"disconnect"}},EJSS_TOOLS.jsonrpcClient=function(e,t){function r(e){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function n(e,t,n,i){var a=i?i:r(12);n&&(d[a]=n);var s=S.request(e,t,a);o.send(JSON.stringify(s))}function i(){o.onopen=function(e){a&&a(e),console.log("Openhd Event: "+e.type+" - Message: "+e.data)},o.onmessage=function(e){var t=JSON.parse(e.data);u&&u(d),t.id&&d[t.id]&&d[t.id](t.result)},o.onclose=function(e){s&&s(message),console.log("Closehd Event: "+message.type+" - Message: "+message.data)},o.onerror=function(e){l&&l(e),console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}}var o,a,s,l,u,g={},c=EJSS_TOOLS.JsonrpcClient,S=EJSS_TOOLS.JsonrpcBuilder,d={};return g.connect=function(e){return n(c.methods.connect,null,e)},g.open=function(e){return n(c.methods.open,null,e)},g.getValue=function(e,t){return n(c.methods.getValue,[e],t)},g.setValue=function(e,t){return n(c.methods.setValue,e,t)},g.getMetadata=function(e){return n(c.methods.getMetadata,null,e)},g.disconnect=function(e){return n(c.methods.disconnect,null,e)},g.close=function(e){return n(c.methods.close,null,e)},g.init=function(r,n,g,c){try{a=r,l=g,s=c,u=n;var S="ws://"+e;t&&(S+=":"+t),o=new WebSocket(S),i(),console.log("Connecting... (readyState "+o.readyState+")")}catch(e){console.log(e)}},g.finish=function(){try{o.close()}catch(e){console.log(e)}},g};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Mathematics={TWO_PI:6.2831852,TO_RADIANS:Math.PI/180,LOG10SCALE:1/Math.log(10),cosineAndSine:[],cosineAndSineForDegrees:function(e){e%=360,e<0&&(e+=360);var t=this.cosineAndSine[e];if(void 0===t){var r=e*this.TO_RADIANS;t=[Math.cos(r),Math.sin(r)]}return t},radians:function(e){return e*Math.PI/180},degrees:function(e){var t=180*e/Math.PI,r=t%360;return t=360*r<0?r+360:r},norm:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return Math.sqrt(t)},crossProduct:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},normalize:function(e){var t=EJSS_TOOLS.Mathematics.norm(e);return 0==t?e:[e[0]/t,e[1]/t,e[2]/t]},normalTo:function(e){if(0==e[0])return[1,0,0];if(0==e[1])return[0,1,0];if(0==e[2])return[0,0,1];var t=EJSS_TOOLS.Mathematics.norm(e);return[-e[1]/t,e[0]/t,0]}},sensors={iOS_accelerometer:{x:0,y:0,z:0},iOS_gyroscope:{x:0,y:0,z:0},setAccelerometer:function(accvalue){var value=JSON.parse(accvalue),accelerometer=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_accelerometer={x:accelerometer.y,y:-accelerometer.x,z:accelerometer.z}:sensors.iOS_accelerometer=accelerometer},setGyroscope:function(gyrvalue){var value=JSON.parse(gyrvalue),gyroscope=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_gyroscope={x:gyroscope.y,y:-gyroscope.x,z:gyroscope.z}:sensors.iOS_gyroscope=gyroscope},iOS_staccelerometer:{x:0,y:0,z:0},iOS_stgyroscope:{x:0,y:0,z:0},iOS_stmagnetometer:{x:0,y:0,z:0},iOS_sthumidity:0,iOS_sttempamb:0,iOS_sttempir:0,iOS_stpressure:0,setSensorTag:function(stvalue){var value=JSON.parse(stvalue),results=eval(value.result);sensors.iOS_staccelerometer={x:results.accx,y:results.accy,z:results.accz},sensors.iOS_stgyroscope={x:results.gyrox,y:results.gyroy,z:results.gyroz},sensors.iOS_stmagnetometer={x:results.magx,y:results.magy,z:results.magz},sensors.iOS_sthumidity=results.hum,sensors.iOS_sttempamb=results.tamb,sensors.iOS_sttempir=results.tir,sensors.iOS_stpressure=results.press},calliOSFunction:function(e,t,r,n){var i="ejss://",o={};o.functionname=e,r&&(o.success=r),n&&(o.error=n),t&&(o.args=t),i+=JSON.stringify(o),window.location=i},isSupportedSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e},runSensorTag:function(e,t){var r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(r){var n=[];n[0]=e,n[1]=t,sensors.calliOSFunction("runSensorTag",n,"sensors.setSensorTag")}},stopSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e&&sensors.calliOSFunction("stopSensorTag")},getSensorTagAccelerometer:function(){return sensors.iOS_staccelerometer},getSensorTagGyroscope:function(){return sensors.iOS_stgyroscope},getSensorTagMagnetometer:function(){return sensors.iOS_stmagnetometer},getSensorTagTempAmb:function(){return sensors.iOS_sttempamb},getSensorTagTempIR:function(){return sensors.iOS_sttempir},getSensorTagPressure:function(){return sensors.iOS_stpressure},getSensorTagHumidity:function(){return sensors.iOS_sthumidity},isAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runAccelerometer():t&&sensors.calliOSFunction("runAccelerometer","","sensors.setAccelerometer")},stopAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopAccelerometer():t&&sensors.calliOSFunction("stopAccelerometer")},getAccelerometer:function(){var is_Androidwebview=window.android&&window.android.isAccelerometer(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getAccelerometer());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_accelerometer:{x:0,y:0,z:0}},isGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runGyroscope():t&&sensors.calliOSFunction("runGyroscope","","sensors.setGyroscope")},stopGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopGyroscope():t&&sensors.calliOSFunction("stopGyroscope")},getGyroscope:function(){var is_Androidwebview=window.android&&window.android.isGyroscope(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getGyroscope());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_gyroscope:{x:0,y:0,z:0}},isGravity:function(){var e=window.android&&window.android.isGravity();return e},runGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.runGravity()},stopGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.stopGravity()},getGravity:function(){var e=window.android&&window.android.isGravity();return e?window.android.getGravity():{x:0,y:0,z:0}},isLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e},runLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.runLinearAcceleration()},stopLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.stopLinearAcceleration()},getLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e?window.android.getLinearAcceleration():{x:0,y:0,z:0}},isRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e},runRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.runRotationVector()},stopRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.stopRotationVector()},getRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e?window.android.getRotationVector():{x:0,y:0,z:0}},isMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e},runMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.runMagneticField()},stopMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.stopMagneticField()},getMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e?window.android.getMagneticField():{x:0,y:0,z:0}},isAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e},runAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.runAmbientTemperature()},stopAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.stopAmbientTemperature()},getAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e?window.android.getAmbientTemperature():0},isLight:function(){var e=window.android&&window.android.isLight();return e},runLight:function(){var e=window.android&&window.android.isLight();e&&window.android.runLight()},stopLight:function(){var e=window.android&&window.android.isLight();e&&window.android.stopLight()},getLight:function(){var e=window.android&&window.android.isLight();return e?window.android.getLight():0},isPressure:function(){var e=window.android&&window.android.isPressure();return e},runPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.runPressure()},stopPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.stopPressure()},getPressure:function(){var e=window.android&&window.android.isPressure();return e?window.android.getPressure():0},isHumidity:function(){var e=window.android&&window.android.isHumidity();return e},runHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.runHumidity()},stopHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.stopHumidity()},getHumidity:function(){var e=window.android&&window.android.isHumidity();return e?window.android.getHumidity():0}};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createView=function(e){function t(e,t){return e.match("^"+t)==t}var r,n,i,o,a={},s={},l={},u=[],g=[],c=[],S=[],d=[],f=[],E=[],p=[],h=[],m=[],A=[],y=[],v=!1,P=!0,D=[],I=[],_=!1,C=[];return a._clearAll=function(){a[e].innerHTML="",s={},l={},u=[],g=[],D=[],c=[],S=[],d=[],f=[],E=[],h=[],m=[],A=[],y=[],p=[],v=!1,P=!0},a._setResourcePath=function(e){n=e},a._getResourcePath=function(e){if(null==e||e.length<=0)return e;if(t(e,"local:"))return e;if(t(e,"data:"))return e;if(t(e,"http:")||t(e,"https:")||t(e,"ws:"))return e;if("undefined"!=typeof __base64Images){var r=__base64Images[e];if(r)return r}if(i&&!t(e,i)&&"/"==e.charAt(0)?e=i+"images"+e:n&&!t(e,n)&&"/"!=e.charAt(0)&&(e=n+e),t(window.location.protocol,"ibooks")){var o=window.location.pathname;o=o.substring(0,o.lastIndexOf("/")),t(e,"./")&&(e=e.substring(2)),e="ibooksimg://"+window.location.host+"/"+o+"/"+e}return e},a._setLibraryPath=function(e){i=e},a._showDocument=function(e){window.open(a._getResourcePath(e))},a._addDescriptionPage=function(e,t){C[e]=t},a._openDescriptionPage=function(e){var t=C[e];t?window.open(a._getResourcePath(t)):console.log("Desription page not found: "+e)},a._registerVariable=function(e,t){s[e]={getter:null,setter:null,listeners:[],collectors:[],value:t}},a._registerVariables=function(e){for(var t=0;t<e.length;t++)a._registerVariable(e[t])},a._registerAction=function(e){l[e]={action:null}},a._registerActions=function(e){for(var t=0;t<e.length;t++)a._registerAction(e[t])},a._addElement=function(e,t,r,n){var i=EJSS_CORE.promoteToControlElement(e(t,n),a,t);return i.render&&d.push(i),i.touch&&f.push(i),i.dataCollected&&E.push(i),i.reset&&c.push(i),i.initialize&&S.push(i),i.enableEPub&&h.push(i),i.adjustPosition&&m.push(i),t&&(a[t]=i),r&&i.setProperty("Parent",r),i},a._getInitialValue=function(e){var t=s[e];if(void 0!==t)return t.value},a._startUp=function(){a._reset(),a._initValues(),a._initialize(),a._update(),a._render()},a._setReportInteractionMethod=function(e){r=e},a._linkVariable=function(e,t,r,n){var i=s[e];if(i){i.getter=t,i.setter=r,i.value=n;var o=g.indexOf(i);i.getter?i.listeners.length>0&&o<0&&g.push(i):o>=0&&g.splice(o,1),o=D.indexOf(i),i.value?i.listeners.length>0&&o<0&&D.push(i):o>=0&&D.splice(o,1)}else console.log("WARNING: view._setAccessors() - Variable not found : "+e);return i},a._setAction=function(e,t){var r=l[e];return r?r.action=t:console.log("WARNING: view._setAction() - Action not found : "+e),r},a._setReportNeeded=function(e){P=e},a._reset=function(){for(var e=0,t=c.length;e<t;e++)c[e].reset()},a._initValues=function(){for(var e=0,t=D.length;e<t;e++){var r=D[e],n=r.value;if(n)for(var i=r.listeners,o=0,a=i.length;o<a;o++)i[o](n)}},a._initialize=function(){for(var e=0,t=S.length;e<t;e++)S[e].initialize()},a._update=function(){var e,t;for(e=0,t=g.length;e<t;e++)for(var r=g[e],n=r.listeners,i=r.getter(),o=0,a=n.length;o<a;o++)n[o](i);for(e=0,t=u.length;e<t;e++){var s=u[e];s.propertySetter(s.getter())}},a._collectData=function(){var e,t;for(e=0,t=g.length;e<t;e++)for(var r=g[e],n=r.collectors,i=r.getter(),o=0,a=n.length;o<a;o++)n[o](i);for(e=0,t=u.length;e<t;e++){var s=u[e];s.isCollector&&s.propertySetter(s.getter())}for(e=0,t=E.length;e<t;e++)E[e].dataCollected()},a._render=function(){for(var e=0,t=d.length;e<t;e++)d[e].render()},a._touch=function(){for(var e=0,t=f.length;e<t;e++)f[e].touch()},a._enableEPub=function(){if("undefined"!=typeof _isEPub&&_isEPub)for(var e=0,t=h.length;e<t;e++)h[e].enableEPub()},a._addFontResizeListener=function(e){A.push(e)},a._fontResized=function(e,t,r){for(var n=0,i=m.length;n<i;n++)m[n].adjustPosition();if(e)for(var o=0,a=A.length;o<a;o++)A[o](e,t,r)},a._addResizeListener=function(e){y.push(e)},a._resized=function(e,t){for(var r=0,n=m.length;r<n;r++)m[r].adjustPosition();for(var i=0,o=y.length;i<o;i++)y[i](e,t)},a._readInteractions=function(e,t,r){var n=p.length;if(n<=0)return!1;v=!0;for(var i=0;i<n;i++){var o=p[i];if(a.isRegInteractions()){var s=o.interaction;s.data=o.data,s.runCount=e,s.runTime=t,s.isPlaying=r,s.timeStamp=Date.now(),a.pushRegInteractions(s)}o.what(o.data)}return p=[],v=!1,!0},a._interactionsNumber=function(){return p.length},a._reportInteraction=function(){r&&P&&r()},a._addListener=function(e,t,r){var n=s[e];return n?(n.listeners.indexOf(t)<0&&(n.listeners.push(t),r&&n.collectors.push(t)),n.getter&&g.indexOf(n)<0&&g.push(n),n.value&&D.indexOf(n)<0&&D.push(n)):console.log("WARNING: view._addListener() - Variable not found : "+e),n},a._addUnkownListener=function(e,t,r){for(var n=!1,i=0,o=u.length;i<o;i++){var a=u[i];if(a.propertySetter===t){a.getter=e,n=!0;break}}return n||u.push({getter:e,propertySetter:t,isCollector:r}),n},a._getAction=function(e){var t=l[e];return t||console.log("WARNING: view._getAction() - Action not found : "+e),t},a._addInteraction=function(e,t,n){return r?void(!v&&P&&p.push({what:e,data:t,interaction:n})):void e(t)},a._format=function(e,t){var r=t.indexOf("."),n=0;return r>=0&&(n=Number(t.length-r-1)),parseFloat(e).toFixed(n)},a.print=function(e){var t=document.getElementsByTagName("textarea");t.length?t[0].innerHTML=e:console.log(e)},a._setVisible=function(t){t?document.getElementById(e).style.display="inherit":document.getElementById(e).style.display="none"},a._switchVisibility=function(){a._setVisible("none"==document.getElementById(e).style.display)},a.serialize=function(){var e={};for(key in a)a[key].serialize&&(e[key]=a[key].serialize());return e},a.unserialize=function(e){for(key in e)a[key]&&a[key].unserialize?a[key].unserialize(e[key]):console.log("Impossible unserialize: "+key)},a.registerInteractions=function(e){I=[],o=e,_=!0},a.unregisterInteractions=function(){_=!1},a.getRegInteractions=function(){return I},a.isRegInteractions=function(){return _},a.pushRegInteractions=function(e){"undefined"!=typeof o?o.send(JSON.stringify(e)):I.push(e)},a[e]=document.getElementById(e),a},EJSS_CORE.promoteToControlElement=function(e,t,r){r=r||"unnamed";var n={},i={};return e.setName=function(e){r=e},e.getName=function(){return r},e.getResourcePath=function(e){return t._getResourcePath(e)},e.registerProperty=function(t,r,i){return n[t]={setter:r,getter:i,variable:null,variableSetter:null},e},e.registerAction=function(t,r,n,o){return i[t]={action:null,helper:r,process:n},o&&e.setAction(t,o),e},e.setProperty=function(t,r){var o=i[t];if(o)return e.setAction(t,r);var a=n[t];return a?a.setter(r):console.log("WARNING: ControlElement setProperty() - Property not registered : "+t+" for element : "+e.getName()),e},e.setProperties=function(t){for(var r in t)e.setProperty(r,t[r]);return e},e.linkProperty=function(r,i,o){var a=n[r];if(!a)return console.log("WARNING: ControlElement linkProperty() - Element property not registered : "+r+" for element : "+e.getName()),e;if("string"==typeof i){var s=t._addListener(i,a.setter,e.dataCollected);if(!s)return console.log("WARNING: ControlElement linkProperty() - element : "+e.getName()+" - property :"+r+" - View variable not registered : "+i),e;"InputOnly"===o||(a.variable=s),a.variableSetter=null}else t._addUnkownListener(i,a.setter,e.dataCollected),a.variableSetter=o,a.variable=null;return e},e.linkProperties=function(t){for(var r in t)e.linkProperty(r,t[r]);return e},e.setAction=function(r,n){var o=i[r];if(!o)return console.log("WARNING: ControlElement setAction() - action not registered : "+r+" for element : "+e.getName),e;if("string"==typeof n){var a=t._getAction(n);if(!a)return console.log("WARNING: ControlElement setAction() - element : "+e.getName()+" - View action not registered : "+n),e;o.action=a}else o.action={action:n};return e},e.setActions=function(t){for(var r in t)e.setAction(r,t[r]);return e},e.invokeAction=function(r){var n={};t.isRegInteractions()&&(n={action:r,element:e.getName(),timeStamp:Date.now()});var o=i[r];if(o&&(o.process&&t._addInteraction(o.process,null,n),o.action)){var a=o.helper?o.helper():null;t._addInteraction(o.action.action,a,n)}return e},e.propertiesChanged=function(){for(var t=0,r=arguments.length;t<r;t++)e.propertyChanged(arguments[t]);return e},e.propertyChanged=function(r,i){var o={};t.isRegInteractions()&&(o={property:r,element:e.getName(),timeStamp:Date.now()});var a=n[r];if(a){var s=a.variableSetter;if(s||a.variable&&(s=a.variable.setter),s||a.setter&&(s=a.setter),s){var l="undefined"!=typeof i?i:a.getter();t._addInteraction(s,l,o)}}return e},e.reportInteractions=function(r,n){var i,o;if(r)for(i=0,o=r.length;i<o;i++)e.invokeAction(r[i]);if(n)for(i=0,o=n.length;i<o;i++)e.propertiesChanged(n[i]);return t._interactionsNumber()>0&&t._reportInteraction(),e},e.getProperty=function(e,t){var r=n[e];if(r&&r.getter)return r.getter()},e.getProperties=function(){return n},e.registerProperty("name",e.setName,e.getName),e.registerProperties&&e.registerProperties(e),e};
