<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Solar System Model</title>
    <link rel="stylesheet"  type="text/css" href="file:///Users/lookang/Google Drive/PublicLawrence/workspace/output/_ejs_library/css/ejss.css" />
    <script src="file:///Users/lookang/Google Drive/PublicLawrence/EjsS_5.2_161123epub/bin/javascript/lib/scripts/common_script.js"></script>
    <script src="file:///Users/lookang/Google Drive/PublicLawrence/EjsS_5.2_161123epub/bin/javascript/lib/scripts/textresizedetector.js"></script>
<script type="text/javascript"><!--//--><![CDATA[//><!--
function Matrix(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=hasFloat32Array?new Float32Array(e):e}function Vector(e,t,r){"object"==typeof e?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=r||0)}var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.AnalyticCurve={},EJSS_DRAWING2D.analyticCurve=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Arrow={},EJSS_DRAWING2D.arrow=function(e){},EJSS_DRAWING2D.ArrowSet={},EJSS_DRAWING2D.arrowSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Axis={},EJSS_DRAWING2D.axis=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ByteRaster={},EJSS_DRAWING2D.byteRaster=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Canvas={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setDimensions(e.getDimensions())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Dimensions",e.setDimensions,e.getDimensions)}},EJSS_DRAWING2D.canvas=function(e){var t=EJSS_DRAWING2D.element(e),r=[];return t._23=function(){return"ElementCanvas"},t.setDimensions=function(e){xMin=e[0],xMax=e[1],yMin=e[2],yMax=e[3],t.setChanged(!0)},t.getDimensions=function(){return[xMin,xMax,yMin,yMax]},t.addDrawable=function(e){r.push(e),t.setChanged(!0)},t.addImageField=function(e,r,n,i,o,a,s,l,u,g){var c=function(){function c(e,t,r){for(var n=[],i=(t-e)/(r-1),o=e,a=0;r>a;a++)n.push(o),o+=i;return n}var S={};return S.imageField=!0,S.data=e||void 0,S.xMin=void 0===r?-5:r,S.xMax=void 0===n?5:n,S.nx=i||128,S.yMin=void 0===o?-5:o,S.yMax=void 0===a?5:a,S.ny=s||128,S.autoscale=l||!0,S.lower=void 0===u?-1:u,S.upper=void 0===g?1:g,S.center=(S.lower+S.upper)/2,S.maskRadius=0,S.xPos=c(S.xMin,S.xMax,S.nx),S.yPos=c(S.yMin,S.yMax,S.ny),S.updateData=function(e){S.data=e||S.data,S.xPos=c(S.xMin,S.xMax,S.nx),S.yPos=c(S.yMin,S.yMax,S.ny),t.setChanged(!0)},S.setThreshold=function(e,r){S.lower=void 0===e?S.lower:e,S.upper=void 0===r?S.upper:r,t.setChanged(!0)},S.setCircularMask=function(e){S.maskRadius=e,t.setChanged(!0)},S}();return t.addDrawable(c),c},t.getDrawables=function(){return r},this.clearObjects=function(){r=[],t.setChanged(!0)},t.registerProperties=function(e){EJSS_DRAWING2D.Canvas.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Canvas.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.CellLattice={},EJSS_DRAWING2D.cellLattice=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Cursor={},EJSS_DRAWING2D.cursor=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Custom={},EJSS_DRAWING2D.custom=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.DrawingPanel={},EJSS_DRAWING2D.drawingPanel=function(e,t){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Element={},EJSS_DRAWING2D.element=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ElementSet={},EJSS_DRAWING2D.elementSet=function(e,t){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Grid={},EJSS_DRAWING2D.grid=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Group={},EJSS_DRAWING2D.group=function(e){},EJSS_DRAWING2D.GroupSet={},EJSS_DRAWING2D.groupSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Histogram={},EJSS_DRAWING2D.histogram=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Image={},EJSS_DRAWING2D.image=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ImageSet={},EJSS_DRAWING2D.imageSet=function(e){};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.analyticCurve=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}var n,i,o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getNumPoints(),f=t.getMinimun(),d=t.getMaximun(),E="undefined"==typeof f||null===f?t.getPanel().getRealWorldXMin():f,p="undefined"==typeof d||null===d?t.getPanel().getRealWorldXMax():d,h=t.getVariable(),m=t.getFunctionX(),A=t.getFunctionY(),y=EJSS_DRAWING2D.functionsParser(),v=!1;try{n=y.parse(m)}catch(P){console.log("Analytic curve error parsing FunctionX: "+m),v=!0}if(!v)try{i=y.parse(A)}catch(D){console.log("Analytic curve error parsing FunctionY: "+A),v=!0}if(v)return void t.getController().invokeAction("OnError");var _=(p-E)/(S-1),I=[],C={},R=t.getParameters();for(var T in R)C[T]=R[T];try{for(var N=0,O=E;p>=O;O+=_){C[h]=O;var M=n.evaluate(C),b=i.evaluate(C);isNaN(M)||isNaN(b)||(I[N]=[],I[N][0]=M,I[N++][1]=b)}}catch(G){t.getController().invokeAction("OnError")}r(I,l-g,u-c,a[0],a[1]);var x=t.getStyle();x.getDrawFill()&&"none"!=x.getFillColor()&&(e.fillStyle=x.getFillColor(),e.fill()),x.getDrawLines()&&(e.lineWidth=x.getLineWidth(),e.strokeStyle=x.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.arrow=function(e,t){function r(t,r,i,o,a,s,l,u,g){e.save(),o/=2,a/=2;var c=0==u?Math.PI/2:Math.atan(g/u);switch(c+=0>u?-Math.PI/2:Math.PI/2,i){case n.TRIANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,a/2),e.lineTo(o,a/2),e.lineTo(0,-a/2),e.lineTo(-o,a/2),e.closePath();break;case n.ANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(o,a),e.lineTo(0,0),e.lineTo(-o,a);break;case n.LINE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(o,0),e.lineTo(-o,0);break;case n.RECTANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,-a),e.lineTo(o,a),e.lineTo(-o,a),e.lineTo(-o,-a),e.closePath();break;case n.POINTED:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,a/4),e.lineTo(o,a),e.lineTo(0,-a/4),e.lineTo(-o,a),e.closePath();break;case n.CIRCLE:var S=a>o?o:a;e.beginPath(),e.translate(t,r),e.arc(0,0,S,0,2*Math.PI,!1);break;case n.DIAMOND:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath();break;case n.INVTRIANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(0,-a/2),e.lineTo(-o,-a/2),e.lineTo(0,a/2),e.lineTo(o,-a/2),e.closePath();break;case n.INVANGLE:e.beginPath(),e.translate(t,r),e.rotate(c),e.moveTo(-o,-a),e.lineTo(0,0),e.lineTo(o,-a);break;case n.WEDGE:case n.CURVE:console.log("Type of Arrow: not supported")}"none"!=l&&(i!=n.ANGLE&&i!=n.INVANGLE&&(e.fillStyle=l,e.fill()),i!=n.POINTED&&(e.lineWidth=s,e.strokeStyle=l,e.stroke())),e.restore()}var n=EJSS_DRAWING2D.Arrow,i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=o[0]/2,g=o[1]/2;if(0!=o[0]||0!=o[1]){e.beginPath(),e.moveTo(s-u,l-g),e.lineTo(s+u,l+g);var c=t.getStyle();if(c.getDrawFill()&&"none"!=c.getFillColor()&&(e.fillStyle=c.getFillColor(),e.fill()),c.getDrawLines()&&(e.lineWidth=c.getLineWidth(),e.strokeStyle=c.getLineColor(),e.stroke()),t.getMarkEnd()!=n.NONE){var S=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),f=0!=S&&S<t.getMarkEndWidth()?S:t.getMarkEndWidth(),d=0!=S&&S<t.getMarkEndHeight()?S:t.getMarkEndHeight(),E="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),p=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();r(s+u,l+g,t.getMarkEnd(),f,d,p,E,u,g)}if(t.getMarkMiddle()!=n.NONE){var h=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),m=0!=h&&h<t.getMarkMiddleWidth()?h:t.getMarkMiddleWidth(),A=0!=h&&h<t.getMarkMiddleHeight()?h:t.getMarkMiddleHeight(),E="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),p=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();r(s,l,t.getMarkMiddle(),m,A,p,E,u,g)}if(t.getMarkStart()!=n.NONE){var y=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),v=0!=y&&y<t.getMarkStartWidth()?y:t.getMarkStartWidth(),P=0!=y&&y<t.getMarkStartHeight()?y:t.getMarkStartHeight(),E="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),p=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();r(s-u,l-g,t.getMarkStart(),v,P,p,E,u,g)}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.axis=function(e,t){function r(t,r,n,i,o,a){o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(a&&(i=-i,r=-r),e.moveTo(t,r-i),e.lineTo(t,r+i)):(e.moveTo(t-n,r),e.lineTo(t+n,r))}function n(t,r,n,i){i==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(e.moveTo(t-n/2,r),e.lineTo(t+n/2,r)):(e.moveTo(t,r-n/2),e.lineTo(t,r+n/2))}function i(r,n,i,o,a){e.save();var o=t.getFont(),s="";s+="none"!=o.getFontStyle()?o.getFontStyle()+" ":"",s+="none"!=o.getFontWeight()?o.getFontWeight()+" ":"",s+=o.getFontSizeString()+"px ",s+=o.getFontFamily(),e.font=s,e.fillStyle=o.getFillColor(),a?r-=e.measureText(i).width/2+.5:n+=o.getFontSize()/2,e.fillText(i,r,n),e.restore()}if(t.getShow()){var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getStyle(),f=t.getOrient(),d=t.getInvertedScaleY();e.beginPath(),r(l,u,g,c,f,d);var E=f==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(a[1]):Math.abs(a[0]),p=t.getTicksMode();if(p==EJSS_DRAWING2D.Axis.SCALE_LOG){var h=t.getScale();if(h[0]>0&&h[1]>0){var m=t.getTicks(),A=t.getScalePrecision(),y=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawLogTicks(l,u,g,c,E,y,h,m,f,n);var v=t.getFont(),P=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawLogTicksText(l,u,g,c,m,y,h,A,v,P,f,i)}}else if(p==EJSS_DRAWING2D.Axis.SCALE_NUM){var D=0,_=0;if(t.getAutoTicks())for(var I=t.getAutoStepMin(),C=t.getAutoTicksRange(),R=C.length-1;R>=0&&(D=Math.abs(E/C[R]),!(1.001*D>=I));R--);else{var m=t.getTicks();0!=m?D=E/m:(D=t.getStep(),_=t.getTickStep())}var A=t.getScalePrecision(),h=t.getScale();if(0==_)var T=Math.abs((h[1]-h[0])*D/E);else{var T=_;D=Math.abs(T*E/(h[1]-h[0]))}var N=Math.pow(10,A),O=Math.round(T*N)/N;O>0&&(T=O,D=Math.abs(O*E/(h[1]-h[0])));var M=t.getFixedTick(),b=h[1];isNaN(M)||(b=M<h[0]?M+(Math.floor((h[0]-M)/T)+1)*T:M>h[1]?M-(Math.floor((M-h[1])/T)+1)*T:M);var G=Math.abs((h[0]-b)%T),x=Math.abs(G-T);(.001>G||.001>x)&&(G=0);var L=E*G/Math.abs(h[1]-h[0]),y=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawDecTicks(l,u,g,c,y,D,L,f,d,n);var v=t.getFont(),P=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawDecTicksText(l,u,g,c,y,D,L,h,A,T,G,v,P,f,d,i)}var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.byteRaster=function(e,t){if(t.getDataChanged()){var r=t.getData(),n=t.getColorMapper().getColors(),i=r.length,o=r[0].length,a=t.getColorMapper().getNumberOfColors(),s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=Math.abs(l[0]/2),f=Math.abs(l[1]/2),d=e.canvas.id;EJSS_SVGGRAPHICS.Utils.ImageDataCanvas(i,o,a,r,n,function(t){var r=document.getElementById(d);e=r.getContext("2d"),e.putImageData(t,g-S,c-f)}),t.setDataChanged(!1)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.canvas=function(e,t){for(var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=t.getDimensions(),l=s[1]-s[0],u=s[3]-s[2],g=Math.abs(n[0]),c=Math.abs(n[1]),S=g/l,f=c/u,d=o-g/2,E=a+c/2,p=t.getDrawables(),h=0;h<p.length;h++)"undefined"!=typeof p[h].imageField?EJSS_GRAPHICS.GraphicsUtils.drawImageField(e,d,E,xMin,yMin,g,c,S,f,p[h]):"undefined"!=typeof p[h].run&&p[h].draw(e,d,E,xMin,yMin,g,c,S,f)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cellLattice=function(e,t){function r(t,r,n,i,o,a){e.beginPath(),0==o&&(o=Math.abs(n-t));for(var s=t;n>=s;s+=o)e.moveTo(s,r),e.lineTo(s,i);0==a&&(a=Math.abs(r-i));for(var s=i;s>=r;s-=a)e.moveTo(t,s),e.lineTo(n,s)}function n(t,r,n,i,o){e.beginPath();var a=n/2,s=i/2;e.moveTo(t-a,r+s),e.lineTo(t+a,r+s),e.lineTo(t+a,r-s),e.lineTo(t-a,r-s),e.lineTo(t-a,r+s),e.fillStyle=o,e.fill(),e.lineWidth=1,e.strokeStyle=o,e.stroke()}function i(t,n,i,o,a,s,l){var u=i/2,g=o/2,c=t-u,S=t+u,f=n+g,d=n-g;r(c,f,S,d,a,s),l.getDrawFill()&&"none"!=l.getFillColor()&&(e.fillStyle=l.getFillColor(),e.fill()),l.getDrawLines()&&(e.lineWidth=l.getLineWidth(),e.strokeStyle=l.getLineColor(),e.stroke())}for(var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getStyle(),f=t.getData(),d=t.getColorMapper().getColors(),E=f.length,p=f[0].length,h=Math.abs(a[0]/E),m=Math.abs(a[1]/p),A=l-g+h/2,y=u-c-m/2,v=0;p>v;v++)for(var P=0;E>P;P++)n(A+h*P,y-m*v,h,m,d[f[P][v]]);var D=t.getShowGrid();D&&i(l,u,a[0],a[1],h,m,S)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cursor=function(e,t){var r=t.getPixelPosition(),n=t.getCursorType(),i=t.getGroupPanel(),o=i.getRealWorldCoordinates(),a=i._26([o[0],o[2]]),s=i._26([o[1],o[3]]);if(e.beginPath(),n!=EJSS_DRAWING2D.Cursor.VERTICAL){var l=a[0],u=s[0],g=r[1];g>a[1]?g=a[1]:g<s[1]&&(g=s[1]),e.moveTo(l,g),e.lineTo(u,g)}if(n!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var c=r[0],S=a[1],f=s[1];c<a[0]?c=a[0]:c>s[0]&&(c=s[0]),e.moveTo(c,S),e.lineTo(c,f)}var d=t.getStyle();d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),d.getDrawLines()&&(e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.ellipse=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=.5522848,g=o-s/2,c=a-l/2;ox=s/2*u,oy=l/2*u,xe=g+s,ye=c+l,e.beginPath(),e.moveTo(g,a),e.bezierCurveTo(g,a-oy,o-ox,c,o,c),e.bezierCurveTo(o+ox,c,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,g,a+oy,g,a);var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.grid=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getShowX(),g=t.getShowY();if(u){e.beginPath();var c=t.getTicksXMode();if(c==EJSS_DRAWING2D.Grid.SCALE_LOG){var S=t.getScaleX();if(S[0]>0&&S[1]>0){var f=t.getTicksX(),d=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(d,p,E,h,f,S,1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}}else if(c==EJSS_DRAWING2D.Grid.SCALE_NUM){var m=0,A=0;if(t.getAutoTicksX())for(var y=t.getAutoStepXMin(),v=t.getAutoTicksRangeX(),P=v.length-1;P>=0&&(m=Math.abs(n[0]/v[P]),!(m>=y));P--);else{var f=t.getTicksX();0!=f?m=Math.abs(n[0]/f):(m=t.getStepX(),A=t.getTickStepX())}var D=t.getScalePrecisionX(),S=t.getScaleX();if(0==A)var _=Math.abs((S[1]-S[0])*m/n[0]);else{var _=A;m=Math.abs(_*n[0]/(S[1]-S[0]))}var I=Math.pow(10,D),C=Math.round(_*I)/I;C>0&&(_=C,m=Math.abs(C*n[0]/(S[1]-S[0])));var R=t.getFixedTickX(),T=S[1];isNaN(R)||(T=R<S[0]?R+(Math.floor((S[0]-R)/_)+1)*_:R>S[1]?R-(Math.floor((R-S[1])/_)+1)*_:R);var N=Math.abs((S[0]-T)%_),O=Math.abs(N-_);(.001>N||.001>O)&&(N=0);var M=Math.abs(n[0]*N/(S[1]-S[0])),d=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(d,p,E,h,M,m,1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}e.lineWidth=t.getLineWidthX(),e.strokeStyle=t.getLineColorX(),e.stroke()}if(g){e.beginPath();var b=t.getTicksYMode();if(b==EJSS_DRAWING2D.Grid.SCALE_LOG){var G=t.getScaleY();if(G[0]>0&&G[1]>0){var x=t.getTicksY(),d=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(d,p,E,h,x,G,-1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}}else if(b==EJSS_DRAWING2D.Grid.SCALE_NUM){var L=0,J=0;if(t.getAutoTicksY())for(var w=t.getAutoStepYMin(),k=t.getAutoTicksRangeY(),P=k.length-1;P>=0&&(L=Math.abs(n[1]/k[P]),!(L>=w));P--);else{var x=t.getTicksY();0!=x?L=Math.abs(n[1]/x):(L=t.getStepY(),J=t.getTickStepY())}var W=t.getScalePrecisionY(),G=t.getScaleY();if(0==J)var F=Math.abs((G[1]-G[0])*L/n[1]);else{var F=J;L=Math.abs(F*n[1]/(G[1]-G[0]))}var V=Math.pow(10,W),B=Math.round(F*V)/V;B>0&&(F=B,L=Math.abs(B*n[1]/(G[1]-G[0])));var R=t.getFixedTickY(),T=G[1];isNaN(R)||(T=R<G[0]?R+(Math.floor((G[0]-R)/F)+1)*F:R>G[1]?R-(Math.floor((R-G[1])/F)+1)*F:R);var N=Math.abs((G[0]-T)%F),O=Math.abs(N-F);(.001>N||.001>O)&&(N=0);var H=Math.abs(n[1]*N/(G[1]-G[0])),d=o-s,E=o+s,p=a+l,h=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(d,p,E,h,H,L,-1,function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)})}e.lineWidth=t.getLineWidthY(),e.strokeStyle=t.getLineColorY(),e.stroke()}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.histogram=function(e,t){function r(t,r,n,i,o){e.beginPath(),e.moveTo(t,i),e.lineTo(t,n),e.lineTo(r,n),e.lineTo(r,i),o.getDrawFill()&&"none"!=o.getFillColor()&&(e.fillStyle=o.getFillColor(),e.fill()),o.getDrawLines()&&(e.lineWidth=o.getLineWidth(),e.strokeStyle=o.getLineColor(),e.stroke())}for(var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=t.getStyle(),c=t.getDiscrete(),S=t.getBinWidth()/2,f=t.getBars(),d=t.getGroupPanel().getPixelPositionWorldOrigin()[1],E=0;E<f.length;E++){var p,h,m=f[E][0];c?p=h=a-l+m*i[0]:(p=a-l+(m-S)*i[0],h=a-l+(m+S)*i[0]);var A=s-u+f[E][1]*i[1];r(p,h,A,d,g)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.image=function(e,t,r){var n,i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=Math.abs(o[0]/2),g=Math.abs(o[1]/2);if(t.getChangedImage()||(n=t.getCustomObject()),n)e.save(),r(t),e.drawImage(n,s-u,l-g,Math.abs(o[0]),Math.abs(o[1])),e.restore();else{n=new Image,t.setCustomObject(n),n.onload=function(){e.save(),r(t),e.drawImage(n,s-u,l-g,Math.abs(o[0]),Math.abs(o[1])),e.restore()};var c=t.getEncode();c.length>0?n.src="data:png;base64,"+c:n.src=t.getImageUrl()}t.setChangedImage(!1)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.mesh=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;n>a;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]);var s=i.indexToColor(o);e.fillStyle=s,e.fill(),e.lineWidth=1.25,e.strokeStyle=s,e.stroke()}function n(t,r,n,i){e.beginPath();for(var o=t.length,a=0;o>a;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),n&&i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function i(t,r,n,i){e.beginPath();for(var o=t.length,a=0;o>a;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),e.lineWidth=i+.5,e.strokeStyle=n,e.stroke()}function o(t,r,n,i){for(var o=0;o<t.length;o++){var a=t[o],s=r[o],l=n[o][0],u=n[o][1],g=EJSS_TOOLS.Mathematics.norm([l,u]),c=l*i/g,S=u*i/g;if(0!=c||0!=S){var f=.3*EJSS_TOOLS.Mathematics.norm([c,S]),E=0!=f&&12>f?f:12,h=Math.atan2(c,S);e.beginPath(),e.moveTo(a,s),e.lineTo(a+c-E*Math.cos(h),s+S-E*Math.sin(h)),e.lineTo(a+c-E*Math.cos(h-Math.PI/6),s+S-E*Math.sin(h-Math.PI/6)),e.lineTo(a+c,d+p),e.lineTo(a+c-E*Math.cos(h+Math.PI/6),s+S-E*Math.sin(h+Math.PI/6)),e.lineTo(a+c-E*Math.cos(h),s+S-E*Math.sin(h)),e.lineWidth=1,e.strokeStyle="black",e.stroke()}}}var a,s,l,u,g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),f=g[0]+S[0],d=g[1]+S[1],E=c[0]/2,p=c[1]/2,h=t.getPoints();if(null!=h){var m=h.length;a=new Array(m),s=new Array(m);for(var A=0;m>A;A++)a[A]=f-E+h[A][0]*c[0],s[A]=d-p+h[A][1]*c[1];var y=t.getCells(),v=t.getFieldAtPoints();if(v?l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,y,v,!1):(v=t.getFieldAtCells(),l=EJSS_GRAPHICS.GraphicsUtils.buildCells(a,s,y,v,!0)),null!=y){var P=t.getStyle();if(null!=v){var D=t.getColorCoded();EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,D,function(e,t){n(e,t,!1,P)},function(e,t,n,i,o){r(e,t,n,i,o)})}else EJSS_GRAPHICS.GraphicsUtils.drawPolygons(l,D,function(e,t){n(e,t,!0,P)},function(e,t,r,n,i){})}var _=t.getBoundary();if(t.getDrawBoundary()&&null!=_){var I=t.getBoundaryLabels(),C=t.getBoundaryColors(),R=t.getBoundaryLineWidth();u=EJSS_GRAPHICS.GraphicsUtils.buildBoundary(a,s,_),EJSS_GRAPHICS.GraphicsUtils.drawBoundary(u,I,C,function(e,t,r){i(e,t,r,R)})}if(t.getDataType()>=4&&null!=v)for(var T=t.getVectorLength()*c[0],A=0,N=y.length;N>A;A++)o(mCellA[A],mCellB[A],v[A],T)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.pipe=function(e,t){var r=t.getPoints();if(r&&!(r.length<=0)){var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=Math.abs(i[0]),u=Math.abs(i[1]),g=a-l/2,c=s+u/2,S=t.getStyle();e.beginPath(),e.moveTo(g,c);for(var a=g,s=c,f=0,d=r.length;d>f;f++){var E=r[f];a+=Math.round(E[0]*l),s+=Math.round(-E[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=2*S.getLineWidth()+t.getPipeWidth(),e.strokeStyle=S.getLineColor(),e.stroke()),e.beginPath(),e.moveTo(g,c);for(var a=g,s=c,f=0,d=r.length;d>f;f++){var E=r[f];a+=Math.round(E[0]*l),s+=Math.round(-E[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=t.getPipeWidth(),e.strokeStyle=S.getFillColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.point=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1];e.beginPath(),e.arc(o,a,2,0,2*Math.PI);var s=t.getStyle();e.fillStyle=s.getFillColor(),e.fill()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.polygon=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath();for(var u=t.getPoints(),g=0;g<u.length;g++){var c=u[g],S=o-s+c[0]*n[0],f=a-l+c[1]*n[1];0==g?e.moveTo(S,f):e.lineTo(S,f)}var d=t.getStyle();d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),d.getDrawLines()&&(e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.rectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a+l),e.lineTo(o+s,a+l),e.lineTo(o+s,a-l),e.lineTo(o-s,a-l),e.lineTo(o-s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.roundRectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=o-s/2,g=a-l/2,c=Math.abs(t.getCornerRadius());e.beginPath(),e.moveTo(u+c,g),e.lineTo(u+s-c,g),e.quadraticCurveTo(u+s,g,u+s,g+c),e.lineTo(u+s,g+l-c),e.quadraticCurveTo(u+s,g+l,u+s-c,g+l),e.lineTo(u+c,g+l),e.quadraticCurveTo(u,g+l,u,g+l-c),e.lineTo(u,g+c),e.quadraticCurveTo(u,g,u+c,g),e.closePath();var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.segment=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a-l),e.lineTo(o+s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.spring=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0];e.beginPath(),EJSS_GRAPHICS.GraphicsUtils.drawSpring(t.getLoops(),t.getPointsPerLoop(),u,t.getSolenoid(),t.getThinExtremes(),o-s,a-l,n[0],n[1],function(t,r){e.moveTo(t,r)},function(t,r){e.lineTo(t,r)});var g=t.getStyle();g.getDrawFill()&&"none"!=g.getFillColor()&&(e.fillStyle=g.getFillColor(),e.fill()),g.getDrawLines()&&(e.lineWidth=g.getLineWidth(),e.strokeStyle=g.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.tank=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]/2),l=Math.abs(n[1]/2),u=t.getPixelSizeOf(0,t.getLevel()),g=o-s,c=o+s,S=a+l,f=a-l,d=S+u[1],E=t.getStyle();e.beginPath(),e.moveTo(g+u[0],d),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c+u[0],d),e.fillStyle=t.getLevelColor(),e.fill(),e.beginPath(),e.moveTo(g,f),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c,f),E.getDrawFill()&&"none"!=E.getFillColor()&&(e.fillStyle=E.getFillColor(),e.fill()),e.lineWidth=E.getLineWidth(),e.strokeStyle=E.getLineColor(),e.stroke()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.text=function(e,t){var r=t.getFont(),n="";n+="none"!=r.getFontStyle()?r.getFontStyle()+" ":"",n+="none"!=r.getFontWeight()?r.getFontWeight()+" ":"",n+=r.getFontSizeString()+(r.getFontSizeString().toString().indexOf("px")>-1?" ":"px "),n+=r.getFontFamily(),e.font=n;var i=t.getText(),o=t.getPixelPosition(),a=t.getFramed()?4:0,s=[e.measureText(i).width+2*a,r.getFontSize()+2*a],l=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),s[0],s[1]),u=t.getMarginX(),g=t.getMarginY(),c=o[0]+l[0]+u+a,S=o[1]+l[1]+g-a;if(t.getFramed()){var f=a,d=a,E=s[0]-2*a,p=s[1]-2*a;if(E>0){var h=S+f,m=S-p-f,A=c-d,y=c+E+f;e.save(),e.beginPath(),e.moveTo(A,h),e.lineTo(y,h),e.lineTo(y,m),e.lineTo(A,m),e.lineTo(A,h);var v=t.getStyle();v.getDrawFill()&&"none"!=v.getFillColor()&&(e.fillStyle=v.getFillColor(),e.fill()),v.getDrawLines()&&(e.lineWidth=v.getLineWidth(),e.strokeStyle=v.getLineColor(),e.stroke()),e.restore()}}var P=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:P=Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:P=Math.PI;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:P=3*Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:P=0}e.translate(o[0]+u,o[1]+g),e.rotate(P),e.translate(-(o[0]+u),-(o[1]+g)),e.fillStyle=r.getFillColor(),e.fillText(t.getText(),c,S)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trace=function(e,t){function r(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}function n(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]),u=.5522848,g=o-s/2,c=a-l/2;ox=s/2*u,oy=l/2*u,xe=g+s,ye=c+l,e.beginPath(),e.moveTo(g,a),e.bezierCurveTo(g,a-oy,o-ox,c,o,c),e.bezierCurveTo(o+ox,c,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,g,a+oy,g,a),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function i(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]);e.beginPath(),e.rect(o-s/2,a-l/2,s,l),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function o(t,r,n,i,o,a){e.beginPath(),e.moveTo(t,o),e.lineTo(t,r),e.lineTo(n,i),e.lineTo(n,o),a.getDrawFill()&&"none"!=a.getFillColor()&&(e.fillStyle=a.getFillColor(),e.fill()),a.getDrawLines()&&(e.lineWidth=a.getLineWidth(),e.strokeStyle=a.getLineColor(),e.stroke())}var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2;r(t.getPoints(),u-c,g-S,s[0],s[1]);var f=t.getStyle();f.getDrawFill()&&"none"!=f.getFillColor()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke());for(var d,E,p=t.getPoints(),h=0;h<p.length;h++){var m=p[h],A=u-c+m[0]*s[0],y=g-S+m[1]*s[1],v=m[3],P=m[4],D=[m[5],m[6]];if(v==EJSS_DRAWING2D.Trace.ELLIPSE)n(A,y,D,P);else if(v==EJSS_DRAWING2D.Trace.RECTANGLE)i(A,y,D,P);else if(v==EJSS_DRAWING2D.Trace.BAR){var _=t.getGroupPanel()._26([0,0])[1];D[1]=_-y,y+=D[1]/2,i(A,y,D,P)}else if(v==EJSS_DRAWING2D.Trace.AREA){if(0!=h){var _=t.getGroupPanel()._26([0,0])[1],I=u-c+d*s[0],C=g-S+E*s[1];o(mMark,I,C,A,y,_,P)}d=m[0],E=m[1]}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trail=function(e,t){function r(t,r,n,i,o,a,s){if(!(0>=r)){e.beginPath();for(var l=0;r>l;l++){var u=t[l],g=i+u[0]*a,c=o+u[1]*s,S=u[2];0==l||0==S?e.moveTo(g,c):e.lineTo(g,c)}n.getDrawLines()&&(e.lineWidth=n.getLineWidth(),e.strokeStyle=n.getLineColor(),e.stroke())}}var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=a-l,c=s-u,S=i[0],f=i[1],d=t.getSegmentsCount();if(d>0)for(var E=0;d>E;E++){var p=t.getSegmentPoints(E).length;r(t.getSegmentPoints(E),p,t.getSegmentStyle(E),g,c,S,f)}var p=t.getCurrentPoints().length;r(t.getCurrentPoints(),p,t.getStyle(),g,c,S,f)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.wheel=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=n[0]/2,g=n[1]/2,c=.5522848,S=o-s/2,f=a-l/2;ox=s/2*c,oy=l/2*c,xe=S+s,ye=f+l,e.beginPath(),e.moveTo(S,a),e.bezierCurveTo(S,a-oy,o-ox,f,o,f),e.bezierCurveTo(o+ox,f,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,S,a+oy,S,a),e.moveTo(o-u,a),e.lineTo(o+u,a),e.moveTo(o,a-g),e.lineTo(o,a+g);var d=t.getStyle();d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),d.getDrawLines()&&(e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke())};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.CanvasGraphics={},EJSS_GRAPHICS.canvasGraphics=function(e){};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.GraphicsUtils={getOffsetRect:function(e){var t,r,n,i,o=e.getDOMElement(),a=e.getWidth(),s=e.getHeight();t=parseFloat(a);var l=!isNaN(t)&&isFinite(a);r=parseFloat(s);var u=!isNaN(r)&&isFinite(s);if(o.getBoundingClientRect){var g=o.getElementById?o.getElementById(".myPanel"):null;if(g&&g.childElementCount>0)var c=g.getBoundingClientRect();else var c=o.getBoundingClientRect();n=c.top,i=c.left,l||(t=c.width),u||(r=c.height)}else if(void 0!==o.offsetTop)n=o.offsetTop,i=o.offsetLeft,l||(t=o.offsetWidth),u||(r=o.offsetHeight);else{for(var S=o.parentNode||document.getElementById(o.id).parentNode;S&&!S.offsetTop&&S&&!S.previousElementSibling&&!S.nextElementSibling;)S=S.parentNode;n=S.offsetTop,i=S.offsetLeft,l||(t=S.offsetWidth),u||(r=S.offsetHeight)}var f=document.body,d=document.documentElement,E=d.clientTop||f.clientTop||0,p=d.clientLeft||f.clientLeft||0;return n-=E,i-=p,{top:n,left:i,width:t,height:r,bottom:n+r,right:i+t}},drawSpring:function(e,t,r,n,i,o,a,s,l,u,g){var c=e*t,S=2*Math.PI/t;0>r&&(S*=-1);for(var f=t/2,d=[s,l,0],E=EJSS_TOOLS.Mathematics.normalTo(d),p=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct(d,E)),h=0;c>=h;h++){var m;m=i?f>h?0:t>h?h-f:h>c-f?0:h>c-t?c-h-f:f:f;var A=Math.PI/2+h*S,y=Math.cos(A),v=Math.sin(A),P=o+h*s/c+m*r*(y*E[0]+v*p[0])/f,D=a+h*l/c+m*r*(y*E[1]+v*p[1])/f;if(0!=n){var _=m*Math.cos(2*h*Math.PI/t)/f;P+=n*_*s,D+=n*_*l}0==h?u(P,D):g(P,D)}},drawDecTicks:function(e,t,r,n,i,o,a,s,l,u){var g=EJSS_SVGGRAPHICS.Utils,c=e-r,S=e+r,f=t+n,d=t-n,E=g.crispValue(S),p=g.crispValue(d);if(s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var h=p-a;h>=f-.5;h-=o)u(e,h,i,s);else for(var h=c+a;E+.5>=h;h+=o)u(h,t,i,s)},drawDecTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c,S,f,d,E){var p=EJSS_SVGGRAPHICS.Utils,h=e-r,m=e+r,A=t+n,y=t-n,v=p.crispValue(m),P=p.crispValue(y);if(f==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var D=0,_=P-a;_>=A-.5;_-=o,D++){if(d)var I=s[1]-g-u*D;else var I=s[0]+g+u*D;var C=parseFloat(I.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){var R=i/2;E(mGroup,e+R,_,C,c,!1)}else{var R=C.length*Math.floor(c.getFontSize()/2);R+=C.length*c.getNumberLetterSpacing(),R+=Math.floor(i/2),E(e-R,_,C,c,!1)}}else for(var D=0,_=h+a;v+.5>=_;_+=o,D++){var I=s[0]+g+u*D,C=parseFloat(I.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){var T=Math.floor(i/2)+2;E(_,t-i,C,c,!0)}else{var T=c.getFontSize()+Math.floor(i/2);E(_,t+T,C,c,!0)}}},drawLogTicks:function(e,t,r,n,i,o,a,s,l,u){var g=EJSS_SVGGRAPHICS.Utils,c=e-r,S=t-n,f=g.crispValue(S);if(l==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var d=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10),p=E-d,h=Math.ceil(p),m=i/p,A=0;h>=A;A++)for(var y=Math.pow(10,A+d),v=Math.pow(10,A+d+1),P=v/s,D=0;s-1>D;D++){var _=y+D*P;if(0!=_&&_>=a[0]&&_<=a[1]){var I=Math.log(_)/Math.log(10),C=f-(I-d)*m;u(e,C,o,l)}}else for(var d=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10),p=E-d,h=Math.ceil(p),m=i/p,A=0;h>=A;A++)for(var y=Math.pow(10,A+d),v=Math.pow(10,A+d+1),P=v/s,D=0;s-1>D;D++){var _=y+D*P;if(0!=_&&_>=a[0]&&_<=a[1]){var I=Math.log(_)/Math.log(10),C=c+(I-d)*m;u(C,t,o,l)}}},drawLogTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c){var S=EJSS_SVGGRAPHICS.Utils,f=e-r,d=t-n,E=S.crispValue(d);if(g==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var p=Math.log(a[0])/Math.log(10),h=Math.log(a[1])/Math.log(10),m=h-p,A=Math.ceil(m),y=segsize/m,v=0;A>=v;v++)for(var P=Math.pow(10,v+p),D=Math.pow(10,v+p+1),_=D/i,I=0;i-1>I;I++){var C=P+I*_;if(0!=C&&C>=a[0]&&C<=a[1]){var R=Math.log(C)/Math.log(10),T=E-(R-p)*y;if(0==I)var N=C.toExponential(s);else var N=parseFloat((C/P).toFixed(s)).toFixed(s);if(u==EJSS_DRAWING2D.Axis.TICKS_DOWN){var O=o/2;c(e+O,T,N,l,!1)}else{var O=N.length*Math.floor(l.getFontSize()/2);O+=N.length*l.getNumberLetterSpacing(),O+=Math.floor(o/2),c(e-O,T,N,l,!1)}}}else for(var p=Math.log(a[0])/Math.log(10),h=Math.log(a[1])/Math.log(10),m=h-p,A=Math.ceil(m),y=segsize/m,v=0;A>=v;v++)for(var P=Math.pow(10,v+p),D=Math.pow(10,v+p+1),_=D/i,I=0;i-1>I;I++){var C=P+I*_;if(0!=C&&C>=a[0]&&C<=a[1]){var R=Math.log(C)/Math.log(10),T=f+(R-p)*y;if(0==I)var N=C.toExponential(s);else var N=parseFloat((C/P).toFixed(s)).toFixed(s);if(u==EJSS_DRAWING2D.Axis.TICKS_DOWN){var M=Math.floor(o/2)+2;c(T,t-o,N,l,!0)}else{var M=l.getFontSize()+Math.floor(o/2);c(T,t+M,N,l,!0)}}}},drawDecGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),f=u.crispValue(n);if(-1==a){0==o&&(o=Math.abs(S-f));for(var d=f-i;d>=t-.5;d-=o)s(e,d),l(r,d)}else{0==o&&(o=Math.abs(c-g));for(var d=e+i;c+.5>=d;d+=o)s(d,t),l(d,n)}},drawLogGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),f=u.crispValue(n),d="",E=Math.log(o[0])/Math.log(10),p=Math.log(o[1])/Math.log(10),h=p-E,m=Math.ceil(h);if(-1==a)var A=(f-S)/h;else var A=(c-g)/h;for(var y=0;m>=y;y++)for(var v=Math.pow(10,y+E),P=Math.pow(10,y+E+1),D=P/i,_=0;i-1>_;_++){var I=v+_*D;if(0!=I&&I>=o[0]&&I<=o[1]){var C=Math.log(I)/Math.log(10);if(-1==a){var R=f-(C-E)*A;s(g,R),l(c,R)}else{var R=g+(C-E)*A;s(R,S),l(R,f)}}}return d},buildCells:function(e,t,r,n,i){var o,a,s,l;if(null!=r&&r.length>0){var u=r.length;o=new Array(u),a=new Array(u),s=new Array(u),l=new Array(u);var g=1;null!=n&&(g=i?n[0][0].length:n[0].length);for(var c=0;u>c;c++){var S=r[c],f=S.length;o[c]=new Array(f),a[c]=new Array(f);for(var d=0;f>d;d++){var E=S[d];o[c][d]=e[E],a[c][d]=t[E]}if(null!=n)if(s[c]=new Array(f),l[c]=new Array(f),i)for(var p=n[c],d=0;f>d;d++){s[c][d]=1>=g?p[d][0]:EJSS_TOOLS.Mathematics.norm(p[d]),l[c][d]=new Array(g);for(var h=0;g>h;h++)l[c][d][h]=p[d][h]}else for(var d=0;f>d;d++){var E=S[d];s[c][d]=1>=g?n[E][0]:EJSS_TOOLS.Mathematics.norm(n[E]),l[c][d]=new Array(g);for(var h=0;g>h;h++)l[c][d][h]=n[E][h]}}}return{cellA:o,cellB:a,cellZ:s,cellVector:l}},drawPolygons:function(e,t,r,n){for(var i=e.cellA,o=e.cellB,a=e.cellZ,s=0,l=i.length;l>s;s++){var u=i[s],g=o[s],c=a[s];if("undefined"!=typeof c){for(var S=u.length,f=new Array(S),d=Number.MAX_VALUE,E=Number.MIN_VALUE,p=0;S>p;p++){var h=t.doubleToIndex(c[p]);d=Math.min(h,d),E=Math.max(h,E),f[p]=h}for(var m=t.getColorThresholds(),A=new Array(2*S),y=new Array(2*S),v=d;E>=v;v++){for(var P=0,D=0;S>D;D++){var _=(D+1)%S;if(f[D]<=v&&f[_]>=v){if(f[D]==v)A[P]=u[D],y[P]=g[D],P++;else{var I=(m[v]-c[D])/(c[_]-c[D]);A[P]=Math.round(u[D]+I*(u[_]-u[D])),y[P]=Math.round(g[D]+I*(g[_]-g[D])),P++}if(f[_]>v){var I=(m[v+1]-c[D])/(c[_]-c[D]);A[P]=Math.round(u[D]+I*(u[_]-u[D])),y[P]=Math.round(g[D]+I*(g[_]-g[D])),P++}}else if(f[D]>=v&&f[_]<=v){if(f[D]==v)A[P]=u[D],y[P]=g[D],P++;else{var I=(m[v+1]-c[D])/(c[_]-c[D]);A[P]=Math.round(u[D]+I*(u[_]-u[D])),y[P]=Math.round(g[D]+I*(g[_]-g[D])),P++}if(f[_]<v){var I=(m[v]-c[D])/(c[_]-c[D]);A[P]=Math.round(u[D]+I*(u[_]-u[D])),y[P]=Math.round(g[D]+I*(g[_]-g[D])),P++}}}P>0&&n(A,y,P,t,v)}}r(u,g)}},buildBoundary:function(e,t,r){var n,i;if(null!=r&&r.length>0){var o=r.length;n=new Array(o),i=new Array(o);for(var a=0;o>a;a++){var s=r[a],l=s.length;n[a]=new Array(l),i[a]=new Array(l);for(var u=0;l>u;u++){var g=s[u];n[a][u]=e[g],i[a][u]=t[g]}}}return{boundaryA:n,boundaryB:i}},drawBoundary:function(e,t,r,n){for(var i=e.boundaryA,o=e.boundaryB,a="black",s=0,l=i.length;l>s;s++){if(null!=t){var u=t[s];null!=r&&u<r.length&&(a=r[u])}n(i[s],o[s],a)}},drawImageField:function(e,t,r,n,i,o,a,s,l,u){function g(e){return t+(e-n)*s}function c(e){return r-(e-i)*l}for(var S=Math.round(g(u.xMin)),f=Math.round(c(u.yMax)),d=Math.round(o),E=Math.round(a),p=e.getImageData(S,f,d,E),h=this.maskRadius*s,m=0,A=0,y=0,v=0;d>v;v++)for(var P=Math.floor(v*u.nx/d),D=0;E>D;D++){var _=Math.floor(D*u.ny/E);A=0,u.data[P][_]<u.lower?(y=255,m=0):u.data[P][_]<u.center?(y=255*(u.center-u.data[P][_])/(u.center-u.lower),m=0):u.data[P][_]<u.upper?(y=0,m=255*(u.data[P][_]-u.center)/(u.upper-u.center)):(y=0,m=255),u.maskRadius>0&&Math.sqrt((v-d/2)*(v-d/2)+(D-E/2)*(D-E/2))>h&&(m=A=224,y=255);var I=4*v+4*d*D;p.data[I+0]=m,p.data[I+1]=A,p.data[I+2]=y}e.putImageData(p,S,f)}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.analyticCurve=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.arrow=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.axis=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.byteRaster=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.canvas=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?(o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),o.setAttribute("id",t.getName()),r.appendChild(o),i=document.createElement("canvas"),i.setAttribute("id",t.getName()+".canvas"),o.appendChild(i)):i=document.getElementById(t.getName()+".canvas");var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1];i.width=Math.abs(s[0]),i.height=Math.abs(s[1]),o.width=Math.abs(s[0]),o.height=Math.abs(s[1]);var c=Math.abs(s[0]/2),S=Math.abs(s[1]/2);o.setAttribute("x",u-c),o.setAttribute("y",g-S);var f=t.getDimensions(),d=f[1]-f[0],E=f[3]-f[2],p=Math.abs(s[0]),h=Math.abs(s[1]),m=p/d,A=h/E,y=u-p/2,v=g+h/2,P=t.getDrawables(),D=i.getContext("2d");D.fillRect(0,0,i.width-.5,i.height-.5);for(var _=0;_<P.length;_++)"undefined"!=typeof P[_].imageField?EJSS_GRAPHICS.GraphicsUtils.drawImageField(D,y,v,xMin,yMin,p,h,m,A,P[_]):"undefined"!=typeof P[_].run&&P[_].draw(D,y,v,xMin,yMin,p,h,m,A);var I=t.getStyle().getAttributes();for(var C in I)o.setAttribute(C,I[C]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cellLattice=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cursor=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.ellipse=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.grid=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.group=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.histogram=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.image=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.mesh=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.pipe=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.point=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.polygon=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.rectangle=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.roundRectangle=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.segment=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.spring=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.tank=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.text=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trace=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.Utils={},EJSS_SVGGRAPHICS.Utils.crispValue=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.crispTop=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.round=function(e){return+e.toFixed(4)},EJSS_SVGGRAPHICS.Utils.hsl2rgb=function(e){var t,r,n,i=e[0],o=e[1],a=e[2],s=(1-Math.abs(2*a-1))*o,l=i/60,u=s*(1-Math.abs(l%2-1));void 0===i||isNaN(i)||null===i?t=r=n=0:l>=0&&1>l?(t=s,r=u,n=0):l>=1&&2>l?(t=u,r=s,n=0):l>=2&&3>l?(t=0,r=s,n=u):l>=3&&4>l?(t=0,r=u,n=s):l>=4&&5>l?(t=u,r=0,n=s):l>=5&&6>l&&(t=s,r=0,n=u);var g,c,S,f=a-s/2;return g=255*(t+f),c=255*(r+f),S=255*(n+f),g=Math.round(g),c=Math.round(c),S=Math.round(S),{r:g,g:c,b:S}},EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker=function(e){function t(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function r(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function n(e,t,r,n,i,o,a){u=4*(t+r*e.width),e.data[u+0]=n,e.data[u+1]=i,e.data[u+2]=o,e.data[u+3]=a}for(var i=e.data.params.imageData,o=e.data.params.width,a=e.data.params.height,s=(e.data.params.depth,e.data.params.data),l=e.data.params.colors,u=e.data.id,g=l[0],c=l[l.length-1],S=0;o>S;S++)for(var f=0;a>f;f++){var u=s[S][a-f-1],d=0>u?g:u<l.length?l[u]:c;"undefined"==typeof d&&(d=g),"rgb"==d.substring(0,3)?rgb=t(d):"hsl"==d.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(r(d))),n(i,S,f,rgb.r,rgb.g,rgb.b,255)}self.postMessage({result:i,id:u})},EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker=function(e,t,r,n,i,o){function a(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function s(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function l(e,t,r,n,i,o,a){f=4*(t+r*e.width),e.data[f+0]=n,e.data[f+1]=i,e.data[f+2]=o,e.data[f+3]=a}for(var u=o[0],g=o[o.length-1],c=0;t>c;c++)for(var S=0;r>S;S++){var f=i[c][r-S-1],d=0>f?u:f<o.length?o[f]:g;"undefined"==typeof d&&(d=u),"rgb"==d.substring(0,3)?rgb=a(d):"hsl"==d.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(s(d))),l(e,c,S,rgb.r,rgb.g,rgb.b,255)}},EJSS_SVGGRAPHICS.Utils.PNGCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d"),l=s.createImageData(e,t);EJSS_TOOLS.Worker.runFunction?EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){s.putImageData(e.result,0,0),o(a.toDataURL())}):(EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker(l,e,t,r,n,i),s.putImageData(l,0,0),o(a.toDataURL()))},EJSS_SVGGRAPHICS.Utils.ImageDataCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d"),l=s.createImageData(e,t);EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},function(e){o(e)})};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.video=function(e,t){};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.wheel=function(e,t){};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.SvgGraphics={},EJSS_GRAPHICS.svgGraphics=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InfoText={},EJSS_DRAWING2D.infoText=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Mesh={},EJSS_DRAWING2D.mesh=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Pipe={},EJSS_DRAWING2D.pipe=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PlottingPanel={},EJSS_DRAWING2D.plottingPanel=function(e,t){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Polygon={},EJSS_DRAWING2D.polygon=function(e){},EJSS_DRAWING2D.PolygonSet={},EJSS_DRAWING2D.polygonSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Segment={},EJSS_DRAWING2D.segment=function(e){},EJSS_DRAWING2D.SegmentSet={},EJSS_DRAWING2D.segmentSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Shape={},EJSS_DRAWING2D.shape=function(e){},EJSS_DRAWING2D.ShapeSet={},EJSS_DRAWING2D.shapeSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SimplePanel={GRAPHICS2D_SVG:"SVG",GRAPHICS2D_CANVAS:"Canvas",registerProperties:function(e,t){t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS)}},EJSS_DRAWING2D.simplePanel=function(e){var t={},r=EJSS_GRAPHICS.svgGraphics(e),n=EJSS_DRAWING2D.style(e),i=[],o=!1,a=[],s={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,xorigin:0,yorigin:0,xscale:1,yscale:1},l=!0,u=!0;return t.getName=function(){return e},t.getGraphics=function(){return r},t.importGraphics=function(e){return r.importSVG(e)},t.getStyle=function(){return n},t.setGraphics=function(t){t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_CANVAS?console.log("WARNING: setGraphics() - Canvas not supported"):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==s.xminPreferred&&(s.xminPreferred=e,u=!0)},t.getWorldXMin=function(){return s.xminPreferred},t.setWorldXMax=function(e){e!==s.xmaxPreferred&&(s.xmaxPreferred=e,u=!0)},t.getWorldXMax=function(){return s.xmaxPreferred},t.setWorldYMin=function(e){e!==s.yminPreferred&&(s.yminPreferred=e,u=!0)},t.getWorldYMin=function(){return s.yminPreferred},t.setWorldYMax=function(e){e!==s.ymaxPreferred&&(s.ymaxPreferred=e,u=!0)},t.getWorldYMax=function(){return s.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.addElement=function(e,r){EJSS_TOOLS.addToArray(i,e,r),e.setPanel(t),e.dataCollected&&a.push(e),o=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(i,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(a,e),o=!0},t.getElements=function(){return i},t.indexOfElement=function(e){return i.indexOf(e)},t.toPixelAxisY=function(e){return s.yorigin-e-s.yscale*s.yminPreferred},t.toPixelAxisX=function(e){return s.xorigin+e-s.xscale*s.xminPreferred},t._26=function(e){var t=[];return t[0]=s.xorigin+s.xscale*(e[0]-s.xminPreferred),t[1]=s.yorigin+s.yscale*(e[1]-s.yminPreferred),t},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*s.xscale,t[1]=e[1]*s.yscale,t},t.toPanelPosition=function(e){var t=[];return t[0]=s.xminPreferred+(e[0]-s.xorigin)/s.xscale,t[1]=s.yminPreferred+(e[1]-s.yorigin)/s.yscale,t},t.toPanelMod=function(e){var t=[];return t[0]=0==s.xscale?0:e[0]/s.xscale,t[1]=0==s.yscale?0:e[1]/s.yscale,t},t.getPixelPositionWorldOrigin=function(){return[s.xorigin,s.yorigin]},t._27=function(){var e=r.getWidth(),t=r.getHeight(),n=e/(s.xmaxPreferred-s.xminPreferred),i=t/(s.ymaxPreferred-s.yminPreferred);s.xscale=n,s.yscale=-i,s.xorigin=.5,s.yorigin=t+.5,u=!1},t.reset=function(){r.reset()},t.render=function(){var e=!1;o&&(r.reset(),e=!0,o=!1);for(var n=0,s=a.length;s>n;n++)a[n].dataCollected();u&&t._27(),
(l||e)&&r.drawPanel(t),r.draw(i,e),l=!1;for(var n=0,s=i.length;s>n;n++)i[n].setChanged(!1)},t.registerProperties=function(e){EJSS_DRAWING2D.SimplePanel.registerProperties(t,e)},n.setLineColor("black"),n.setFillColor("rgb(239,239,255)"),n.setChangeListener(function(e){l=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Spring={},EJSS_DRAWING2D.spring=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SpringSet={},EJSS_DRAWING2D.springSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Tank={},EJSS_DRAWING2D.tank=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Text={},EJSS_DRAWING2D.text=function(e){},EJSS_DRAWING2D.TextSet={},EJSS_DRAWING2D.textSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trace={},EJSS_DRAWING2D.trace=function(e){},EJSS_DRAWING2D.TraceSet={},EJSS_DRAWING2D.traceSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trail={},EJSS_DRAWING2D.trail=function(e){},EJSS_DRAWING2D.TrailSet={},EJSS_DRAWING2D.trailSet=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.colorCoded=function(e,t){var r=EJSS_DRAWING2D.colorMapper(e,t),n=!1;return r.setSymmetricZ=function(e){n=e},r.isSymmetricZ=function(){return n},r.setAutoscale=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;a>o;o++){var s=e[o];i=Math.max(i,s),t=Math.min(t,s)}var l=i,u=t;n&&(l=Math.max(Math.abs(t),Math.abs(i)),u=-l),r.setScale(u,l)},r.setAutoscaleArray2=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;a>o;o++)for(var s=0,l=e[o].length;l>s;s++){var u=e[o][s];i=Math.max(i,u),t=Math.min(t,u)}var g=i,c=t;n&&(g=Math.max(Math.abs(t),Math.abs(i)),c=-g),r.setScale(c,g)},r.setAutoscaleArray3=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;a>o;o++)for(var s=0,l=e[o].length;l>s;s++)for(var u=0,g=e[o][s].length;g>u;u++){var c=e[o][s][u];i=Math.max(i,c),t=Math.min(t,c)}var S=i,f=t;n&&(S=Math.max(Math.abs(t),Math.abs(i)),f=-S),r.setScale(f,S)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ColorMapper={CUSTOM:-1,SPECTRUM:0,GRAYSCALE:1,DUALSHADE:2,RED:3,GREEN:4,BLUE:5,BLACK:6,WIREFRAME:7,NORENDER:8,REDBLUE_SHADE:9,getColorPalette:function(e,t){function r(e,t,r){var n={h:Math.round(360*e),s:t,b:r},i={r:0,g:0,b:0};if(0===n.s)return i.r=i.g=i.b=n.h,i;var o=Math.floor(n.h/60),a=n.h/60-o,s=n.b*(1-n.s),l=n.b*(1-a*n.s),u=n.b*(1-(1-a)*n.s);switch(o){case 0:i.r=n.b,i.g=u,i.b=s;break;case 1:i.r=l,i.g=n.b,i.b=s;break;case 2:i.r=s,i.g=n.b,i.b=u;break;case 3:i.r=s,i.g=l,i.b=n.b;break;case 4:i.r=u,i.g=s,i.b=n.b;break;case 5:i.r=n.b,i.g=s,i.b=l}return i.r=Math.round(255*i.r),i.g=Math.round(255*i.g),i.b=Math.round(255*i.b),i}var n=EJSS_DRAWING2D.ColorMapper,i=[];2>e&&(e=2);for(var o=0;e>o;o++){var a=o/(e-1)*.8,s=1,l=1,u=0,g=0,c=0;switch(t){case n.REDBLUE_SHADE:u=Math.floor(255*Math.max(0,-e-1+2*o)/(e-1)),c=Math.floor(255*Math.max(0,e-1-2*o)/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.SPECTRUM:a=.8-a;var S=r(a,s,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")";break;case n.GRAYSCALE:case n.BLACK:u=g=c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.RED:u=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.GREEN:g=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.BLUE:c=Math.floor(255*o/(e-1)),i[o]="rgb("+u+","+g+","+c+")";break;case n.DUALSHADE:default:var f=o/(e-1);a=.8*(1-f),l=.2+1.6*Math.abs(.5-f);var S=r(a,s,l);i[o]="rgb("+S.r+","+S.g+","+S.b+")"}}return i}},EJSS_DRAWING2D.colorMapper=function(e,t){var r,n,i,o=EJSS_DRAWING2D.ColorMapper,a={},s=[],l="darkgray",u="lightgray",g=-1,c=1;return a.setChangeListener=function(e){r=e},a.setPaletteType=function(t){"string"==typeof t&&(t=EJSS_DRAWING2D.ColorMapper[t.toUpperCase()]),n=t,l="darkgray",u="lightgray",(n==EJSS_DRAWING2D.ColorMapper.GRAYSCALE||n==EJSS_DRAWING2D.ColorMapper.BLACK)&&(l="rgb(64,64,128)",u="rgb(255,191,191)"),e=Math.max(2,e),s=o.getColorPalette(e,n),r&&r("palette")},a.getColors=function(){return s},a.getFloorColor=function(){return l},a.getCeilColor=function(){return u},a.getNumColors=function(){return e},a.setFloorCeilColor=function(e,t){l=e,u=t},a.setScale=function(e,t){g=e,c=t,i=new Array(s.length+1);for(var r=(c-g)/s.length,n=0,o=s.length;o>n;n++)i[n]=g+n*r;i[s.length]=c},a.getPaletteType=function(){return n},a.setColorPalette=function(t){l="darkgray",u="lightgray",s=t,e=t.length,n=EJSS_DRAWING2D.ColorMapper.CUSTOM,r&&r("colors")},a.setNumberOfColors=function(t){if(t!=e){if(e=t,n==EJSS_DRAWING2D.ColorMapper.CUSTOM){for(var i=[],o=0,s=Math.min(colors.length,e);s>o;o++)i[o]=colors[o];for(var o=colors.length;o<numColors;o++)i[o]=colors[colors.length-1];colors=i}else a.setPaletteType(n);r&&r("numColors")}},a.getNumberOfColors=function(){return e},a.doubleToIndex=function(e){if(g-e>Number.MIN_VALUE)return-1;if(e-c>Number.MIN_VALUE)return s.length;var t=0;return c!=g&&(t=Math.floor(s.length*(e-g)/(c-g))),t=Math.max(0,t),Math.min(t,s.length-1)},a.indexToColor=function(e){return 0>e?l:e>=s.length?u:s[e]},a.doubleToColor=function(e){return a.indexToColor(a.doubleToIndex())},a.getColorThresholds=function(){return i},a.setPaletteType(t),a.setScale(-1,1),a};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Font={FONTSTYLES:["normal","italic","oblique","initial"],FONTWEIGHTS:["normal","lighter","bold","bolder","initial","100","200","300","400","500","600","700","800","900"],copyTo:function(e,t){t.setFontFamily(e.getFontFamily()),t.setFontSize(e.getFontSizeString()),t.setLetterSpacing(e.getLetterSpacing()),t.setOutlineColor(e.getOutlineColor()),t.setFontWeight(e.getFontWeight()),t.setFillColor(e.getFillColor())}},EJSS_DRAWING2D.font=function(e){var t,r={},n="Arial",i="20",o="normal",a="none",s="normal",l="black",u="none";return r.setChangeListener=function(e){t=e},r.setFontFamily=function(e){n!=e&&(n=e,t&&t("fontFamily"))},r.getFontFamily=function(){return n},r.setFontSize=function(e){i!=e&&(i=e,t&&t("fontSize"))},r.getFontSize=function(){var e;return e=isNaN(i)?-1!=i.indexOf("em")?10*+i.substr(0,i.indexOf("em")):-1!=i.indexOf("px")?+i.substr(0,i.indexOf("px")):0:+i},r.getFontSizeString=function(){return i},r.setLetterSpacing=function(e){o!=e&&(o=e,t&&t("letterSpacing"))},r.getLetterSpacing=function(){return o},r.getNumberLetterSpacing=function(){var e;return e=isNaN(o)?-1!=o.indexOf("px")?+o.substr(0,o.indexOf("px")):1:+o},r.setOutlineColor=function(e){a!=e&&(a=e,t&&t("lineColor"))},r.getOutlineColor=function(){return a},r.setFontWeight=function(e){s!=e&&FONTWEIGHTS.indexOf(e)>-1&&(s=e,t&&t("fontWeight"))},r.getFontWeight=function(){return s},r.setFillColor=function(e){l!=e&&(l=e,t&&t("fillColor"))},r.getFillColor=function(){return l},r.setFontStyle=function(e){u!=e&&FONTSTYLES.indexOf(e)>-1&&(u=e,t&&t("fontstyle"))},r.getFontStyle=function(){return u},r.getFont=function(){return u+" "+mLineWidth+" "+i+" "+n},r.setFont=function(e){if(!("string"!=typeof e||e.length<=0)){var t=e.split(" ");u=t[0],s=t[1];var r=t[2].split("/");i=r[0],t[3]&&(n=e.substring(e.indexOf(t[3])))}},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.functionsParser=function(){function e(e){function t(){}return t.prototype=e,new t}function t(e,t,r,n){this.type_=e,this.index_=t||0,this.prio_=r||0,this.number_=void 0!==n&&null!==n?n:0,this.toString=function(){switch(this.type_){case D:return this.number_;case _:case I:case C:return this.index_;case R:return"CALL";default:return"Invalid Token"}}}function r(e,t,r,n){this.tokens=e,this.ops1=t,this.ops2=r,this.functions=n}function n(e){return"string"==typeof e?(T.lastIndex=0,T.test(e)?"'"+e.replace(T,function(e){var t=N[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+e+"'"):e}function i(e,t){return Number(e)+Number(t)}function o(e,t){return e-t}function a(e,t){return e*t}function s(e,t){return e/t}function l(e,t){return e%t}function u(e,t){return""+e+t}function g(e){return-e}function c(e){return Math.random()*(e||1)}function S(e){e=Math.floor(e);for(var t=e;e>1;)t*=--e;return t}function f(e,t){return Math.sqrt(e*e+t*t)}function d(e,t,r){return e?t:r}function E(e){return 0>e?0:1}function p(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:(e=e.slice(),e.push(t),e)}function h(e,t){return e>t?1:0}function m(e,t){return t>e?1:0}function A(e,t){return e==t?1:0}function y(e,t){return e!=t?1:0}function v(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":g,exp:Math.exp},this.ops2={"+":i,"-":o,"*":a,"/":s,"%":l,"^":Math.pow,",":p,"||":u,">":h,"<":m,"==":A,"!=":y},this.functions={random:c,fac:S,min:Math.min,max:Math.max,pyt:f,step:E,pow:Math.pow,atan2:Math.atan2,"if":d},this.consts={E:Math.E,pi:Math.PI,PI:Math.PI}}var P={},D=0,_=1,I=2,C=3,R=4,T=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,N={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};r.prototype={simplify:function(n){n=n||{};var i,o,a,s,l=[],u=[],g=this.tokens.length,c=0;for(c=0;g>c;c++){s=this.tokens[c];var S=s.type_;if(S===D)l.push(s);else if(S===C&&s.index_ in n)s=new t(D,0,0,n[s.index_]),l.push(s);else if(S===I&&l.length>1)o=l.pop(),i=l.pop(),a=this.ops2[s.index_],s=new t(D,0,0,a(i.number_,o.number_)),l.push(s);else if(S===_&&l.length>0)i=l.pop(),a=this.ops1[s.index_],s=new t(D,0,0,a(i.number_)),l.push(s);else{for(;l.length>0;)u.push(l.shift());u.push(s)}}for(;l.length>0;)u.push(l.shift());return new r(u,e(this.ops1),e(this.ops2),e(this.functions))},substitute:function(n,i){i instanceof r||(i=(new v).parse(String(i)));var o,a=[],s=this.tokens.length,l=0;for(l=0;s>l;l++){o=this.tokens[l];var u=o.type_;if(u===C&&o.index_===n)for(var g=0;g<i.tokens.length;g++){var c=i.tokens[g],S=new t(c.type_,c.index_,c.prio_,c.number_);a.push(S)}else a.push(o)}var f=new r(a,e(this.ops1),e(this.ops2),e(this.functions));return f},evaluate:function(e){e=e||{};var t,r,n,i,o=[],a=this.tokens.length,s=0;for(s=0;a>s;s++){i=this.tokens[s];var l=i.type_;if(l===D)o.push(i.number_);else if(l===I)r=o.pop(),t=o.pop(),n=this.ops2[i.index_],o.push(n(t,r));else if(l===C)if(i.index_ in e)o.push(e[i.index_]);else{if(!(i.index_ in this.functions))throw new Error("undefined variable: "+i.index_);o.push(this.functions[i.index_])}else if(l===_)t=o.pop(),n=this.ops1[i.index_],o.push(n(t));else{if(l!==R)throw new Error("invalid Expression");if(t=o.pop(),n=o.pop(),!n.apply||!n.call)throw new Error(n+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?o.push(n.apply(void 0,t)):o.push(n.call(void 0,t))}}if(o.length>1)throw new Error("invalid Expression (parity)");return o[0]},toString:function(e){var t,r,i,o,a=[],s=this.tokens.length,l=0;for(l=0;s>l;l++){o=this.tokens[l];var u=o.type_;if(u===D)a.push(n(o.number_));else if(u===I)r=a.pop(),t=a.pop(),i=o.index_,e&&"^"==i?a.push("Math.pow("+t+","+r+")"):a.push("("+t+i+r+")");else if(u===C)a.push(o.index_);else if(u===_)t=a.pop(),i=o.index_,"-"===i?a.push("("+i+t+")"):a.push(i+"("+t+")");else{if(u!==R)throw new Error("invalid Expression");t=a.pop(),i=a.pop(),a.push(i+"("+t+")")}}if(a.length>1)throw new Error("invalid Expression (parity)");return a[0]},variables:function(){for(var e=this.tokens.length,t=[],r=0;e>r;r++){var n=this.tokens[r];n.type_===C&&-1==t.indexOf(n.index_)&&t.push(n.index_)}return t},toJSFunction:function(e,t){var r=new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }");return r}},P.parse=function(e){return(new v).parse(e)},P.evaluate=function(e,t){return v.parse(e).evaluate(t)},v.Expression=r,v.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:c,fac:S,exp:Math.exp,min:Math.min,max:Math.max,pyt:f,ifelse:d,step:E,pow:Math.pow,atan2:Math.atan2,E:Math.E,pi:Math.PI,PI:Math.PI};var O=1,M=2,b=4,G=8,x=16,L=32,J=64,w=128,k=256;return v.prototype={parse:function(n){this.errormsg="",this.success=!0;var i=[],o=[];this.tmpprio=0;var a=O|G|b|J,s=0;for(this.expression=n,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&a&J?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",s++,this.addfunc(o,i,_)),a=O|G|b|J):this.isComment()||(0===(a&M)&&this.error_parsing(this.pos,"unexpected operator"),s+=2,this.addfunc(o,i,I),a=O|G|b|J);else if(this.isNumber()){0===(a&O)&&this.error_parsing(this.pos,"unexpected number");var l=new t(D,0,0,this.tokennumber);o.push(l),a=M|x|L}else if(this.isString()){0===(a&O)&&this.error_parsing(this.pos,"unexpected string");var l=new t(D,0,0,this.tokennumber);o.push(l),a=M|x|L}else if(this.isLeftParenth())0===(a&G)&&this.error_parsing(this.pos,'unexpected "("'),a&w&&(s+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(o,i,R)),a=O|G|b|J|k;else if(this.isRightParenth()){if(a&k){var l=new t(D,0,0,[]);o.push(l)}else 0===(a&x)&&this.error_parsing(this.pos,'unexpected ")"');a=M|x|L|G|w}else if(this.isComma())0===(a&L)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(o,i,I),s+=2,a=O|G|b|J;else if(this.isConst()){0===(a&O)&&this.error_parsing(this.pos,"unexpected constant");var u=new t(D,0,0,this.tokennumber);o.push(u),a=M|x|L}else if(this.isOp2())0===(a&b)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,I),s+=2,a=G;else if(this.isOp1())0===(a&b)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,_),s++,a=G;else if(this.isVar()){0===(a&O)&&this.error_parsing(this.pos,"unexpected variable");var g=new t(C,this.tokenindex,0,0);o.push(g),a=M|x|L|G|w}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');i.length>0;){var c=i.pop();o.push(c)}return s+1!==o.length&&this.error_parsing(this.pos,"parity"),new r(o,e(this.ops1),e(this.ops2),e(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,r,n){for(var i=new t(n,this.tokenindex,this.tokenprio+this.tmpprio,0);r.length>0&&i.prio_<=r[r.length-1].prio_;)e.push(r.pop());r.push(i)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var r=this.expression.charCodeAt(this.pos);if(!(r>=48&&57>=r||46===r))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e.charAt(i);if(n){switch(o){case"'":r.push("'");break;case"\\":r.push("\\");break;case"/":r.push("/");break;case"b":r.push("\b");break;case"f":r.push("\f");break;case"n":r.push("\n");break;case"r":r.push("\r");break;case"t":r.push("	");break;case"u":var a=parseInt(e.substring(i+1,i+5),16);r.push(String.fromCharCode(a)),i+=4;break;default:throw this.error_parsing(t+i,"Illegal escape sequence: '\\"+o+"'")}n=!1}else"\\"==o?n=!0:r.push(o)}return r.join("")},isString:function(){var e=!1,t="",r=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){var n=this.expression.charAt(this.pos);if("'"==n&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,r),e=!0;break}t+=this.expression.charAt(this.pos),
this.pos++}return e},isConst:function(){var e;for(var t in this.consts){var r=t.length;if(e=this.expression.substr(this.pos,r),t===e)return this.tokennumber=this.consts[t],this.pos+=r,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(61===e){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="=="}else if(33===e){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="!="}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else if(94===e)this.tokenprio=3,this.tokenindex="^";else if(60===e)this.tokenprio=2,this.tokenindex="<";else{if(62!==e)return!1;this.tokenprio=2,this.tokenindex=">"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e?!0:!1},isPositiveSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 43===e?!0:!1},isNegativeSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e?!0:!1},isLeftParenth:function(){var e=this.expression.charCodeAt(this.pos);return 40===e?(this.pos++,this.tmpprio+=10,!0):!1},isRightParenth:function(){var e=this.expression.charCodeAt(this.pos);return 41===e?(this.pos++,this.tmpprio-=10,!0):!1},isComma:function(){var e=this.expression.charCodeAt(this.pos);return 44===e?(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0):!1},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return 32===e||9===e||10===e||13===e?(this.pos++,!0):!1},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0&&e in this.ops1?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0&&e in this.ops2?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&("0">r||r>"9")))break;e+=r}return e.length>0?(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0):!1},isComment:function(){var e=this.expression.charCodeAt(this.pos-1);return 47===e&&42===this.expression.charCodeAt(this.pos)?(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0):!1}},P};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InteractionTarget={ENABLED_FIXED:0,ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,SENSITIVITY_BOTH:0,SENSITIVITY_HORIZONTAL:1,SENSITIVITY_VERTICAL:2,SENSITIVITY_ANY:3,copyTo:function(e,t){t.setMotionEnabled(e.getMotionEnabled()),t.setAffectsGroup(e.getAffectsGroup()),t.setActionCommand(e.getActionCommand()),t.setDataObject(e.getDataObject()),t.setSensitivity(e.getSensitivity())}},EJSS_DRAWING2D.interactionTarget=function(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i={},o=EJSS_DRAWING2D.Element,a=n.ENABLED_NONE,s=!1,l=null,u=null,g=20,c=n.SENSITIVITY_BOTH;return i.getElement=function(){return e},i.getType=function(){return t},i.setMotionEnabled=function(e){"string"==typeof e?(value=n[e.toUpperCase()],a="undefined"==typeof value?n.ENABLED_NONE:value):a=e},i.getMotionEnabled=function(){return a},i.setSensitivityType=function(e){c="string"==typeof e?n[e.toUpperCase()]:e},i.getSensitivityType=function(){return c},i.isEnabled=function(){return a!=n.ENABLED_NONE},i.setPositionOffset=function(e){r=e},i.getPixelPosition=function(){var t=e.getPixelPosition(!0),n=e.getPixelSizes(!0),i=e.getRelativePositionOffset(n),a=t[0]+i[0],s=t[1]+i[1],l=e.getPanel().getInvertedScaleY(),u=o.getRelativePositionOffset(r,n[0],n[1],l);return[a-u[0],s-u[1]]},i.getPosition=function(){var t=e.getAbsolutePosition(!0),n=e.getAbsoluteSize(),i=e.getPanel().getInvertedScaleY(),a=o.getRelativePositionOffset(r,n[0],n[1],i),s=e.getRelativePositionOffset(n),l=t[0]+s[0]-a[0],u=t[1]+s[1]-a[1];return[l,u]},i.setAffectsGroup=function(e){s=e},i.getAffectsGroup=function(){return s},i.setSensitivity=function(e){g=e},i.getSensitivity=function(){return g},i.setActionCommand=function(e){l=e},i.getActionCommand=function(){return l},i.setDataObject=function(e){u=e},i.getDataObject=function(){return u},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PanelInteraction={TARGET_POSITION:0,TARGET_SIZE:1},EJSS_DRAWING2D.panelInteraction=function(e){function t(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i=EJSS_DRAWING2D.PanelInteraction;if(t.getType()===i.TARGET_POSITION){var o=t.getPosition(),a=r[0]-o[0],s=r[1]-o[1];switch(t.getMotionEnabled()){case n.ENABLED_ANY:e.setX(e.getX()+a),e.setY(e.getY()+s),e.getController().propertiesChanged("Position","X","Y");break;case n.ENABLED_X:e.setX(e.getX()+a),e.getController().propertiesChanged("Position","X");break;case n.ENABLED_Y:e.setY(e.getY()+s),e.getController().propertiesChanged("Position","Y")}}else if(t.getType()===i.TARGET_SIZE){var o=t.getPosition(),a=r[0]-o[0],s=r[1]-o[1],l=t.getElement(),u=l.getAbsoluteSize();0===u[0]&&(u[0]=1e-5),0===u[1]&&(u[1]=1e-5);var g=[a/u[0],s/u[1]],c=e.getSize();switch(0===c[0]&&0!==g[0]&&(c[0]=1e-5),0===c[1]&&0!==g[0]&&(c[1]=1e-5),t.getMotionEnabled()){case n.ENABLED_ANY:e.setSizeX(c[0]+c[0]*g[0]),e.setSizeY(c[1]+c[1]*g[1]),e.getController().propertiesChanged("Size","SizeX","SizeY");break;case n.ENABLED_X:e.setSizeX(c[0]+c[0]*g[0]),e.getController().propertiesChanged("Size","SizeX");break;case n.ENABLED_Y:e.setSizeY(c[1]+c[1]*g[1]),e.getController().propertiesChanged("Size","SizeY")}}}function r(t){var r=e.getGraphics().getBox(),n=r.left,i=r.top,o=[];if("undefined"!=typeof t.changedTouches)for(var a=0;a<t.changedTouches.length;a++)o[a]=[],o[a][0]=t.changedTouches[a].pageX-window.pageXOffset-n,o[a][1]=t.changedTouches[a].pageY-window.pageYOffset-i;else o[0]=[],o[0][0]=(t.clientX||t.x)-n,o[0][1]=(t.clientY||t.y)-i;return o}var n={},i=EJSS_DRAWING2D.PanelInteraction,o=!1,a=!1,s=!1,l=[],u=[],g=null,c=!1,S=!1,f=0,d="move",E=0;n.reload=function(){l=[],u=[],g=null,S=!1,f=0,E=0,o=!o,n.setEnabled(!o),a=!a,n.setStopGestures(!a)},n.getPanel=function(){return e},n.getEnabled=function(){return o},n.setStopMoveEvents=function(e){s!=e&&(s=e,s?n.setHandler("move",function(){return!0}):n.setHandler("move",n.handleMouseMoveEvent))},n.setStopGestures=function(e){a!=e&&(a=e,a?(n.setHandler("gesturestart",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gesturechange",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.setHandler("gestureend",function(e){return e.preventDefault(),e.stopPropagation(),!1})):(n.setHandler("gesturestart",function(){return!0}),n.setHandler("gesturechange",function(){return!0}),n.setHandler("gestureend",function(){return!0})))},n.setEnabled=function(e){o!=e&&(o=e,o?(s||n.setHandler("move",n.handleMouseMoveEvent),n.setHandler("down",n.handleMouseDownEvent),n.setHandler("up",n.handleMouseUpEvent)):(n.setHandler("move",function(){return!0}),n.setHandler("down",function(){return!0}),n.setHandler("up",function(){return!0})))},n.setCursorTypeForMove=function(e){d=e},n.getInteractionPoint=function(){return l},n.getInteractionBounds=function(){return 0==u.length||0==l.length?[]:[u[0],l[0],u[1],l[1]]},n.getInteractionElement=function(){return g},n.getOrientation=function(){return window.orientation},n.handleMouseMoveEvent=function(i){a&&(i.preventDefault(),i.stopPropagation());var s=r(i);if(l=e.toPanelPosition(s[s.length-1]),S)if(null!=g){var u=g.getAffectsGroup()?g.getElement().getGroup():g.getElement();t(u,g,l),u.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else if(c)o&&e.getController().invokeAction("OnDrag");else for(var f=0;f<s.length;f++){var E=n.findInteractionTarget(e.getElements(),s[f]);if(null!=E){var u=E.getAffectsGroup()?E.getElement().getGroup():E.getElement(),p=e.toPanelPosition(s[f]);t(u,E,p),u.getController().invokeAction("OnDrag"),o&&e.getController().invokeAction("OnMove")}else o&&e.getController().invokeAction("OnDrag")}else{var E=n.findInteractionTarget(e.getElements(),s[0]);null===E?(null!=g&&g.getElement().getController().invokeAction("OnExit"),o&&e.getController().invokeAction("OnMove"),i.target.style.cursor="default"):(g!=E&&(null!=g&&g.getElement().getController().invokeAction("OnExit"),E.getElement().getController().invokeAction("OnEnter")),E.isEnabled()?i.target.style.cursor=d:i.target.style.cursor="default"),g=E}return e.getController().reportInteractions(),!1},n.handleMouseDownEvent=function(t){S=!0,s&&n.setHandler("move",n.handleMouseMoveEvent),a&&(t.preventDefault(),t.stopPropagation());var i=r(t);u=e.toPanelPosition(i[0]),l=e.toPanelPosition(i[i.length-1]);for(var f=!1,E=null,p=0;p<i.length;p++)E=n.findInteractionTarget(e.getElements(),i[p]),null!==E?(E.getElement().getController().invokeAction("OnPress"),t.target.style.cursor=d):o&&(e.getController().invokeAction("OnPress"),f=!0);var h="undefined"!=typeof t.touches?t.touches.length:1;return 1==i.length&&1==h?(g=E,c=f):(g=null,c=!1),e.getController().reportInteractions(),!1},n.handleMouseUpEvent=function(t){S=!1,s&&n.setHandler("move",function(){return!0}),a&&(t.preventDefault(),t.stopPropagation());var i=r(t);if(l=e.toPanelPosition(i[i.length-1]),null!=g)g.getElement().getController().invokeAction("OnRelease");else for(var u=0;u<i.length;u++){var c=n.findInteractionTarget(e.getElements(),i[u]);null!==c?c.getElement().getController().invokeAction("OnRelease"):o&&e.getController().invokeAction("OnRelease")}return t.timeStamp-f<500&&e.getController().invokeAction("OnDoubleClick"),f=t.timeStamp,t.target.style.cursor="default",e.getController().reportInteractions(),!1},n.findInteractionTarget=function(t,r){for(var o=EJSS_DRAWING2D.InteractionTarget,a=null,s=t.length-1;s>=0;s--){var l=t[s];if(l.isGroupVisible())if(l.getElements){if(a=n.findInteractionTarget(l.getElements(),r),null!==a)return a}else{for(var u=l.getInteractionTargets(),g=0;g<u.length;g++)if(u[g].isEnabled()){var c=u[g].getSensitivity();if(c>0){var S=u[g].getPixelPosition(),f=!1;switch(u[g].getSensitivityType()){case o.SENSITIVITY_HORIZONTAL:f=Math.abs(S[1]-r[1])<c;break;case o.SENSITIVITY_VERTICAL:f=Math.abs(S[0]-r[0])<c;break;case o.SENSITIVITY_ANY:f=Math.abs(S[0]-r[0])<c||Math.abs(S[1]-r[1])<c;break;default:f=Math.abs(S[0]-r[0])<c&&Math.abs(S[1]-r[1])<c}if(f)return E=s,u[g]}}if(a=l.getInteractionTarget(i.TARGET_POSITION),a.isEnabled()&&!a.getSensitivity()){var d=l.getBounds(),p=e.toPanelPosition(r);if(d.left<p[0]&&d.right>p[0]&&d.bottom<p[1]&&d.top>p[1])return E=s,a}}}return null},n.getIndexElement=function(){return E},n.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"gesturestart":i.addEventListener("gesturestart",r,!1);break;case"gesturechange":i.addEventListener("gesturechange",r,!1);break;case"gestureend":i.addEventListener("gestureend",r,!1)}return!1};var p=window.onorientationchange;window.onorientationchange=function(){p&&p(),e.getController().invokeAction("OnOrientationChange"),e.getController().reportInteractions()};var h=window.onresize;return window.onresize=function(){h&&h(),e.getController().invokeAction("OnResize"),e.getController().reportInteractions()},n.setStopGestures(!0),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Style={RENDER_AUTO:"auto",RENDER_OPTSPEED:"optimizeSpeed",RENDER_CRISPEDGES:"crispEdges",RENDER_GEOPRECISION:"geometricPrecision",copyTo:function(e,t){t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setAttributes(e.getAttributes()),t.setShapeRendering(e.getShapeRendering())}},EJSS_DRAWING2D.style=function(e){var t,r=EJSS_DRAWING2D.Style,n={},i=!0,o="black",a=.5,s=!0,l="none",u=r.RENDER_AUTO,g={};return n.setChangeListener=function(e){t=e},n.setDrawLines=function(e){e!=i&&(i=e,t&&t("drawlines"))},n.getDrawLines=function(){return i},n.setLineColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=o&&(o=e,t&&t("linecolor")),n},n.getLineColor=function(){return o},n.setLineWidth=function(e){e!=a&&(a=e,t&&t("linewidth"))},n.getLineWidth=function(){return a},n.setDrawFill=function(e){e!=s&&(s=e,t&&t("drawfill"))},n.getDrawFill=function(){return s},n.setFillColor=function(e){"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=l&&(l=e,t&&t("fillcolor"))},n.getFillColor=function(){return l},n.setShapeRendering=function(e){"RENDER"==e.substring(0,6)&&(e=r[e.toUpperCase()]),u!=e&&(u=e,t&&t("shaperendering"))},n.getShapeRendering=function(){return u},n.setAttributes=function(e){e!=g&&(g=e,t&&t("attributes"))},n.getAttributes=function(){return g},n.serialize=function(){return{mDrawLines:i,mLineColor:o,mLineWidth:a,mDrawFill:s,mFillColor:l,mShapeRendering:u,mAttributes:g}},n.unserialize=function(e){i=e.mDrawLines,o=e.mLineColor,a=e.mLineWidth,s=e.mDrawFill,l=e.mFillColor,u=e.mShapeRendering,g=e.mAttributes},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Transformation={compare:function(e,t){return e.radians==t.radians&&e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.e==t.e&&e.f==t.f}},EJSS_DRAWING2D.transformation=function(e){e=e||{a:1,b:0,c:0,d:1,e:0,f:0};var t={a:e.a,c:e.c,e:e.e,b:e.b,d:e.d,f:e.f,radians:0};return t.toString=function(){return"a="+t.a+", c="+t.c+", e="+t.e+"\nb="+t.b+", d="+t.d+", f="+t.f},t.setToIdentity=function(){t.a=1,t.c=0,t.e=0,t.b=0,t.d=1,t.f=0,radians=0},t.setTransform=function(e){Array.isArray(e)&&e.length>5?(t.a=e[0],t.c=e[2],t.e=e[4],t.b=e[1],t.d=e[3],t.f=e[5]):(t.a=e.a,t.c=e.c,t.e=e.e,t.b=e.b,t.d=e.d,t.f=e.f,t.radians=e.radians)},t.setToTranslation=function(e,r){t.a=1,t.c=0,t.e=e,t.b=0,t.d=1,t.f=r},t.setToRotation=function(e){var r=Math.cos(e),n=Math.sin(e);t.a=r,t.c=-n,t.e=0,t.b=n,t.d=r,t.f=0,t.radians=e},t.getRotation=function(){return t.radians},t.translate=function(e,r){t.e+=e,t.f+=r},t.scale=function(e,r){t.a*=e,t.b*=e,t.c*=r,t.d*=r},t.concatenate=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f;t.a=r*e.a+i*e.b,t.b=n*e.a+o*e.b,t.c=r*e.c+i*e.d,t.d=n*e.c+o*e.d,t.e=r*e.e+i*e.f+a,t.f=n*e.e+o*e.f+s,t.radians+=e.radians},t.transform=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n+t.e,e[1]=t.b*r+t.d*n+t.f,e},t.transformVector=function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n,e[1]=t.b*r+t.d*n,e},t.inverseTransform=function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f,l=r*o-n*i;if(0===l)return null;var u=e[0],g=e[1];return e[0]=(o*u-i*g+(i*s-o*a))/l,e[1]=(-n*u+r*g+(n*a-r*s))/l,e},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Video={},EJSS_DRAWING2D.video=function(e){};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.WebCamImage={},EJSS_DRAWING2D.webCamImage=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticCurve={},EJSS_DRAWING3D.analyticCurve=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticSurface={},EJSS_DRAWING3D.analyticSurface=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Arrow={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setHeadHeight(e.getHeadHeight()),t.setHeadWidth(e.getHeadWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("HeadHeight",e.setHeadHeight),t.registerProperty("HeadWidth",e.setHeadWidth)}},EJSS_DRAWING3D.arrow=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=0,i=0,o=1,a=1,s=1,l=8,u=20;return t._23=function(){return"ElementArrow"},t.setHeadHeight=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.getHeadHeight=function(){return l},t.setHeadWidth=function(e){u!=e&&(u=wh,t.setMeshChanged(!0))},t.getHeadWidth=function(){return u},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getY=function(){return n},t.setZ=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getZ=function(){return i},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,n,i]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return a},t.getSizeZ=function(){return s},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.registerProperties=function(e){EJSS_DRAWING3D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Arrow.copyTo(t,e)},t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!0),t.getStyle().setLineWidth(3),t.setResolution([10,2]),t},EJSS_DRAWING3D.ArrowSet={},EJSS_DRAWING3D.arrowSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Basic={},EJSS_DRAWING3D.basic=function(e){},EJSS_DRAWING3D.BasicSet={},EJSS_DRAWING3D.basicSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Box={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setReduceZby(e.getReduceZby())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("ReduceZby",e.setReduceZby)}},EJSS_DRAWING3D.box=function(e){var t=EJSS_DRAWING3D.element(e),r=0;return t._23=function(){return"ElementBox"},t.setReduceZby=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getReduceZby=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Box.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Box.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BoxSet={},EJSS_DRAWING3D.boxSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cone={},EJSS_DRAWING3D.cone=function(e){},EJSS_DRAWING3D.ConeSet={},EJSS_DRAWING3D.coneSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cylinder={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU)}},EJSS_DRAWING3D.cylinder=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=1,o=1;return t._23=function(){return"ElementCylinder"},t.setOriginAndEnd=function(e,r){var n=(e[0]+r[0])/2,i=(e[1]+r[1])/2,o=(e[2]+r[2])/2,a=r[0]-e[0],s=r[1]-e[1],l=r[2]-e[2],u=Math.sqrt(a*a+s*s+l*l),g=Math.acos(l/u);t.setPosition([n,i,o]),t.setSizeZ(u),t.setFirstTransformation([[g,-s,a,0,n,i,o]])},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Cylinder.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cylinder.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.CylinderSet={},EJSS_DRAWING3D.cylinderSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Disk={},EJSS_DRAWING3D.disk=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.DrawingPanel={GRAPHICS3D_WEBGL:"WebGL",registerProperties:function(e,t){e.setController(t),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("MinimumZ",e.setWorldZMin,e.getWorldZMin),t.registerProperty("MaximumZ",e.setWorldZMax,e.getWorldZMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("CameraAzimuth",e.setCamAzimuth,e.getCamAzimuth),t.registerProperty("CameraAltitude",e.setCamAltitude,e.getCamAltitude),t.registerProperty("CameraX",e.setCamLocX,e.getCamLocX),t.registerProperty("CameraY",e.setCamLocY,e.getCamLocY),t.registerProperty("CameraZ",e.setCamLocZ,e.getCamLocZ),t.registerProperty("CameraLocation",e.setCamLoc,e.getCamLoc),t.registerProperty("CameraFocusX",e.setCamFocusX,e.getCamFocusX),t.registerProperty("CameraFocusY",e.setCamFocusY,e.getCamFocusY),
t.registerProperty("CameraFocusZ",e.setCamFocusZ,e.getCamFocusZ),t.registerProperty("CameraFocus",e.setCamFocus,e.getCamFocus),t.registerProperty("Perspective",e.setFOV,e.getFOV),t.registerProperty("FieldOfView",e.setFOV,e.getFOV),t.registerProperty("CameraNear",e.setNear,e.getNear),t.registerProperty("CameraFar",e.setFar,e.getFar),t.registerProperty("Lights",e.setLights,e.getLights),t.registerProperty("DecorationType",e.setDecorationType),t.registerProperty("VisibleDecorationBox",e.setVisibleDecorationBox),t.registerProperty("VisibleDecorationAxis",e.setVisibleDecorationAxis),t.registerProperty("VisibleDecorationBasicAxis",e.setVisibleDecorationBasicAxis),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Draggable",e.setDraggable),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineColor",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineWidth",e.getGraphics().getStyle().setBorderWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint),t.registerAction("OnPress",e.getInteraction().getInteractionPoint),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds),t.registerAction("OnZoom",e.getInteraction().getZoomDelta,e.getOnZoomHandler)}},EJSS_DRAWING3D.drawingPanel=function(e){var t,r={},n=EJSS_GRAPHICS.webGLGraphics(e),i=EJSS_DRAWING3D.style(e),o=[],a=[],s=!0,l=1,u=!1,g=[],c={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,zminPreferred:-1,zmaxPreferred:1},S=!0,f=!0,d={location:new Vector(4,0,0),focus:new Vector(0,0,0),azimuth:0,altitude:0},E=45,p=1,h=1e4,m=1,A=1,y=1,v=[[1,2,3]],P=!0,D=!0,_={propertiesChanged:function(){},invokeAction:function(){}};r.getName=function(){return e},r.getGraphics=function(){return n},r.supportsWebGL=function(){return n.supportsWebGL()},r.getStyle=function(){return i},r.setGraphics=function(t){t==EJSS_DRAWING3D.DrawingPanel.GRAPHICS3D_WEBGL?n=EJSS_GRAPHICS.webGLGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported")},r.setWorldXMin=function(e){e!==c.xminPreferred&&(c.xminPreferred=e,D=!0)},r.getWorldXMin=function(){return c.xminPreferred},r.setWorldXMax=function(e){e!==c.xmaxPreferred&&(c.xmaxPreferred=e,D=!0)},r.getWorldXMax=function(){return c.xmaxPreferred},r.setWorldYMin=function(e){e!==c.yminPreferred&&(c.yminPreferred=e,D=!0)},r.getWorldYMin=function(){return c.yminPreferred},r.setWorldYMax=function(e){e!==c.ymaxPreferred&&(c.ymaxPreferred=e,D=!0)},r.getWorldYMax=function(){return c.ymaxPreferred},r.setWorldZMin=function(e){e!==c.zminPreferred&&(c.zminPreferred=e,D=!0)},r.getWorldZMin=function(){return c.zminPreferred},r.setWorldZMax=function(e){e!==c.zmaxPreferred&&(c.zmaxPreferred=e,D=!0)},r.getWorldZMax=function(){return c.zmaxPreferred},r.setWorldCoordinates=function(e){r.setWorldXMin(e[0]),r.setWorldXMax(e[1]),r.setWorldYMin(e[2]),r.setWorldYMax(e[3]),r.setWorldZMin(e[4]),r.setWorldZMax(e[5])},r.getWorldCoordinates=function(){return[r.getWorldXMin(),r.getWorldXMax(),r.getWorldYMin(),r.getWorldYMax(),r.getWorldZMin(),r.getWorldZMax()]},r.getCamLocX=function(){return d.location.getx()},r.getCamLocY=function(){return d.location.gety()},r.getCamLocZ=function(){return d.location.getz()},r.getCamLoc=function(){return d.location.toArray()},r.setCamLocX=function(e){d.location.getx()!=e&&(d.location.setx(e),S=!0),f=!1},r.setCamLocY=function(e){d.location.gety()!=e&&(d.location.sety(e),S=!0),f=!1},r.setCamLocZ=function(e){d.location.getz()!=e&&(d.location.setz(e),S=!0),f=!1},r.setCamLoc=function(e){r.setCamLocX(e[0]),r.setCamLocY(e[1]),r.setCamLocZ(e[2])},r.setCamAzimuth=function(e){d.azimuth!=e&&(d.azimuth=e,S=!0)},r.getCamAzimuth=function(){return d.azimuth},r.setCamAltitude=function(e){d.altitude!=e&&(d.altitude=e,S=!0)},r.getCamAltitude=function(){return d.altitude},r.getCamFocusX=function(){return d.focus.getx()},r.getCamFocusY=function(){return d.focus.gety()},r.getCamFocusZ=function(){return d.focus.getz()},r.getCamFocus=function(){d.focus.toArray()},r.setCamFocusX=function(e){d.focus.getx()!=e&&(d.focus.setx(e),S=!0),f=!1},r.setCamFocusY=function(e){d.focus.gety()!=e&&(d.focus.sety(e),S=!0),f=!1},r.setCamFocusZ=function(e){d.focus.getz()!=e&&(d.focus.setz(e),S=!0),f=!1},r.setCamFocus=function(e){r.setCamFocusX(e[0]),r.setCamFocusY(e[1]),r.setCamFocusZ(e[2])},r.setLights=function(e){v=e,D=!0},r.getLights=function(){return v},r.setSizeX=function(e){m!==e&&(m=e,D=!0)},r.getSizeX=function(){return m},r.setSizeY=function(e){A!==e&&(A=e,D=!0)},r.getSizeY=function(){return A},r.setSizeZ=function(e){y!==e&&(y=e,D=!0)},r.getSizeZ=function(){return y},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setImageUrl=function(e){u=!0,null!=r.getResourcePath?e=r.getResourcePath(e):console.log("No getResourcePath function for panel. Texture="+e),r.getGraphics().getStyle().setBackgroundImage(e)},r.isImageUrl=function(){return u},r.addDecoration=function(e,t){return EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(r),r},r.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),e.setPanel&&e.setPanel(null),r},r.setVisibleDecorationBasicAxis=function(e){N.setVisible(e),O.setVisible(e),M.setVisible(e)},r.setVisibleDecorationAxis=function(e){C.setVisible(e),R.setVisible(e),T.setVisible(e)},r.setVisibleDecorationBox=function(e){I.setVisible(e)},r.setDecorationType=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"AXES":e=1;break;case"CUBE":e=2;break;case"CENTERED_AXES":e=3}switch(e){case 0:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 1:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!0);break;default:case 2:r.setVisibleDecorationBox(!0),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 3:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!0),r.setVisibleDecorationAxis(!1)}},r.addElement=function(e,t){EJSS_TOOLS.addToArray(a,e,t),e.setPanel(r),e.dataCollected&&g.push(e),s=!0},r.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(g,e),s=!0},r.getElements=function(){return a},r.indexOfElement=function(e){return a.indexOf(e)},r.getFOV=function(){return E},r.setFOV=function(e){E!==e&&(E=e,D=!0)},r.getFar=function(){return h},r.setFar=function(e){h!==e&&(h=e,D=!0)},r.getNear=function(){return p},r.setNear=function(e){p!==e&&(p=e,D=!0)},r.reset=function(){n.reset(E,p,h)},r.render=function(){s&&n.reset(E,p,h);for(var e=0,t=g.length;t>e;e++)g[e].dataCollected();if((P||s)&&n.drawPanel(r),D){for(e=0,t=o.length;t>e;e++)o[e].panelChangeListener&&o[e].panelChangeListener("bounds");if(f){var i=new Vector(m,A,y),l=new Vector(c.xminPreferred,c.yminPreferred,c.zminPreferred),u=new Vector(c.xmaxPreferred,c.ymaxPreferred,c.zmaxPreferred);d.focus=u.add(l).divide(2).multiply(i);var v=new Vector(c.xmaxPreferred,c.yminPreferred,c.zminPreferred),_=n.getAspect(),I=(c.ymaxPreferred-c.yminPreferred)*A/_,C=(c.zmaxPreferred-c.zminPreferred)*y*_,R=I>C?I:C,T=1.5*(R/4)/Math.tan(E*Math.PI/360),N=v.subtract(l).unit().multiply(T);d.location=d.focus.add(N)}}n.putCamera(d),n.draw(o),n.draw(a),D=!1,P=!1,S=!1,s=!1;for(var e=0,t=a.length;t>e;e++)a[e].setProjChanged(!1),a[e].setMeshChanged(!1)},r.setEnabled=function(e){t.setEnabled(e)},r.setDraggable=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"ANY":e=1;break;case"AZIMUTH":e=2;break;case"ALTITUDE":e=3}l=e},r.getPanelInteraction=function(){return t},r.getController=function(){return _},r.setController=function(e){_=e},r.getInteraction=function(){return t},r.registerProperties=function(e){EJSS_DRAWING3D.DrawingPanel.registerProperties(r,e)},r.getOnDragHandler=function(){if(l>0){var e=r.getPanelInteraction().getInteractionDeltas();if((2==l||1==l)&&(d.azimuth+=e[0]),3==l||1==l){var t=Math.abs(d.azimuth%360);t>=270||90>=t?d.altitude+=e[1]:d.altitude-=e[1]}}r.getController().propertiesChanged("CameraAzimuth","CameraAltitude"),S=!0},r.getOnZoomHandler=function(){var e=r.getPanelInteraction().getInteractionZoomDelta(),t=d.focus.subtract(d.location);e>0?d.location=d.focus.subtract(t.multiply(1.1)):d.location=d.focus.subtract(t.divide(1.1)),r.getController().propertiesChanged("CameraLocation","CameraX","CameraY","CameraZ"),S=!0},i.setFillColor([.83,.85,1]),i.setMeshChangeListener(function(e){P=!0}),i.setProjChangeListener(function(e){P=!0});var I=EJSS_DRAWING3D.box(e+"box");I.getStyle().setDrawFill(!1),I.getStyle().setDrawLines(!0),I.getStyle().setLineWidth(2),I.getStyle().setLineColor("black"),I.setVisible(!0),I.setSize([2,2,2]),I.panelChangeListener=function(e){if("bounds"==e)var t=(c.xmaxPreferred+c.xminPreferred)/2;var r=(c.ymaxPreferred+c.yminPreferred)/2,n=(c.zmaxPreferred+c.zminPreferred)/2,i=Math.abs(c.xmaxPreferred-c.xminPreferred),o=Math.abs(c.ymaxPreferred-c.yminPreferred),a=Math.abs(c.zmaxPreferred-c.zminPreferred);I.setPosition([t,r,n]),I.setSize([i,o,a])},r.addDecoration(I,0);var C=EJSS_DRAWING3D.arrow(e+"axisX");C.getStyle().setLineWidth(2),C.setColor("red"),C.setVisible(!1),C.panelChangeListener=function(e){"bounds"==e&&C.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.xmaxPreferred-c.xminPreferred);C.setSize([t,0,0])},r.addDecoration(C,0);var R=EJSS_DRAWING3D.arrow(e+"axisY");R.setPosition([0,0,0]),R.setSize([0,1,0]),R.getStyle().setLineWidth(2),R.setColor("green"),R.setVisible(!1),R.panelChangeListener=function(e){"bounds"==e&&R.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.ymaxPreferred-c.yminPreferred);R.setSize([0,t,0])},r.addDecoration(R,0);var T=EJSS_DRAWING3D.arrow(e+"axisZ");T.setPosition([0,0,0]),T.setSize([0,0,1]),T.getStyle().setLineWidth(2),T.setColor("blue"),T.setVisible(!1),T.panelChangeListener=function(e){"bounds"==e&&T.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.zmaxPreferred-c.zminPreferred);T.setSize([0,0,t])},r.addDecoration(T,0);var N=EJSS_DRAWING3D.arrow(e+"baxisX");N.setPosition([0,0,0]),N.setSize([1,0,0]),N.getStyle().setLineWidth(2),N.setColor("red"),N.setVisible(!1),N.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.xmaxPreferred-c.xminPreferred)/2;N.setSize([t,0,0])},r.addDecoration(N,0);var O=EJSS_DRAWING3D.arrow(e+"baxisY");O.setPosition([0,0,0]),O.setSize([0,1,0]),O.getStyle().setLineWidth(2),O.setColor("green"),O.setVisible(!1),O.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.ymaxPreferred-c.yminPreferred)/2;O.setSize([0,t,0])},r.addDecoration(O,0);var M=EJSS_DRAWING3D.arrow(e+"baxisZ");return M.setPosition([0,0,0]),M.setSize([0,0,1]),M.getStyle().setLineWidth(2),M.setColor("blue"),M.setVisible(!1),M.panelChangeListener=function(e){if("bounds"==e)var t=Math.abs(c.zmaxPreferred-c.zminPreferred)/2;M.setSize([0,0,t])},r.addDecoration(M,0),t=EJSS_DRAWING3D.panelInteraction(r),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Element={copyTo:function(e,t){EJSS_DRAWING3D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setSize(e.getSize()),t.setTransformation(e.getTransformation()),t.setExtraTransformation(e.getExtraTransformation()),t.setTextureUrl(e.getTextureUrl()),t.setResolution(e.getResolution()),t.setParent(e.getParent())},registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Z",e.setZ,e.getZ),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("TextureUrl",e.setTextureUrl,e.getTextureUrl),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("AlwaysUpdated",e.setAlwaysUpdated,e.isAlwaysUpdated),t.registerProperty("Transparency",e.getStyle().setTransparency,e.getStyle().getTransparency),t.registerProperty("AmbientColor",e.getStyle().setAmbientColor,e.getStyle().getAmbientColor),t.registerProperty("FillColor",e.getStyle().setFillColor,e.getStyle().getFillColor),t.registerProperty("SpecularColor",e.getStyle().setSpecularColor,e.getStyle().getSpecularColor),t.registerProperty("AmbientReflection",e.getStyle().setAmbientReflection,e.getStyle().getAmbientReflection),t.registerProperty("ColorReflection",e.getStyle().setColorReflection,e.getStyle().getColorReflection),t.registerProperty("SpecularReflection",e.getStyle().setSpecularReflection,e.getStyle().getSpecularReflection),t.registerProperty("Shininess",e.getStyle().setShininessVal,e.getStyle().getShininessVal),t.registerProperty("PaletteFloor",e.getStyle().setPaletteFloor,e.getStyle().getPaletteFloor),t.registerProperty("PaletteCeil",e.getStyle().setPaletteCeil,e.getStyle().getPaletteCeil),t.registerProperty("PaletteFloorColor",e.getStyle().setPaletteFloorColor,e.getStyle().getPaletteFloorColor),t.registerProperty("PaletteCeilColor",e.getStyle().setPaletteCeilColor,e.getStyle().getPaletteCeilColor),t.registerProperty("LineColor",e.getStyle().setLineColor,e.getStyle().getLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth,e.getStyle().getLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines,e.getStyle().getDrawLines),t.registerProperty("DrawFill",e.getStyle().setDrawFill,e.getStyle().getDrawFill),t.registerProperty("ClosedTop",e.getStyle().setClosedTop,e.getStyle().getClosedTop),t.registerProperty("ClosedBottom",e.getStyle().setClosedBottom,e.getStyle().getClosedBottom),t.registerProperty("ClosedLeft",e.getStyle().setClosedLeft,e.getStyle().getClosedLeft),t.registerProperty("ClosedRight",e.getStyle().setClosedRight,e.getStyle().getClosedRight),t.registerProperty("Resolution",e.setResolution),t.registerProperty("Color",e.setColor),t.registerProperty("EnabledPosition",function(e){}),t.registerProperty("MovesGroup",function(e){}),t.registerProperty("EnabledSize",function(e){}),t.registerProperty("ResizesGroup",function(e){}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition),t.registerAction("OnLoadTexture",null,null,function(){e.setProjChanged(!0)})}},EJSS_DRAWING3D.element=function(e){function t(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i.length>4?t.push(i):t.push(i.concat(r.getPosition()))}return t}var r={},n=EJSS_DRAWING3D.Element,i=EJSS_DRAWING3D.style(e),o=!0,a=!0,s="",l=0,u=0,g=0,c=1,S=1,f=1,d=[],E=[],p=[],h=null,m=null,A=null,y=-1,v=!0,P=!0,D=!1,_=20,I=20,C=0,R={propertiesChanged:function(){},invokeAction:function(){}};return r.copyTo=function(e){n.copyTo(r,e)},r.getName=function(){return e.replace(/\[|\]/g,"")},r.setTextureUrl=function(e){var t=null!=A?A.getResourcePath:r.getResourcePath;null!=t?e=t(e):console.log("No getResourcePath function for "+r.getName()+". Texture="+e),s=e},r.getTextureUrl=function(){return s},r.setVisible=function(e){o=e},r.isVisible=function(){return o},r.isGroupVisible=function(){for(var e=m;"undefined"!=typeof e&&null!==e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},r.getStyle=function(){return i},r.setMeasured=function(e){a=e},r.isMeasured=function(){return a},r.setColor=function(e){r.getStyle().setFillColor(e),r.getStyle().setLineColor(e)},r.setResolution=function(e){Array.isArray(e)?(r.setResolutionU(e[0]),r.setResolutionV(e[1]),e[2]&&r.setResolutionR(e[2])):(r.setResolutionU(e),r.setResolutionV(e))},r.getResolution=function(){return[_,I,C]},r.setResolutionU=function(e){_!=e&&(_=e,v=!0)},r.getResolutionU=function(){return _},r.setResolutionV=function(e){I!=e&&(I=e,v=!0)},r.getResolutionV=function(){return I},r.setResolutionR=function(e){C!=e&&(C=e,v=!0)},r.getResolutionR=function(){return C},r.setX=function(e){l!=e&&(l=e,P=!0)},r.getX=function(){return l},r.setY=function(e){u!=e&&(u=e,P=!0)},r.getY=function(){return u},r.setZ=function(e){g!=e&&(g=e,P=!0)},r.getZ=function(){return g},r.setPosition=function(e){r.setX(e[0]),r.setY(e[1]),r.setZ(e[2])},r.getPosition=function(){return[l,u,g]},r.setSizeX=function(e){c!=e&&(c=e,P=!0)},r.getSizeX=function(){return c},r.setSizeY=function(e){S!=e&&(S=e,P=!0)},r.getSizeY=function(){return S},r.setSizeZ=function(e){f!=e&&(f=e,P=!0)},r.getSizeZ=function(){return f},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setPanel=function(e){h=e,P=!0},r.getPanel=function(){return h},r.getGroupPanel=function(){for(var e=r;e.getGroup();)e=e.getGroup();return e.getPanel()},r.setGroup=function(e){m=e,P=!0},r.getGroup=function(){return m},r.setSet=function(e,t){A=e,y=t},r.getSetIndex=function(){return y},r.setParent=function(e){e.render?(r.setGroup(null),e.addElement(r),r.setPanel(e)):"ElementGroup"==e._23()?(r.setGroup(e),r.getGroupPanel().addElement(r),r.setPanel(r.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},r.getParent=function(){var e;return e=null!==m?r.getGroup():r.getPanel()},r.setTransformation=function(e){("undefined"==typeof e||null===e)&&(e=[]),EJSS_TOOLS.compareArrays(d,e)||(d=e,P=!0)},r.setFirstTransformation=function(e){("undefined"==typeof e||null===e)&&(e=[]),EJSS_TOOLS.compareArrays(d,e)||(p=e,P=!0)},r.setExtraTransformation=function(e){E=e},r.getExtraTransformation=function(){return E},r.addExtraTransformation=function(e){"undefined"!=typeof e&&null!==e&&(E.push(e),P=!0)},r.removeExtraTransformation=function(e){if("undefined"!=typeof e&&null!==e)for(var t=0;t<E.length;t++){var r=E[t];if(r===e)return E.splice(t,1),void(P=!0)}},r.getFullTransformation=function(){for(var e=t(p).concat(t(d)),r=0;r<E.length;r++)e.push(E[r].getArray());return e},r.getTransformation=function(){return d},r.getGroupTransformation=function(){for(var e=EJSS_DRAWING3D.transformation(),t=r;"undefined"!=typeof t&&null!==t;)e.concatenate(t.getFullTransformation()),t=t.getGroup();return e},r.isAlwaysUpdated=function(){return D},r.setAlwaysUpdated=function(e){D=e},r.isMeshChanged=function(){return v},r.setMeshChanged=function(e){v=e},r.isProjChanged=function(){return P},r.setProjChanged=function(e){P=e},r.isGroupChanged=function(){for(var e=r.getGroup();"undefined"!=typeof e&&null!==e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},r.getController=function(){return R},r.setController=function(e){R=e},r.registerProperties=function(e){n.registerProperties(r,e)},i.setMeshChangeListener(function(e){v=!0}),i.setProjChangeListener(function(e){P=!0}),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.ElementSet={registerProperties:function(e,t){e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Z",function(t){e.setToEach(function(e,t){e.setZ(t)},t)},function(){return e.getFromEach(function(e){return e.getZ()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("SizeZ",function(t){e.setToEach(function(e,t){e.setSizeZ(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeZ()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("TextureUrl",function(t){e.setToEach(function(e,t){e.setTextureUrl(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("ClosedTop",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedBottom",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedLeft",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedRight",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Resolution",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Color",function(t){e.setToEach(function(e,t){e.setColor(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){},t)});var r=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",r),t.registerAction("OnExit",r),t.registerAction("OnPress",r),t.registerAction("OnDrag",r),t.registerAction("OnRelease",r),t.registerAction("OnLoadTexture",null,null,function(){element.setProjChanged(!0)})}},EJSS_DRAWING3D.elementSet=function(e,t){var r=EJSS_DRAWING3D.group(t),n=EJSS_DRAWING3D.ElementSet,i=[],o=-1,a=[];r.setNumberOfElements=function(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){a=i.splice(t,o);for(var s=0;s<a.length;s++){var l=a[s].getPanel();l&&l.removeElement(a[s])}}else if(0>o){a=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;t>c;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}},r.getElements=function(){return i},r.getLastElements=function(){var e=a.slice();return a=[],e},r.setElementInteracted=function(e){o=e},r.getElementInteracted=function(){return o};var s=r.setPanel;r.setPanel=function(e){s(e);for(var t=0,r=i.length;r>t;t++)i[t].setPanel(e)},r.setProjChanged=function(e){for(var t=0,r=i.length;r>t;t++)i[t].setProjChanged(e)},r.setToEach=function(e,t){if(Array.isArray(t)){1==i.length&&r.setNumberOfElements(t.length);for(var n=0,o=Math.min(i.length,t.length);o>n;n++)e(i[n],t[n])}else for(var n=0,o=i.length;o>n;n++)e(i[n],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;n>r;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var l=e(t+"[0]");return l.setController(r.getController()),l.setSet(r,0),i.push(l),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Ellipsoid={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setMinAngleU(e.getMinAngleU()),t.setMaxAngleU(e.getMaxAngleU()),t.setMinAngleV(e.getMinAngleV()),t.setMaxAngleV(e.getMaxAngleV())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU),t.registerProperty("MinAngleV",e.setMinAngleV),t.registerProperty("MaxAngleV",e.setMaxAngleV)}},EJSS_DRAWING3D.ellipsoid=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=-90,o=90;return t._23=function(){return"ElementEllipsoid"},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setMinAngleV=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMinAngleV=function(){return i},t.setMaxAngleV=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getMaxAngleV=function(){return o},t.copyTo=function(e){EJSS_DRAWING3D.Ellipsoid.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Ellipsoid.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.EllipsoidSet={},EJSS_DRAWING3D.ellipsoidSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Group={},EJSS_DRAWING3D.group=function(e){var t=EJSS_DRAWING3D.element(e);return t._23=function(){return"ElementGroup"},t.isGroup=function(){return!0},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.panelInteraction=function(e){function t(t){var r,n,i=e.getGraphics().getBox(),o=i.left,a=i.top;return"undefined"!=typeof t.changedTouches&&1===t.changedTouches.length?(r=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(r=t.x||t.clientX,n=t.y||t.clientY),[r-o,n-a]}var r={},n=!1,i=[0,0],o=0,a=0,s=!1,l=0,u=0,g=0;return r.getPanel=function(){return e},r.getEnabled=function(){return n},r.setEnabled=function(e){n!=e&&(n=e,n?(r.setHandler("move",r.handleMouseMoveEvent),r.setHandler("down",r.handleMouseDownEvent),r.setHandler("up",r.handleMouseUpEvent),r.setHandler("mousewheel",r.handleMouseWheelEvent),r.setHandler("pinch",r.handlePinchGesture)):(r.setHandler("move",function(){}),r.setHandler("down",function(){}),r.setHandler("up",function(){}),r.setHandler("mousewheel",function(){}),r.setHandler("pinch",function(){})))},r.getInteractionPoint=function(){return i},r.getInteractionDeltas=function(){return[o,a]},r.getInteractionZoomDelta=function(){return u/3},r.handleMouseWheelEvent=function(t){var r="undefined"!=typeof t.touches?t.touches.length:0;0==r&&(t.preventDefault(),u=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},r.handlePinchGesture=function(t){t.timeStamp-l>100&&(t.preventDefault(),t.scale<g?u=1:t.scale>=g&&(u=-1),g=t.scale,e.getController().invokeAction("OnZoom"),e.getController().reportInteractions(),l=t.timeStamp)},r.handleMouseMoveEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;if(1==n){var l=i[0],u=i[1];i=t(r),o=i[0]-l,a=i[1]-u,s?(e.getController().invokeAction("OnDrag"),r.target.style.cursor="move"):r.target.style.cursor="default",e.getController().reportInteractions()}},r.handleMouseDownEvent=function(n){var o="undefined"!=typeof n.touches?n.touches.length:1;1==o&&(s=!0,i=t(n),e.getController().invokeAction("OnPress"),r.pick(i[0],i[1]),n.preventDefault(),e.getController().reportInteractions())},r.handleMouseUpEvent=function(r){var n="undefined"!=typeof r.touches?r.touches.length:1;1==n&&(s=!1,i=t(r),e.getController().invokeAction("OnRelease"),r.target.style.cursor="default",r.timeStamp-l<500&&e.getController().invokeAction("OnDoubleClick"),l=r.timeStamp,e.getController().reportInteractions())},r.setHandler=function(t,r){var n=e.getGraphics(),i=n.getEventContext();switch(t){case"move":i.addEventListener("mousemove",r,!1),i.addEventListener("touchmove",r,!1);break;default:case"down":i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1);break;case"up":i.addEventListener("mouseup",r,!1),i.addEventListener("touchend",r,!1);break;case"mousewheel":i.addEventListener("mousewheel",r,!1);break;case"pinch":i.addEventListener("gesturestart",function(e){g=1},!1),i.addEventListener("gesturechange",r,!1)}return!1},r.pick=function(t,r){var n=t-1,i=r-1,o=1,a=1,s=e.getGraphics().getContext();if(s){var l=new Uint8Array(o*a*4);s.readPixels(n,i,o,a,s.RGBA,s.UNSIGNED_BYTE,l),l.data&&(l=l.data)}},r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Style={copyTo:function(e,t){t.setClosedTop(e.getClosedTop()),t.setClosedBottom(e.getClosedBottom()),t.setClosedLeft(e.getClosedLeft()),t.setClosedRight(e.getClosedRight()),t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setTransparency(e.getTransparency()),t.setAmbientColor(e.getAmbientColor()),t.setFillColor(e.getFillColor()),t.setSpecularColor(e.getSpecularColor()),t.setAmbientReflection(e.getAmbientReflection()),t.setColorReflection(e.getColorReflection()),t.setSpecularReflection(e.getSpecularReflection()),t.setShininessVal(e.getShininessVal()),t.setPaletteFloor(e.getPaletteFloor()),t.setPaletteCeil(e.getPaletteCeil()),t.setPaletteFloorColor(e.getPaletteFloorColor()),t.setPaletteCeilColor(e.getPaletteCeilColor())}},EJSS_DRAWING3D.style=function(e){var t,r,n,i,o={},a=!0,s=!0,l=!0,u=!0,g=[0,0,0],c=.5,S=[0,0,0],f=[0,0,0],d=[1,1,1],E=1,p=1,h=1,m=10,A=[1,0,-1],y=[-1,0,1],v=!1,P=!0,D=0;return o.setProjChangeListener=function(e){n=e},o.setMeshChangeListener=function(e){i=e},o.setClosedTop=function(e){e!=a&&(a=e,i&&i("closedtop"))},o.getClosedTop=function(){return a},o.setClosedBottom=function(e){e!=s&&(s=e,i&&i("closedbottom"))},o.getClosedBottom=function(){return s},o.setClosedLeft=function(e){e!=l&&(l=e,i&&i("closedleft"))},o.getClosedLeft=function(){return l},o.setClosedRight=function(e){e!=u&&(u=e,i&&i("closedright"))},o.getClosedRight=function(){return u},o.setDrawLines=function(e){e!=v&&(v=e,n&&n("drawlines"))},o.getDrawLines=function(){return v},o.setLineColor=function(e){return"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,g)||(g=e.slice(),
n&&n("linecolor")),o},o.getLineColor=function(){return g},o.setLineWidth=function(e){e!=c&&(c=e,n&&n("linewidth"))},o.getLineWidth=function(){return c},o.setDrawFill=function(e){e!=P&&(P=e,n&&n("drawfill"))},o.getDrawFill=function(){return P},o.setFillColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,f)||(f=e.slice(),n&&n("fillcolor"))},o.getFillColor=function(){return f},o.setAmbientColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,S)||(S=e.slice(),n&&n("ambientcolor"))},o.getAmbientColor=function(){return S},o.setSpecularColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,d)||(d=e.slice(),n&&n("specularcolor"))},o.getSpecularColor=function(){return d},o.setAmbientReflection=function(e){E!=e&&(E=e,n&&n("ambientreflection"))},o.getAmbientReflection=function(){return E},o.setColorReflection=function(e){p!=e&&(p=e,n&&n("colorreflection"))},o.getColorReflection=function(){return p},o.setSpecularReflection=function(e){h!=e&&(h=e,n&&n("specularreflection"))},o.getSpecularReflection=function(){return h},o.setShininessVal=function(e){m!=e&&(m=e,n&&n("shininess"))},o.getShininessVal=function(){return m},o.setTransparency=function(e){e!=D&&(D=e,n&&n("transparency"))},o.getTransparency=function(){return D},o.setPaletteFloor=function(e){e&&!EJSS_TOOLS.compareArrays(e,t)&&(t=e.slice(),n&&n("palettefloor"))},o.getPaletteFloor=function(){return t},o.setPaletteCeil=function(e){e&&!EJSS_TOOLS.compareArrays(e,r)&&(r=e.slice(),n&&n("paletteceil"))},o.getPaletteCeil=function(){return r},o.setPaletteFloorColor=function(e){EJSS_TOOLS.compareArrays(e,A)||(A=e.slice(),n&&n("palettefloorcolor"))},o.getPaletteFloorColor=function(){return A},o.setPaletteCeilColor=function(e){EJSS_TOOLS.compareArrays(e,y)||(y=e.slice(),n&&n("paletteceilcolor"))},o.getPaletteCeilColor=function(){return y},o};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Transformation={registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("Axis",e.setAxis,e.getAxis),t.registerProperty("Angle",e.setAngle,e.getAngle),t.registerProperty("Origin",e.setOrigin,e.getOrigin)}},EJSS_DRAWING3D.rotationX=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([1,0,0]),t},EJSS_DRAWING3D.rotationY=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,1,0]),t},EJSS_DRAWING3D.rotationZ=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,0,1]),t},EJSS_DRAWING3D.transformation=function(e){var t={},r=null,n=[0,0,0,1,0,0,0],i={propertiesChanged:function(){},invokeAction:function(){}};return t.getArray=function(){return n},t.setChanged=function(e){e&&r.setProjChanged(!0)},t.setParent=function(e){r&&r.removeExtraTransformation(t),r=e,r&&r.addExtraTransformation(t)},t.getParent=function(){return r},t.setAngle=function(e){n[0]=e},t.getAngle=function(){return n[0]},t.setAxis=function(e){n[1]=e[0],n[2]=e[1],n[3]=e[2]},t.getAxis=function(){return n.slice(1,4)},t.setOrigin=function(e){n[4]=e[0],n[5]=e[1],n[6]=e[2]},t.getOrigin=function(){return n.slice(5)},t.getController=function(){return i},t.setController=function(e){i=e},t.registerProperties=function(e){EJSS_DRAWING3D.Transformation.registerProperties(t,e)},t};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticCurve=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticSurface=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.arrow=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=new Vector(t.getSize()),i=(new Vector(t.getPosition()),n.length()),o=t.getResolutionV(),a=t.getResolutionU()+1,s=t.getHeadWidth(),l=t.getHeadHeight(),u=[],g=0;o>g;g++)for(var c=g/(o-1),S=c/s*i,f=0;a>f;f++){var d=f/(a-1),E=S*Math.sin(d*Math.PI*2),p=S*Math.cos(d*Math.PI*2),h=-c/l*i;u.push(new Vector(E,p,h))}var m=n.cross(new Vector(0,0,1));0==m.length()&&(m.y=1);var A=n.angle(new Vector(0,0,1)),y=new Matrix;Matrix.rotate(-A,m.x,m.y,m.z,0,0,0,y);for(var v=0;v<u.length;v++){var P=y.transformPoint(u[v]);r.vertices.push(P.add(n).toArray())}r.vertices.push(n.toArray()),r.vertices.push([0,0,0]),r.lines.push([r.vertices.length-1,r.vertices.length-2]);for(var g=0;o-1>g;g++)for(var f=0;a-1>f;f++){var D=g*a+f,_=(g+1)*a+f,I=(g+1)*a+f+1,C=g*a+f+1;r.triangles.push([I,_,D]),r.triangles.push([C,I,D]),r.lines.push([I,_]),r.lines.push([C,I]),r.lines.push([D,C])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.basic=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.box=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],i=[[0,0],[1,0],[0,1],[1,1]],o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],a=[[0,2,4,6],[1,3,5,7],[0,4,1,5],[2,6,3,7],[0,2,1,3],[4,6,5,7]],s=t.getStyle().getClosedTop(),l=t.getStyle().getClosedBottom(),u=t.getStyle().getClosedRight(),g=t.getStyle().getClosedLeft(),c=t.getReduceZby(),S=0;S<a.length;S++){for(var f=a[S],d=4*S,E=0;4>E;E++){var p=f[E];6==p||7==p?r.vertices.push([n[p][0],n[p][1],n[p][2]-2*c]):r.vertices.push(n[p]),r.coords.push(i[E]),r.normals.push(o[S])}2==S&&!g||3==S&&!u||4==S&&!s||5==S&&!l||(r.triangles.push([d,d+1,d+2]),r.triangles.push([d+2,d+1,d]),r.triangles.push([d+2,d+1,d+3]),r.triangles.push([d+3,d+1,d+2])),r.lines.push([d,d+1]),r.lines.push([d,d+2]),r.lines.push([d+2,d+3]),r.lines.push([d+1,d+3])}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.cylinder=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getResolutionV(),i=t.getResolutionU()+1,o=t.getRadiusTop(),a=t.getRadiusBottom(),s=t.getMinAngleU(),l=t.getMaxAngleU(),u=0,g=0,c=0;n>c;c++){var S=c/(n-1),f=S*(a-o)+o;g=Math.floor(s*i/360),u=Math.floor(l*i/360);for(var d=g;u>d;d++){var E=d/(i-1),p=f*Math.sin(E*Math.PI*2),h=f*Math.cos(E*Math.PI*2),m=2*-S+1;r.vertices.push([p,h,m]),r.coords.push([E,S])}}for(var c=0;n>c;c++){var m=-1+c*(2/(n-1));r.vertices.push([0,0,m]),r.coords.push([1,c/(n-1)])}for(var A=u-g,c=0;n-1>c;c++){for(var d=0;A-1>d;d++){var y=c*A+d,v=(c+1)*A+d,P=(c+1)*A+d+1,D=c*A+d+1;r.triangles.push([P,v,y]),r.triangles.push([D,P,y]),r.lines.push([P,v]),r.lines.push([D,P]),r.lines.push([y,D])}if(0!=s||360!=l){var _=r.vertices.length-(c+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([P,D,_-1]),r.triangles.push([D,_,_-1]),r.lines.push([P,_-1]),r.lines.push([D,_]),r.lines.push([_,_-1])),t.getStyle().getClosedRight()){var I=c*A,C=(c+1)*A;r.triangles.push([_-1,I,C]),r.triangles.push([_-1,_,I]),r.lines.push([C,I]),r.lines.push([C,_-1]),r.lines.push([I,_]),r.lines.push([_,_-1])}}}var R=t.getStyle().getClosedTop();if(R&&o>0){r.vertices.push([0,0,1]);for(var T=0;A-1>T;T++)r.triangles.push([r.vertices.length-1,T+1,T]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}var N=t.getStyle().getClosedBottom();if(N&&a>0){r.vertices.push([0,0,-1]);for(var T=(n-1)*A;A*n>T;T++)r.triangles.push([T,T+1,r.vertices.length-1]),r.coords.push([1,T/(A-2)]),r.lines.push([r.vertices.length-1,T]),r.lines.push([T,T+1])}return 0==s&&360==l?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.ellipsoid=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=(EJSS_WEBGLGRAPHICS.indexer(),t.getResolutionV()),i=t.getResolutionU(),o=0;n>=o;o++)for(var a=o*Math.PI/n,s=Math.sin(a),l=Math.cos(a),u=0;i>=u;u++){var g=2*u*Math.PI/i,c=Math.sin(g),S=Math.cos(g),f=S*s,d=-l,E=-c*s,p=1-u/i,h=o/n;r.vertices.push([-E,f,d]),r.coords.push([p,h])}for(var o=0;n>=o;o++){var h=o/n,a=o*Math.PI/n,d=-Math.cos(a);r.vertices.push([0,0,d]),r.coords.push([0,h])}var o,m=t.getMinAngleU(),A=t.getMaxAngleU(),y=t.getMinAngleV()+90,v=t.getMaxAngleV()+90,P=Math.floor(y*n/180),D=Math.floor(v*n/180);for(o=P;D>o;o++){var u,_,I,C=Math.floor(m*i/360),R=Math.floor(A*i/360);for(u=C;R>u;u++)_=o*(i+1)+u,I=_+i+1,r.triangles.push([_,I,_+1]),r.triangles.push([I,I+1,_+1]),r.lines.push([_,I]),r.lines.push([_,_+1]),r.lines.push([I,I+1]);if(0!=m||360!=A){var T=r.vertices.length-(n-o+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([_+1,I+1,T]),r.triangles.push([I+1,T+1,T]),r.lines.push([_+1,I+1]),r.lines.push([_+1,T]),r.lines.push([I+1,T+1]),r.lines.push([T,T+1])),t.getStyle().getClosedRight()){var N=o*(i+1)+C,O=N+i+1;r.triangles.push([T,O,N]),r.triangles.push([T,T+1,O]),r.lines.push([N,O]),r.lines.push([N,T]),r.lines.push([O,T+1]),r.lines.push([T,T+1])}}}if(t.getStyle().getClosedBottom()&&y>0){var _,u,M;for(u=C;R>u;u++)_=P*(i+1)+u,M=r.vertices.length-(n-P+1),r.triangles.push([_+1,M,_]),r.lines.push([_+1,M]),r.lines.push([_,_+1])}if(t.getStyle().getClosedTop()&&180>v){var _,u,M;for(u=C;R>u;u++)_=D*(i+1)+u,M=r.vertices.length-(n-D+1),r.triangles.push([_,M,_+1]),r.lines.push([_+1,M]),r.lines.push([_,_+1])}return 0==m&&360==A?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var hasFloat32Array="undefined"!=typeof Float32Array;Matrix.prototype={inverse:function(){return Matrix.inverse(this,new Matrix)},transpose:function(){return Matrix.transpose(this,new Matrix)},multiply:function(e){return Matrix.multiply(this,e,new Matrix)},transformPoint:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11]).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},Matrix.inverse=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;n[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],n[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],n[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],n[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],n[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],n[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],n[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],n[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],n[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],n[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],n[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],n[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],n[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],n[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],n[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],n[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var i=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12],o=0;16>o;o++)n[o]/=i;return t},Matrix.transpose=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;return n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],t},Matrix.multiply=function(e,t,r){r=r||new Matrix;var n=e.m,i=t.m,o=r.m;return o[0]=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],o[1]=n[0]*i[1]+n[1]*i[5]+n[2]*i[9]+n[3]*i[13],o[2]=n[0]*i[2]+n[1]*i[6]+n[2]*i[10]+n[3]*i[14],o[3]=n[0]*i[3]+n[1]*i[7]+n[2]*i[11]+n[3]*i[15],o[4]=n[4]*i[0]+n[5]*i[4]+n[6]*i[8]+n[7]*i[12],o[5]=n[4]*i[1]+n[5]*i[5]+n[6]*i[9]+n[7]*i[13],o[6]=n[4]*i[2]+n[5]*i[6]+n[6]*i[10]+n[7]*i[14],o[7]=n[4]*i[3]+n[5]*i[7]+n[6]*i[11]+n[7]*i[15],o[8]=n[8]*i[0]+n[9]*i[4]+n[10]*i[8]+n[11]*i[12],o[9]=n[8]*i[1]+n[9]*i[5]+n[10]*i[9]+n[11]*i[13],o[10]=n[8]*i[2]+n[9]*i[6]+n[10]*i[10]+n[11]*i[14],o[11]=n[8]*i[3]+n[9]*i[7]+n[10]*i[11]+n[11]*i[15],o[12]=n[12]*i[0]+n[13]*i[4]+n[14]*i[8]+n[15]*i[12],o[13]=n[12]*i[1]+n[13]*i[5]+n[14]*i[9]+n[15]*i[13],o[14]=n[12]*i[2]+n[13]*i[6]+n[14]*i[10]+n[15]*i[14],o[15]=n[12]*i[3]+n[13]*i[7]+n[14]*i[11]+n[15]*i[15],r},Matrix.identity=function(e){e=e||new Matrix;var t=e.m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},Matrix.perspective=function(e,t,r,n,i){var o=Math.tan(e*Math.PI/360)*r,a=o*t;return Matrix.frustum(-a,a,-o,o,r,n,i)},Matrix.frustum=function(e,t,r,n,i,o,a){a=a||new Matrix;var s=a.m;return s[0]=2*i/(t-e),s[1]=0,s[2]=(t+e)/(t-e),s[3]=0,s[4]=0,s[5]=2*i/(n-r),s[6]=(n+r)/(n-r),s[7]=0,s[8]=0,s[9]=0,s[10]=-(o+i)/(o-i),s[11]=-2*o*i/(o-i),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,a},Matrix.ortho=function(e,t,r,n,i,o,a){a=a||new Matrix;var s=a.m;return s[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=-(t+e)/(t-e),s[4]=0,s[5]=2/(n-r),s[6]=0,s[7]=-(n+r)/(n-r),s[8]=0,s[9]=0,s[10]=-2/(o-i),s[11]=-(o+i)/(o-i),s[12]=0,s[13]=0,s[14]=0,s[15]=1,a},Matrix.scale=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.translate=function(e,t,r,n){n=n||new Matrix;var i=n.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=e,i[4]=0,i[5]=1,i[6]=0,i[7]=t,i[8]=0,i[9]=0,i[10]=1,i[11]=r,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.rotate=function(e,t,r,n,i,o,a,s){if(!e||!t&&!r&&!n)return Matrix.identity(s);s=s||new Matrix;var l=s.m,u=Math.sqrt(t*t+r*r+n*n);t/=u,r/=u,n/=u;var g=Math.cos(e),c=Math.sin(e),S=1-g;return l[0]=t*t*S+g,l[1]=t*r*S-n*c,l[2]=t*n*S+r*c,l[3]=i-l[0]*i-l[1]*o-l[2]*a,l[4]=r*t*S+n*c,l[5]=r*r*S+g,l[6]=r*n*S-t*c,l[7]=o-l[4]*i-l[5]*o-l[6]*a,l[8]=n*t*S-r*c,l[9]=n*r*S+t*c,l[10]=n*n*S+g,l[11]=a-l[8]*i-l[9]*o-l[10]*a,l[12]=0,l[13]=0,l[14]=0,l[15]=1,s},Matrix.lookAt=function(e,t,r,n,i,o,a,s,l,u){u=u||new Matrix;var g=u.m,c=new Vector(e,t,r),S=new Vector(n,i,o),f=new Vector(a,s,l),d=c.subtract(S).unit(),E=f.cross(d).unit(),p=d.cross(E).unit();return g[0]=E.x,g[1]=E.y,g[2]=E.z,g[3]=-E.dot(c),g[4]=p.x,g[5]=p.y,g[6]=p.z,g[7]=-p.dot(c),g[8]=d.x,g[9]=d.y,g[10]=d.z,g[11]=-d.dot(c),g[12]=0,g[13]=0,g[14]=0,g[15]=1,u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.mesh=function(e,t,r){var n={};r=r||{coords:!0,normals:!0,triangles:!0,lines:!0,colors:!0},t=t||"mesh";var i={},o={};return n.getId=function(){return t},n.getVertexBuffers=function(){return i},n.getIndexBuffers=function(){return o},n.setVertices=function(e){n.vertices=e},n.getVertices=function(){return n.vertices},n.setCoords=function(e){n.coords=e},n.getCoords=function(){return n.coords},n.setNormals=function(e){n.normals=e},n.getNormals=function(){return n.normals},n.setColors=function(e){n.colors=e},n.getColors=function(){return n.colors},n.setTriangles=function(e){n.triangles=e},n.getTriangles=function(){return n.triangles},n.setLines=function(e){n.lines=e},n.getLines=function(){return n.lines},n.setBuffer=function(e,t){n[e]=t},n.addVertexBuffer=function(t,r){var o=i[r]=EJSS_WEBGLGRAPHICS.buffer(e,e.ARRAY_BUFFER,Float32Array);o._0(t),n[t]=[]},n.addIndexBuffer=function(t){o[t]=EJSS_WEBGLGRAPHICS.buffer(e,e.ELEMENT_ARRAY_BUFFER,Uint16Array);n[t]=[]},n.compile=function(){for(var e in i){var t=i[e];t.setData(n[t.getName()]),t.compile()}for(var r in o){var t=o[r];t.setData(n[r]),t.compile()}},n.transform=function(e){if(n.vertices=n.vertices.map(function(t){return e.transformPoint(Vector.fromArray(t)).toArray()}),n.normals){var t=e.inverse().transpose();n.normals=n.normals.map(function(e){return t.transformVector(Vector.fromArray(e)).unit().toArray()})}return n.compile(),n},n.computeNormals=function(){n.normals||n.addVertexBuffer("normals","gl_Normal");for(var e=0;e<n.vertices.length;e++)n.normals[e]=new Vector;for(var e=0;e<n.triangles.length;e++){var t=n.triangles[e],r=Vector.fromArray(n.vertices[t[0]]),i=Vector.fromArray(n.vertices[t[1]]),o=Vector.fromArray(n.vertices[t[2]]),a=i.subtract(r).cross(o.subtract(r)).unit();n.normals[t[0]]=n.normals[t[0]].add(a),n.normals[t[1]]=n.normals[t[1]].add(a),n.normals[t[2]]=n.normals[t[2]].add(a)}for(var e=0;e<n.vertices.length;e++)n.normals[e]=n.normals[e].unit().toArray();return n.compile(),n},n.computeWireframe=function(){for(var e=EJSS_WEBGLGRAPHICS.indexer(),t=0;t<n.triangles.length;t++)for(var r=n.triangles[t],i=0;i<r.length;i++){var o=r[i],a=r[(i+1)%r.length];e.add([Math.min(o,a),Math.max(o,a)])}return n.lines||n.addIndexBuffer("lines"),n.lines=e.getUnique(),n.compile(),n},n.getAABB=function(){var e={min:new Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<n.vertices.length;t++){var r=Vector.fromArray(n.vertices[t]);e.min=Vector.min(e.min,r),e.max=Vector.max(e.max,r)}return e},n.getBoundingSphere=function(){for(var e=n.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0},r=0;r<n.vertices.length;r++)t.radius=Math.max(t.radius,Vector.fromArray(n.vertices[r]).subtract(t.center).length());return t},n.addVertexBuffer("vertices","gl_Vertex"),r.coords&&n.addVertexBuffer("coords","gl_TexCoord"),r.normals&&n.addVertexBuffer("normals","gl_Normal"),r.colors&&n.addVertexBuffer("colors","gl_Color"),"triangles"in r&&!r.triangles||n.addIndexBuffer("triangles"),r.lines&&n.addIndexBuffer("lines"),n},EJSS_WEBGLGRAPHICS.indexer=function(){var e={},t=[],r={};return e.getUnique=function(){return t},e.add=function(e){var n=JSON.stringify(e);return n in r||(r[n]=t.length,t.push(e)),r[n]},e},EJSS_WEBGLGRAPHICS.buffer=function(e,t,r){var n={},i=null,t=t,r=r,o="",a=[];return n.setData=function(e){a=e},n._0=function(e){o=e},n.getBuffer=function(){return i},n.getName=function(){return o},n.compile=function(n){for(var o=[],s=0,l=1e4;s<a.length;s+=l)o=Array.prototype.concat.apply(o,a.slice(s,s+l));var u=a.length?o.length/a.length:0;if(u!=Math.round(u))throw"buffer elements not of consistent size, average size is "+u;i=i||e.createBuffer(),i.length=o.length,i.spacing=u,e.bindBuffer(t,i),e.bufferData(t,new r(o),n||e.STATIC_DRAW)},n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.plane=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.segment=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1});return r.vertices.push([0,0,0]),r.vertices.push([2,2,2]),r.lines.push([0,1]),r.compile(),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Shader={BasicVS:"void main() {  gl_Position=gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",BasicFS:"uniform vec3 color;uniform float opacity;void main() {    gl_FragColor=vec4(color, opacity);}",ColorVS:"varying vec4 color;void main() { color=gl_Color; gl_Position=gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",ColorFS:"varying vec4 color;void main() { gl_FragColor=color;}",LightVS:"uniform float ka;uniform float kd;uniform float ks;uniform float shininessVal;uniform vec3 ambientColor;uniform vec3 diffuseColor;uniform vec3 specularColor;uniform vec3 lights[10];uniform int numlight;varying vec3 tmpcolor;void main() {  vec4 vmPos=gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);  vec3 normal=normalize(gl_NormalMatrix * gl_Normal);  tmpcolor=vec3(0);	for(int i=0; i < 10; i++) { 		if(i== numlight) break;		vec3 light=normalize(lights[i] - vmPos.xyz);      float lambertian=abs(dot(normal, light));      float specular=0.0;      if(lambertian > 0.0) {        vec3 reflect=reflect(-light, normal);        vec3 vector=normalize(-vmPos.xyz);        float specAngle=max(dot(reflect, vector), 0.0);        specular=pow(specAngle, shininessVal);      }      tmpcolor += vec3(ka * ambientColor +        kd * lambertian * diffuseColor +        ks * specular * specularColor);	}   gl_Position=gl_ProjectionMatrix * vmPos;}",LightFS:"uniform float opacity;varying vec3 tmpcolor;void main() {  gl_FragColor=vec4(tmpcolor, opacity);}",LightAndColorVS:"uniform float ka;uniform float kd;uniform float ks;uniform float shininessVal;uniform vec3 ambientColor;uniform vec3 specularColor;uniform vec3 lights[10];uniform int numlight;varying vec3 tmpcolor;void main() {  vec4 vmPos=gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);  vec3 normal=normalize(gl_NormalMatrix * gl_Normal);  tmpcolor=vec3(0);	for(int i=0; i < 10; i++) { 		if(i== numlight) break;		vec3 light=normalize(lights[i] - vmPos.xyz);      float lambertian=abs(dot(normal, light));      float specular=0.0;      if(lambertian > 0.0) {        vec3 reflect=reflect(-light, normal);        vec3 vector=normalize(-vmPos.xyz);        float specAngle=max(dot(reflect, vector), 0.0);        specular=pow(specAngle, shininessVal);      }      tmpcolor += vec3(ka * ambientColor +        kd * lambertian * vec3(gl_Color) +        ks * specular * specularColor);	}   gl_Position=gl_ProjectionMatrix * vmPos;}",LightAndColorFS:"uniform float opacity;varying vec3 tmpcolor;void main() {  gl_FragColor=vec4(tmpcolor, opacity);}",PaletteColorVS:"uniform vec3 floor;uniform vec3 ceil;uniform vec3 floorColor;uniform vec3 ceilColor;varying vec3 tmpcolor;void main() {  vec4 vmPos=gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);  vec3 normal=normalize(gl_NormalMatrix * gl_Normal);  vec3 diff=ceil - floor;  vec3 diffFloor=vmPos.xyz - floor;  vec3 diffCeil=vmPos.xyz - ceil;  float value1=dot(diff, diffFloor);  if(value1 < 0.0) {    tmpcolor=floorColor;  } else {    float value2=dot(diff, diffCeil);    if(value2 > 0.0) {      tmpcolor=ceilColor;    } else {      float value=length(diffFloor) / (length(diffFloor) + length(diffCeil));      tmpcolor=floorColor + value * (ceilColor - floorColor);    }  }  gl_Position=gl_ProjectionMatrix * vmPos;}",PaletteColorFS:"uniform float opacity;varying vec3 tmpcolor;void main() {  gl_FragColor=vec4(tmpcolor, opacity);}",BasicVSwithTex:"varying vec2 coord;void main() {  coord=gl_TexCoord.xy;  gl_Position=gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);}",BasicFSwithTex:"uniform sampler2D texture;varying vec2 coord;void main() {  gl_FragColor=texture2D(texture, coord);}"},EJSS_WEBGLGRAPHICS.shader=function(e,t,r,n){function i(e,r){var n=e+r,i={};return EJSS_WEBGLGRAPHICS.Utils.regexMap(/\b(gl_[^;]*)\b;/g,u,function(e){var r=e[1];if(-1!=n.indexOf(r)){var o=r.replace(/[a-z_]/g,"");i[o]=t+r}}),i}function o(e,r){var n={},i=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(r);return r=i?i[1]+e+r.substr(i[1].length):e+r,EJSS_WEBGLGRAPHICS.Utils.regexMap(/\bgl_\w+\b/g,e,function(e){e in n||(r=r.replace(new RegExp("\\b"+e+"\\b","g"),t+e),n[e]=!0)}),r}function a(t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(n);return n}var s,l={},u="uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelMatrix;uniform mat4 gl_ViewMatrix;uniform mat4 gl_ProjectionMatrix;",g=u+"attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;",c="precision highp float;"+u,S={},f={};l.uniforms=function(t){e.useProgram(d);for(var r in t){var n=f[r]||e.getUniformLocation(d,r);if(n){f[r]=n;var i=t[r];if(i instanceof Vector?i=[i.x,i.y,i.z]:i instanceof Matrix&&(i=i.m),EJSS_WEBGLGRAPHICS.Utils.isArray(i))if(EJSS_WEBGLGRAPHICS.Utils.isArray(i[0])){for(var o=[],a=0;a<i.length;a++)o.push(i[a][0]),o.push(i[a][1]),o.push(i[a][2]);e.uniform3fv(n,new Float32Array(o))}else switch(i.length){case 1:e.uniform1fv(n,new Float32Array(i));break;case 2:e.uniform2fv(n,new Float32Array(i));break;case 3:e.uniform3fv(n,new Float32Array(i));break;case 4:e.uniform4fv(n,new Float32Array(i));break;case 9:e.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw"don't know how to load uniform \""+r+'" of length '+i.length}else{if(!EJSS_WEBGLGRAPHICS.Utils.isNumber(i))throw'attempted to set uniform "'+r+'" to invalid value '+i;(-1!=r.indexOf("texture")||-1!=r.indexOf("num")?e.uniform1i:e.uniform1f).call(e,n,i)}}}},l.setLineWidth=function(e){s=e},l.draw=function(t,r){l.drawBuffers(t.getVertexBuffers(),t.getIndexBuffers()[r==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:r)},l.drawBuffers=function(o,a,u){var g=i(r,n),c=e.modelMatrix,f=e.viewMatrix,E=e.projectionMatrix,p={};if(g.MM&&(p[g.MM]=c),g.VM&&(p[g.VM]=f),g.PM&&(p[g.PM]=E),g.NM){var h=f.multiply(c).inverse().m;p[g.NM]=[h[0],h[4],h[8],h[1],h[5],h[9],h[2],h[6],h[10]]}l.uniforms(p);var m=0;for(var A in o){var y=o[A],v=S[A]||e.getAttribLocation(d,A.replace(/^(gl_.*)$/,t+"$1"));-1!=v&&y.getBuffer()&&(S[A]=v,e.bindBuffer(e.ARRAY_BUFFER,y.getBuffer()),e.enableVertexAttribArray(v),e.vertexAttribPointer(v,y.getBuffer().spacing,e.FLOAT,!1,0,0),m=y.getBuffer().length/y.getBuffer().spacing)}for(var A in S)A in o||e.disableVertexAttribArray(S[A]);u==e.LINES&&e.lineWidth(s),!m||a&&!a.getBuffer()||(a?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.getBuffer()),e.drawElements(u,a.getBuffer().length,e.UNSIGNED_SHORT,0)):e.drawArrays(u,0,m))};var d=e.createProgram();if(e.attachShader(d,a(e.VERTEX_SHADER,o(g,r))),e.attachShader(d,a(e.FRAGMENT_SHADER,o(c,n))),e.linkProgram(d),!e.getProgramParameter(d,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(d);return l};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.spring=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.surface=function(e,t){};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.text=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getFont(),i=t.getBackground(),o=t.getText(),a=n.getFillColor(),s=document.createElement("canvas"),l=s.getContext("2d");l=s.getContext("2d");var u="";u+="none"!=n.getFontStyle()?n.getFontStyle()+" ":"",u+="none"!=n.getFontWeight()?n.getFontWeight()+" ":"",u+=n.getFontSizeString()+(n.getFontSizeString().toString().indexOf("px")>-1?" ":"px "),u+=n.getFontFamily(),l.font=u,i&&(l.fillStyle=i,l.fillRect(0,0,s.width,s.height)),l.textAlign="center",l.textBaseline="middle",l.fillStyle=a,l.fillText(o,s.width/2,s.height/2);var g=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,s);e.addElement(t.getName()+".texture",g);for(var c=1,S=0;c>=S;S++)for(var f=S/c,d=0;c>=d;d++){var E=d/c;if(r.vertices.push([0,2*f-1,2*E-1]),r.coords.push([f,E]),c>d&&c>S){var p=d+S*(c+1);r.triangles.push([p,p+1,p+c+1]),r.triangles.push([p+c+1,p+1,p+c+2])}}return r.computeNormals(),r.computeWireframe(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Texture={fromImage:function(e,t,r){r=r||{};var n=EJSS_WEBGLGRAPHICS.texture(e,t.width,t.height,r);try{e.texImage2D(e.TEXTURE_2D,0,n.getFormat(),n.getFormat(),n.getType(),t)}catch(i){throw"file:"==location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)";
}return r.minFilter&&r.minFilter!=e.NEAREST&&r.minFilter!=e.LINEAR&&e.generateMipmap(e.TEXTURE_2D),n},fromURL:function(e,t,r,n){checkerboardCanvas=function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var r=0;r<e.canvas.width;r+=16)e.fillStyle=16&(r^t)?"#FFF":"#DDD",e.fillRect(r,t,16,16);return e.canvas}();var i=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,checkerboardCanvas,r),o=new Image;return o.onload=function(){EJSS_WEBGLGRAPHICS.Texture.fromImage(e,o,r).swapWith(i),n()},o.src=t,i}},EJSS_WEBGLGRAPHICS.texture=function(e,t,r,n){var i={};n=n||{};var o,a,s=e.createTexture(),l=n.format||e.RGBA,u=n.type||e.UNSIGNED_BYTE;return i.getId=function(){return s},i.setId=function(e){s=e},i.getFormat=function(){return l},i.setFormat=function(e){l=e},i.getType=function(){return u},i.setType=function(e){u=e},i.getWidth=function(){return t},i.setWidth=function(e){t=e},i.getHeight=function(){return r},i.setHeight=function(e){r=e},i.bind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,s)},i.unbind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},i.drawTo=function(n){var i=e.getParameter(e.VIEWPORT);o=o||e.createFramebuffer(),a=a||e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,o),e.bindRenderbuffer(e.RENDERBUFFER,a),(t!=a.width||r!=a.height)&&(a.width=t,a.height=r,e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),e.viewport(0,0,t,r),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.viewport(i[0],i[1],i[2],i[3])},i.swapWith=function(e){var n;n=e.getId(),e.setId(s),s=n,n=e.getWidth(),e.setWidth(t),t=n,n=e.getHeight(),e.setHeight(r),r=n},e.bindTexture(e.TEXTURE_2D,s),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.filter||n.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.filter||n.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap||n.wrapS||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap||n.wrapT||e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,l,t,r,0,l,u,null),i};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.trail=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getPoints(),i=[],o=[],a=0,s=0;s<n.length;s++)i[s]=[n[s][0],n[s][1],n[s][2]],0!=s&&1==n[s][3]&&(o[a++]=[s-1,s]);return r.setVertices(i),o.length>0&&r.setLines(o),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Utils={},EJSS_WEBGLGRAPHICS.Utils.regexMap=function(e,t,r){for(;null!=(result=e.exec(t));)r(result)},EJSS_WEBGLGRAPHICS.Utils.isArray=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"==t||"[object Float32Array]"==t},EJSS_WEBGLGRAPHICS.Utils.isNumber=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t},Vector.prototype={setx:function(e){this.x=e},sety:function(e){this.y=e},setz:function(e){this.z=e},getx:function(){return this.x},gety:function(){return this.y},getz:function(){return this.z},negative:function(){return new Vector(-this.x,-this.y,-this.z)},add:function(e){return e instanceof Vector?new Vector(this.x+e.x,this.y+e.y,this.z+e.z):new Vector(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof Vector?new Vector(this.x-e.x,this.y-e.y,this.z-e.z):new Vector(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof Vector?new Vector(this.x*e.x,this.y*e.y,this.z*e.z):new Vector(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof Vector?new Vector(this.x/e.x,this.y/e.y,this.z/e.z):new Vector(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},angle:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new Vector(this.x,this.y,this.z)},init:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},Vector.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Vector.add=function(e,t,r){return t instanceof Vector?(r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z):(r.x=e.x+t,r.y=e.y+t,r.z=e.z+t),r},Vector.subtract=function(e,t,r){return t instanceof Vector?(r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z):(r.x=e.x-t,r.y=e.y-t,r.z=e.z-t),r},Vector.multiply=function(e,t,r){return t instanceof Vector?(r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z):(r.x=e.x*t,r.y=e.y*t,r.z=e.z*t),r},Vector.divide=function(e,t,r){return t instanceof Vector?(r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z):(r.x=e.x/t,r.y=e.y/t,r.z=e.z/t),r},Vector.cross=function(e,t,r){return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},Vector.unit=function(e,t){var r=e.length();return t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,t},Vector.fromAngles=function(e,t){return new Vector(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},Vector.randomDirection=function(){return Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},Vector.min=function(e,t){return new Vector(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},Vector.max=function(e,t){return new Vector(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},Vector.lerp=function(e,t,r){return t.subtract(e).multiply(r).add(e)},Vector.fromArray=function(e){return new Vector(e[0],e[1],e[2])};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.WebGLGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.webGLGraphics=function(e){function t(){i.MODEL=1|o,i.VIEW=2|o,i.PROJECTION=3|o;var e=new Matrix,t=new Matrix;i.modelMatrix=new Matrix,i.viewMatrix=new Matrix,i.projectionMatrix=new Matrix;var r,n,a=[],s=[],l=[];i.elements={},i.addElement=function(e,t){i.elements[e]=t},i.getElement=function(e){return i.elements[e]},i.removeElement=function(e){delete i.elements[e]},i.matrixMode=function(e){switch(e){case i.MODEL:r="modelMatrix",n=a;break;case i.VIEW:r="viewMatrix",n=s;break;case i.PROJECTION:r="projectionMatrix",n=l;break;default:throw"invalid matrix mode "+e}},i.loadIdentity=function(){Matrix.identity(i[r])},i.loadMatrix=function(e){for(var t=e.m,n=i[r].m,o=0;16>o;o++)n[o]=t[o]},i.multMatrix=function(e){i.loadMatrix(Matrix.multiply(i[r],e,t))},i.perspective=function(t,r,n,o){i.multMatrix(Matrix.perspective(t,r,n,o,e))},i.frustum=function(t,r,n,o,a,s){i.multMatrix(Matrix.frustum(t,r,n,o,a,s,e))},i.ortho=function(t,r,n,o,a,s){i.multMatrix(Matrix.ortho(t,r,n,o,a,s,e))},i.scale=function(t,r,n){i.multMatrix(Matrix.scale(t,r,n,e))},i.translate=function(t,r,n){i.multMatrix(Matrix.translate(t,r,n,e))},i.applyMatrix=function(e){i.multMatrix(new Matrix(e))},i.rotate=function(t,r,n,o,a,s,l){a=a||0,s=s||0,l=l||0,i.multMatrix(Matrix.rotate(t,r,n,o,a,s,l,e))},i.lookAt=function(t,r,n,o,a,s,l,u,g){i.multMatrix(Matrix.lookAt(t,r,n,o,a,s,l,u,g,e))},i.pushMatrix=function(){n.push(Array.prototype.slice.call(i[r].m))},i.popMatrix=function(){var e=n.pop();i[r].m=hasFloat32Array?new Float32Array(e):e},i.matrixMode(i.MODEL)}var r=EJSS_INTERFACE.webGLCanvas(e),n=r.getDOMElement(),i=r.getContext();r.supportsWebGL=function(){return i},r.getEventContext=function(){return n},r.getBox=function(){var e=EJSS_GRAPHICS.WebGLGraphics.getOffsetRect(r);return e.width-=1,e.height-=1,e},r.getAspect=function(){var e=EJSS_GRAPHICS.WebGLGraphics.getOffsetRect(r),t=Math.max(1,e.height);return e.width/t},r.remove=function(e){},r.reset=function(e,n,o){if(i){t();var a=r.getBox(),s=Math.max(1,a.height);i.viewport(0,0,a.width,s),i.matrixMode(i.PROJECTION),i.loadIdentity(),i.perspective(e,a.width/s,n,o),i.matrixMode(i.VIEW),i.disable(i.CULL_FACE),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)}},r.putCamera=function(e){i&&(i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.loadIdentity(),i.lookAt(e.location.x,e.location.y,e.location.z,e.focus.x,e.focus.y,e.focus.z,0,0,1),i.rotate(EJSS_TOOLS.Mathematics.radians(e.altitude),0,1,0,e.focus.x,e.focus.y,e.focus.z),i.rotate(EJSS_TOOLS.Mathematics.radians(e.azimuth),0,0,1,e.focus.x,e.focus.y,e.focus.z))},r.draw=function(e,t){if(i)for(var n=0,o=e.length;o>n;n++)if(element=e[n],element.getElements){for(var a=element.getLastElements(),s=0,l=a.length;l>s;s++)i.removeElement(a[s].getName()+".mesh");r.draw(element.getElements(),t)}else r.drawElement(element,t)},r.drawElement=function(e,t){var n=null;if(e.isGroupVisible()){var n=i.getElement(e.getName()+".mesh");if(!n||e.isMeshChanged()||e.isAlwaysUpdated())switch(e._23()){case"ElementArrow":n=EJSS_WEBGLGRAPHICS.arrow(i,e);break;case"ElementSegment":n=EJSS_WEBGLGRAPHICS.segment(i,e);break;case"ElementSphere":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementEllipsoid":n=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementBox":n=EJSS_WEBGLGRAPHICS.box(i,e);break;case"ElementCylinder":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementCone":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementTetrahedron":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementDisk":n=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementBasic":n=EJSS_WEBGLGRAPHICS.basic(i,e);break;case"ElementPlane":n=EJSS_WEBGLGRAPHICS.plane(i,e);break;case"ElementSurface":n=EJSS_WEBGLGRAPHICS.surface(i,e);break;case"ElementAnalyticSurface":n=EJSS_WEBGLGRAPHICS.analyticSurface(i,e);break;case"ElementText":n=EJSS_WEBGLGRAPHICS.text(i,e);break;case"ElementTrail":n=EJSS_WEBGLGRAPHICS.trail(i,e);break;case"ElementAnalyticCurve":n=EJSS_WEBGLGRAPHICS.analyticCurve(i,e);break;case"ElementSpring":n=EJSS_WEBGLGRAPHICS.spring(i,e)}if(n){i.matrixMode(i.MODEL),i.loadIdentity();for(var o=[],a=e;a.getGroup();)a=a.getGroup(),o.unshift(a);for(var s=0;s<o.length;s++){a=o[s];var l=a.getFullTransformation();if(l&&l.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(l[0]))for(var u=0;u<l.length;u++)i.rotate(l[u][0],l[u][1],l[u][2],l[u][3],l[u][4],l[u][5],l[u][6]);else i.rotate(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);i.translate(a.getX()*e.getPanel().getSizeX(),a.getY()*e.getPanel().getSizeY(),a.getZ()*e.getPanel().getSizeZ()),i.scale(a.getSizeX(),a.getSizeY(),a.getSizeZ())}var g=e.getFullTransformation();if(g&&g.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(g[0]))for(var u=0;u<g.length;u++)i.rotate(g[u][0],g[u][1],g[u][2],g[u][3],g[u][4],g[u][5],g[u][6]);else 16==g.length?i.applyMatrix(g):i.rotate(g[0],g[1],g[2],g[3],g[4],g[5],g[6]);i.translate(e.getX()*e.getPanel().getSizeX(),e.getY()*e.getPanel().getSizeY(),e.getZ()*e.getPanel().getSizeZ()),"ElementArrow"==e._23()||"ElementSpring"==e._23()?i.scale(e.getPanel().getSizeX(),e.getPanel().getSizeY(),e.getPanel().getSizeZ()):"ElementTrail"==e._23()?i.scale(e.getPanel().getSizeX()*e.getSizeX(),e.getPanel().getSizeY()*e.getSizeY(),e.getPanel().getSizeZ()*e.getSizeZ()):i.scale(e.getPanel().getSizeX()*e.getSizeX()/2,e.getPanel().getSizeY()*e.getSizeY()/2,e.getPanel().getSizeZ()*e.getSizeZ()/2),e.getStyle().getTransparency()>0&&(i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.DEPTH_TEST)),r.drawMesh(i,e,n),e.getStyle().getTransparency()>0&&(i.disable(i.BLEND),i.enable(i.DEPTH_TEST)),i.matrixMode(i.VIEW)}}return n},r.drawPanel=function(e){if(i){var t=e.getStyle();if(e.isImageUrl())i.clearColor(0,0,0,0);else{var n=t.getFillColor();i.clearColor(n[0],n[1],n[2],void 0!==typeof n[3]?n[3]:1)}return r}},r.drawMesh=function(e,t,r){var n=1-t.getStyle().getTransparency()/255,i=t.getTextureUrl();if("ElementText"==t._23()||i&&i.length>0){var o=e.getElement(r.getId()+".shader_tex"),a=e.getElement(r.getId()+".texture");if(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_tex",EJSS_WEBGLGRAPHICS.Shader.BasicVSwithTex,EJSS_WEBGLGRAPHICS.Shader.BasicFSwithTex),a)a.bind(),o.uniforms({texture:0}),o.draw(r),a.unbind(),e.addElement(r.getId()+".texture",a);else{var s=EJSS_WEBGLGRAPHICS.Texture.fromURL(e,i,{},function(e){t.getController().invokeAction("OnLoadTexture"),t.getController().reportInteractions()});s.bind(),o.uniforms({texture:0}),o.draw(r),s.unbind(),e.addElement(r.getId()+".texture",s)}e.addElement(r.getId()+".shader_tex",o)}else{var l=t.getStyle().getDrawLines();if(l){var o=e.getElement(r.getId()+".shader_lines");o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_lines",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getLineColor(),opacity:n}),o.setLineWidth(t.getStyle().getLineWidth()),o.draw(r,e.LINES),e.addElement(r.getId()+".shader_lines",o)}var u=t.getStyle().getDrawFill();if(u){var o=e.getElement(r.getId()+".shader_fill"),g=t.getColors&&t.getColors().length>0,c=t.getGroupPanel().getLights().length>0,S="undefined"!=typeof t.getStyle().getPaletteFloor();S?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.PaletteColorVS,EJSS_WEBGLGRAPHICS.Shader.PaletteColorFS),o.uniforms({floor:t.getStyle().getPaletteFloor(),ceil:t.getStyle().getPaletteCeil(),floorColor:t.getStyle().getPaletteFloorColor(),ceilColor:t.getStyle().getPaletteCeilColor()})):g?c?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightAndColorVS,EJSS_WEBGLGRAPHICS.Shader.LightAndColorFS),o.uniforms({ambientColor:t.getStyle().getAmbientColor(),specularColor:t.getStyle().getSpecularColor(),ka:t.getStyle().getAmbientReflection(),kd:t.getStyle().getColorReflection(),ks:t.getStyle().getSpecularReflection(),shininessVal:t.getStyle().getShininessVal()})):o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.ColorVS,EJSS_WEBGLGRAPHICS.Shader.ColorFS):c?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightVS,EJSS_WEBGLGRAPHICS.Shader.LightFS),o.uniforms({ambientColor:t.getStyle().getAmbientColor(),diffuseColor:t.getStyle().getFillColor(),specularColor:t.getStyle().getSpecularColor(),ka:t.getStyle().getAmbientReflection(),kd:t.getStyle().getColorReflection(),ks:t.getStyle().getSpecularReflection(),shininessVal:t.getStyle().getShininessVal()})):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),o.uniforms({color:t.getStyle().getFillColor()}));var f=t.getGroupPanel().getLights(),d=f.length;o.uniforms({numlight:d,light:f,opacity:n}),o.draw(r,e.TRIANGLES),e.addElement(r.getId()+".shader_fill",o)}}};var o=305397760;return r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Plane={},EJSS_DRAWING3D.plane=function(e){},EJSS_DRAWING3D.PlaneSet={},EJSS_DRAWING3D.planeSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Segment={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t)}},EJSS_DRAWING3D.segment=function(e){var t=EJSS_DRAWING3D.element(e);return t._23=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING3D.Segment.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Segment.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t},EJSS_DRAWING3D.SegmentSet={},EJSS_DRAWING3D.segmentSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Sphere={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Ellipsoid.copyTo(e,t),t.setRadius(e.getRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Ellipsoid.registerProperties(e,t),t.registerProperty("Radius",e.setRadius)}},EJSS_DRAWING3D.sphere=function(e){var t=EJSS_DRAWING3D.ellipsoid(e),r=.5;return t._23=function(){return"ElementSphere"},t.setRadius=function(e){r=e,t.setSize([2*e,2*e,2*e])},t.getRadius=function(){return r},t.copyTo=function(e){EJSS_DRAWING3D.Sphere.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Sphere.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.SphereSet={registerProperties:function(e,t){var r=EJSS_DRAWING3D.ElementSet;r.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)})}},EJSS_DRAWING3D.sphereSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.sphere,e),r=EJSS_DRAWING3D.SphereSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Spring={},EJSS_DRAWING3D.spring=function(e){},EJSS_DRAWING3D.SpringSet={},EJSS_DRAWING3D.springSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Surface={},EJSS_DRAWING3D.surface=function(e){},EJSS_DRAWING3D.SurfaceSet={},EJSS_DRAWING3D.surfaceSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Tetrahedron={},EJSS_DRAWING3D.tetrahedron=function(e){},EJSS_DRAWING3D.TetrahedronSet={},EJSS_DRAWING3D.tetrahedronSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Text={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setTextBackground(e.getTextBackground()),t.setTextMargin(e.getTextMargin())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Background",e.setBackground),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("FontColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle)}},EJSS_DRAWING3D.text=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.font(e),n="",i="rgba(255,255,255,0)";return t._23=function(){return"ElementText"},t.setBackground=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setMeshChanged(!0)),t},t.getBackground=function(){return i},t.setText=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getText=function(){return n},t.getFont=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Text.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setTransparency(255),t},EJSS_DRAWING3D.TextSet={},EJSS_DRAWING3D.textSet=function(e){};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints),t.registerProperty("InputZ",e.addZPoints)}},EJSS_DRAWING3D.trail=function(e){function t(e,t,n,o){return isNaN(e)||isNaN(t)?void(c=!0):void(i&&S[0]==e&&S[1]==t&&S[2]==n||(("undefined"==typeof o||null===o)&&(o=u),f=0,S=r.formatPoint([e,t,n,o]),a>0&&(g>0&&(f=r.formatPoint([e,t,n,o])),++g>=a&&(g=0)),0==f&&(l>2&&d.length>=l&&d.splice(0,1),d[d.length]=r.formatPoint([e,t,n,o]),c=!1)))}var r=EJSS_DRAWING3D.element(e),n=!0,i=!1,o=!1,a=0,s=["x","y","z"],l=0,u=EJSS_DRAWING3D.Trail.LINE_CONNECTION,g=0,c=!0,S=0,f=0,d=[],E=[],p=[],h=0,m=0,A=0;return r._23=function(){return"ElementTrail"},r.setActive=function(e){n!=e&&(n=e,r.setMeshChanged(!0))},r.getActive=function(){return n},r.setNoRepeat=function(e){i!=e&&(i=e,r.setMeshChanged(!0))},r.getNoRepeat=function(){return i},r.setClearAtInput=function(e){o!=e&&(o=e,r.setMeshChanged(!0))},r.getClearAtInput=function(){return o},r.setSkip=function(e){a!=e&&(a=e,g=0,r.setMeshChanged(!0))},r.getSkip=function(){return a},r.setInputLabels=function(e){(s[0]!=e[0]||s[1]!=e[1]||s[2]!=e[2])&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],r.setMeshChanged(!0))},r.getInputLabels=function(){return s},r.setMaximumPoints=function(e){var t=Math.max(e,2);l!=t&&(l=t,r.setMeshChanged(!0))},r.getMaximumPoints=function(){return l},r.setConnected=function(e){e?r.setConnectionType(EJSS_DRAWING3D.Trail.LINE_CONNECTION):r.setConnectionType(EJSS_DRAWING3D.Trail.NO_CONNECTION)},r.isConnected=function(){return u===EJSS_DRAWING3D.Trail.LINE_CONNECTION},r.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING3D.Trail[e.toUpperCase()]),u!=e&&(u=e,r.setMeshChanged(!0))},r.getConnectionType=function(){return u},r.addPoint=function(e,n,i,a){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],a):t(e,n,i,a),r.setMeshChanged(!0)},r.addPoints=function(e,n,i){if(o&&r.initialize(),e[0]instanceof Array)for(var a=0,s=e.length;s>a;a++)t(e[a][0],e[a][1],e[a][2],u);else if(e&&n&&i)for(var s=Math.min(e.length,n.length,i.length),a=0;s>a;a++)t(e[a],n[a],i[a],u);r.setMeshChanged(!0)},r.addXPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[e[t],p[t][1],p[t][2],p[t][3]]:p[t]=[e[t],m,A,u];h=e[t]}else p[t]?p[t]=[e,p[t][1],p[t][2],p[t][3]]:p[t]=[e,m,A,u],t++,h=e;for(;p[t];)p[t]=[h,p[t][1],p[t][2],p[t][3]],t++},r.addYPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[p[t][0],e[t],p[t][2],p[t][3]]:p[t]=[h,e[t],A,u];m=e[t]}else p[t]?p[t]=[p[t][0],e,p[t][2],p[t][3]]:p[t]=[h,e,A,u],t++,m=e;for(;p[t];)p[t]=[p[t][0],m,p[t][2],p[t][3]],t++},r.addZPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;r>t;t++)p[t]?p[t]=[p[t][0],p[t][1],e[t],p[t][3]]:p[t]=[h,m,e[t],u];A=e[t]}else p[t]?p[t]=[p[t][0],p[t][1],e,p[t][3]]:p[t]=[h,m,e,u],t++,A=e;for(;p[t];)p[t]=[p[t][0],p[t][1],A,p[t][3]],t++},r.dataCollected=function(){p.length>0&&(r.addPoints(p),p=[],r.setMeshChanged(!0))},r.setPoints=function(e,t,n,i){r.clear(),r.addPoints(e,t,n,i),r.setMeshChanged(!0)},r.moveToPoint=function(e,n,i){o&&r.initialize(),e instanceof Array?t(e[0],e[1],e[2],EJSS_DRAWING3D.Trail.NO_CONNECTION):t(e,n,i,EJSS_DRAWING3D.Trail.NO_CONNECTION),r.setMeshChanged(!0)},r.getPoints=function(){for(var e=[],t=E.length,r=0;t>r;r++)e=e.concat(E[r]);return e=e.concat(d)},r.getLastPoint=function(){return S},r.reset=function(){r.clear()},r.clear=function(){E=[],mCurrentSegment=0,r.initialize()},r.initialize=function(){d=[],f=0,c=!0,g=0,S=0,r.setMeshChanged(!0)},r.newSegment=function(){if(0!=f){var e=d.length;d[e]=r.formatPoint(f)}var e=E.length;E[e]=d,r.initialize()},r.formatPoint=function(e){return e},r.registerProperties=function(e){EJSS_DRAWING3D.Trail.registerProperties(r,e)},r.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(r,e)},r.setSize([1,1,1]),r.getStyle().setDrawFill(!1),r.getStyle().setDrawLines(!0),r},EJSS_DRAWING3D.TrailSet={},EJSS_DRAWING3D.trailSet=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ArrayPanel={},EJSS_INTERFACE.arrayPanel=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Audio={},EJSS_INTERFACE.audio=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.BoxPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t)},showOkDialog:function(e,t,r){var n=document.getElementById(".myBoxPanelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelOk").getDOMElement(),i=document.getElementById(".myBoxPanelOk.back"),o=document.getElementById(".myBoxPanelOk.msg");o.style.visibility="visible",o.innerHTML=e+"<br/>";var a=document.getElementById(".myBoxPanelOk.okbt");a.onclick=t,a.style.display="inline",n.style.width=r||"200px",n.style.marginLeft=parseFloat(n.style.width)/-2+"px",n.style.visibility="visible",i.style.visibility="visible"},showOkCancelDialog:function(e,t,r,n){var i=document.getElementById(".myBoxPanelCancelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelCancelOk").getDOMElement(),o=document.getElementById(".myBoxPanelCancelOk.back"),a=document.getElementById(".myBoxPanelCancelOk.msg");a.style.visibility="visible",a.innerHTML=e+"<br/>";var s=document.getElementById(".myBoxPanelCancelOk.okbt");s.onclick=t,s.style.display="inline";var l=document.getElementById(".myBoxPanelCancelOk.cancelbt");l.onclick=r,l.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showInputDialog:function(e,t,r,n){var i=document.getElementById(".BoxPanelInput")||EJSS_INTERFACE.boxPanel(".BoxPanelInput").getDOMElement(),o=document.getElementById(".BoxPanelInput.back"),a=document.getElementById(".BoxPanelInput.msg");a.style.visibility="visible",a.innerHTML=e;var s=document.getElementById(".BoxPanelInput.input");s.style.display="inline";var l=document.getElementById(".BoxPanelInput.okbt");l.onclick=function(){t(s.value)},l.style.display="inline";var u=document.getElementById(".BoxPanelInput.cancelbt");u.onclick=r,u.style.display="inline",i.style.width=n||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",o.style.visibility="visible"},showSelectDialog:function(e,t,r,n,i,o){var a=document.getElementById(".BoxPanelSelect")||EJSS_INTERFACE.boxPanel(".BoxPanelSelect").getDOMElement(),s=document.getElementById(".BoxPanelSelect.back"),l=document.getElementById(".BoxPanelSelect.msg");l.style.visibility="visible",l.innerHTML=e;var u=document.getElementById(".BoxPanelSelect.select");u.innerHTML="";for(var g=0;g<t.text.length;g++){var c=document.createElement("option");c.value&&c.value[g]&&c.setAttribute("value",t.value[g]),c.innerHTML=t.text[g],u.appendChild(c)}i&&(u.size=i),u.style.display="block",u.style.margin="0 auto";var S=document.getElementById(".BoxPanelSelect.okbt");S.onclick=function(){r(t.value[u.selectedIndex])},S.style.display="inline";var f=document.getElementById(".BoxPanelSelect.cancelbt");f.onclick=n,f.style.display="inline",a.style.width=o||"200px",a.style.marginLeft=parseFloat(a.style.width)/-2+"px",a.style.visibility="visible",s.style.visibility="visible"}},EJSS_INTERFACE.boxPanel=function(e){var t=EJSS_INTERFACE.panel(e);t.setVisibility=function(e){mElement.style.visibility=e,t.getStyle().setVisibility(e)},t.registerProperties=function(e){EJSS_INTERFACE.BoxPanel.registerProperties(t,e)};var r=document.createElement("div");document.body.appendChild(r),r.className="myBoxPanelBackground",r.id=e+".back",r.style.backgroundColor="rgba(255, 255, 255, 0.3)",r.style.position="fixed",r.style.top="1%",r.style.left="1%",r.style.width="98%",r.style.height="98%",r.style.zIndex="99998",r.style.visibility="hidden";var n=document.createElement("span");n.id=e+".msg",n.style.visibility="hidden",t.getDOMElement().appendChild(n);var i=document.createElement("input");i.id=e+".input",i.type="text",i.style.display="none",i.size="20",t.getDOMElement().appendChild(i);var o=document.createElement("select");o.id=e+".select",o.style.display="none",o.size="4",t.getDOMElement().appendChild(o);var a=document.createElement("button");a.id=e+".okbt",a.innerHTML="Ok",a.style.verticalAlign="middle",a.style.display="none",a.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(a);var s=document.createElement("button");return s.id=e+".cancelbt",s.innerHTML="Cancel",s.style.verticalAlign="middle",s.style.display="none",s.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(s),t.getDOMElement().className="BoxPanel",t.getStyle().setCSS({position:"fixed",top:"25%",left:"50%"}),t.getStyle().setCSS({zIndex:"99999",visibility:"hidden"}),t.getStyle().setCSS({marginLeft:"-250px",width:"500px"}),t.getStyle().setCSS({background:"lightgray"}),t.getStyle().setCSS({borderWidth:"1px"}),t.getStyle().setCSS({borderStyle:"solid"}),t.getStyle().setCSS({borderColor:"red"}),t.getStyle().setCSS({overflow:"hidden",wordWrap:"break-word"}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Button={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease")}},EJSS_INTERFACE.button=function(e){function t(){r.getDOMElement().innerHTML="",n.length>0&&(r.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+n+'"/>'),i.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+i.toString()+"</span>")}var r=EJSS_INTERFACE.element(e),n="",i="";r.setDisabled=function(e){r.getDOMElement().disabled=e},r.getDisabled=function(){return r.getDOMElement().disabled},r.setText=function(e){i!=e&&(i=e,t())},r.getText=function(){return i},r.setImageUrl=function(e){var i=r.getResourcePath(e);i!=n&&(n=i,t())},r.getImageUrl=function(){return n},r.registerProperties=function(e){EJSS_INTERFACE.Button.registerProperties(r,e)};var o=document.createElement("button");return o.id=e,o.style.verticalAlign="middle",document.body.appendChild(o),r.setDOMElement(o),r.getDOMElement().onmousedown=function(){var e=r.getController();e&&e.invokeAction("OnPress").reportInteractions()},r.getDOMElement().addEventListener("touchstart",function(){var e=r.getController();e&&e.invokeAction("OnPress").reportInteractions()}),r.getDOMElement().onmouseup=function(){var e=r.getController();e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions())},r.getDOMElement().addEventListener("touchend",function(){var e=r.getController();e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions())}),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Canvas={},EJSS_INTERFACE.canvas=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.CheckBox={},EJSS_INTERFACE.checkBox=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ComboBox={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Options",e.setOptions,e.getOptions),t.registerProperty("SelectedOptions",e.setSelectedOptions,e.getSelectedOptions),t.registerProperty("Multiple",e.setMultiple),t.registerProperty("Size",e.setSize),t.registerAction("OnChange"),t.registerAction("OnFocus")}},EJSS_INTERFACE.comboBox=function(e){var t=EJSS_INTERFACE.element(e),r=[];t.registerProperties=function(e){EJSS_INTERFACE.ComboBox.registerProperties(t,e)},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setSelectedOptions=function(e){for(var r=t.getDOMElement(),n=0;n<r.options.length;n++){r.options[n].selected=!1;for(var i=0;i<e.length;i++)if(r.options[n].value==e[i]){r.options[n].selected=!0;break}}},t.getSelectedOptions=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=r.options[i].value);return e},t.getSelectedOptionsIndexes=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=i);return e},t.setOptions=function(e){if(!EJSS_TOOLS.compareArrays(r,e)){r=[];var n=t.getSelectedOptions(),i=t.getDOMElement();i.innerHTML="";for(var o=0;o<e.length;o++){var a=document.createElement("option");a.setAttribute("value",e[o]),a.innerHTML=e[o],i.appendChild(a),r[o]=e[o]}t.setSelectedOptions(n)}},t.getOptions=function(){for(var e=[],r=t.getDOMElement(),n=0;n<r.options.length;n++)e[n]=r.options[n].value;return e},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly};var n=document.createElement("select");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onfocus=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("Options"),e.invokeAction("OnFocus"),e.reportInteractions())},t.getDOMElement().onchange=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("SelectedOptions"),e.invokeAction("OnChange"),e.reportInteractions())},t.getDOMElement().onkeydown=function(){t.getStyle().setBackgroundColor("yellow")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.DataTable={},EJSS_INTERFACE.dataTable=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Element={registerProperties:function(e,t){e.setController(t),t.registerProperty("Tooltip",e.setTitle),t.registerProperty("Foreground",e.getStyle().setColor),t.registerProperty("Background",e.getStyle().setBackgroundColor),t.registerProperty("BackgroundImage",e.getStyle().setBackgroundImage),t.registerProperty("BorderWidth",e.getStyle().setBorderWidth),t.registerProperty("BorderColor",e.getStyle().setBorderColor),t.registerProperty("BorderStyle",e.getStyle().setBorderStyle),t.registerProperty("Padding",e.getStyle().setPadding),t.registerProperty("Width",e.getStyle().setWidth,e.getStyle().getWidth),t.registerProperty("Height",e.getStyle().setHeight,e.getStyle().getHeight),t.registerProperty("LineHeight",e.getStyle().setLineHeight,e.getStyle().getLineHeight),t.registerProperty("TextAlign",e.getStyle().setTextAlign),t.registerProperty("VerticalAlign",e.getStyle().setVerticalAlign),t.registerProperty("Visibility",e.getStyle().setVisibility),t.registerProperty("Display",e.getStyle().setDisplay),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("Float",e.getStyle().setFloat),t.registerProperty("Position",e.getStyle().setPosition),t.registerProperty("Left",e.getStyle().setLeft),t.registerProperty("Top",e.getStyle().setTop),t.registerProperty("Bottom",e.getStyle().setBottom),t.registerProperty("Overflow",e.getStyle().setOverflow),t.registerProperty("BoxShadow",e.getStyle().setShadow),t.registerProperty("Margin",e.getStyle().setMargin),t.registerProperty("Parent",e.setParent),t.registerProperty("ClassName",e.setClassName),t.registerProperty("CSS",e.getStyle().setCSS),t.registerProperty("Font",e.getStyle().setFont),t.registerProperty("FontFamily",e.getStyle().setFontFamily),t.registerProperty("FontSize",e.getStyle().setFontSize),t.registerProperty("LetterSpacing",e.getStyle().setLetterSpacing),t.registerProperty("OutlineColor",e.getStyle().setOutlineColor),t.registerProperty("FontWeight",e.getStyle().setFontWeight),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("FontStyle",e.getStyle().setFontStyle),t.registerProperty("Transform",e.getStyle().setTransform),t.registerProperty("WhiteSpace",e.getStyle().setWhiteSpace)}},EJSS_INTERFACE.element=function(e){var t,r,n={},i=EJSS_INTERFACE.style(e),o=null;return n.getDOMElement=function(){return t},n.setDOMElement=function(e){t=e},n.setParent=function(e){if(r=e,"string"==typeof e){var t=document.getElementById(e);t.appendChild(n.getDOMElement())}else e.getDOMElement?e.appendChild(n):e.appendChild(n.getDOMElement())},n.getParent=function(){return r},n.getName=function(){return e},n.getResourcePath=function(e){return e},n.setClassName=function(e){n.getDOMElement().className=e},n._23Name=function(){return n.getDOMElement().className},n.setDisabled=function(e){n.getDOMElement().disabled=e},n.getDisabled=function(){return n.getDOMElement().disabled},n.setTitle=function(e){n.getDOMElement().title=e},n.getTitle=function(){return n.getDOMElement().title},n.getStyle=function(){return i},n.getController=function(){return o},n.setController=function(e){o=e},n.registerProperties=function(e){EJSS_INTERFACE.Element.registerProperties(n,e)},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FunctionField={},EJSS_INTERFACE.functionField=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Html={},EJSS_INTERFACE.html=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Image={},EJSS_INTERFACE.image=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ImageAndTextButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),
t.registerAction("OnClick")}},EJSS_INTERFACE.imageAndTextButton=function(e){var t=EJSS_INTERFACE.element(e),r="",n="";t.setText=function(e){r=e.toString(),t.getDOMElement().innerHTML=n+r},t.getText=function(){return r},t.setImageUrl=function(e){n='<img src="'+t.getResourcePath(e)+'"/>',t.getDOMElement().innerHTML=n+r},t.getImageUrl=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.ImageAndTextButton.registerProperties(t,e)};var i=document.createElement("button");return i.id=e,i.style.borderStyle="none",i.style.background="inherit",i.style.cursor="inherit",i.style.webkitBoxShadow="inset 0 0px 0 rgba(255,255,255,0),0 0px 0px rgba(0,0,0,0)",document.body.appendChild(i),t.setDOMElement(i),t.getDOMElement().onclick=function(){var e=t.getController();e&&e.invokeAction("OnClick").reportInteractions()},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Label={},EJSS_INTERFACE.label=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MathML={},EJSS_INTERFACE.mathML=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Media={},EJSS_INTERFACE.media=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MotionJPEG={},EJSS_INTERFACE.motionJPEG=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.NumberField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Format",e.setFormat),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.numberField=function(e){function t(){var e=r.getDOMElement().value;if(!isNaN(parseFloat(e))&&isFinite(e)){if(r.getStyle().setBackgroundColor("white"),a!=e){var t=r.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}else{if("∞"!==e&&"-∞"!==e&&"∅"!==e)return r.getStyle().setBackgroundColor("red"),!1;r.getStyle().setBackgroundColor("white")}return!0}var r=EJSS_INTERFACE.element(e),n=3,i=!1,o=!1,a="";r.registerProperties=function(e){EJSS_INTERFACE.NumberField.registerProperties(r,e)},r.enableEPub=function(){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(r.render=function(){r.enableEPub()}),r.setValue=function(e){o||("undefined"==typeof e?r.getDOMElement().value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)?i?r.getDOMElement().value=parseFloat(e).toExponential(n):r.getDOMElement().value=parseFloat(e).toFixed(n):e===Number.POSITIVE_INFINITY?r.getDOMElement().value="∞":e===Number.NEGATIVE_INFINITY?r.getDOMElement().value="-∞":isNaN(e)&&(r.getDOMElement().value="∅"))},r.getValue=function(){var e=r.getDOMElement().value;return!isNaN(parseFloat(e))&&isFinite(e)?e=parseFloat(e):"∞"===e?e=Number.POSITIVE_INFINITY:"-∞"===e?e=Number.NEGATIVE_INFINITY:"∅"===e&&(e=Number.NaN),e},r.setEditable=function(e){r.getDOMElement().readOnly=!e,e?r.getStyle().setBackgroundColor("white"):r.getStyle().setBackgroundColor("lightgrey")},r.getEditable=function(){return!r.getDOMElement().readOnly},r.setSize=function(e){r.getDOMElement().size=e},r.getSize=function(){return r.getDOMElement().size},r.setFormat=function(e){var t=e.indexOf("."),o=e.toUpperCase().indexOf("E");if(-1==o){var a=0;t>=0&&(a=Number(e.length-t-1)),(i||n!=a)&&(n=a,i=!1,r.setValue(r.getValue()))}else{var a=0;t>=0&&(a=Number(o-t-1)),i&&n==a||(n=a,i=!0,r.setValue(r.getValue()))}};var s=document.createElement("input");return s.type="tel",s.id=e,s.value=0,document.body.appendChild(s),r.setDOMElement(s),r.getDOMElement().onkeydown=function(e){var n=r.getDOMElement();if(!n.readOnly){var i=e||window.event,s=i.which?i.which:i.keyCode;13==s?(o=!1,t()&&(a=r.getDOMElement().value)):27==s?r.getDOMElement().value=a:(r.getStyle().setBackgroundColor("yellow"),o=!0)}},r.getDOMElement().onfocus=function(e){a=r.getDOMElement().value},r.getDOMElement().onblur=function(e){!e.readOnly&&o&&(o=!1,t())},"undefined"!=typeof _isEPub&&_isEPub&&(r.getDOMElement().ontouchstart=function(e){r.getDOMElement().disabled&&(r.getDOMElement().disabled=!1),r.getDOMElement().focus(),e.stop()}),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Panel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml,e.getHtml)}},EJSS_INTERFACE.panel=function(e){var t=EJSS_INTERFACE.element(e);t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)},t.setHtml=function(e){t.getDOMElement().innerHTML=e},t.getHtml=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Panel.registerProperties(t,e)};var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({display:"block","margin-left":"auto","margin-right":"auto"}),t.getDOMElement().ontouchstart=function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.PasswordField={},EJSS_INTERFACE.passwordField=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.RadioButton={},EJSS_INTERFACE.radioButton=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Separator={},EJSS_INTERFACE.separator=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Slider={},EJSS_INTERFACE.slider=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Style={BORDER_SOLID:"solid",BORDER_DOTTED:"dotted",BORDER_DASHED:"dashed",TEXTA_LEFT:"left",TEXTA_RIGHT:"right",TEXTA_CENTER:"center",TEXTA_JUSTIFY:"justify",VISIB_VISIBLE:"visible",VISIB_HIDDEN:"hidden",FLOAT_LEFT:"left",FLOAT_RIGHT:"right",FLOAT_NONE:"none",FLOAT_CENTER:"none",POSITION_STATIC:"static",POSITION_ABSOLUTE:"absolute",POSITION_FIXED:"fixed",POSITION_RELATIVE:"relative",POSITION_INHERIT:"inherit",OVERFLOW_VISIBLE:"visible",OVERFLOW_HIDDEN:"hidden",OVERFLOW_SCROLL:"scroll",OVERFLOW_AUTO:"auto",setCSS:function(e,t){var r=/-([\da-z])/gi,n=function(e,t){return(t+"").toUpperCase()},i=e.style;if("object"!=typeof t){var o=t.trim().split("{");if(o[0]&&o[0].length>0){var a,s=o[0].trim(),l=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(a=0;a<l.length&&l[a].selectorText!=s;a++);var u=l[a].cssText?l[a].cssText:l[a].style.cssText;u=u.match(/{.*}/g)[0];var g=u.slice(1,u.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),f=c[1].trim(),d=S.replace(r,n);i[d]=f}}}if(o[1]){var E=o[1].trim(),g=E.slice(0,E.length-2).split(";");for(elem in g){var c=g[elem].split(":");if(2==c.length){var S=c[0].trim(),f=c[1].trim(),d=S.replace(r,n);i[d]=f}}}}else for(var p in t){var d=p.replace(r,n);i[d]=t[p]}}},EJSS_INTERFACE.style=function(e){var t=EJSS_INTERFACE.Style,r={},n="white",i=0,o=t.BORDER_SOLID;return r.setCSS=function(r){t.setCSS(document.getElementById(e),r)},r.setVisibility=function(t){document.getElementById(e).style.visibility=t?"visible":"hidden"},r.getVisibility=function(){return"visible"==document.getElementById(e).style.visibility},r.setVerticalAlign=function(t){document.getElementById(e).style.verticalAlign=t},r.getVerticalAlign=function(){return document.getElementById(e).style.verticalAlign},r.setTextAlign=function(r){"TEXTA_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.textAlign=r},r.getTextAlign=function(){return document.getElementById(e).style.textAlign},r.setLineHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.lineHeight=t},r.getLineHeight=function(){return document.getElementById(e).style.lineHeight},r.setHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.height=t},r.getHeight=function(){return document.getElementById(e).style.height},r.setWidth=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.width=t},r.getWidth=function(){return document.getElementById(e).style.width},r.setOverflow=function(r){"OVERFL"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.overflow=r},r.getOverflow=function(){return document.getElementById(e).style.overflow},r.setPosition=function(r){"POSITI"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.position=r},r.getPosition=function(){return document.getElementById(e).style.position},r.setFloat=function(r){"FLOAT_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style["float"]=r},r.getFloat=function(){return document.getElementById(e).style["float"]},r.setDisplay=function(t){document.getElementById(e).style.display=t},r.getDisplay=function(){return document.getElementById(e).style.display},r.setTop=function(t){document.getElementById(e).style.top=t},r.getTop=function(){return document.getElementById(e).style.top},r.setBottom=function(t){document.getElementById(e).style.bottom=t},r.getBottom=function(){return document.getElementById(e).style.bottom},r.setLeft=function(t){document.getElementById(e).style.left=t},r.getLeft=function(){return document.getElementById(e).style.left},r.setBorderStyle=function(r){"BORDER"==r.substring(0,6)&&(r=t[r.toUpperCase()]),o=r,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderStyle=function(){return o},r.setBorderWidth=function(t){i=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderWidth=function(){return i},r.setBorderColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),n=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderColor=function(){return n},r.setPadding=function(t){document.getElementById(e).style.padding=t},r.getPadding=function(){return document.getElementById(e).style.padding},r.setShadow=function(t){t?document.getElementById(e).style.boxShadow=t:document.getElementById(e).style.boxShadow=""},r.getShadow=function(){return""!=document.getElementById(e).style.boxShadow},r.setMargin=function(t){document.getElementById(e).style.margin=t},r.getMargin=function(){return document.getElementById(e).style.margin},r.setBackgroundImage=function(t){document.getElementById(e).style.backgroundImage="url("+t+")",document.getElementById(e).style.backgroundSize="100% 100%"},r.getBackgroundImage=function(){return document.getElementById(e).style.backgroundImage},r.setBackgroundColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.backgroundColor=t},r.getBackgroundColor=function(){return document.getElementById(e).style.backgroundColor},r.setColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.color=t},r.getColor=function(){return document.getElementById(e).style.color},r.getFont=function(){return document.getElementById(e).style.font},r.setFont=function(t){var r=document.getElementById(e).style,n=t.split(" ");r.fontStyle=n[0],r.fontWeight=n[1];var i=n[2].split("/");r.fontSize=i[0],i[1]&&(r.lineHeight=i[1]),n[3]&&(r.fontFamily=t.substring(t.indexOf(n[3])))},r.setFontStyle=function(t){document.getElementById(e).style.fontStyle=t},r.getFontStyle=function(){return document.getElementById(e).style.fontStyle},r.setFontFamily=function(t){document.getElementById(e).style.fontFamily=t},r.getFontFamily=function(){return document.getElementById(e).style.fontFamily},r.setFontSize=function(t){document.getElementById(e).style.fontSize=t},r.getFontSize=function(){return document.getElementById(e).style.fontSize},r.setLetterSpacing=function(t){document.getElementById(e).style.letterSpacing=t},r.getLetterSpacing=function(){return document.getElementById(e).style.letterSpacing},r.setOutlineColor=function(t){document.getElementById(e).style.stroke=t},r.getOutlineColor=function(){return document.getElementById(e).style.stroke},r.setFontWeight=function(t){document.getElementById(e).style.fontWeight=t},r.getFontWeight=function(){return document.getElementById(e).style.fontWeight},r.setFillColor=function(t){document.getElementById(e).style.fill=t},r.getFillColor=function(){return document.getElementById(e).style.fill},r.setTransform=function(t){document.getElementById(e).style.transform=t,document.getElementById(e).style["-ms-transform"]=t,document.getElementById(e).style["-webkit-transform"]=t},r.getTransform=function(){return document.getElementById(e).style.transform},r.setWhiteSpace=function(t){document.getElementById(e).style.whiteSpace=t},r.getWhiteSpace=function(){return document.getElementById(e).style.whiteSpace},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.SvgGraphics={},EJSS_INTERFACE.svgGraphics=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextArea={},EJSS_INTERFACE.textArea=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextField={},EJSS_INTERFACE.textField=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TwoStateButton={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageUrlOn),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageUrlOff),t.registerProperty("State",e.setState,e.getState),t.registerAction("OnClick"),t.registerAction("OffClick")}},EJSS_INTERFACE.twoStateButton=function(e){function t(){n.getDOMElement().innerHTML="",l?(i.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+i+'"/>'),a.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+a.toString()+"</span>")):(o.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+o+'"/>'),s.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+s.toString()+"</span>"))}var r=EJSS_INTERFACE.TwoStateButton,n=EJSS_INTERFACE.element(e),i="",o="",a="",s="",l=-1;n.setTextOff=function(e){s=e,t()},n.getTextOff=function(){return s},n.setImageUrlOff=function(e){var r=n.getResourcePath(e);r!=o&&(o=r,t())},n.getImageUrlOff=function(){return o},n.setTextOn=function(e){a=e,t()},n.getTextOn=function(){return a},n.setImageUrlOn=function(e){var r=n.getResourcePath(e);r!=i&&(i=r,t())},n.getImageUrlOn=function(){
return i},n.setState=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),e!=l&&(l=e,t())},n.getState=function(){return l},n.registerProperties=function(e){EJSS_INTERFACE.TwoStateButton.registerProperties(n,e)};var u=document.createElement("button");return u.id=e,u.style.verticalAlign="middle",document.body.appendChild(u),n.setDOMElement(u),n.getDOMElement().onclick=function(){var e=n.getState();n.setState(!e);var t=n.getController();t&&(t.propertiesChanged("State"),e?t.invokeAction("OnClick"):t.invokeAction("OffClick"),t.reportInteractions())},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Video={},EJSS_INTERFACE.video=function(e){};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WebGLCanvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.webGLCanvas=function(e){var t,r=EJSS_INTERFACE.element(e),n=0,i=0,o=0,a=0;r.setWidth=function(e){var t=r.getDOMElement();return i!=e?(i=e,"string"==typeof e&&-1!=e.indexOf("%")&&t.parentNode&&t.parentNode.offsetWidth?e=t.parentNode.offsetWidth*parseFloat(e)/100:"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e&&t.setAttribute("width",e),!0):!1},r.getWidth=function(){var e=r.getDOMElement();if("string"==typeof i&&-1!=i.indexOf("%")&&e.parentNode&&e.parentNode.offsetWidth){var t=e.parentNode.offsetWidth*parseFloat(i)/100;if("number"==typeof t&&t!=a){var n=e.getAttribute("width");t!=n&&e.setAttribute("width",t),a=e.parentNode.offsetWidth*parseFloat(i)/100}}return i},r.setHeight=function(e){var t=r.getDOMElement();return n!=e?(n=e,"string"==typeof e&&-1!=e.indexOf("%")&&t.parentNode&&t.parentNode.offsetHeight?e=t.parentNode.offsetHeight*parseFloat(e)/100:"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e&&t.setAttribute("height",e),!0):!1},r.getHeight=function(){var e=r.getDOMElement();if("string"==typeof n&&-1!=n.indexOf("%")&&e.parentNode&&e.parentNode.offsetHeight&&(value=e.parentNode.offsetHeight*parseFloat(n)/100,"number"==typeof value&&value!=o)){var t=e.getAttribute("height");value!=t&&e.setAttribute("height",value),o=e.parentNode.offsetHeight*parseFloat(n)/100}return n},r.getContext=function(){return t},r.registerProperties=function(e){EJSS_INTERFACE.WebGLCanvas.registerProperties(r,e)};var s=document.createElement("canvas");s.setAttribute("id",e),document.body.appendChild(s),r.setDOMElement(s),r.setWidth(500),r.setHeight(500);try{t=s.getContext("webgl")}catch(l){}try{t=t||s.getContext("experimental-webgl")}catch(l){}try{t=t||s.getContext("webkit-3d")}catch(l){}try{t=t||s.getContext("moz-webgl")}catch(l){}if(!t){r.getStyle().setBackgroundColor("rgb(239,239,255)");var u=s.getContext("2d");u.font="bold 16px Arial",u.fillText("WebGL not supported!",100,100)}return r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WrappedPanel={},EJSS_INTERFACE.wrappedPanel=function(e){};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Model={MODE_JAVA_STYLE:1,MODE_RESPECT_TIME:2,MODE_RESPECT_DELAY:3},EJSS_CORE.createAnimation=function(){function e(e){for(var t=0,r=e.length;r>t;t++)if(f=!1,e[t](),f)return}var t,r,n,i={},o=1,a="Choose a name for the file",s="Select a file to read",l=o,u=1,g=!1,c=!0,S=!1,f=!1,d=+new Date,E=!1,p=null,h=NaN,m=l,A=0,y=10,v=!0,P=!1,D=EJSS_CORE.Model.MODE_JAVA_STYLE;i.setView=function(e){p=e,p._12(function(){E||p._16(b,r,E)&&(i.automaticResetSolvers(),i.update())})},i.getView=function(){return p},i.serialize=function(){var e={};i._userSerialize&&(e=i._userSerialize());var t=p.serialize(),r={model:e,view:t};return JSON.stringify(r,function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})},i.unserialize=function(e){var t=JSON.parse(e,function(e,t){return"__NaN"==t?t=NaN:"__Infinity"==t&&(t=1/0),t});if(t.model){var r=t.model;i._userUnserialize&&i._userUnserialize(r)}if(t.view){var n=t.view;p.unserialize(n)}};var _,I,C,R,T;i.sendCallback=function(){},i.setStatusParams=function(e,t,r,n,o,a){_=e,I=t,C=r,R=n,T=o,a&&(i.sendCallback=a)},i.sendSnapshot=function(e,t,r,n){if(R){var i=t.split(".").pop();i==t.split(".")[0]&&(i="");var o=t.split(".")[0]+"_context_id_"+_+"_user_id_"+I+"_ejsapp_id_"+C+i;e.importGraphics(function(e){var t=new XMLHttpRequest,i="user_file="+o+"&file="+encodeURIComponent(e)+"&type=png";t.open("POST",R,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4==t.readyState&&200==t.status?r&&r():n&&n()},t.send(i)})}},i.sendState=function(e,t,r){if(R){var n=e.split(".").pop();n==e.split(".")[0]&&(n="");var o=e.split(".")[0]+"_context_id_"+_+"_user_id_"+I+"_ejsapp_id_"+C+n,a=i.serialize(),s=new XMLHttpRequest,l="user_file="+o+"&file="+encodeURIComponent(a)+"&type=json";s.open("POST",R,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200==s.status?t&&t():r&&r()},s.send(l)}},i.sendText=function(e,t,r,n,i){if(R){if(r)o="."+r;else{r="txt";var o="."+e.split(".").pop();o=="."+e.split(".")[0]&&(o="")}var a=e.split(".")[0]+"_context_id_"+_+"_user_id_"+I+"_ejsapp_id_"+C+o,s=new XMLHttpRequest,l="user_file="+a+"&file="+encodeURIComponent(t)+"&type="+r;s.open("POST",R,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&200==s.status?n&&n():i&&i()},s.send(l)}},i.getState=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?(i.unserialize(n.responseText),t&&t()):r&&r()},n.send()},i.getText=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?t&&t(n.responseText):r&&r()},n.send()},i.getStateFiles=function(e,t,r){if(C){var n=new XMLHttpRequest,i=T+"?ejsapp_id="+C+"&type="+e;n.open("GET",i,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=n.responseText.split(";"),i={};i.name=[],i.url=[];for(var o=0;o+1<e.length;o++)i.name.push(e[o]),i.url.push(e[++o]);t&&t(i)}else r&&r()},n.send()}},i.saveText=function(e,t,r){if(!r){var r=t;t=null}_?EJSS_INTERFACE.BoxPanel.showInputDialog(a,function(e){i.sendText(e,r,t,function(){i.sendCallback()})}):i.sendText(e,r,t,function(){i.sendCallback()})},i.saveState=function(e){_?EJSS_INTERFACE.BoxPanel.showInputDialog(a,function(e){i.sendState(e,function(){i.sendCallback()})}):i.sendState(e,function(){i.sendCallback()})},i.saveImage=function(e,t){_?EJSS_INTERFACE.BoxPanel.showInputDialog(a,function(e){i.sendSnapshot(p[t],e,function(){i.sendCallback()})}):i.sendSnapshot(p[t],e,function(){i.sendCallback()})},i.readState=function(e,t){if(e)i.getState(e);else{var r="undefined"!=typeof t?t:".json";i.getStateFiles(r,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(s,t,function(e){i.getState(e)})})}},i.readText=function(e,t,r){e?i.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,i._userUnserialize(t)}}):i.getStateFiles(t,function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(s,t,function(e){i.getText(e,function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,i._userUnserialize(t)}})})})};var N,O,M=[],b=0,G={},x=!1;i.getEventInteractionsStream=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:+new Date};n.runCount=b,n.runTime=r,n.event="mouse",N.send(JSON.stringify(n))},i.startCaptureStream=function(e,t,n,o,a){var s=window.location,l="https:"===s.protocol?"wss:":"ws:";l+="//"+s.host+":"+e;try{N=new WebSocket(l),"undefined"!=typeof t&&t(),N.onopen=function(){b=0,r=+new Date,p.registerInteractions(N),document.addEventListener("mousemove",i.getEventInteractionsStream),document.addEventListener("touchmove",i.getEventInteractionsStream),document.addEventListener("mousedown",i.getEventInteractionsStream),document.addEventListener("touchstart",i.getEventInteractionsStream)},N.onclose=function(e){i.stopCaptureStream(),a(e)},N.onmessage=function(e){console.log("Message is received: "+e.data)}}catch(u){return void("undefined"!=typeof n&&n(u))}},i.stopCaptureStream=function(){try{N.close()}catch(e){}p.unregisterInteractions(),document.removeEventListener("mousemove",i.getEventInteractionsStream),document.removeEventListener("touchmove",i.getEventInteractionsStream),document.removeEventListener("mousedown",i.getEventInteractionsStream),document.removeEventListener("touchstart",i.getEventInteractionsStream)},i.playCaptureStream=function(e,t,n,i,o){var a=10;if(!x){x=!0;var s=[];try{O=new EventSource(e),"undefined"!=typeof t&&t(),O.onopen=i,O.onclose=function(e){var t=document.getElementById("_my_mouse");t&&document.body.removeChild(t),o(e)},O.onmessage=function(e){var t=JSON.parse(e.data);console.log("Now: "+Date.now()+"-"+t.timeStamp),s=s.concat(t.interactions)}}catch(l){return void("undefined"!=typeof n&&n(l))}setTimeout(function(){b=0,r=+new Date,W=[];var e=0,t=b,n=0,i=0,o=0,l=0,u=setInterval(function(){for(var r=e;r<s.length;){var g=s[r++];if("undefined"!=typeof g.isPlaying&&g.isPlaying)W.push(g),e++;else if(g.runCount==t&&n>=g.timeStamp-g.runTime&&i<=g.timeStamp-g.runTime){e++,i=g.timeStamp-g.runTime;for(var c in G){var S=p[c];S.getDOMElement().style.border=G[c]}if(G={},"undefined"!=typeof g.event){var f=g.pageX,d=g.pageY,E=g.target;if("undefined"!=typeof E&&E.length>0){var S=document.getElementById(E);null!=S&&(o=g.offsetLeft-S.offsetLeft,l=g.offsetTop-S.offsetTop)}f-=o,d+=l;var h=document.getElementById("_my_mouse");if(!h){var h=document.createElement("div");h.id="_my_mouse",h.style.position="absolute",h.style.margin="0",h.style.border="3px solid red",document.body.appendChild(h)}h.style.left=f+"px",h.style.top=d+"px"}else if("undefined"!=typeof g.property){var S=p[g.element];S.propertyChanged(g.property,g.data).reportInteractions()}else if("undefined"!=typeof g.action){var S=p[g.element];S.invokeAction(g.action).reportInteractions(),"undefined"==typeof G[S.getName()]&&(G[S.getName()]=S.getDOMElement().style.border),S.getDOMElement().style.border="1px solid red"}}}t!=b?(t=b,n=0,i=0):n+=a,x||clearInterval(u)},a)},1e3)}},i.pauseCaptureStream=function(){try{O.close()}catch(e){}x=!1},i.getEventInteractions=function(e){var t=e.target||e.srcElement,n={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:e.timeStamp};n.runCount=b,n.runTime=r,n.event="mouse",M.push(n)},i.startCapture=function(){b=0,r=+new Date,p.registerInteractions(),M=[],document.addEventListener("mousemove",i.getEventInteractions),document.addEventListener("touchmove",i.getEventInteractions),document.addEventListener("mousedown",i.getEventInteractions),document.addEventListener("touchstart",i.getEventInteractions)},i.stopCapture=function(){p.unregisterInteractions(),document.removeEventListener("mousemove",i.getEventInteractions),document.removeEventListener("touchmove",i.getEventInteractions),document.removeEventListener("mousedown",i.getEventInteractions),document.removeEventListener("touchstart",i.getEventInteractions);var e={interactions:p.getRegInteractions(),events:M};return e},i._readCapturedInteractions=function(){for(var e=W.length,t=0;e>t;t++){var r=W[t];if(r.runCount==b&&r.isPlaying){if("undefined"!==r.property){var n=p[r.element];n.propertyChanged(r.property,r.data).reportInteractions()}if("undefined"!==r.action){var n=p[r.element];n.invokeAction(r.action).reportInteractions(),"undefined"==typeof G[n.getName()]&&(G[n.getName()]=n.getDOMElement().style.border),n.getDOMElement().style.border="1px solid red"}r.runCount=-1}}};var L=!1,J=!1,w=1,k=!1,W=[];i.playCapture=function(e,t,n){var o=10,a=e.interactions,s=a.length,u=0,g=e.events,c=g.length,S=0;if(!L){L=!0,J=!1,i.reset(),"undefined"!=typeof n&&(w=n),l/=w,b=0,r=+new Date,W=a;var f=b,d=0,E=0,h=0,m=setInterval(function(){for(var e in G){var r=p[e];r.getDOMElement().style.border=G[e]}if(G={},L){for(;s>u&&a[u].runCount<=f&&d>=a[u].timeStamp-a[u].runTime;){if(!a[u].isPlaying){if("undefined"!==a[u].property){var r=p[a[u].element];r.propertyChanged(a[u].property,a[u].data).reportInteractions()}if("undefined"!==a[u].action){var r=p[a[u].element];r.invokeAction(a[u].action).reportInteractions(),"undefined"==typeof G[r.getName()]&&(G[r.getName()]=r.getDOMElement().style.border),r.getDOMElement().style.border="1px solid red"}}u++}for(;c>S&&g[S].runCount<=f&&d>=g[S].timeStamp-g[S].runTime;){var n=g[S].pageX,i=g[S].pageY,A=g[S].target;if("undefined"!=typeof A&&A.length>0){var r=document.getElementById(A);null!=r&&(E=g[S].offsetLeft-r.offsetLeft,h=g[S].offsetTop-r.offsetTop)}n-=E,i+=h;var y=document.getElementById("_my_mouse");if(!y){var y=document.createElement("div");y.id="_my_mouse",y.style.position="absolute",y.style.margin="0",y.style.border="3px solid red",document.body.appendChild(y)}y.style.left=n+"px",y.style.top=i+"px",S++}if(f!=b?(f=b,d=0):d+=o*w,S>=c&&u>=s){var y=document.getElementById("_my_mouse");y&&document.body.removeChild(y),clearInterval(m),L=!1,l*=w,W=[],t()}}J&&(clearInterval(m),L=!1,l*=w,W=[],t())},o)}},i.pauseCapture=function(){k=E,i.pause(),L=!1},i.resumeCapture=function(){k&&i.play(),L=!0},i.resetCapture=function(){J=!0},i.changeCaptureStep=function(e){l*=w,w=e,l/=w},i.setMode=function(e){i.setRunningMode(e)},i.setRunningMode=function(e){D="string"==typeof e?EJSS_CORE.Model[e.toUpperCase()]:e},i.getMode=function(){return D},i.setRunAlways=function(e){P=e},i.setPauseOnPageExit=function(e){P=!e},i.setFPS=function(e){l=Math.max(1e3/e,o)},i.getFPS=function(){return Math["int"](1e3/l)},i.setDelay=function(e){l=Math.max(e,0)},i.setMinimumDelay=function(e){y=Math.max(e,0)},i.setStepsPerDisplay=function(e){e>=1&&(u=e)},i.setUpdateView=function(e){c=e},i.setAutoplay=function(e){S=e},i.isPlaying=function(){return E},i.isPaused=function(){return!E},i.resetRealTime=function(){var e=+Date();h=1e3*i.getRealTime()-e},i.play=function(){E||(d=+new Date,m=l,E=!0,t=window.setTimeout(i.run,y))},i.pause=function(){E=!1,g=!0,0!=t&&(window.clearTimeout(t),t=0)},i.run=function(){b++,r=+new Date;var e,n=1;if(E){if(v||P){switch(D){default:case EJSS_CORE.Model.MODE_JAVA_STYLE:i.step(),d=+new Date,e=d-r,n=Math.max(y,l-e);break;case EJSS_CORE.Model.MODE_RESPECT_DELAY:i.step(),n=l,d=+new Date;break;case EJSS_CORE.Model.MODE_RESPECT_TIME:if(e=r-d,e>=m-A){var o=0;m&&(o=Math.floor((e+A)/m),A=e+A-o*m);var a=i.step(o);m&&a>e&&o>100&&(alert("Imposible running with delay "+m+" ms."),E=!1,A=0),m=l,d=r}}var s=t;if(i._readCapturedInteractions(),p._16(b,r,E)&&(i.automaticResetSolvers(),i.update()),s!=t)return}else d=+new Date;t=window.setTimeout(i.run,n)}},i.onExit=function(){i.pause(),p._16(b,r,E),i.freeMemory()},i.reset=function(e){e||(i.pause(),i.resetModel()),p._14(!1),p._reset(),e||(p._15(),p._initialize(),i.initializeModel()),i.updateModel(),c?(p._update(),p._render()):p._collectData(),p._14(!0),S&&i.play(),p._resized(window.innerWidth,window.innerHeight)},i.initialize=function(){p._initialize(),i.initializeModel(),i.updateModel(),c?(p._update(),p._render()):p._collectData()},i.update=function(){(v||P)&&(i.updateModel(),c?(p._update(),p._render()):p._collectData())},i.step=function(e){var t=+new Date;e||(e=1);var r=Math.max(e,u);if(r>1){g=!1;for(var n=1;r>n;n++){if(g)return void i.update();i.stepModel(),i.updateModel(),p._collectData()}}i.stepModel();var o=+new Date-t;return i.update(),o},i.setShouldBreak=function(e){f=e},i.getShouldBreak=function(){return f},i._autoSelectView=function(e){for(var t=screen.height,r=screen.width,n=[],i=Number.MAX_VALUE,o=0;o<e.length;o++){var a=r-e[o].width;a>=0&&(i>a?(i=a,n=[o]):a==i&&n.push(o))}var s=-1;i=Number.MAX_VALUE;for(var o=0;o<n.length;o++){var a=Math.abs(t-e[n[o]].height);i>a&&(i=a,s=n[o])}return s},i.addToOnload=function(e){n=e},i.onload=function(){"function"==typeof n&&n()};var F=[],V=[],B=[],H=[];return i.getRealTime=function(){return NaN},i.automaticResetSolvers=function(){},i.freeMemory=function(){},i.addToReset=function(e){F.push(e)},i.addToInitialization=function(e){V.push(e)},i.addToEvolution=function(e){B.push(e)},i.addToFixedRelations=function(e){H.push(e)},i.resetModel=function(){e(F)},i.initializeModel=function(){e(V)},i.stepModel=function(){e(B)},i.updateModel=function(){e(H)},window.onblur=function(){v=!1,p&&p._onBlur()},window.onfocus=function(){v=!0,p&&p._onFocus()},i};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Bootstrap2IntervalData={},EJSS_ODE_INTERPOLATION.bootstrap2IntervalData=function(e,t,r,n,i){var o,a,s,l,u=EJSS_ODE_INTERPOLATION.bootstrapIntervalData(e,t,r,n,i);u.interpolate=function(e,t){var r=u.getDeltaTime(),n=u.getLeftState(),i=u.getLeftRate(),g=(e-u.getLeft())/r;return n[t]+g*(r*i[t]+g*(o[t]+g*(a[t]+g*(s[t]+g*l[t]))))},u.interpolateState=function(e,t,r,n){return u.bootstrap2((e-u.getLeft())/u.getDeltaTime(),t,r,n),t},u.bootstrap2=function(e,t,r,n){for(var i=u.getDeltaTime(),g=u.getLeftState(),c=u.getLeftRate(),S=r,f=0;n>f;f++)t[f]=g[S]+e*(i*c[S]+e*(o[S]+e*(a[S]+e*(s[S]+e*l[S])))),S++};var g=.7,c=.85,S=2*g*(g-1)*c*(c-1)*(c-g)*(10*g*c-5*c-5*g+3),f=g*(-3*g+2),d=g*(-3*g+4)-1,E=6*g*(g-1),p=c*(-3*c+2),h=c*(-3*c+4)-1,m=6*c*(c-1),A=g*(2+g*(-6+4*g)),y=c*(2+c*(-6+4*c)),v=g*(4+g*(-9+5*g*g)),P=c*(4+c*(-9+5*c*c)),D=e.length,_=D-1,I=u.getDeltaTime(),C=new Array(D),R=new Array(D),T=new Array(D);o=new Array(D),a=new Array(D),s=new Array(D),l=new Array(D),u.bootstrap1(g,C,0,_),C[_]=u.getLeft()+g*I,i.getRate(C,R),u.bootstrap1(c,C,0,_),C[_]=u.getLeft()+c*I,i.getRate(C,T);for(var N=0;D>N;N++){var O=r[N]-e[N],M=I*t[N],b=I*n[N],G=I*R[N]+f*b+d*M+E*O,x=I*T[N]+p*b+h*M+m*O,L=(P*G-v*x)/S,J=(A*x-y*G)/S,w=b+M-2*O-2*L-3*J;l[N]=J,s[N]=L,a[N]=w,o[N]=O-M-w-L-J}return u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.BootstrapIntervalData={},EJSS_ODE_INTERPOLATION.bootstrapIntervalData=function(e,t,r,n,i){var o,a,s,l=EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,n);l.interpolate=function(e,t){var r=l.getDeltaTime(),n=l.getLeftState(),i=l.getLeftRate(),u=(e-l.getLeft())/r;return n[t]+u*(r*i[t]+u*(o[t]+u*(a[t]+u*s[t])))},l.interpolateState=function(e,t,r,n){return l.bootstrap1((e-l.getLeft())/l.getDeltaTime(),t,r,n),t},l.bootstrap1=function(e,t,r,n){for(var i=l.getDeltaTime(),u=l.getLeftState(),g=l.getLeftRate(),c=r,S=0;n>S;S++)t[S]=u[c]+e*(i*g[c]+e*(o[c]+e*(a[c]+e*s[c]))),c++};var u=.25,g=u*(u-1)*(4*u-2),c=u*(-3*u+2),S=u*(-3*u+4)-1,f=6*u*(u-1),d=e.length,E=l.getDeltaTime(),p=new Array(d),h=new Array(d);o=new Array(d),a=new Array(d),s=new Array(d),l.hermite(u,p,0,d-1),p[d-1]=l.getLeft()+u*E,i.getRate(p,h);for(var m=0;d>m;m++){var A=r[m]-e[m],y=E*t[m],v=E*n[m],P=(E*h[m]+c*v+S*y+f*A)/g,D=v+y-2*A-2*P;s[m]=P,a[m]=D,o[m]=A-y-D-P}return l};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ConstantConditionData={},EJSS_ODE_INTERPOLATION.constantConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(e,r){return t[r]},r.interpolateState=function(e,r,n,i){for(var o=n,a=0;i>a;a++)r[a]=t[o],o++;return r};var n=e.length;t=new Array(n);for(var i=0;n>i;i++)t[i]=e[i];return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri5IntervalData={},EJSS_ODE_INTERPOLATION.dopri5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*o[4][t])))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;i>u;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*s[4][l]))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri853IntervalData={},EJSS_ODE_INTERPOLATION.dopri853IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*(o[4][t]+r*(o[5][t]+i*(o[6][t]+r*o[7][t]))))))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;i>u;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*(s[4][l]+o*(s[5][l]+a*(s[6][l]+o*s[7][l])))))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerIntervalData={},EJSS_ODE_INTERPOLATION.eulerIntervalData=function(e,t,r){var n,i,o=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);o.interpolate=function(e,t){var r=e-o.getLeft();return n[t]+r*i[t]},o.interpolateState=function(e,t,r,a){for(var s=e-o.getLeft(),l=r,u=0;a>u;u++)t[u]=n[l]+s*i[l],l++;return t};var a=e.length;n=new Array(a),i=new Array(a);for(var s=0;a>s;s++)n[s]=e[s],i[s]=t[s];return o};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerRichardsonIntervalData={},EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData=function(e,t,r,n){var i,o,a,s,l,u=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);u.interpolate=function(e,t){var r=(e-u.getLeft())/o,n=r*r*o,i=o*r-n;return a[t]+i*s[t]+n*l[t]},u.interpolateState=function(e,t,r,n){for(var i=(e-u.getLeft())/o,g=i*i*o,c=o*i-g,S=r,f=0;n>f;f++)t[f]=a[S]+c*s[S]+g*l[S],S++;return t};var g=e.length;a=new Array(g),s=new Array(g),l=new Array(g);for(var c=0;g>c;c++)a[c]=e[c],s[c]=t[c],l[c]=n[c];return i=g-1,o=r-e[i],u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ExtraStepsIntervalData={},EJSS_ODE_INTERPOLATION.extraStepsIntervalData=function(e,t,r){var n,i,o,a=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],t[t.length-1]);a.getTimeIndex=function(){return n},a.getDeltaTime=function(){return i},a.getCoeffs=function(){return o};var s=e.length;n=s-1,i=t[n]-e[n];var l=r.length;o=new Array(l);for(var u=0;l>u;u++){o[u]=new Array(s);for(var g=0;s>g;g++)o[u][g]=r[u][g]}return a};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.HermiteIntervalData={},EJSS_ODE_INTERPOLATION.hermiteIntervalData=function(e,t,r,n){var i,o,a,s,l,u,g=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r[r.length-1]);g.getTimeIndex=function(){return i},g.getDeltaTime=function(){return o},g.getLeftState=function(){return a},g.getLeftRate=function(){return s},g.interpolate=function(e,t){var r=(e-g.getLeft())/o,n=r-1,i=r*n,c=i*(1-2*r),S=-n-c,f=r+c,d=i*n*o,E=i*r*o;return S*a[t]+f*l[t]+d*s[t]+E*u[t]},g.interpolateState=function(e,t,r,n){return g.hermite((e-g.getLeft())/o,t,r,n),t},g.hermite=function(e,t,r,n){for(var i=e-1,g=e*i,c=g*(1-2*e),S=-i-c,f=e+c,d=g*i*o,E=g*e*o,p=r,h=0;n>h;h++)t[h]=S*a[p]+f*l[p]+d*s[p]+E*u[p],p++};var c=e.length;a=new Array(c),s=new Array(c),l=new Array(c),u=new Array(c);for(var S=0;c>S;S++)a[S]=e[S],s[S]=t[S],l[S]=r[S],u[S]=n[S];return i=c-1,o=r[i]-e[i],g};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.InitialConditionData={},EJSS_ODE_INTERPOLATION.initialConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(r,n){return e.getInitialCondition(r,t),t[n]},r.interpolateState=function(r,n,i,o){e.getInitialCondition(r,t);for(var a=i,s=0;o>s;s++)n[s]=t[a],a++;return n};var n=e.getState(),i=n.length;return t=new Array(i),r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.IntervalData={},EJSS_ODE_INTERPOLATION.intervalData=function(e,t){var r={};return r.getLeft=function(){return e},r.getRight=function(){return t},r.setRight=function(e){t=e},r.interpolate=function(e,t){return Number.NaN},r.interpolateState=function(e,t,r,n){return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Radau5IntervalData={},EJSS_ODE_INTERPOLATION.radau5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r),i=bState[bState.length-1];return n.interpolate=function(e,t){var r=(e-i)/n.getDeltaTime(),o=n.getCoeffs(),a=EJSS_ODE_SOLVERS.Radau5.c1m1,s=EJSS_ODE_SOLVERS.Radau5.c2m1;return o[0][t]+r*(o[1][t]+(r-s)*(o[2][t]+(r-a)*o[3][t]))},n.interpolateState=function(e,t,r,o){for(var a=(e-i)/mDeltaTime,s=n.getCoeffs(),l=EJSS_ODE_SOLVERS.Radau5.c1m1,u=EJSS_ODE_SOLVERS.Radau5.c2m1,g=r,c=0;o>c;c++)t[c]=s[0][g]+a*(s[1][g]+(a-u)*(s[2][g]+(a-l)*s[3][g])),g++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.StateHistory={},EJSS_ODE_INTERPOLATION.stateHistory=function(e){var t,r={},n=[],i=!0,o=0,a=0,s=0;return r.setLength=function(e){a=Math.abs(e),s=Math.max(o,a)},r.setMinimumLength=function(e){o=Math.abs(e),s=Math.max(o,a)},r.addIntervalData=function(e){i=e.getLeft()<=e.getRight();n.length;if(n.length>0){var t=n.length-1,r=n[t],o=0;if(i){for(;null!=r&&r.getLeft()>=e.getLeft();)o++,t--,r=0>t?null:n[t];null!=r&&e.getLeft()<r.getRight()&&r.setRight(e.getLeft())}else{for(;null!=r&&r.getLeft()<=e.getLeft();)o++,t--,r=0>t?null:n[t];null!=r&&e.getLeft()>r.getRight()&&r.setRight(e.getLeft())}o>0&&n.splice(t,o)}n.push(e)},r.toString=function(){for(var e="History has now "+n.length+" intervals: ",t=0,r=n.length;r>t;t++){var i=n[t];t>0&&(e+=", "),e+=" ["+i.getLeft()+","+i.getRight()+")"}return e},r.clearAll=function(){n=[]},r.clean=function(e){if(isFinite(s)){if(0==s)return void clearAll();var t=0,r=n.length;if(i){e-=s;for(var o=0;r>o;o++){var a=n[o];if(a.getRight()>e)break;t++}}else{e+=s;for(var o=0;r>o;o++){var a=n[o];if(a.getRight()<e)break;t++}}t>0&&n.splice(0,t)}},r.findInterval=function(e){var r=n.length;if(i)for(var o=r-1;o>=0;o--){var a=n[o];if(a.getLeft()<=e)return a}else for(var o=r-1;o>=0;o--){var a=n[o];if(a.getLeft()>=e)return a}return t},r.interpolate=function(e,t){var n=r.findInterval(e);return n.interpolate(e,t)},r.interpolateState=function(e,t,n,i){var o=r.findInterval(e);return i||(i=t.length),n||(n=0),o.interpolateState(e,t,n,i)},e.getInitialCondition?(t=EJSS_ODE_INTERPOLATION.initialConditionData(e),e.setStateHistory(r)):t=EJSS_ODE_INTERPOLATION.constantConditionData(e.getState()),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EVENT_TYPE={STATE_EVENT:0,POSITIVE_EVENT:1,CROSSING_EVENT:2},EJSS_ODE_SOLVERS.EVENT_METHOD={BISECTION:0,SECANT:1},EJSS_ODE_SOLVERS.ERROR={NO_ERROR:0,INTERNAL_SOLVER_ERROR:1,EVENT_NOT_FOUND:2,ILLEGAL_EVENT_STATE:3,ZENO_EFFECT:4,TOO_MANY_STEPS_ERROR:5,DISCONTINUITY_PRODUCED_ERROR:6,DID_NOT_CONVERGE:7},EJSS_ODE_SOLVERS.DISCONTINUITY_CODE={DISCONTINUITY_PRODUCED_ERROR:0,NO_DISCONTINUITY_ALONG_STEP:1,DISCONTINUITY_ALONG_STEP:2,DISCONTINUITY_JUST_PASSED:3,DISCONTINUITY_EXACTLY_ON_STEP:4},EJSS_ODE_SOLVERS.InterpolatorEventSolver={},EJSS_ODE_SOLVERS.interpolatorEventSolver=function(e,t){function r(t,r){h?e.bestInterpolate(t,r):e.interpolate(t,r)}function n(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];if(o+i[S]==o)return 0;var a=e.getMaximumTime(!1);return isNaN(a)?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]):o==a&&(a=e.internalStep(!1),isNaN(a))?E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at max step at "+n[S]):(r(a,n),a-o)}function i(){var n=t.getState(),i=e.getCurrentRate(),o=n[S];if(o+i[S]==o)return 0;var a=n[S]+m,s=e.getMaximumTime(!1);if(isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);var l=0;if(C)for(;a>s;){if(s=e.internalStep(!1),isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);if(++l>I){var u=n[S],g=e.bestInterpolate(a,new Array(c))[S];return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the maximum of "+I+" internal steps\nat "+g+", starting from "+u+" for an step of "+m)}}else for(;s>a;){if(s=e.internalStep(!1),isNaN(s))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver backwards at "+n[S]);if(++l>I)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S])}return r(a,n),m}function o(){var n=t.getState();if(P>0&&L>P&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var a=e.getMaximumTime(W);if(isNaN(a))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);if(i==a&&(a=e.internalStep(W),isNaN(a)))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+n[S]);null!=x&&(isNaN(x.getMaxAdvance())||(a=C?Math.min(a,x.getMaxAdvance()):Math.max(a,x.getMaxAdvance())));for(var u=C?Math.min(i+v,a):Math.max(i-v,a);;){var g=null;if(w=null,r(u,f),g=E.findFirstEvent(n,u,f),null==g&&null!=F&&F.getTime()<=u&&(g=F),null!=g){if(w=g,h)e.bestInterpolate(g.getTime(),n);else for(var d=0;c>d;d++)n[d]=f[d];var p=n[S];return g.action(),E.reinitialize(),n=t.getState(),p!=n[S]?(L=0,x=null,w=null,g.reset(n),g.getTime()-i):(null!=x&&(Math.abs(G-g.getTime())<D?L++:L=0),x=g,G=g.getTime(),g.getTime()-i)}if(u==a){for(var d=0;c>d;d++)n[d]=f[d];return s(n[S]),
a-i}u=C?Math.min(u+v,a):Math.max(u-v,a)}}function a(){var n=t.getState();if(P>0&&L>P&&l(n))return 0;var i=n[S],o=e.getCurrentRate();if(i+o[S]==i)return 0;var a=i+m,u=e.getMaximumTime(W);if(isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+n[S]);for(var g=C?Math.min(i+v,a):Math.max(i-v,a),d=0;;){var p=null;w=null;var A=C?g>u:u>g;if(A){if(e.bestInterpolate(u,f),p=E.findFirstEvent(n,u,f),null==p&&(p=F),null==p){for(var y=0;c>y;y++)n[y]=f[y];if(s(n[S]),u=e.internalStep(W),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver looking for an event at "+n[S]);if(++d>I)return E.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+n[S]);continue}}else if(r(g,f),p=E.findFirstEvent(n,g,f),null==p&&null!=F&&F.time<=g&&(p=F),null==p){if(g==a){for(var y=0;c>y;y++)n[y]=f[y];return s(n[S]),a-i}g=C?Math.min(g+v,a):Math.max(g-v,a);continue}if(w=p,h)e.bestInterpolate(p.getTime(),n);else for(var y=0;c>y;y++)n[y]=f[y];var R=n[S],T=p.action();if(E.reinitialize(),d=0,n=t.getState(),R!=n[S])return L=0,x=null,w=null,p.reset(n),p.getTime()-i;if(null!=x&&(Math.abs(G-p.getTime())<D?(L++,_&&(T=!1)):L=0),x=p,G=p.getTime(),T)return p.getTime()-i;if(P>0&&L>P&&l(n))return p.getTime()-i;if(F=null,u=e.getMaximumTime(W),isNaN(p.getMaxAdvance())||(u=C?Math.min(u,p.getMaxAdvance()):Math.max(u,p.getMaxAdvance())),isNaN(u))return E.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver after an event at "+n[S])}}function s(e){var t,r;for(r=O.length,t=0;r>t;t++){var n=O[t];n.findPosition(e,n.getH())}for(r=V.length,t=0;r>t;t++){var n=V[t];n.findPosition(e,n.getH())}}function l(e){if(J.length<=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ZENO_EFFECT,"A Zeno-like effect has been detected.\nLast event was "+x.getProblem()+" which took place at "+G),!0;var t,r=!1,n=J.length;for(t=0;n>t;t++){var i=J[t];i.zenoEffectAction(x.getProblem(),e)&&(r=!0)}return L=0,r}function u(e,t,r,n){r.splice(0,r.length);for(var i=O.length,o=0;i>o;o++){var a=O[o];switch(a.setH(a.getEvent().evaluate(t)),a.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:a.getH()<=0&&r.push(a);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(a.getH()<=0&&(a.hasPositiveFlag()||a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT))return a;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(a.getH()<0){if(a.hasPositiveFlag()||a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return a}else if(a.getH()>0&&a.hasNegativeFlag()&&a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)return a;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT){if(a.getH()<=-a.getEvent().getTolerance())return a}else if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT&&a.hasNegativeFlag()&&a.getH()>=0)return a;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)a.getH()>=0&&r.push(a);else if(a.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e+" for the state event "+a.getEvent()),a}}return null}function g(e,t,r){var n,i,o=e.length,a=r,s=r-t,l=(t+r)/2;if(C)for(n=0;o>n;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.min(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.min(a,t-i*s/(u.getHAfter()-i))}}else for(n=0;o>n;n++){var u=e[n];switch(u.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.max(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.max(a,t-i*s/(u.getHAfter()-i))}}return a}var c,S,f,d,E={},p=!0,h=!1,m=.1,A=Number.NaN,y=Number.NaN,v=Number.POSITIVE_INFINITY,P=500,D=2*Number.MIN_VALUE,_=!0,I=1e4,C=m>0,R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",N=0,O=[],M=[],b=[],G=Number.NaN,x=null,L=0,J=[],w=null,k=!1,W=!1,F=null,V=[],B=null,H=100,z=1e-8,Y=Number.NaN;return E.getEPSILON=function(){if(isNaN(Y)){for(Y=1;Y+1!=1;)Y/=2;Y*=2}return Y},E.setEnableExceptions=function(e){p=e},E.setBestInterpolation=function(e){h=e},E.setHistoryLength=function(t){e.getStateHistory().setLength(t)},E.setStepSize=function(t){m!=t&&(m=t,C=m>0,E.setInternalStepSize(e.getStepSize()))},E.getStepSize=function(){return m},E.setEstimateFirstStep=function(t){e.setEstimateFirstStep(t)},E.setInternalStepSize=function(t){e.setStepSize(C?Math.abs(t):-Math.abs(t))},E.setMaximumInternalStepSize=function(t){e.setMaximumStepSize(t)},E.setMaximumInternalSteps=function(e){I=e},E.setTolerances=function(t,r){e.setTolerances(A=Math.abs(t),y=Math.abs(r))},E.setTolerance=function(e){setTolerances(e,0)},E.getTolerance=function(){return Math.max(A,y)},E.setDDETolerance=function(e){z=e},E.getDDETolerance=function(){return z},E.setDDEIterations=function(e){H=e},E.getDDEIterations=function(){return H},E.addEvent=function(e){O.push(EJSS_ODE_SOLVERS.eventData(E,e,t.getState())),k=!0},E.removeEvent=function(e){for(var t=-1,r=O.length,n=0;r>n;n++){var i=O[n];if(i.getEvent()==e){t=n;break}}if(t>=0){var o=O[t];x==o&&(x=null,L=0),w==o&&(w=null),O.splice(t,1)}k=W||O.length>0},E.addDiscontinuity=function(e){V.push(EJSS_ODE_SOLVERS.discontinuityData(E,e,t.getState())),W=!0,k=!0},E.removeDiscontinuity=function(e){for(var t=-1,r=V.length,n=0;r>n;n++){var i=V[n];if(i.getDiscontinuity()==e){t=n;break}}t>=0&&V.splice(t,1),W=V.length>0,k=W||O.length>0},E.removeAllEvents=function(){O=[],V=[],W=!1,k=!1,null!=B&&E.addDiscontinuity(B)},E.setMaximumEventStep=function(e){v=Math.abs(e)},E.getMaximumEventStep=function(){return v},E.setCoalesceCloseEvents=function(e){_=e},E.isCoalesceCloseEvents=function(){return _},E.setEventProximityThreshold=function(e){D=e},E.getEventProximityThreshold=function(){return D},E.setZenoEffectDetection=function(e){P=e},E.getZenoEffectDetection=function(){return P},E.addZenoEffectListener=function(e){J.push(e)},E.removeZenoEffectListener=function(e){for(var t=J.length,r=0;t>r;r++)if(J[r]==e)return void J.splice(r,1)},E.setZeroZenoCounter=function(){L=0},E.getSolverEngine=function(){return e},E.getODE=function(){return t},E.getStateHistory=function(){return e.getStateHistory()},E.getErrorCode=function(){return R},E.getErrorMessage=function(){return T},E.getCounter=function(){return e.getCounter()},E.getNumberOfAttempts=function(){return N},E.getInternalStepSize=function(){return e.getInternalStepSize()},E.getIndependentVariableValue=function(){return t.getState()[S]},E.getCurrentTime=function(){return t.getState()[S]},E.getRunsForwards=function(){return C},E.getCurrentEventData=function(){return w},E.getLastEventData=function(){return x},E.getLastEventDataTime=function(){return G},E.initialize=function(r){var n,i,o;for(m=r,C=m>0,e.initialize(m),o=t.getState(),c=o.length,S=c-1,f=new Array(c),d=new Array(c),R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",L=0,x=null,w=null,null!==B&&(B.initialize(o),E.removeDiscontinuity(B),E.addDiscontinuity(B)),i=O.length,n=0;i>n;n++)O[n].reset(o);for(i=V.length,n=0;i>n;n++)V[n].reset(o)},E.step=function(){return k?a():i()},E.maxStep=function(){return k?o():n()},E.userReinitialize=function(){w=null,E.reinitialize()},E.reinitialize=function(){var r,n,i=t.getState();for(e.reinitialize(i),R=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,T="No error",null!=B&&B.reset(i),n=O.length,r=0;n>r;r++)O[r].reset(i);for(n=V.length,r=0;n>r;r++)V[r].reset(i);F=null},E.resetDiscontinuities=function(e){if(null!==B){B.reset(e);for(var t=V.length,r=0;t>r;r++)V[r].reset(e)}},E.checkDiscontinuity=function(e,t){for(var r=V.length,n=null,i=0;r>i;i++){var o=V[i],a=o.getDiscontinuity().evaluate(e);switch(o.setH(a),o.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:if(0>=a)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;a<o.getDiscontinuity().getTolerance()&&(n=o);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(0>=a&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(0>a&&o.hasPositiveFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;if(a>0&&o.hasNegativeFlag())return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(o.hasNegativeFlag()&&a>=0)return E.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[S]+" for the discontinuity "+o.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(a>0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;a>-o.getDiscontinuity().getTolerance()&&(n=o)}}return null!=n?(t&&(F=n,F.setTime(e[S])),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP):EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},E.error=function(t,r){if(R=t,T=r,p)throw{name:"ODE Solver exception",solver:e,message:r};return Number.NaN},E.findFirstEvent=function(t,n,i){var o,a;N=0;var s=u(t[S],i,M,"at t1");if(null!=s){for(s.time=t[S],s.maxAdvance=n,o=0;c>o;o++)i[o]=t[o];return s}if(M.length<=0)return null;var l=!0;for(a=O.length,o=0;a>o;o++){var f=O[o];f.setHAfter(f.getH())}for(;l;){N++;var p=g(M,t[S],n);r(p,d);var h=u(t[S],d,b,"short");if(null!=h){for(h.time=t[S],h.maxAdvance=p,o=0;c>o;o++)i[o]=t[o];return h}if(b.length<=0){var m=null;for(a=M.length,o=0;a>o;o++){var f=M[o];if(f.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(f.getH()<f.getEvent().getTolerance()){m=f;break}}else if(f.getH()>-f.getEvent().getTolerance()){m=f;break}}if(null!=m){for(m.time=p,m.maxAdvance=n,o=0;c>o;o++)i[o]=d[o];return m}for(o=0;c>o;o++)t[o]=d[o];for(a=O.length,o=0;a>o;o++){var f=O[o];f.findPosition(t[S],f.getH())}var A=u(t[S],i,M,"at tTest");if(null!=A){for(A.time=t[S],A.maxAdvance=n,o=0;c>o;o++)i[o]=t[o];return A}}else{var y=!0,m=null;for(a=b.length,o=0;a>o;o++){var v=b[o];if(v.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(v.getH()<=-v.getEvent().getTolerance()){y=!1;break}m=v}else{if(v.getH()>=v.getEvent().getTolerance()){y=!1;break}m=v}}if(y&&null!=m){for(m.time=p,m.maxAdvance=n,o=0;c>o;o++)i[o]=d[o];return m}for(n=p,o=0;c>o;o++)i[o]=d[o];for(a=O.length,o=0;a>o;o++){var f=O[o];f.setHAfter(f.getH())}for(M=[],a=b.length,o=0;a>o;o++)M.push(b[o])}for(a=M.length,o=0;a>o;o++){var v=M[o];if(N>v.getEvent().getMaxIterations()){l=!1;break}}}var P=M[0];return E.error(EJSS_ODE_SOLVERS.ERROR.EVENT_NOT_FOUND,"Warning : Event not found after "+N+" attempts at t="+t[S]+" h="+P.getH()+".\nPlease check the code of your event, decrease the initial step size, the tolerance of the solver,\nor the event maximum step, or increase the maximum number of attempts.\nFirst event remaining in the queue: "+P.getEvent()),P.setTime((t[S]+n)/2),P.setMaxAdvance(Number.NaN),e.bestInterpolate(P.time,i),P},t.getDelays&&(B=EJSS_ODE_SOLVERS.ddeDiscontinuity(E,t)),e.setODE(E,t),E};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.BogackiShampine23={B3_1:2/9,B3_2:1/3,B3_3:4/9,B2_1:7/24,B2_2:.25,B2_3:1/3,B2_4:1/8},EJSS_ODE_SOLVERS.bogackiShampine23=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(3),i=n.allocateOtherArrays;return n.getNumberOfEvaluations=function(){return 3},n.allocateOtherArrays=function(){i(),e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(r,i){var o,a=r/2,s=n.getODE(),l=n.getInitialState(),u=n.getInitialRate(),g=n.getDimension(),c=g-1,S=(u[c],EJSS_ODE_SOLVERS.BogackiShampine23);for(o=0;g>o;o++)i[o]=l[o]+a*u[o];s.getRate(i,e);var f=.75*r;for(o=0;g>o;o++)i[o]=l[o]+f*e[o];for(s.getRate(i,t),o=0;c>o;o++)i[o]=l[o]+r*(S.B3_1*u[o]+S.B3_2*e[o]+S.B3_3*t[o]);i[c]=n.getInitialTime()+r*u[c]},n.computeCarefulIntermediateStep=function(r,i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,f=(g[S],EJSS_ODE_SOLVERS.BogackiShampine23),d=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(a=0;c>a;a++)o[a]=u[a]+s*g[a];switch(r.checkDiscontinuity(o,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(o,e);var E=.75*i;for(a=0;c>a;a++)o[a]=u[a]+E*e[a];switch(r.checkDiscontinuity(o,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}for(l.getRate(o,t),a=0;S>a;a++)o[a]=u[a]+i*(f.B3_1*g[a]+f.B3_2*e[a]+f.B3_3*t[a]);return o[S]=n.getInitialTime()+i*g[S],r.checkDiscontinuity(o,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=(n.getODE(),n.getInitialState()),t=n.getInitialRate(),r=n.getFinalState(),i=n.getFinalRate();return EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,i)},n.computeApproximation=function(i){var o=n.getODE(),a=n.getTimeIndex(),s=n.getInitialState(),l=n.getInitialRate(),u=n.getFinalState(),g=n.getFinalRate();o.getRate(u,g);for(var c=EJSS_ODE_SOLVERS.BogackiShampine23,S=0;a>S;S++)r[S]=s[S]+i*(c.B2_1*l[S]+c.B2_2*e[S]+c.B2_3*t[S]+c.B2_4*g[S]);return r[a]=n.getInitialTime()+i*l[a],n.computeError(r)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.CashKarp45={A_11:.2,A_21:.075,A_22:.225,A_31:.3,A_32:-.9,A_33:1.2,A_41:-11/54,A_42:2.5,A_43:-70/27,A_44:35/27,A_51:1631/55296,A_52:175/512,A_53:575/13824,A_54:44275/110592,A_55:253/4096,B4_1:2825/27648,B4_2:0,B4_3:18575/48384,B4_4:13525/55296,B4_5:277/14336,B4_6:.25,B5_1:37/378,B5_2:0,B5_3:250/621,B5_4:125/594,B5_5:0,B5_6:512/1771},EJSS_ODE_SOLVERS.cashKarp45=function(){var e,t,r,n,i,o,a=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),s=a.allocateOtherArrays;return a.getNumberOfEvaluations=function(){return 6},a.allocateOtherArrays=function(){s(),e=new Array(a.getDimension()),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(o,s){var l,u=a.getODE(),g=a.getInitialState(),c=a.getInitialRate(),S=a.getDimension(),f=S-1,d=(c[f],EJSS_ODE_SOLVERS.CashKarp45);for(l=0;S>l;l++)s[l]=g[l]+o*d.A_11*c[l];for(u.getRate(s,e),l=0;S>l;l++)s[l]=g[l]+o*(d.A_21*c[l]+d.A_22*e[l]);for(u.getRate(s,t),l=0;S>l;l++)s[l]=g[l]+o*(d.A_31*c[l]+d.A_32*e[l]+d.A_33*t[l]);for(u.getRate(s,r),l=0;S>l;l++)s[l]=g[l]+o*(d.A_41*c[l]+d.A_42*e[l]+d.A_43*t[l]+d.A_44*r[l]);for(u.getRate(s,n),l=0;S>l;l++)s[l]=g[l]+o*(d.A_51*c[l]+d.A_52*e[l]+d.A_53*t[l]+d.A_54*r[l]+d.A_55*n[l]);for(u.getRate(s,i),l=0;f>l;l++)s[l]=g[l]+o*(d.B5_1*c[l]+d.B5_2*e[l]+d.B5_3*t[l]+d.B5_4*r[l]+d.B5_5*n[l]+d.B5_6*i[l]);s[f]=a.getInitialTime()+o*c[f]},a.computeCarefulIntermediateStep=function(o,s,l){var u,g=a.getODE(),c=a.getInitialState(),S=a.getInitialRate(),f=a.getDimension(),d=f-1,E=(S[d],EJSS_ODE_SOLVERS.CashKarp45),p=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(u=0;f>u;u++)l[u]=c[u]+s*E.A_11*S[u];switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,e),u=0;f>u;u++)l[u]=c[u]+s*(E.A_21*S[u]+E.A_22*e[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,t),u=0;f>u;u++)l[u]=c[u]+s*(E.A_31*S[u]+E.A_32*e[u]+E.A_33*t[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,r),u=0;f>u;u++)l[u]=c[u]+s*(E.A_41*S[u]+E.A_42*e[u]+E.A_43*t[u]+E.A_44*r[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,n),u=0;f>u;u++)l[u]=c[u]+s*(E.A_51*S[u]+E.A_52*e[u]+E.A_53*t[u]+E.A_54*r[u]+E.A_55*n[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:break;case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,i),u=0;d>u;u++)l[u]=c[u]+s*(E.B5_1*S[u]+E.B5_2*e[u]+E.B5_3*t[u]+E.B5_4*r[u]+E.B5_5*n[u]+E.B5_6*i[u]);return l[d]=a.getInitialTime()+s*S[d],o.checkDiscontinuity(l,!0)},a.computeFinalRateAndCreateIntervalData=function(){var e=a.getODE(),t=a.getInitialState(),r=a.getInitialRate(),n=a.getFinalState(),i=a.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},a.computeApproximation=function(s){for(var l=a.getTimeIndex(),u=a.getInitialState(),g=a.getInitialRate(),c=EJSS_ODE_SOLVERS.CashKarp45,S=0;l>S;S++)o[S]=u[S]+s*(c.B4_1*g[S]+c.B4_2*e[S]+c.B4_3*t[S]+c.B4_4*r[S]+c.B4_5*n[S]+c.B4_6*i[S]);return o[l]=a.getInitialTime()+s*g[l],a.computeError(o)},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Euler={},EJSS_ODE_SOLVERS.euler=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return e.getNumberOfEvaluations=function(){return 1},e.computeIntermediateStep=function(t,r){for(var n=e.getDimension(),i=e.getInitialState(),o=e.getInitialRate(),a=0;n>a;a++)r[a]=i[a]+t*o[a]},e.computeCarefulIntermediateStep=function(t,r,n){return e.computeIntermediateStep(r,n),t.checkDiscontinuity(n,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),r=e.getInitialState(),n=e.getInitialRate(),i=e.getFinalState(),o=e.getFinalRate();return t.getRate(i,o),EJSS_ODE_INTERPOLATION.eulerIntervalData(r,n,i[e.getTimeIndex()])},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Radau5={c1:(4-Math.sqrt(6))/10,c2:(4+Math.sqrt(6))/10,c1m1:(4-Math.sqrt(6))/10-1,c2m1:(4+Math.sqrt(6))/10-1,c1mc2:(4-Math.sqrt(6))/10-(4+Math.sqrt(6))/10};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.RungeKutta4={},EJSS_ODE_SOLVERS.rungeKutta4=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return n.getNumberOfEvaluations=function(){return 4},n.allocateOtherArrays=function(){e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,f=g[S];for(a=0;c>a;a++)o[a]=u[a]+s*g[a];for(l.getRate(o,e),a=0;c>a;a++)o[a]=u[a]+s*e[a];for(l.getRate(o,t),a=0;c>a;a++)o[a]=u[a]+i*t[a];for(l.getRate(o,r),a=0;S>a;a++)o[a]=u[a]+i*(g[a]+2*e[a]+2*t[a]+r[a])/6;o[S]=n.getInitialTime()+i*f},n.computeCarefulIntermediateStep=function(i,o,a){var s,l=o/2,u=n.getODE(),g=n.getInitialState(),c=n.getInitialRate(),S=n.getDimension(),f=S-1,d=c[f],E=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(s=0;S>s;s++)a[s]=g[s]+l*c[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,e),s=0;S>s;s++)a[s]=g[s]+l*e[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,t),s=0;S>s;s++)a[s]=g[s]+o*t[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:break;case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,r),s=0;f>s;s++)a[s]=g[s]+o*(c[s]+2*e[s]+2*t[s]+r[s])/6;return a[f]=n.getInitialTime()+o*d,i.checkDiscontinuity(a,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=n.getODE(),t=n.getInitialState(),r=n.getInitialRate(),i=n.getFinalState(),o=n.getFinalRate();return e.getRate(i,o),EJSS_ODE_INTERPOLATION.bootstrapIntervalData(t,r,i,o,e)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTime={},EJSS_ODE_SOLVERS.solverEngineDiscreteTime=function(){var e,t,r,n,i,o,a,s,l,u={},g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,c=0,S=.1,f=Number.POSITIVE_INFINITY,d=0,E=0;return u.getNumberOfEvaluations=function(){return 0},u.allocateOtherArrays=function(){},u.computeIntermediateStep=function(e,t){return null},u.computeCarefulIntermediateStep=function(e,t,r){return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},u.computeFinalRateAndCreateIntervalData=function(){return null},u.getODE=function(){return a},u.getEventSolver=function(){return s},u.getDimension=function(){return e},u.getTimeIndex=function(){return t},u.getInitialTime=function(){return d},u.getInitialState=function(){return r},u.getInitialRate=function(){return n},u.getFinalState=function(){return i},u.getFinalRate=function(){return o},u.setFinalTime=function(e){E=e},u.getFinalTime=function(){return E},u.setErrorCode=function(e){g=e},u.addToEvaluations=function(e){c+=e},u.setODE=function(r,n){s=r,a=n;var i=a.getState();e=i.length,t=e-1,l=EJSS_ODE_INTERPOLATION.stateHistory(n),a.getMaximumDelay&&l.setMinimumLength(a.getMaximumDelay())},u.initialize=function(s){S=s;var g=a.getState();(null==r||r.length!=g.length)&&(e=g.length,t=e-1,r=new Array(e),n=new Array(e),i=new Array(e),o=new Array(e),u.allocateOtherArrays()),c=0,l.clearAll(),a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(s))):l.setMinimumLength(s),u.reinitialize(g)},u.reinitialize=function(i){d=i[t];for(var o=0;e>o;o++)r[o]=i[o];a.getRate(r,n),E=Number.NaN,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR},u.getCurrentRate=function(){return n},u.setStepSize=function(e){S=e,a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(e))):l.setMinimumLength(e)},u.setMaximumStepSize=function(e){f=Math.abs(e)},u.getMaximumStepSize=function(){return f},u.getStepSize=function(){return S},u.getInternalStepSize=function(){return E-d},u.setEstimateFirstStep=function(e){},u.setTolerances=function(e,t){},u.getMaximumTime=function(e){return g!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR?Number.NaN:(isNaN(E)&&u.computeOneStep(e),E)},u.internalStep=function(t){var a;for(d=E,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,a=0;e>a;a++)r[a]=i[a];for(a=0;e>a;a++)n[a]=o[a];return u.computeOneStep(t),E},u.getCounter=function(){return c},u.getStateHistory=function(){return l},u.interpolate=function(e,t){return l.interpolateState(e,t)},u.bestInterpolate=function(t,n){var o;if(isNaN(E))return null;if(t==E){for(o=0;e>o;o++)n[o]=i[o];return n}if(t==d){for(o=0;e>o;o++)n[o]=r[o];return n}return u.computeIntermediateStep(t-d,n),n},u.getActualStepSize=function(){return S},u.findTheDiscontinuity=function(e){for(var r=0,n=0,o=e,a=0,l=s.getDDEIterations(),g=s.getEPSILON();l>r&&!(Math.abs(n-o)<g);){var c=(n+o)/2;switch(u.computeCarefulIntermediateStep(s,c,i)){default:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:a=i[t],n=c;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:return i[t];case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:o-=(o-n)/4;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:o=c}r++}return u.computeCarefulIntermediateStep(s,a,i),a},u.computeOneStep=function(e){var r=S;if(e){switch(u.computeCarefulIntermediateStep(s,r,i)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void(E=Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:E=i[t];break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E=u.findTheDiscontinuity(r)}if(isNaN(E))return void(g=EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else u.computeIntermediateStep(r,i),E=i[t];c+=u.getNumberOfEvaluations(),l.clean(d),l.addIntervalData(u.computeFinalRateAndCreateIntervalData())},u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive={FAC1:.33,FAC2:6,BETA:0,SAFE:.9},EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive=function(e){function t(e){var t=0;return 0!=e?(t=Math.pow(e,l),g=t/Math.exp(EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*Math.log(u)),g=Math.max(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2,Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE))):(t=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,g=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2),1>=e?(u=Math.max(e,1e-4),i/g):i/Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,t/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE)}function r(e){var t,r,n,i=s.getODE();if(e>=0){if(i.getDelays)for(t=i.getDelays(s.getInitialState()),n=t.length,r=0;n>r;r++)e=Math.min(e,t[r]/2);return Math.min(e,s.getMaximumStepSize())}if(i.getDelays)for(t=i.getDelays(s.getInitialState()),n=t.length,r=0;n>r;r++)e=Math.max(e,t[r]/2);return Math.max(e,-s.getMaximumStepSize())}function n(t){var r,n=s.getDimension(),i=s.getInitialState(),l=s.getInitialRate(),u=s.getODE(),g=0>t?-1:1;t=Math.abs(t);var c=0,S=0;for(r=0;n>r;r++){var f=o[r]+a[r]*Math.abs(i[r]),d=l[r]/f;c+=d*d,d=i[r]/f,S+=d*d}var E;if(E=1e-10>=c||1e-10>=S?1e-6:.01*Math.sqrt(S/c),E=g*Math.min(E,t),u.getDelays){var p=s.getEventSolver();p.resetDiscontinuities(i);for(var h=0,m=!1;!m;){for(r=0;n>r;r++)finalState[r]=i[r]+E*l[r];switch(p.checkDiscontinuity(finalState,!1)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:E/=2;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:m=!0;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:m=!0}if(++h>100)return Number.NaN}}else for(r=0;n>r;r++)finalState[r]=i[r]+E*l[r];u.getRate(finalState,finalRate);var A=0;for(r=0;n>r;r++){var f=o[r]+a[r]*Math.abs(i[r]),d=(finalRate[r]-l[r])/f;A+=d*d}A=Math.sqrt(A)/E;var y,v=Math.max(Math.abs(A),Math.sqrt(c));return y=1e-15>=v?Math.max(1e-6,.001*Math.abs(E)):Math.exp(1/e*Math.log(.01/v)),E=g*Math.min(100*E,y),0!=t&&(E=g*Math.min(Math.abs(E),t)),E}var i,o,a,s=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),l=1/e-.75*EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA,u=1e-4,g=0,c=!1,S=Number.NaN,f=Number.NaN,d=s.reinitialize,E=s.setMaximumStepSize;return s.computeApproximation=function(e){},s.getAbsTol=function(){return o},s.getRelTol=function(){return a},s.allocateOtherArrays=function(){var e=s.getDimension();o=new Array(e),a=new Array(e),s.setTolerances(1e-6,1e-6)},s.reinitialize=function(e){d(e),i=r(c?n(s.getStepSize()):s.getStepSize())},s.setEstimateFirstStep=function(e){c=e},s.setMaximumStepSize=function(e){E(e),i=r(i)},s.setTolerances=function(e,t){var l,u=s.getDimension();if(e instanceof Array)for(S=f=Number.NaN,l=0;u>l;l++)o[l]=e[l],a[l]=t[l];else{if(S==e&&f==t)return;for(S=e,f=t,l=0;u>l;l++)o[l]=e,a[l]=t}mFinalTime=Number.NaN,mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,i=r(c?n(s.getStepSize()):s.getStepSize())},s.computeOneStep=function(e){var n=s.getEventSolver(),o=s.getFinalState();mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(var a=0;500>a;a++){if(e){switch(s.computeCarefulIntermediateStep(n,i,o)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void s.setFinalTime(Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:s.setFinalTime(o[s.getTimeIndex()]);break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:var l=s.findTheDiscontinuity(i);s.setFinalTime(l),i=l-s.getInitialTime()}if(isNaN(s.getFinalTime()))return void s.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else s.computeIntermediateStep(i,o),s.setFinalTime(o[s.getTimeIndex()]);var u=s.computeApproximation(i);if(s.addToEvaluations(s.getNumberOfEvaluations()),1>=u)return s.getStateHistory().clean(s.getInitialTime()),s.getStateHistory().addIntervalData(s.computeFinalRateAndCreateIntervalData()),void(i=r(a>0?i>0?Math.min(i,t(u)):Math.max(i,t(u)):t(u)));i=r(i>0?Math.min(i,t(u)):Math.max(i,t(u)))}s.setFinalTime(Number.NaN),s.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DID_NOT_CONVERGE)},s.getActualStepSize=function(){return i},s.computeError=function(e){for(var t=0,r=s.getDimension(),n=s.getInitialState(),i=s.getFinalState(),l=0;r>l;l++){var u=o[l]+a[l]*Math.max(Math.abs(i[l]),Math.abs(n[l])),g=(i[l]-e[l])/u;t+=g*g}return Math.sqrt(t/r)},s};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DDEDiscontinuity={},EJSS_ODE_SOLVERS.ddeDiscontinuity=function(e,t){function r(r){var n,s=t.getDelays(r),l=s.length,u=o.length,g=r.length-1;if(e.getRunsForwards())for(n=0;l>n;n++)for(var c=r[g]-s[n]+i.getTolerance(),S=a[n];u>S;S++){var f=o[S];if(f>c){a[n]=S;break}}else for(n=0;l>n;n++)for(var c=r[g]-s[n]-i.getTolerance(),S=a[n];u>S;S++){var f=o[S];if(c>f){a[n]=S;break}}}function n(r){var n,o=r.length,a=o-1,l=i.getTolerance()/20,u=e.getDDEIterations(),g=e.getStateHistory(),c=0;if(e.getRunsForwards())for(;++c<u;){for(t.getRate(r,s),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,s,r[a]+l)),n=0;o>n;n++)r[n]+=l*s[n];var S=i.evaluate(r);if(0>S)return r[a]}else for(;++c<u;){for(t.getRate(r,s),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(r,s,r[a]-l)),n=0;o>n;n++)r[n]-=l*s[n];var S=evaluate(r);if(S>0)return r[a]}return Number.NaN}var i={},o=[],a=[],s=[];return i.initialize=function(r){e.getRunsForwards()?o.push(Number.NEGATIVE_INFINITY):o.push(Number.POSITIVE_INFINITY);var n=t.getInitialConditionDiscontinuities();if(null!=n)for(var l=n.length,u=0;l>u;u++)o.push(n[u]);o.push(r[r.length-1]);var g=t.getDelays(r);a=new Array(g.length),i.reset(r),s=new Array(r.length)},i.reset=function(e){
for(var t=a.length,n=0;t>n;n++)a[n]=0;r(e)},i.evaluate=function(r){var n,i=r[r.length-1],s=t.getDelays(r),l=s.length;if(e.getRunsForwards()){var u=Number.POSITIVE_INFINITY;for(n=0;l>n;n++){var g=o[a[n]];u=Math.min(u,s[n]+g-i)}return u}var c=Number.NEGATIVE_INFINITY;for(n=0;l>n;n++){var g=o[a[n]];c=Math.max(c,s[n]+g-i)}return c},i.action=function(){var r=t.getState(),i=n(r);o.push(i);var a=e.findFirstEvent(r,i,r);return null!=a&&(mCurrentEventData=a,a.action()),!0},i.getTolerance=function(){return e.getDDETolerance()},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ProblemData={POSITIVE:2,SMALL_POSITIVE:1,ZERO:0,SMALL_NEGATIVE:-1,NEGATIVE:-2},EJSS_ODE_SOLVERS.eventData=function(e,t,r){var n,i,o,a,s,l,u,g,c={},S=t.getTypeOfEvent(),f=r.length-1;return c.getEvent=function(){return t},c.getEventType=function(){return S},c.setH=function(e){l=e},c.getH=function(){return l},c.getTime=function(){return u},c.setTime=function(e){u=e},c.hasPositiveFlag=function(){return n},c.hasNegativeFlag=function(){return i},c.getHBefore=function(){return a},c.setHAfter=function(e){s=e},c.getHAfter=function(){return s},c.getCurrentPosition=function(){return o},c.getMaxAdvance=function(){return g},c.setMaxAdvance=function(e){g=e},c.action=function(){return t.action()},c.getProblem=function(){return t},c.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);c.findPosition(r[f],o),e.getCurrentEventData()!=c&&(S==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT?o>0?n=!0:0>o&&(i=!0):S==EJSS_ODE_SOLVERS.EVENT_TYPE.POSITIVE_EVENT&&o>0&&(n=!0))},c.findPosition=function(r,s){if(a=s,a>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0),S==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT&&o==EJSS_ODE_SOLVERS.ProblemData.NEGATIVE){var l="The state event "+t+" is in an illegal state: "+a+" at "+r;l+=null==e.getLastEventData()?"\nThere was no previous event":"\nLast previous event was "+e.getLastEventData().getProblem()+", which took place at "+e.getLastEventDataTime(),e.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,l)}},c.reset(r),c},EJSS_ODE_SOLVERS.discontinuityData=function(e,t,r){var n,i,o,a,s,l,u={},g=r.length-1;return u.getDiscontinuity=function(){return t},u.setH=function(e){s=e},u.getH=function(){return s},u.setTime=function(e){l=e},u.getTime=function(){return l},u.hasPositiveFlag=function(){return n},u.hasNegativeFlag=function(){return i},u.getHBefore=function(){return a},u.setHAfter=function(e){mHAfter=e},u.getHAfter=function(){return mHAfter},u.getCurrentPosition=function(){return o},u.getMaxAdvance=function(){return Number.NaN},u.action=function(){return t.action()},u.getProblem=function(){return t},u.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);u.findPosition(r[g],o),e.getCurrentEventData()!=u&&(o>0?n=!0:0>o&&(i=!0))},u.findPosition=function(e,r){a=r,a>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0)},u.reset(r),u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ODEMultistepSolver={NO_ERROR:0,DID_NOT_CONVERGE:1},EJSS_ODE_SOLVERS.createODEMultistepSolver=function(e){function t(){var e=g.getTolerance(),t=l;(g.getStepSize()<=0||g.getStepSize()>l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;t>e*l;){r++;var n=t;if(t<g.getStepSize()){var u=g.getStepSize();g.setStepSize(t);var c=g.step();t-=c,g.setStepSize(u)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10>g.getStepSize()||r>o){if(s="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,a)throw s;mMaxMessages>0&&(mMaxMessages--,console.log(s));break}}return t}function r(){var e=g.getTolerance(),t=l;(g.getStepSize()>=0||g.getStepSize()<l||l-g.getStepSize()==l)&&g.setStepSize(l);for(var r=0;e*l>t;){r++;var n=t;if(t>g.getStepSize()){var a=g.getStepSize();g.setStepSize(t);var u=g.step();t-=u,g.setStepSize(a)}else t-=g.step();if(g.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(n-t)<=Number.MIN_VALUE||e*l/10<g.getStepSize()||r>o){if(s="ODEMultiStep did not converge. Remainder="+t,i=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,enableExceptions)throw s;mMaxMessages>0&&(mMaxMessages--,console.log(s))}}return t}var n={},i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,o=200,a=!1,s="",l=.1,u=EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE(e),g=EJSS_ODE_SOLVERS.createCashKarp45(u);return n.enableRuntimeExceptions=function(e){a=e},n.setMaxIterations=function(e){o=Math.max(1,e)},n.setTolerance=function(e){e=Math.abs(e),g.setTolerance(e)},n.getTolerance=function(){return g.getTolerance()},n.getErrorCode=function(){return i},n.initialize=function(e){mMaxMessages=4,s="",i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=e,u.setInitialConditions(),g.initialize(e)},n.setStepSize=function(e){mMaxMessages=4,l=e,0>e?g.setStepSize(Math.max(-Math.abs(g.getStepSize()),e)):g.setStepSize(Math.min(g.getStepSize(),e))},n.setMaximumNumberOfErrorMessages=function(e){mMaxMessages=e},n.getStepSize=function(){return l},n.step=function(){i=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,u.setInitialConditions();var e=0;return e=l>0?t():r(),u.update(),l-e},n},EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE=function(e){var t={},r=[];return t.getRate=function(t,r){e.getRate(t,r)},t.getState=function(){return r},t.setInitialConditions=function(){var t=e.getState();if(null!=t){(null==r||r.length!=t.length)&&(r=new Array(t.length));for(var n=0,i=t.length;i>n;n++)r[n]=t[n]}},t.update=function(){for(var t=e.getState(),n=0,i=t.length;i>n;n++)t[n]=r[n]},t.setInitialConditions(),t},EJSS_ODE_SOLVERS.createCashKarp45=function(e){var t,r={},n=[[.2],[.075,.225],[.3,-.9,1.2],[-11/54,2.5,-70/27,35/27],[1631/55296,175/512,575/13824,44275/110592,253/4096]],i=[37/378,0,250/621,125/594,0,512/1771],o=[277/64512,0,-6925/370944,6925/202752,277/14336,-277/7084],a=6,s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l=.01,u=0,g=[],c=[],S=1e-6,f=!1;return r.enableRuntimeExpecptions=function(e){f=e},r.setStepSize=function(e){l=e},r.getStepSize=function(){return l},r.setTolerance=function(e){if(S=Math.abs(e),1e-12>S){var t="Error: Cash-Karp ODE solver tolerance cannot be smaller than 1.0e-12.";if(f)throw t;console.log(t),S=1e-12}},r.getTolerance=function(){return S},r.getErrorCode=function(){return s},r.initialize=function(t){l=t;var r=e.getState();if(null!=r&&u!=r.length){u=r.length,g=new Array(u),c=new Array(a);for(var n=0;a>n;n++)c[n]=new Array(u)}},r.step=function(){var r,d,E,p=10,h=l,m=0,A=e.getState();s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,e.getRate(A,c[0]);do{for(p--,h=l,E=1;a>E;E++){for(r=0;u>r;r++)for(g[r]=A[r],d=0;E>d;d++)g[r]=g[r]+l*n[E-1][d]*c[d][r];e.getRate(g,c[E])}for(m=0,r=0;u>r;r++){for(t=0,E=0;a>E;E++)t+=l*o[E]*c[E][r];m=Math.max(m,Math.abs(t))}if(m<=Number.MIN_VALUE&&(m=S/1e5),m>S){var y=.9*Math.pow(m/S,-.25);l*=Math.max(y,.1)}else if(S/10>m){var y=.9*Math.pow(m/S,-.2);y>1&&(l*=Math.min(y,10))}}while(m>S&&p>0);for(r=0;u>r;r++)for(E=0;a>E;E++)A[r]+=h*i[E]*c[E][r];if(0==p&&(s=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,f))throw"DormanPrince45 ODE solver did not converge.";return h},r.initialize(l),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createEulerODESolver=function(e){var t,r=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n=r.initialize;return r.initialize=function(e){n(e),t=new Array(r.getDimension())},r.computeIntermediateStep=function(r,n){e.getRate(n,t);for(var i=0,o=n.length;o>i;i++)n[i]=n[i]+r*t[i];return n},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createRungeKutta4ODESolver=function(e){var t,r,n,i,o,a=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),s=a.initialize;return a.initialize=function(e){s(e),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(a,s){e.getRate(s,r);for(var l=0,u=s.length;u>l;l++)t[l]=s[l],s[l]=t[l]+a*r[l]/2;e.getRate(s,n);for(var l=0,u=s.length;u>l;l++)s[l]=t[l]+a*n[l]/2;e.getRate(s,i);for(var l=0,u=s.length;u>l;l++)s[l]=t[l]+a*i[l];e.getRate(s,o);for(var l=0,u=s.length;u>l;l++)s[l]=t[l]+a*(r[l]+2*n[l]+2*i[l]+o[l])/6;return s},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverInterpolatorDiscreteTime={},EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime=function(e){var t,r={},n=.1,i=(Number.POSITIVE_INFINITY,0);return r.getNumberOfEvaluations=function(){return 0},r.allocateOtherArrays=function(){},r.computeIntermediateStep=function(e,t){return null},r.computeCarefulIntermediateStep=function(e,t,r){return 0},r.setTolerance=function(e){i=Math.abs(e)},r.getDimension=function(){return t},r.initialize=function(r){n=r;var i=e.getState();t=i.length},r.step=function(){var t=e.getState();return r.computeIntermediateStep(n,t),0},r.setStepSize=function(e){n=e},r.getStepSize=function(){return n},r};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createRemoteView=function(e,t,r,n){function i(e,t){if(c){void 0!==t?s.send(e+JSON.stringify(t)):s.send(e);var r=s.onmessage;s.onmessage=null,s.onmessage=r}}function o(e){var t;switch(e.charAt(0)){case"R":l._reset();break;case"I":l._initialize();break;case"U":f=JSON.parse(e.substring(1)),a(l._update);break;case"C":f=JSON.parse(e.substring(1)),a(l._collectData);break;case"M":t=JSON.parse(e.substring(1)),l[t.method]&&console.log("View function: <"+t.method+"> with data: <"+t.data+"> ignored. View function does not exist."),l[t.method](t.data);break;case"P":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element].setProperty(t.property,t.value):console.log("setProperty<"+t.property+"> with value: <"+t.value+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"E":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"F":t=JSON.parse(e.substring(1)),l[t.element]?l[t.element][t.method](t.data):console.log("Message with object <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;default:console.log("view process input error : Unrecognised command: "+e)}}function a(e){e(),l._render(),i("O")}var s,l=EJSS_CORE.createView(e),u=10,g=500,c=!1,S=0,f={},d=[],E=[],p=[],h=[],m="",A=!0,y=0,v="";if(l._23=function(){return"ConnectionWS"},l._connectToServer=function(){try{s=new WebSocket(v),console.log("Connecting... (readyState "+s.readyState+")"),s.onopen=function(e){c=!0,S=0,console.log("Openhd Event: "+e.type+" - Message: "+e.data),i("A",{variables:d,actions:E})},s.onclose=function(e){u>S&&(window.setTimeout(function(){l._connectToServer()},g),S++),c=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data+" - Reopen: "+S)},s.onerror=function(e){c=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},s.onmessage=function(e){o(e.data)}}catch(e){console.log(e)}l._update(),l._render()},l._getValue=function(e){return c?f[e]:l._10(e)},super_registerVariable=l._5,super_registerAction=l._7,super_startUp=l._11,l._11=function(){super_startUp(),l._connectToServer()},l._5=function(e,t,r){super_registerVariable(e,t),r?l._13(e,function(){return l._getValue(e)},null,t):(d.push(e),l._13(e,function(){return l._getValue(e)},function(t){p.push({name:e,value:t})},t))},l._7=function(e){super_registerAction(e),E.push(e),l._setAction(e,function(t){h.push({name:e,argument:t})})},l._18=function(){l._16(),i("I",{properties:p,actions:h}),p=[],h=[]},l._17=function(){return h.length},l.getLinkingURL=function(){return m},l.createLinkingButtons=function(){l._9(EJSS_INTERFACE.button,"_linkingButton_").setAction("OnClick",function(){var e=l.getLinkingURL();window.alert(e.toString())}).setProperties({Text:"@",FontSize:"8px"}),l._9(EJSS_INTERFACE.button,"_qrButton_").setAction("OnClick",function(){var e=encodeURIComponent(l.getLinkingURL()),t="https://chart.googleapis.com/chart?cht=qr&chl="+e+"&chs=400";window.open(t,"_blank")}).setProperties({Text:"QR",FontSize:"8px"})},l.hiddenLinkingButtons=function(){_view._linkingButton_.setVisibility("hidden"),_view._qrButton_.setVisibility("hidden")},l.showLinkingButtons=function(){_view._linkingButton_.setVisibility("visible"),_view._qrButton_.setVisibility("visible")},-1!=window.location.protocol.indexOf("file"))("undefined"==typeof t||null===t||0==t)&&(t=8800),v="ws://localhost:"+t,A=!1;else{if(history.state&&(y=history.state.mServerModelPort,A=!1),"undefined"==typeof r||null===r||""==r){var P=window.location.host,D=window.location.protocol;r=D+"//"+P+"/ejsS_library/models"}if("undefined"==typeof n||null===n||""==n){var _=window.location.href.lastIndexOf("/_view");n=window.location.href.slice(r.length,_)}var I=new XMLHttpRequest;y>0?I.open("GET",r+"/broker.php?model="+n+"&port="+y,!0):I.open("GET",r+"/broker.php?model="+n,!0),I.onreadystatechange=function(){if(4==I.readyState&&200==I.status){var e=JSON.parse(I.responseText);v=e.webserver,m=r+"/linking.php?model="+n+"&port="+e.port,A&&l.createLinkingButtons(),l._11()}else console.log("WARNING: server no response!")},I.send()}return l};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.addToArray=function(e,t,r){EJSS_TOOLS.removeFromArray(e,t),r>=0?e.splice(r,0,t):e.push(t)},EJSS_TOOLS.arrayObjectIndexOf=function(e,t){return e.indexOf(t)},EJSS_TOOLS.removeFromArray=function(e,t){var r=e.indexOf(t);r>=0&&e.splice(r,1)},EJSS_TOOLS.compareArrays=function(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!EJSS_TOOLS.compareArrays(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.ConnectionWS={},EJSS_TOOLS.connectionWS=function(e){function t(){try{s=new WebSocket(e),console.log("Connecting... (readyState "+s.readyState+")")}catch(t){console.log(t)}}function r(e,t){switch(e){case"onopen":s.onopen=function(e){t(e)};break;case"onmessage":s.onmessage=function(e){t(e)};break;case"onclose":s.onclose=function(e){t(e)};break;case"onerror":s.onerror=function(e){t(e)}}}function n(e){var t=e.data.split(" ");g[t[0]]=e.data.substring(t[0].length+1)}function i(e){l=!0,console.log("Openhd Event: "+e.type+" - Message: "+e.data)}function o(e){l=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data)}function a(e){l=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}var s,l,u={},g={};return u._23=function(){return"ConnectionWS"},u.get=function(e){var t=g[e];return"undefined"!=typeof t||null==t?t:void 0},u.set=function(e,t){if(console.log("set:"+e+":"+t.toString()),console.log("set:is open="+l),l){var r=e+" "+t.toString();s.send(r),u.reset()}},u.reset=function(){var e=s.onmessage;s.onmessage=null,s.onmessage=e},t(),r("onopen",i),r("onclose",o),r("onerror",a),r("onmessage",n),u};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.DisplayColors={phaseColors:{},lineColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],markerColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],arrayColors:{black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,160],darkcyan:[0,240,240],darkgray:[64,64,64],darkgreen:[0,240,0],darkgrey:[64,64,64],darkyellow:[240,240,0],gray:[125,125,125],green:[0,255,0],grey:[125,125,125],lightblue:[173,216,230],lightgray:[192,192,192],lightgrey:[192,192,192],magenta:[255,0,255],maroon:[128,0,0],olive:[128,128,0],orange:[255,165,0],pink:[255,175,175],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]},getLineColor:function(e){var t=EJSS_TOOLS.DisplayColors.lineColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,50%)",EJSS_TOOLS.DisplayColors.lineColors[e]=t}return t},getMarkerColor:function(e){var t=EJSS_TOOLS.DisplayColors.markerColors[e];if(void 0===t){var r=360*e/12%360;t="hsl("+r+",100%,100%)",EJSS_TOOLS.DisplayColors.markerColors[e]=t}return t},getArrayColor:function(e){if(e=e.toLowerCase(),0==e.indexOf("rgb"))var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");else if(0==e.indexOf("#")){e=e.slice(1),e=e.toUpperCase();for(var r,n,i="0123456789ABCDEF",t=new Array(3),o=0,a=0;6>a;a+=2)r=i.indexOf(e.charAt(a)),n=i.indexOf(e.charAt(a+1)),t[o]=16*r+n,o++}else{var t=EJSS_TOOLS.DisplayColors.arrayColors[e];void 0===t&&(t=EJSS_TOOLS.DisplayColors.arrayColors.black)}return[t[0]/255,t[1]/255,t[2]/255]}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Worker=function(){function e(e,t){if(e){var r=new XMLHttpRequest;r.open("GET",e),r.onreadystatechange=function(){4==r.readyState&&200==r.status?t(r.responseText):console.log("Warning: impossible to read "+e)},r.send()}else t("")}var t={};if("undefined"==typeof Worker)return t;if(!window.Worker)return t;if(!window.URL)return t;if(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident")>0)return t;t.dummy=function(e){var e=e.data.params;t.postMessage({result:"dummy"})};var r=new Blob(['onmessage=function (oEvent) { 		postMessage({ 			"id": oEvent.data.id, 			"evaluated": eval(oEvent.data.code) 		}); 	}   '],{type:"text/javascript"}),n=window.URL.createObjectURL(r),i=[],o=new Worker(n);o.onmessage=function(e){i[e.data.id]&&i[e.data.id](e.data.evaluated),delete i[e.data.id]},t.runCode=function(e,t){i.push(t||null),o.postMessage({id:i.length-1,code:e})};var a={};return t.runFunction=function(t,r,n,i,o){if("function"==typeof r)if("undefined"==typeof a[t])e(o,function(e){var o=e;o+=";onmessage="+r.toString();var s=new Blob([o],{type:"text/javascript"}),l=window.URL.createObjectURL(s);a[t]=l;var u=new Worker(l);u.postMessage({id:t,params:n}),u.onmessage=function(e){i&&i(e.data)}});else{var s=a[t],l=new Worker(s);l.postMessage({id:t,params:n})}},t.runMultipleFunction=function(t,r,n,i,o,s){if("function"==typeof n&&i instanceof Array&&i.length>=r)if("undefined"==typeof a[t])e(s,function(e){var s=e;s+=";onmessage="+n.toString();var l=new Blob([s],{type:"text/javascript"}),u=window.URL.createObjectURL(l);a[t]=u;for(var g=0;r>g;g++){var c=new Worker(u),e=[];c.onmessage=function(t){e.push(t.data),e.length==r&&o&&o(e)},c.postMessage({id:t,params:i[g]})}});else for(var l=a[t],u=0;r>u;u++){var g=new Worker(l),c=[];g.onmessage=function(e){c.push(e.data),c.length==r&&o&&o(c)},g.postMessage({id:t,params:i[u]})}},t}();var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.enumeration=function(e){var t=function(){throw"Can't Instantiate Enumerations"},r=t.prototype={constructor:t,toString:function(){return this.name},valueOf:function(){return this.value},toJSON:function(){return this.name}};t.values=[];for(var n in e){var i=inherit(r);i.name=n,i.value=e[n],t[n]=i,t.values.push(i)}return t.foreach=function(e,t){for(var r=0;r<this.values.length;r++)e.call(t,this.values[r])},t};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.File={JSLoaded:"",loadJSfile:function(e,t){if(-1!=EJSS_TOOLS.File.JSLoaded.indexOf("["+e+"]"))return console.log("File already loaded "+e),void t();EJSS_TOOLS.File.JSLoaded+="["+e+"]";var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),"undefined"!=typeof t&&(r.onload=t),document.getElementsByTagName("head")[0].appendChild(r)},plainName:function(e){var t=e.lastIndexOf("/");return t>=0&&(e=e.substring(t+1)),t=e.indexOf("."),t>0&&(e=e.substring(0,t)),e},download:function(e,t){var r=document.createElement("a");r.setAttribute("href","data:application/ejss;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.click()},loadScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJSONFile:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);t(e)}},r.open("GET",e,!0),r.send()},requestShortUrl:function(e,t){var r=escape("http://urlecho.appspot.com/echo?status=200&Content-Type=text/plain&body="+e);if(EJSS_TOOLS.File.CALLBACK=t,EJSS_TOOLS.File.callFunction=function(e){EJSS_TOOLS.File.CALLBACK(e.shortUrl)},null==document.getElementById("__rtShortUrl")){var n=document.createElement("script");n.type="text/javascript",n.id="__rtShortUrl",n.innerHTML="function rtShortUrl(data) { EJSS_TOOLS.File.callFunction(data); }",document.getElementsByTagName("head")[0].appendChild(n)}var i=document.getElementById("_requestShortUrl");null!=i&&document.getElementsByTagName("head")[0].removeChild(i),i=document.createElement("script"),i.id="_requestShortUrl",i.type="text/javascript",i.src="http://b1t.co/Site/api/External/MakeUrlWithGet?callback=rtShortUrl&url="+r,document.getElementsByTagName("head")[0].appendChild(i)}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcBuilder={template:{METHOD:"${METHOD}",PARAMS:"${PARAMS}",ID:"${ID}",REQUEST:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',RESPONSE_OK:'{jsonrpc: "2.0", result: ${RESULT}, params: ${PARAMS}, id: ${ID}}',RESPONSE_ERROR:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',ERROR:'{code: "2.0", message: ${MESSAGE}, data: ${DATA}}'},request:function(e,t,r){if(t&&!(t instanceof Array))throw new InvalidParamsException;var n={jsonrpc:"2.0",method:e};return t&&(n.params=t),r&&(n.id=r),n},response:function(e,t){return{jsonrpc:"2.0",result:e,id:t}},responseWithError:function(e,t){return{jsonrpc:"2.0",error:e,id:t}},error:function(e,t,r){return{code:e,message:t,data:r}},parseResponse:function(e){var t=null;try{t=JSON.parse(e)}catch(r){console.log(r)}return null!=t?t.result:null}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcClient={methods:{connect:"connect",open:"open",getMetadata:"getMetadata",getValue:"getValue",setValue:"setValue",close:"close",disconnect:"disconnect"}},EJSS_TOOLS.jsonrpcClient=function(e,t){function r(e){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;e>n;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function n(e,t,n,i){var a=i?i:r(12);n&&(f[a]=n);var s=S.request(e,t,a);o.send(JSON.stringify(s))}function i(){o.onopen=function(e){a&&a(e),console.log("Openhd Event: "+e.type+" - Message: "+e.data)},o.onmessage=function(e){var t=JSON.parse(e.data);u&&u(f),t.id&&f[t.id]&&f[t.id](t.result)},o.onclose=function(e){s&&s(message),console.log("Closehd Event: "+message.type+" - Message: "+message.data)},o.onerror=function(e){l&&l(e),console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}}var o,a,s,l,u,g={},c=EJSS_TOOLS.JsonrpcClient,S=EJSS_TOOLS.JsonrpcBuilder,f={};return g.connect=function(e){return n(c.methods.connect,null,e)},g.open=function(e){return n(c.methods.open,null,e)},g.getValue=function(e,t){return n(c.methods.getValue,[e],t)},g.setValue=function(e,t){return n(c.methods.setValue,e,t)},g.getMetadata=function(e){return n(c.methods.getMetadata,null,e)},g.disconnect=function(e){return n(c.methods.disconnect,null,e)},g.close=function(e){return n(c.methods.close,null,e)},g.init=function(r,n,g,c){try{a=r,l=g,s=c,u=n;var S="ws://"+e;t&&(S+=":"+t),o=new WebSocket(S),i(),console.log("Connecting... (readyState "+o.readyState+")")}catch(f){console.log(f)}},g.finish=function(){try{o.close()}catch(e){console.log(e)}},g};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Mathematics={TWO_PI:6.2831852,TO_RADIANS:Math.PI/180,LOG10SCALE:1/Math.log(10),cosineAndSine:[],cosineAndSineForDegrees:function(e){e%=360,0>e&&(e+=360);var t=this.cosineAndSine[e];if(void 0===t){var r=e*this.TO_RADIANS;t=[Math.cos(r),Math.sin(r)]}return t},radians:function(e){return e*Math.PI/180},degrees:function(e){var t=180*e/Math.PI,r=t%360;return t=0>360*r?r+360:r},norm:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return Math.sqrt(t)},crossProduct:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},normalize:function(e){var t=EJSS_TOOLS.Mathematics.norm(e);return 0==t?e:[e[0]/t,e[1]/t,e[2]/t]},normalTo:function(e){if(0==e[0])return[1,0,0];if(0==e[1])return[0,1,0];if(0==e[2])return[0,0,1];var t=EJSS_TOOLS.Mathematics.norm(e);return[-e[1]/t,e[0]/t,0]},rotate:function(e,t,r){var n=Math.cos(r),i=Math.sin(r),o=n*(t[0]-e[0])+i*(t[1]-e[1])+e[0],a=n*(t[1]-e[1])-i*(t[0]-e[0])+e[1];return[o,a]}},sensors={iOS_accelerometer:{x:0,y:0,z:0},iOS_gyroscope:{x:0,y:0,z:0},setAccelerometer:function(accvalue){var value=JSON.parse(accvalue),accelerometer=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_accelerometer={x:accelerometer.y,y:-accelerometer.x,z:accelerometer.z}:sensors.iOS_accelerometer=accelerometer},setGyroscope:function(gyrvalue){var value=JSON.parse(gyrvalue),gyroscope=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_gyroscope={x:gyroscope.y,y:-gyroscope.x,z:gyroscope.z}:sensors.iOS_gyroscope=gyroscope},iOS_staccelerometer:{x:0,y:0,z:0},iOS_stgyroscope:{x:0,y:0,z:0},iOS_stmagnetometer:{x:0,y:0,z:0},iOS_sthumidity:0,iOS_sttempamb:0,iOS_sttempir:0,iOS_stpressure:0,setSensorTag:function(stvalue){var value=JSON.parse(stvalue),results=eval(value.result);sensors.iOS_staccelerometer={x:results.accx,y:results.accy,z:results.accz},sensors.iOS_stgyroscope={x:results.gyrox,y:results.gyroy,z:results.gyroz},sensors.iOS_stmagnetometer={x:results.magx,y:results.magy,z:results.magz},sensors.iOS_sthumidity=results.hum,sensors.iOS_sttempamb=results.tamb,sensors.iOS_sttempir=results.tir,sensors.iOS_stpressure=results.press},calliOSFunction:function(e,t,r,n){var i="ejss://",o={};o.functionname=e,r&&(o.success=r),n&&(o.error=n),t&&(o.args=t),i+=JSON.stringify(o),window.location=i},isSupportedSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e},runSensorTag:function(e,t){var r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(r){var n=[];n[0]=e,n[1]=t,sensors.calliOSFunction("runSensorTag",n,"sensors.setSensorTag")}},stopSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e&&sensors.calliOSFunction("stopSensorTag")},getSensorTagAccelerometer:function(){return sensors.iOS_staccelerometer},getSensorTagGyroscope:function(){return sensors.iOS_stgyroscope},getSensorTagMagnetometer:function(){return sensors.iOS_stmagnetometer},getSensorTagTempAmb:function(){return sensors.iOS_sttempamb},getSensorTagTempIR:function(){return sensors.iOS_sttempir},getSensorTagPressure:function(){return sensors.iOS_stpressure},getSensorTagHumidity:function(){return sensors.iOS_sthumidity},isAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runAccelerometer():t&&sensors.calliOSFunction("runAccelerometer","","sensors.setAccelerometer")},stopAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopAccelerometer():t&&sensors.calliOSFunction("stopAccelerometer")},getAccelerometer:function(){var is_Androidwebview=window.android&&window.android.isAccelerometer(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getAccelerometer());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_accelerometer:{x:0,y:0,z:0}},isGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runGyroscope():t&&sensors.calliOSFunction("runGyroscope","","sensors.setGyroscope")},stopGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopGyroscope():t&&sensors.calliOSFunction("stopGyroscope")},getGyroscope:function(){var is_Androidwebview=window.android&&window.android.isGyroscope(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getGyroscope());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_gyroscope:{x:0,y:0,z:0}},isGravity:function(){var e=window.android&&window.android.isGravity();return e},runGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.runGravity()},stopGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.stopGravity()},getGravity:function(){var e=window.android&&window.android.isGravity();return e?window.android.getGravity():{x:0,y:0,z:0}},isLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e},runLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.runLinearAcceleration()},stopLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.stopLinearAcceleration()},getLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e?window.android.getLinearAcceleration():{x:0,y:0,z:0}},isRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e},runRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.runRotationVector()},stopRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.stopRotationVector()},getRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e?window.android.getRotationVector():{x:0,y:0,z:0}},isMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e},runMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.runMagneticField()},stopMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.stopMagneticField()},getMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e?window.android.getMagneticField():{x:0,y:0,z:0}},isAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e},runAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.runAmbientTemperature()},stopAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.stopAmbientTemperature()},getAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e?window.android.getAmbientTemperature():0},isLight:function(){var e=window.android&&window.android.isLight();return e},runLight:function(){var e=window.android&&window.android.isLight();e&&window.android.runLight()},stopLight:function(){var e=window.android&&window.android.isLight();e&&window.android.stopLight()},getLight:function(){var e=window.android&&window.android.isLight();return e?window.android.getLight():0},isPressure:function(){var e=window.android&&window.android.isPressure();return e},runPressure:function(){var e=window.android&&window.android.isPressure();
e&&window.android.runPressure()},stopPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.stopPressure()},getPressure:function(){var e=window.android&&window.android.isPressure();return e?window.android.getPressure():0},isHumidity:function(){var e=window.android&&window.android.isHumidity();return e},runHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.runHumidity()},stopHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.stopHumidity()},getHumidity:function(){var e=window.android&&window.android.isHumidity();return e?window.android.getHumidity():0}};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createView=function(e){function t(e,t){return e.match("^"+t)==t}var r,n,i,o,a={},s={},l={},u=[],g=[],c=[],S=[],f=[],d=[],E=[],p=[],h=[],m=[],A=[],y=[],v=!1,P=!0,D=[],_=[],I=!1,C=[],R=[],T=[];return a._1=function(){a[e].innerHTML="",s={},l={},u=[],g=[],D=[],c=[],S=[],f=[],d=[],E=[],h=[],m=[],A=[],y=[],p=[],v=!1,P=!0},a._2=function(e){n=e},a._3=function(e){if(null==e||e.length<=0)return e;if(t(e,"local:"))return e;if(t(e,"data:"))return e;if(t(e,"http:")||t(e,"https:")||t(e,"ws:"))return e;if("undefined"!=typeof __base64Images){var r=__base64Images[e];if(r)return r}if(i&&!t(e,i)&&"/"==e.charAt(0)?e=i+"images"+e:n&&!t(e,n)&&"/"!=e.charAt(0)&&(e=n+e),t(window.location.protocol,"ibooks")){var o=window.location.pathname;o=o.substring(0,o.lastIndexOf("/")),t(e,"./")&&(e=e.substring(2)),e="ibooksimg://"+window.location.host+"/"+o+"/"+e}return e},a._4=function(e){i=e},a._showDocument=function(e){window.open(a._3(e))},a._addDescriptionPage=function(e,t){C[e]=t},a._openDescriptionPage=function(e){var t=C[e];t?window.open(a._3(t)):console.log("Desription page not found: "+e)},a._5=function(e,t){s[e]={getter:null,setter:null,listeners:[],collectors:[],value:t}},a._5s=function(e){for(var t=0;t<e.length;t++)a._5(e[t])},a._7=function(e){l[e]={action:null}},a._7s=function(e){for(var t=0;t<e.length;t++)a._7(e[t])},a._9=function(e,t,r,n){var i=EJSS_CORE.promoteToControlElement(e(t,n),a,t);return i.render&&f.push(i),i.touch&&d.push(i),i.dataCollected&&E.push(i),i.reset&&c.push(i),i.initialize&&S.push(i),i.enableEPub&&h.push(i),i.adjustPosition&&m.push(i),t&&(a[t]=i),r&&i.setProperty("Parent",r),i},a._10=function(e){var t=s[e];return void 0!==t?t.value:void 0},a._11=function(){a._reset(),a._15(),a._initialize(),a._update(),a._render()},a._setRootProperty=function(e,t,r){switch(t){case"RunAlways":e.setRunAlways(r);break;case"OnBlur":a._addOnBlurAction(r);break;case"OnFocus":a._addOnFocusAction(r);break;default:console.log("WARNING: View property not registered : "+t)}},a._12=function(e){r=e},a._13=function(e,t,r,n){var i=s[e];if(i){i.getter=t,i.setter=r,i.value=n;var o=g.indexOf(i);i.getter?i.listeners.length>0&&0>o&&g.push(i):o>=0&&g.splice(o,1),o=D.indexOf(i),i.value?i.listeners.length>0&&0>o&&D.push(i):o>=0&&D.splice(o,1)}else console.log("WARNING: view._setAccessors() - Variable not found : "+e);return i},a._setAction=function(e,t){var r=l[e];return r?r.action=t:console.log("WARNING: view._setAction() - Action not found : "+e),r},a._14=function(e){P=e},a._reset=function(){for(var e=0,t=c.length;t>e;e++)c[e].reset()},a._15=function(){for(var e=0,t=D.length;t>e;e++){var r=D[e],n=r.value;if(n)for(var i=r.listeners,o=0,a=i.length;a>o;o++)i[o](n)}},a._initialize=function(){for(var e=0,t=S.length;t>e;e++)S[e].initialize()},a._update=function(){var e,t;for(e=0,t=g.length;t>e;e++)for(var r=g[e],n=r.listeners,i=r.getter(),o=0,a=n.length;a>o;o++)n[o](i);for(e=0,t=u.length;t>e;e++){var s=u[e];s.propertySetter(s.getter())}},a._collectData=function(){var e,t;for(e=0,t=g.length;t>e;e++)for(var r=g[e],n=r.collectors,i=r.getter(),o=0,a=n.length;a>o;o++)n[o](i);for(e=0,t=u.length;t>e;e++){var s=u[e];s.isCollector&&s.propertySetter(s.getter())}for(e=0,t=E.length;t>e;e++)E[e].dataCollected()},a._render=function(){for(var e=0,t=f.length;t>e;e++)f[e].render()},a._touch=function(){for(var e=0,t=d.length;t>e;e++)d[e].touch()},a._enableEPub=function(){if("undefined"!=typeof _isEPub&&_isEPub)for(var e=0,t=h.length;t>e;e++)h[e].enableEPub()},a._addFontResizeListener=function(e){A.push(e)},a._fontResized=function(e,t,r){for(var n=0,i=m.length;i>n;n++)m[n].adjustPosition();if(e)for(var o=0,a=A.length;a>o;o++)A[o](e,t,r)},a._addResizeListener=function(e){y.push(e)},a._resized=function(e,t){for(var r=0,n=m.length;n>r;r++)m[r].adjustPosition();for(var i=0,o=y.length;o>i;i++)y[i](e,t)},a._16=function(e,t,r){var n=p.length;if(0>=n)return!1;v=!0;for(var i=0;n>i;i++){var o=p[i];if(a.isRegInteractions()){var s=o.interaction;s.data=o.data,s.runCount=e,s.runTime=t,s.isPlaying=r,s.timeStamp=Date.now(),a.pushRegInteractions(s)}o.what(o.data)}return p=[],v=!1,!0},a._17=function(){return p.length},a._addOnBlurAction=function(e){R.push(e)},a._onBlur=function(){for(var e=0,t=R.length;t>e;e++)R[e]()},a._addOnFocusAction=function(e){T.push(e)},a._onFocus=function(){for(var e=0,t=T.length;t>e;e++)T[e]()},a._18=function(){r&&P&&r()},a._19=function(e,t,r){var n=s[e];return n?(n.listeners.indexOf(t)<0&&(n.listeners.push(t),r&&n.collectors.push(t)),n.getter&&g.indexOf(n)<0&&g.push(n),n.value&&D.indexOf(n)<0&&D.push(n)):console.log("WARNING: view._19() - Variable not found : "+e),n},a._20=function(e,t,r){for(var n=!1,i=0,o=u.length;o>i;i++){var a=u[i];if(a.propertySetter===t){a.getter=e,n=!0;break}}return n||u.push({getter:e,propertySetter:t,isCollector:r}),n},a._21=function(e){var t=l[e];return t||console.log("WARNING: view._21() - Action not found : "+e),t},a._22=function(e,t,n){return r?void(!v&&P&&p.push({what:e,data:t,interaction:n})):void e(t)},a._format=function(e,t){var r=t.indexOf("."),n=0;return r>=0&&(n=Number(t.length-r-1)),parseFloat(e).toFixed(n)},a.print=function(e){var t=document.getElementsByTagName("textarea");t.length?t[0].innerHTML=e:console.log(e)},a._setVisible=function(t){t?document.getElementById(e).style.display="inherit":document.getElementById(e).style.display="none"},a._switchVisibility=function(){a._setVisible("none"==document.getElementById(e).style.display)},a.serialize=function(){var e={};for(key in a)a[key].serialize&&(e[key]=a[key].serialize());return e},a.unserialize=function(e){for(key in e)a[key]&&a[key].unserialize?a[key].unserialize(e[key]):console.log("Impossible unserialize: "+key)},a.registerInteractions=function(e){_=[],o=e,I=!0},a.unregisterInteractions=function(){I=!1},a.getRegInteractions=function(){return _},a.isRegInteractions=function(){return I},a.pushRegInteractions=function(e){"undefined"!=typeof o?o.send(JSON.stringify(e)):_.push(e)},a[e]=document.getElementById(e),a},EJSS_CORE.promoteToControlElement=function(e,t,r){r=r||"unnamed";var n={},i={};return e._0=function(e){r=e},e.getName=function(){return r},e.getResourcePath=function(e){return t._3(e)},e.registerProperty=function(t,r,i){return n[t]={setter:r,getter:i,variable:null,variableSetter:null},e},e.registerAction=function(t,r,n,o){return i[t]={action:null,helper:r,process:n},o&&e.setAction(t,o),e},e.setProperty=function(t,r){var o=i[t];if(o)return e.setAction(t,r);var a=n[t];return a?a.setter(r):console.log("WARNING: ControlElement setProperty() - Property not registered : "+t+" for element : "+e.getName()),e},e.setProperties=function(t){for(var r in t)e.setProperty(r,t[r]);return e},e.linkProperty=function(r,i,o){var a=n[r];if(!a)return console.log("WARNING: ControlElement linkProperty() - Element property not registered : "+r+" for element : "+e.getName()),e;if("string"==typeof i){var s=t._19(i,a.setter,e.dataCollected);if(!s)return console.log("WARNING: ControlElement linkProperty() - element : "+e.getName()+" - property :"+r+" - View variable not registered : "+i),e;"InputOnly"===o||(a.variable=s),a.variableSetter=null}else t._20(i,a.setter,e.dataCollected),a.variableSetter=o,a.variable=null;return e},e.linkProperties=function(t){for(var r in t)e.linkProperty(r,t[r]);return e},e.setAction=function(r,n){var o=i[r];if(!o)return console.log("WARNING: ControlElement setAction() - action not registered : "+r+" for element : "+e.getName),e;if("string"==typeof n){var a=t._21(n);if(!a)return console.log("WARNING: ControlElement setAction() - element : "+e.getName()+" - View action not registered : "+n),e;o.action=a}else o.action={action:n};return e},e.setActions=function(t){for(var r in t)e.setAction(r,t[r]);return e},e.invokeAction=function(r){var n={};t.isRegInteractions()&&(n={action:r,element:e.getName(),timeStamp:Date.now()});var o=i[r];if(o&&(o.process&&t._22(o.process,null,n),o.action)){var a=o.helper?o.helper():null;t._22(o.action.action,a,n)}return e},e.propertiesChanged=function(){for(var t=0,r=arguments.length;r>t;t++)e.propertyChanged(arguments[t]);return e},e.propertyChanged=function(r,i){var o={};t.isRegInteractions()&&(o={property:r,element:e.getName(),timeStamp:Date.now()});var a=n[r];if(a){var s=a.variableSetter;if(s||a.variable&&(s=a.variable.setter),s||a.setter&&(s=a.setter),s){var l="undefined"!=typeof i?i:a.getter();t._22(s,l,o)}}return e},e.reportInteractions=function(r,n){var i,o;if(r)for(i=0,o=r.length;o>i;i++)e.invokeAction(r[i]);if(n)for(i=0,o=n.length;o>i;i++)e.propertiesChanged(n[i]);return t._17()>0&&t._18(),e},e.getProperty=function(e,t){var r=n[e];return r&&r.getter?r.getter():void 0},e.getProperties=function(){return n},e.registerProperty("name",e._0,e.getName),e.registerProperties&&e.registerProperties(e),e};

function gravity09fast(_topFrame,_libraryPath,_codebasePath) {
  var _model = EJSS_CORE.createAnimation();
  var _view;
  var _isPlaying = false;
  var _isPaused = true;
  var _isMobile = (navigator===undefined) ? false : navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i);

var _stringProperties = {};
  var _tools = {
    showInputDialog : EJSS_INTERFACE.BoxPanel.showInputDialog,
    showOkDialog : EJSS_INTERFACE.BoxPanel.showOkDialog,
    showOkCancelDialog : EJSS_INTERFACE.BoxPanel.showOkCancelDialog
  };

  function _play()  { _isPaused = false; _isPlaying = true;  _model.play();  }
  function _pause() { _isPaused = true;  _isPlaying = false; _model.pause(); }
  function _step()  { _pause();  _model.step(); }
  function _reset() { _model.reset();  _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); }
  _model._play  = _play;
  _model._pause = _pause;
  _model._step  = _step;
  _model._reset = _reset;
  function _update() { _model.update(); }
  function _initialize() { _model.initialize(); }
  function _setFPS(_fps) { _model.setFPS(_fps); }
  function _setDelay(_delay) { _model.setDelay(_delay); }
  function _setStepsPerDisplay(_spd) { _model.setStepsPerDisplay(_spd); }
  function _setUpdateView(_updateView) { _model.setUpdateView(_updateView); }
  function _setAutoplay(_auto) { _model.setAutoplay(_auto); }
  function _println(_message) { console.log(_message); }

  function _breakAfterThisPage() { _model.setShouldBreak(true); }

  function _resetSolvers() { if (_model.resetSolvers) _model.resetSolvers(); }

  function _saveText(name,type,content) { if (_model.saveText) _model.saveText(name,type,content); }

  function _saveState(name) { if (_model.saveState) _model.saveState(name); }

  function _saveImage(name,panelname) { if (_model.saveImage) _model.saveImage(name,panelname); }

  function _readState(url,type) { if (_model.readState) _model.readState(url,type); }

  function _readText(url,type,varname) { if (_model.readText) _model.readText(url,type,varname); }

  function _getStringProperty(propertyName) {
    var _value = _stringProperties[propertyName];
    if (_value===undefined) return propertyName;
    else return _value;
  }
  var __pagesEnabled = [];
  function _setPageEnabled(pageName,enabled) { __pagesEnabled[pageName] = enabled; }

  var print; // EjsS Model.Variables.Var Table.print
  var fontb; // EjsS Model.Variables.Var Table.fontb
  var font; // EjsS Model.Variables.Var Table.font
  var mode; // EjsS Model.Variables.Var Table.mode
  var range; // EjsS Model.Variables.Var Table.range
  var xmin; // EjsS Model.Variables.Var Table.xmin
  var xmax; // EjsS Model.Variables.Var Table.xmax
  var ymin; // EjsS Model.Variables.Var Table.ymin
  var ymax; // EjsS Model.Variables.Var Table.ymax
  var zmin; // EjsS Model.Variables.Var Table.zmin
  var zmax; // EjsS Model.Variables.Var Table.zmax
  var t; // EjsS Model.Variables.Var Table.t
  var t0; // EjsS Model.Variables.Var Table.t0
  var dt; // EjsS Model.Variables.Var Table.dt
  var size; // EjsS Model.Variables.Var Table.size
  var size2; // EjsS Model.Variables.Var Table.size2
  var stroke; // EjsS Model.Variables.Var Table.stroke
  var pi; // EjsS Model.Variables.Var Table.pi
  var blue; // EjsS Model.Variables.Var Table.blue
  var green; // EjsS Model.Variables.Var Table.green
  var green2; // EjsS Model.Variables.Var Table.green2
  var yellow; // EjsS Model.Variables.Var Table.yellow
  var clr; // EjsS Model.Variables.Var Table.clr
  var clr2; // EjsS Model.Variables.Var Table.clr2
  var clabel; // EjsS Model.Variables.Var Table.clabel
  var npt; // EjsS Model.Variables.Var Table.npt

  var rE; // EjsS Model.Variables.Earth.rE
  var phiE; // EjsS Model.Variables.Earth.phiE
  var aE; // EjsS Model.Variables.Earth.aE
  var eE; // EjsS Model.Variables.Earth.eE
  var xE; // EjsS Model.Variables.Earth.xE
  var yE; // EjsS Model.Variables.Earth.yE
  var lonPE; // EjsS Model.Variables.Earth.lonPE
  var lonPEdeg; // EjsS Model.Variables.Earth.lonPEdeg
  var lonS; // EjsS Model.Variables.Earth.lonS
  var scale; // EjsS Model.Variables.Earth.scale
  var scalecamera; // EjsS Model.Variables.Earth.scalecamera
  var decorationtypeaxes; // EjsS Model.Variables.Earth.decorationtypeaxes
  var zoom; // EjsS Model.Variables.Earth.zoom

  var radius; // EjsS Model.Variables.planets.radius
  var r; // EjsS Model.Variables.planets.r
  var phi; // EjsS Model.Variables.planets.phi
  var a; // EjsS Model.Variables.planets.a
  var e; // EjsS Model.Variables.planets.e
  var x; // EjsS Model.Variables.planets.x
  var y; // EjsS Model.Variables.planets.y
  var incl; // EjsS Model.Variables.planets.incl
  var lat; // EjsS Model.Variables.planets.lat
  var lon; // EjsS Model.Variables.planets.lon
  var dist; // EjsS Model.Variables.planets.dist
  var inclDeg; // EjsS Model.Variables.planets.inclDeg
  var lonAN; // EjsS Model.Variables.planets.lonAN
  var lonANdeg; // EjsS Model.Variables.planets.lonANdeg
  var arg; // EjsS Model.Variables.planets.arg
  var argDeg; // EjsS Model.Variables.planets.argDeg
  var pColor; // EjsS Model.Variables.planets.pColor
  var xP; // EjsS Model.Variables.planets.xP
  var yP; // EjsS Model.Variables.planets.yP
  var zP; // EjsS Model.Variables.planets.zP
  var xlos; // EjsS Model.Variables.planets.xlos
  var ylos; // EjsS Model.Variables.planets.ylos
  var zlos; // EjsS Model.Variables.planets.zlos
  var T; // EjsS Model.Variables.planets.T
  var TMars; // EjsS Model.Variables.planets.TMars
  var TVenus; // EjsS Model.Variables.planets.TVenus
  var TEarth; // EjsS Model.Variables.planets.TEarth

  var textureurl; // EjsS Model.Variables.MercuryGeneralarray.textureurl
  var n; // EjsS Model.Variables.MercuryGeneralarray.n
  var aMercury; // EjsS Model.Variables.MercuryGeneralarray.aMercury
  var eMercury; // EjsS Model.Variables.MercuryGeneralarray.eMercury
  var inclDegMercury; // EjsS Model.Variables.MercuryGeneralarray.inclDegMercury
  var lonANdegMercury; // EjsS Model.Variables.MercuryGeneralarray.lonANdegMercury
  var argDegMercury; // EjsS Model.Variables.MercuryGeneralarray.argDegMercury
  var inclMercury; // EjsS Model.Variables.MercuryGeneralarray.inclMercury
  var lonANMercury; // EjsS Model.Variables.MercuryGeneralarray.lonANMercury
  var argMercury; // EjsS Model.Variables.MercuryGeneralarray.argMercury
  var phiMercury; // EjsS Model.Variables.MercuryGeneralarray.phiMercury
  var rMercury; // EjsS Model.Variables.MercuryGeneralarray.rMercury
  var xMercury; // EjsS Model.Variables.MercuryGeneralarray.xMercury
  var yMercury; // EjsS Model.Variables.MercuryGeneralarray.yMercury
  var xPMercury; // EjsS Model.Variables.MercuryGeneralarray.xPMercury
  var yPMercury; // EjsS Model.Variables.MercuryGeneralarray.yPMercury
  var zPMercury; // EjsS Model.Variables.MercuryGeneralarray.zPMercury
  var lonEMercury; // EjsS Model.Variables.MercuryGeneralarray.lonEMercury
  var lonMercuryEdeg; // EjsS Model.Variables.MercuryGeneralarray.lonMercuryEdeg
  var latEMercury; // EjsS Model.Variables.MercuryGeneralarray.latEMercury
  var xlosMercury; // EjsS Model.Variables.MercuryGeneralarray.xlosMercury
  var ylosMercury; // EjsS Model.Variables.MercuryGeneralarray.ylosMercury
  var zlosMercury; // EjsS Model.Variables.MercuryGeneralarray.zlosMercury

  var nst; // EjsS Model.Variables.Stars.nst
  var xstar; // EjsS Model.Variables.Stars.xstar
  var ystar; // EjsS Model.Variables.Stars.ystar
  var zstar; // EjsS Model.Variables.Stars.zstar
  var magstar; // EjsS Model.Variables.Stars.magstar
  var nES; // EjsS Model.Variables.Stars.nES
  var lonES; // EjsS Model.Variables.Stars.lonES
  var latES; // EjsS Model.Variables.Stars.latES
  var magES; // EjsS Model.Variables.Stars.magES
  var xst; // EjsS Model.Variables.Stars.xst
  var yst; // EjsS Model.Variables.Stars.yst
  var zst; // EjsS Model.Variables.Stars.zst
  var magst; // EjsS Model.Variables.Stars.magst

  var traceEV; // EjsS Model.Variables.Control.traceEV
  var showEcl; // EjsS Model.Variables.Control.showEcl
  var eTrace; // EjsS Model.Variables.Control.eTrace
  var pTrace; // EjsS Model.Variables.Control.pTrace
  var lineES; // EjsS Model.Variables.Control.lineES
  var lineEP; // EjsS Model.Variables.Control.lineEP
  var linePS; // EjsS Model.Variables.Control.linePS
  var los; // EjsS Model.Variables.Control.los
  var userDef; // EjsS Model.Variables.Control.userDef
  var traceon; // EjsS Model.Variables.Control.traceon
  var eGrid; // EjsS Model.Variables.Control.eGrid
  var globeStars; // EjsS Model.Variables.Control.globeStars
  var evStars; // EjsS Model.Variables.Control.evStars
  var poPlane; // EjsS Model.Variables.Control.poPlane
  var vearrow; // EjsS Model.Variables.Control.vearrow
  var sunFront; // EjsS Model.Variables.Control.sunFront
  var useTrans; // EjsS Model.Variables.Control.useTrans
  var mars; // EjsS Model.Variables.Control.mars
  var notmars; // EjsS Model.Variables.Control.notmars
  var text; // EjsS Model.Variables.Control.text
  var text3D; // EjsS Model.Variables.Control.text3D

  var PlutoB; // EjsS Model.Variables.PlanetB.PlutoB
  var NeptuneB; // EjsS Model.Variables.PlanetB.NeptuneB
  var memory; // EjsS Model.Variables.PlanetB.memory
  var cmode; // EjsS Model.Variables.PlanetB.cmode
  var cmode1; // EjsS Model.Variables.PlanetB.cmode1
  var cmodeenabled; // EjsS Model.Variables.PlanetB.cmodeenabled
  var eclipticview; // EjsS Model.Variables.PlanetB.eclipticview

  var magRow; // EjsS Model.Variables.recorddata.magRow
  var Tm; // EjsS Model.Variables.recorddata.Tm
  var Rm; // EjsS Model.Variables.recorddata.Rm
  var Rave; // EjsS Model.Variables.recorddata.Rave
  var magRowa; // EjsS Model.Variables.recorddata.magRowa
  var magRowta; // EjsS Model.Variables.recorddata.magRowta
  var magRowra; // EjsS Model.Variables.recorddata.magRowra
  var collectData; // EjsS Model.Variables.recorddata.collectData
  var datai; // EjsS Model.Variables.recorddata.datai
  var countdatai; // EjsS Model.Variables.recorddata.countdatai
  var countdataitext; // EjsS Model.Variables.recorddata.countdataitext

  var _privateOdesList;
  var _ODEi_evolution1;

  function _serialize() { return _model.serialize(); }

  _model._userSerialize = function() {
    return {
      print : print,
      fontb : fontb,
      font : font,
      mode : mode,
      range : range,
      xmin : xmin,
      xmax : xmax,
      ymin : ymin,
      ymax : ymax,
      zmin : zmin,
      zmax : zmax,
      t : t,
      t0 : t0,
      dt : dt,
      size : size,
      size2 : size2,
      stroke : stroke,
      pi : pi,
      blue : blue,
      green : green,
      green2 : green2,
      yellow : yellow,
      clr : clr,
      clr2 : clr2,
      clabel : clabel,
      npt : npt,
      rE : rE,
      phiE : phiE,
      aE : aE,
      eE : eE,
      xE : xE,
      yE : yE,
      lonPE : lonPE,
      lonPEdeg : lonPEdeg,
      lonS : lonS,
      scale : scale,
      scalecamera : scalecamera,
      decorationtypeaxes : decorationtypeaxes,
      zoom : zoom,
      radius : radius,
      r : r,
      phi : phi,
      a : a,
      e : e,
      x : x,
      y : y,
      incl : incl,
      lat : lat,
      lon : lon,
      dist : dist,
      inclDeg : inclDeg,
      lonAN : lonAN,
      lonANdeg : lonANdeg,
      arg : arg,
      argDeg : argDeg,
      pColor : pColor,
      xP : xP,
      yP : yP,
      zP : zP,
      xlos : xlos,
      ylos : ylos,
      zlos : zlos,
      T : T,
      TMars : TMars,
      TVenus : TVenus,
      TEarth : TEarth,
      textureurl : textureurl,
      n : n,
      aMercury : aMercury,
      eMercury : eMercury,
      inclDegMercury : inclDegMercury,
      lonANdegMercury : lonANdegMercury,
      argDegMercury : argDegMercury,
      inclMercury : inclMercury,
      lonANMercury : lonANMercury,
      argMercury : argMercury,
      phiMercury : phiMercury,
      rMercury : rMercury,
      xMercury : xMercury,
      yMercury : yMercury,
      xPMercury : xPMercury,
      yPMercury : yPMercury,
      zPMercury : zPMercury,
      lonEMercury : lonEMercury,
      lonMercuryEdeg : lonMercuryEdeg,
      latEMercury : latEMercury,
      xlosMercury : xlosMercury,
      ylosMercury : ylosMercury,
      zlosMercury : zlosMercury,
      nst : nst,
      xstar : xstar,
      ystar : ystar,
      zstar : zstar,
      magstar : magstar,
      nES : nES,
      lonES : lonES,
      latES : latES,
      magES : magES,
      xst : xst,
      yst : yst,
      zst : zst,
      magst : magst,
      traceEV : traceEV,
      showEcl : showEcl,
      eTrace : eTrace,
      pTrace : pTrace,
      lineES : lineES,
      lineEP : lineEP,
      linePS : linePS,
      los : los,
      userDef : userDef,
      traceon : traceon,
      eGrid : eGrid,
      globeStars : globeStars,
      evStars : evStars,
      poPlane : poPlane,
      vearrow : vearrow,
      sunFront : sunFront,
      useTrans : useTrans,
      mars : mars,
      notmars : notmars,
      text : text,
      text3D : text3D,
      PlutoB : PlutoB,
      NeptuneB : NeptuneB,
      memory : memory,
      cmode : cmode,
      cmode1 : cmode1,
      cmodeenabled : cmodeenabled,
      eclipticview : eclipticview,
      magRow : magRow,
      Tm : Tm,
      Rm : Rm,
      Rave : Rave,
      magRowa : magRowa,
      magRowta : magRowta,
      magRowra : magRowra,
      collectData : collectData,
      datai : datai,
      countdatai : countdatai,
      countdataitext : countdataitext
    };
  };

  function _unserialize(json) { return _model.unserialize(json); }

  _model._userUnserialize = function(json) {
    if(typeof json.print != "undefined") print = json.print;
    if(typeof json.fontb != "undefined") fontb = json.fontb;
    if(typeof json.font != "undefined") font = json.font;
    if(typeof json.mode != "undefined") mode = json.mode;
    if(typeof json.range != "undefined") range = json.range;
    if(typeof json.xmin != "undefined") xmin = json.xmin;
    if(typeof json.xmax != "undefined") xmax = json.xmax;
    if(typeof json.ymin != "undefined") ymin = json.ymin;
    if(typeof json.ymax != "undefined") ymax = json.ymax;
    if(typeof json.zmin != "undefined") zmin = json.zmin;
    if(typeof json.zmax != "undefined") zmax = json.zmax;
    if(typeof json.t != "undefined") t = json.t;
    if(typeof json.t0 != "undefined") t0 = json.t0;
    if(typeof json.dt != "undefined") dt = json.dt;
    if(typeof json.size != "undefined") size = json.size;
    if(typeof json.size2 != "undefined") size2 = json.size2;
    if(typeof json.stroke != "undefined") stroke = json.stroke;
    if(typeof json.pi != "undefined") pi = json.pi;
    if(typeof json.blue != "undefined") blue = json.blue;
    if(typeof json.green != "undefined") green = json.green;
    if(typeof json.green2 != "undefined") green2 = json.green2;
    if(typeof json.yellow != "undefined") yellow = json.yellow;
    if(typeof json.clr != "undefined") clr = json.clr;
    if(typeof json.clr2 != "undefined") clr2 = json.clr2;
    if(typeof json.clabel != "undefined") clabel = json.clabel;
    if(typeof json.npt != "undefined") npt = json.npt;
    if(typeof json.rE != "undefined") rE = json.rE;
    if(typeof json.phiE != "undefined") phiE = json.phiE;
    if(typeof json.aE != "undefined") aE = json.aE;
    if(typeof json.eE != "undefined") eE = json.eE;
    if(typeof json.xE != "undefined") xE = json.xE;
    if(typeof json.yE != "undefined") yE = json.yE;
    if(typeof json.lonPE != "undefined") lonPE = json.lonPE;
    if(typeof json.lonPEdeg != "undefined") lonPEdeg = json.lonPEdeg;
    if(typeof json.lonS != "undefined") lonS = json.lonS;
    if(typeof json.scale != "undefined") scale = json.scale;
    if(typeof json.scalecamera != "undefined") scalecamera = json.scalecamera;
    if(typeof json.decorationtypeaxes != "undefined") decorationtypeaxes = json.decorationtypeaxes;
    if(typeof json.zoom != "undefined") zoom = json.zoom;
    if(typeof json.radius != "undefined") radius = json.radius;
    if(typeof json.r != "undefined") r = json.r;
    if(typeof json.phi != "undefined") phi = json.phi;
    if(typeof json.a != "undefined") a = json.a;
    if(typeof json.e != "undefined") e = json.e;
    if(typeof json.x != "undefined") x = json.x;
    if(typeof json.y != "undefined") y = json.y;
    if(typeof json.incl != "undefined") incl = json.incl;
    if(typeof json.lat != "undefined") lat = json.lat;
    if(typeof json.lon != "undefined") lon = json.lon;
    if(typeof json.dist != "undefined") dist = json.dist;
    if(typeof json.inclDeg != "undefined") inclDeg = json.inclDeg;
    if(typeof json.lonAN != "undefined") lonAN = json.lonAN;
    if(typeof json.lonANdeg != "undefined") lonANdeg = json.lonANdeg;
    if(typeof json.arg != "undefined") arg = json.arg;
    if(typeof json.argDeg != "undefined") argDeg = json.argDeg;
    if(typeof json.pColor != "undefined") pColor = json.pColor;
    if(typeof json.xP != "undefined") xP = json.xP;
    if(typeof json.yP != "undefined") yP = json.yP;
    if(typeof json.zP != "undefined") zP = json.zP;
    if(typeof json.xlos != "undefined") xlos = json.xlos;
    if(typeof json.ylos != "undefined") ylos = json.ylos;
    if(typeof json.zlos != "undefined") zlos = json.zlos;
    if(typeof json.T != "undefined") T = json.T;
    if(typeof json.TMars != "undefined") TMars = json.TMars;
    if(typeof json.TVenus != "undefined") TVenus = json.TVenus;
    if(typeof json.TEarth != "undefined") TEarth = json.TEarth;
    if(typeof json.textureurl != "undefined") textureurl = json.textureurl;
    if(typeof json.n != "undefined") n = json.n;
    if(typeof json.aMercury != "undefined") aMercury = json.aMercury;
    if(typeof json.eMercury != "undefined") eMercury = json.eMercury;
    if(typeof json.inclDegMercury != "undefined") inclDegMercury = json.inclDegMercury;
    if(typeof json.lonANdegMercury != "undefined") lonANdegMercury = json.lonANdegMercury;
    if(typeof json.argDegMercury != "undefined") argDegMercury = json.argDegMercury;
    if(typeof json.inclMercury != "undefined") inclMercury = json.inclMercury;
    if(typeof json.lonANMercury != "undefined") lonANMercury = json.lonANMercury;
    if(typeof json.argMercury != "undefined") argMercury = json.argMercury;
    if(typeof json.phiMercury != "undefined") phiMercury = json.phiMercury;
    if(typeof json.rMercury != "undefined") rMercury = json.rMercury;
    if(typeof json.xMercury != "undefined") xMercury = json.xMercury;
    if(typeof json.yMercury != "undefined") yMercury = json.yMercury;
    if(typeof json.xPMercury != "undefined") xPMercury = json.xPMercury;
    if(typeof json.yPMercury != "undefined") yPMercury = json.yPMercury;
    if(typeof json.zPMercury != "undefined") zPMercury = json.zPMercury;
    if(typeof json.lonEMercury != "undefined") lonEMercury = json.lonEMercury;
    if(typeof json.lonMercuryEdeg != "undefined") lonMercuryEdeg = json.lonMercuryEdeg;
    if(typeof json.latEMercury != "undefined") latEMercury = json.latEMercury;
    if(typeof json.xlosMercury != "undefined") xlosMercury = json.xlosMercury;
    if(typeof json.ylosMercury != "undefined") ylosMercury = json.ylosMercury;
    if(typeof json.zlosMercury != "undefined") zlosMercury = json.zlosMercury;
    if(typeof json.nst != "undefined") nst = json.nst;
    if(typeof json.xstar != "undefined") xstar = json.xstar;
    if(typeof json.ystar != "undefined") ystar = json.ystar;
    if(typeof json.zstar != "undefined") zstar = json.zstar;
    if(typeof json.magstar != "undefined") magstar = json.magstar;
    if(typeof json.nES != "undefined") nES = json.nES;
    if(typeof json.lonES != "undefined") lonES = json.lonES;
    if(typeof json.latES != "undefined") latES = json.latES;
    if(typeof json.magES != "undefined") magES = json.magES;
    if(typeof json.xst != "undefined") xst = json.xst;
    if(typeof json.yst != "undefined") yst = json.yst;
    if(typeof json.zst != "undefined") zst = json.zst;
    if(typeof json.magst != "undefined") magst = json.magst;
    if(typeof json.traceEV != "undefined") traceEV = json.traceEV;
    if(typeof json.showEcl != "undefined") showEcl = json.showEcl;
    if(typeof json.eTrace != "undefined") eTrace = json.eTrace;
    if(typeof json.pTrace != "undefined") pTrace = json.pTrace;
    if(typeof json.lineES != "undefined") lineES = json.lineES;
    if(typeof json.lineEP != "undefined") lineEP = json.lineEP;
    if(typeof json.linePS != "undefined") linePS = json.linePS;
    if(typeof json.los != "undefined") los = json.los;
    if(typeof json.userDef != "undefined") userDef = json.userDef;
    if(typeof json.traceon != "undefined") traceon = json.traceon;
    if(typeof json.eGrid != "undefined") eGrid = json.eGrid;
    if(typeof json.globeStars != "undefined") globeStars = json.globeStars;
    if(typeof json.evStars != "undefined") evStars = json.evStars;
    if(typeof json.poPlane != "undefined") poPlane = json.poPlane;
    if(typeof json.vearrow != "undefined") vearrow = json.vearrow;
    if(typeof json.sunFront != "undefined") sunFront = json.sunFront;
    if(typeof json.useTrans != "undefined") useTrans = json.useTrans;
    if(typeof json.mars != "undefined") mars = json.mars;
    if(typeof json.notmars != "undefined") notmars = json.notmars;
    if(typeof json.text != "undefined") text = json.text;
    if(typeof json.text3D != "undefined") text3D = json.text3D;
    if(typeof json.PlutoB != "undefined") PlutoB = json.PlutoB;
    if(typeof json.NeptuneB != "undefined") NeptuneB = json.NeptuneB;
    if(typeof json.memory != "undefined") memory = json.memory;
    if(typeof json.cmode != "undefined") cmode = json.cmode;
    if(typeof json.cmode1 != "undefined") cmode1 = json.cmode1;
    if(typeof json.cmodeenabled != "undefined") cmodeenabled = json.cmodeenabled;
    if(typeof json.eclipticview != "undefined") eclipticview = json.eclipticview;
    if(typeof json.magRow != "undefined") magRow = json.magRow;
    if(typeof json.Tm != "undefined") Tm = json.Tm;
    if(typeof json.Rm != "undefined") Rm = json.Rm;
    if(typeof json.Rave != "undefined") Rave = json.Rave;
    if(typeof json.magRowa != "undefined") magRowa = json.magRowa;
    if(typeof json.magRowta != "undefined") magRowta = json.magRowta;
    if(typeof json.magRowra != "undefined") magRowra = json.magRowra;
    if(typeof json.collectData != "undefined") collectData = json.collectData;
    if(typeof json.datai != "undefined") datai = json.datai;
    if(typeof json.countdatai != "undefined") countdatai = json.countdatai;
    if(typeof json.countdataitext != "undefined") countdataitext = json.countdataitext;
   _resetSolvers();
   _model.update();
  };

  _model.addToReset(function() {
    __pagesEnabled["selectPlanet"] = true;
    __pagesEnabled["draw planets"] = true;
    __pagesEnabled["Evol Page"] = true;
    __pagesEnabled["Event"] = true;
    __pagesEnabled["mercury"] = true;
    __pagesEnabled["orbitFR"] = true;
    __pagesEnabled["eciplticFR"] = true;
  });

  _model.addToReset(function() {
    print = false; // EjsS Model.Variables.Var Table.print
    fontb = "normal bold 2vw "; // EjsS Model.Variables.Var Table.fontb
    font = "normal normal 2vw "; // EjsS Model.Variables.Var Table.font
    mode = 0; // EjsS Model.Variables.Var Table.mode
    range = 4; // EjsS Model.Variables.Var Table.range
    xmin = -range/2; // EjsS Model.Variables.Var Table.xmin
    xmax = range/2; // EjsS Model.Variables.Var Table.xmax
    ymin = -range/2; // EjsS Model.Variables.Var Table.ymin
    ymax = range/2; // EjsS Model.Variables.Var Table.ymax
    zmin = -range/2; // EjsS Model.Variables.Var Table.zmin
    zmax = range/2; // EjsS Model.Variables.Var Table.zmax
    t = 0.0; // EjsS Model.Variables.Var Table.t
    t0 = t; // EjsS Model.Variables.Var Table.t0
    dt = 0.05; // EjsS Model.Variables.Var Table.dt
    size = range/50.; // EjsS Model.Variables.Var Table.size
    size2 = size/2; // EjsS Model.Variables.Var Table.size2
    stroke = 5; // EjsS Model.Variables.Var Table.stroke
    pi = Math.PI; // EjsS Model.Variables.Var Table.pi
    blue = "rgb(0,0,255)"; // EjsS Model.Variables.Var Table.blue
    green = "rgb(0,255,0)"; // EjsS Model.Variables.Var Table.green
    green2 = "rgb(0,255,0)"; // EjsS Model.Variables.Var Table.green2
    yellow = "rgb(255,255,0)"; // EjsS Model.Variables.Var Table.yellow
    clr = "yellow"; // EjsS Model.Variables.Var Table.clr
    clr2 = "yellow"; // EjsS Model.Variables.Var Table.clr2
    clabel = "current flow"; // EjsS Model.Variables.Var Table.clabel
    npt = 500; // EjsS Model.Variables.Var Table.npt
  });

  _model.addToReset(function() {
    rE = 1; // EjsS Model.Variables.Earth.rE
    phiE = 0; // EjsS Model.Variables.Earth.phiE
    aE = 1; // EjsS Model.Variables.Earth.aE
    eE = 0.0167; // EjsS Model.Variables.Earth.eE
    xE = 1; // EjsS Model.Variables.Earth.xE
    yE = 0; // EjsS Model.Variables.Earth.yE
    lonPE = 0; // EjsS Model.Variables.Earth.lonPE
    lonPEdeg = 102.9472; // EjsS Model.Variables.Earth.lonPEdeg
    lonS = 0; // EjsS Model.Variables.Earth.lonS
    scale = 2; // EjsS Model.Variables.Earth.scale
    scalecamera = 2; // EjsS Model.Variables.Earth.scalecamera
    decorationtypeaxes = "NONE"; // EjsS Model.Variables.Earth.decorationtypeaxes
    zoom = 1; // EjsS Model.Variables.Earth.zoom
  });

  _model.addToReset(function() {
    radius = new Array(9); // EjsS Model.Variables.planets.radius
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.planets.radius
        radius[_i0] = 0;  // EjsS Model.Variables.planets.radius
      }
    }());
    r = 0; // EjsS Model.Variables.planets.r
    phi = 0.0; // EjsS Model.Variables.planets.phi
    a = 0; // EjsS Model.Variables.planets.a
    e = 0; // EjsS Model.Variables.planets.e
    x = 0; // EjsS Model.Variables.planets.x
    y = 0; // EjsS Model.Variables.planets.y
    incl = 15; // EjsS Model.Variables.planets.incl
    lat = 0; // EjsS Model.Variables.planets.lat
    lon = 0; // EjsS Model.Variables.planets.lon
    dist = 0; // EjsS Model.Variables.planets.dist
    inclDeg = 0; // EjsS Model.Variables.planets.inclDeg
    lonAN = 0; // EjsS Model.Variables.planets.lonAN
    lonANdeg = 30; // EjsS Model.Variables.planets.lonANdeg
    arg = 0; // EjsS Model.Variables.planets.arg
    argDeg = 0; // EjsS Model.Variables.planets.argDeg
    pColor = "rgba(1,2,3,1.0)"; // EjsS Model.Variables.planets.pColor
    xP = 0; // EjsS Model.Variables.planets.xP
    yP = 0; // EjsS Model.Variables.planets.yP
    zP = 0; // EjsS Model.Variables.planets.zP
    xlos = 0; // EjsS Model.Variables.planets.xlos
    ylos = 0; // EjsS Model.Variables.planets.ylos
    zlos = 0; // EjsS Model.Variables.planets.zlos
    T = 0; // EjsS Model.Variables.planets.T
    TMars = 1.88; // EjsS Model.Variables.planets.TMars
    TVenus = 0.615; // EjsS Model.Variables.planets.TVenus
    TEarth = 1; // EjsS Model.Variables.planets.TEarth
  });

  _model.addToReset(function() {
    textureurl = new Array(8); // EjsS Model.Variables.MercuryGeneralarray.textureurl
    (function () {
      var _i0;
      for (_i0=0; _i0<8; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.textureurl
        textureurl[_i0] = "";  // EjsS Model.Variables.MercuryGeneralarray.textureurl
      }
    }());
    n = 8; // EjsS Model.Variables.MercuryGeneralarray.n
    aMercury = [0.3871,0.7233,1.5237,5.2034,9.5371,19.19,30.06,39.48]; // EjsS Model.Variables.MercuryGeneralarray.aMercury
    eMercury = [0.2056,0.0068,0.0934,0.0484,0.0542,0.046,0.010,0.248]; // EjsS Model.Variables.MercuryGeneralarray.eMercury
    inclDegMercury = [7.0049,3.3947,1.8506,1.3053,2.4845,0.77,1.77,17.15]; // EjsS Model.Variables.MercuryGeneralarray.inclDegMercury
    lonANdegMercury = [48.3317,76.6807,49.5785,100.5562,113.7150,73.989821,131.794310,110.30347]; // EjsS Model.Variables.MercuryGeneralarray.lonANdegMercury
    argDegMercury = [29.1248,54.8523,286.4623,274.1977,338.7169,96.541318,265.646853,113.76329]; // EjsS Model.Variables.MercuryGeneralarray.argDegMercury
    inclMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.inclMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.inclMercury
        inclMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.inclMercury
      }
    }());
    lonANMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.lonANMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.lonANMercury
        lonANMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.lonANMercury
      }
    }());
    argMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.argMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.argMercury
        argMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.argMercury
      }
    }());
    phiMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.phiMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.phiMercury
        phiMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.phiMercury
      }
    }());
    rMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.rMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.rMercury
        rMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.rMercury
      }
    }());
    xMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.xMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.xMercury
        xMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.xMercury
      }
    }());
    yMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.yMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.yMercury
        yMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.yMercury
      }
    }());
    xPMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.xPMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.xPMercury
        xPMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.xPMercury
      }
    }());
    yPMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.yPMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.yPMercury
        yPMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.yPMercury
      }
    }());
    zPMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.zPMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.zPMercury
        zPMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.zPMercury
      }
    }());
    lonEMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.lonEMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.lonEMercury
        lonEMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.lonEMercury
      }
    }());
    lonMercuryEdeg = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.lonMercuryEdeg
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.lonMercuryEdeg
        lonMercuryEdeg[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.lonMercuryEdeg
      }
    }());
    latEMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.latEMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.latEMercury
        latEMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.latEMercury
      }
    }());
    xlosMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.xlosMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.xlosMercury
        xlosMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.xlosMercury
      }
    }());
    ylosMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.ylosMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.ylosMercury
        ylosMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.ylosMercury
      }
    }());
    zlosMercury = new Array(n); // EjsS Model.Variables.MercuryGeneralarray.zlosMercury
    (function () {
      var _i0;
      for (_i0=0; _i0<n; _i0+=1) {  // EjsS Model.Variables.MercuryGeneralarray.zlosMercury
        zlosMercury[_i0] = 0;  // EjsS Model.Variables.MercuryGeneralarray.zlosMercury
      }
    }());
  });

  _model.addToReset(function() {
    nst = 300; // EjsS Model.Variables.Stars.nst
    xstar = new Array(nst); // EjsS Model.Variables.Stars.xstar
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.xstar
        xstar[_i0] = 0;  // EjsS Model.Variables.Stars.xstar
      }
    }());
    ystar = new Array(nst); // EjsS Model.Variables.Stars.ystar
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.ystar
        ystar[_i0] = 0;  // EjsS Model.Variables.Stars.ystar
      }
    }());
    zstar = new Array(nst); // EjsS Model.Variables.Stars.zstar
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.zstar
        zstar[_i0] = 0;  // EjsS Model.Variables.Stars.zstar
      }
    }());
    magstar = new Array(nst); // EjsS Model.Variables.Stars.magstar
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.magstar
        magstar[_i0] = 0;  // EjsS Model.Variables.Stars.magstar
      }
    }());
    nES = 168; // EjsS Model.Variables.Stars.nES
    lonES = new Array(nES); // EjsS Model.Variables.Stars.lonES
    (function () {
      var _i0;
      for (_i0=0; _i0<nES; _i0+=1) {  // EjsS Model.Variables.Stars.lonES
        lonES[_i0] = 0;  // EjsS Model.Variables.Stars.lonES
      }
    }());
    latES = new Array(nES); // EjsS Model.Variables.Stars.latES
    (function () {
      var _i0;
      for (_i0=0; _i0<nES; _i0+=1) {  // EjsS Model.Variables.Stars.latES
        latES[_i0] = 0;  // EjsS Model.Variables.Stars.latES
      }
    }());
    magES = new Array(nES); // EjsS Model.Variables.Stars.magES
    (function () {
      var _i0;
      for (_i0=0; _i0<nES; _i0+=1) {  // EjsS Model.Variables.Stars.magES
        magES[_i0] = 0;  // EjsS Model.Variables.Stars.magES
      }
    }());
    xst = new Array(nst); // EjsS Model.Variables.Stars.xst
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.xst
        xst[_i0] = 0;  // EjsS Model.Variables.Stars.xst
      }
    }());
    yst = new Array(nst); // EjsS Model.Variables.Stars.yst
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.yst
        yst[_i0] = 0;  // EjsS Model.Variables.Stars.yst
      }
    }());
    zst = new Array(nst); // EjsS Model.Variables.Stars.zst
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.zst
        zst[_i0] = 0;  // EjsS Model.Variables.Stars.zst
      }
    }());
    magst = new Array(nst); // EjsS Model.Variables.Stars.magst
    (function () {
      var _i0;
      for (_i0=0; _i0<nst; _i0+=1) {  // EjsS Model.Variables.Stars.magst
        magst[_i0] = 0;  // EjsS Model.Variables.Stars.magst
      }
    }());
  });

  _model.addToReset(function() {
    eTrace = true; // EjsS Model.Variables.Control.eTrace
    pTrace = true; // EjsS Model.Variables.Control.pTrace
    text3D = ""; // EjsS Model.Variables.Control.text3D
  });

  _model.addToReset(function() {
    cmode = new Array(1); // EjsS Model.Variables.PlanetB.cmode
    (function () {
      var _i0;
      for (_i0=0; _i0<1; _i0+=1) {  // EjsS Model.Variables.PlanetB.cmode
        cmode[_i0] = "";  // EjsS Model.Variables.PlanetB.cmode
      }
    }());
    cmode1 = new Array(1); // EjsS Model.Variables.PlanetB.cmode1
    (function () {
      var _i0;
      for (_i0=0; _i0<1; _i0+=1) {  // EjsS Model.Variables.PlanetB.cmode1
        cmode1[_i0] = "labels off";  // EjsS Model.Variables.PlanetB.cmode1
      }
    }());
    cmodeenabled = 0; // EjsS Model.Variables.PlanetB.cmodeenabled
  });

  _model.addToReset(function() {
    magRow = new Array(2); // EjsS Model.Variables.recorddata.magRow
    (function () {
      var _i0;
      for (_i0=0; _i0<2; _i0+=1) {  // EjsS Model.Variables.recorddata.magRow
        magRow[_i0] = 0;  // EjsS Model.Variables.recorddata.magRow
      }
    }());
    Tm = new Array(9); // EjsS Model.Variables.recorddata.Tm
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.Tm
        Tm[_i0] = 0;  // EjsS Model.Variables.recorddata.Tm
      }
    }());
    Rm = new Array(9); // EjsS Model.Variables.recorddata.Rm
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.Rm
        Rm[_i0] = 0;  // EjsS Model.Variables.recorddata.Rm
      }
    }());
    Rave = new Array(9); // EjsS Model.Variables.recorddata.Rave
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.Rave
        Rave[_i0] = 0;  // EjsS Model.Variables.recorddata.Rave
      }
    }());
    magRowa = new Array(9); // EjsS Model.Variables.recorddata.magRowa
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.magRowa
        magRowa[_i0] = 0;  // EjsS Model.Variables.recorddata.magRowa
      }
    }());
    magRowta = 0; // EjsS Model.Variables.recorddata.magRowta
    magRowra = 0; // EjsS Model.Variables.recorddata.magRowra
    datai = 0; // EjsS Model.Variables.recorddata.datai
    countdatai = new Array(9); // EjsS Model.Variables.recorddata.countdatai
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.countdatai
        countdatai[_i0] = 0;  // EjsS Model.Variables.recorddata.countdatai
      }
    }());
    countdataitext = new Array(9); // EjsS Model.Variables.recorddata.countdataitext
    (function () {
      var _i0;
      for (_i0=0; _i0<9; _i0+=1) {  // EjsS Model.Variables.recorddata.countdataitext
        countdataitext[_i0] = "";  // EjsS Model.Variables.recorddata.countdataitext
      }
    }());
  });

  _model.addToReset(function() {
    _privateOdesList=[];
    _ODEi_evolution1 = _ODE_evolution1();
    _privateOdesList.push(_ODEi_evolution1);
  });

  _model.addToReset(function() {
    _model.setAutoplay(false);
    _model.setPauseOnPageExit(true);
    _model.setFPS(20);
    _model.setStepsPerDisplay(1);
  });

  //sets scale for Orbit Frame and rescales celestial sphere  // > CustomCode.scaleStars:1
  function scaleStars () {  // > CustomCode.scaleStars:2
    for (var i=0; i<nst; i++) {  // > CustomCode.scaleStars:3
      scale = 1.5*Math.max(a/(1-e*e),aE/(1-eE*eE));  // > CustomCode.scaleStars:4
      xst[i] = scale*xstar[i];  // > CustomCode.scaleStars:5
      yst[i] = scale*ystar[i];  // > CustomCode.scaleStars:6
      zst[i] = scale*zstar[i];  // > CustomCode.scaleStars:7
      magst[i] = scale*magstar[i];}  // > CustomCode.scaleStars:8
        // > CustomCode.scaleStars:9
      // error in Ejs4.3  // > CustomCode.scaleStars:10
   // _view.orbitDrawingPanel3D.setScaleFactor(scale,scale,scale);  // > CustomCode.scaleStars:11
  //_view.orbitDrawingPanel3D.  // > CustomCode.scaleStars:12
  }  // > CustomCode.scaleStars:13

  //custom calls to set parameter values for various planets  // > CustomCode.selectPlanet:1
  function selectMercury () {  // > CustomCode.selectPlanet:2
    userDef=false;  // > CustomCode.selectPlanet:3
    notmars=true;  // > CustomCode.selectPlanet:4
    mars=false;  // > CustomCode.selectPlanet:5
    a = 0.3871; //Mean Distance from the Sun (AU)  // > CustomCode.selectPlanet:6
    e = 0.2056; // Orbital  Eccentricity  // > CustomCode.selectPlanet:7
    inclDeg = 7.0049; // Inclination to ecliptic (degrees)  // > CustomCode.selectPlanet:8
    lonANdeg = 48.3317; //longitude of planet's ascending node in degrees  // > CustomCode.selectPlanet:9
    argDeg = 29.1248; //argument of planet's perihelion in degrees  // > CustomCode.selectPlanet:10
   // _view.resetTraces();  // > CustomCode.selectPlanet:11
    scaleStars();  // > CustomCode.selectPlanet:12
  text3D = "Mercury"; // added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:13
  T = 1.88;  // > CustomCode.selectPlanet:14
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:15
  }  // > CustomCode.selectPlanet:16
  function selectVenus () {  // > CustomCode.selectPlanet:17
    userDef=false;  // > CustomCode.selectPlanet:18
    notmars=true;  // > CustomCode.selectPlanet:19
    mars=false;  // > CustomCode.selectPlanet:20
    a = 0.7233;  // > CustomCode.selectPlanet:21
    e = 0.0068;  // > CustomCode.selectPlanet:22
    inclDeg = 3.3947;  // > CustomCode.selectPlanet:23
    lonANdeg = 76.6807;  // > CustomCode.selectPlanet:24
    argDeg = 54.8523;  // > CustomCode.selectPlanet:25
  //  _view.resetTraces();  // > CustomCode.selectPlanet:26
    scaleStars();  // > CustomCode.selectPlanet:27
  text3D = "Venus"; // added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:28
  TVenus = 0.615;  // > CustomCode.selectPlanet:29
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:30
  }  // > CustomCode.selectPlanet:31
  function selectMars () {  // > CustomCode.selectPlanet:32
     mars=true;  // > CustomCode.selectPlanet:33
   userDef=false;  // > CustomCode.selectPlanet:34
    notmars=false;  // > CustomCode.selectPlanet:35
    a = 1.5237;  // > CustomCode.selectPlanet:36
    e = 0.0934;  // > CustomCode.selectPlanet:37
    inclDeg = 1.8506;  // > CustomCode.selectPlanet:38
    lonANdeg = 49.5785;  // > CustomCode.selectPlanet:39
    argDeg = 286.4623;  // > CustomCode.selectPlanet:40
  //  _view.resetTraces();  // > CustomCode.selectPlanet:41
    scaleStars();  // > CustomCode.selectPlanet:42
  text3D = "Mars";// added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:43
  TMars = 1.88;  // > CustomCode.selectPlanet:44
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:45
  }  // > CustomCode.selectPlanet:46
  function selectJupiter () {  // > CustomCode.selectPlanet:47
    userDef=false;  // > CustomCode.selectPlanet:48
    notmars=true;  // > CustomCode.selectPlanet:49
    mars=false;  // > CustomCode.selectPlanet:50
    a = 5.2034;  // > CustomCode.selectPlanet:51
    e = 0.0484;  // > CustomCode.selectPlanet:52
    inclDeg = 1.3053;  // > CustomCode.selectPlanet:53
    lonANdeg = 100.5562;  // > CustomCode.selectPlanet:54
    argDeg = 274.1977;  // > CustomCode.selectPlanet:55
   // _view.resetTraces();  // > CustomCode.selectPlanet:56
    scaleStars();  // > CustomCode.selectPlanet:57
  text3D = "Jupiter";// added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:58
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:59
  }  // > CustomCode.selectPlanet:60
  function selectSaturn () {  // > CustomCode.selectPlanet:61
    userDef=false;  // > CustomCode.selectPlanet:62
    notmars=true;  // > CustomCode.selectPlanet:63
    mars=false;  // > CustomCode.selectPlanet:64
    a = 9.5371;  // > CustomCode.selectPlanet:65
    e = 0.0542;  // > CustomCode.selectPlanet:66
    inclDeg = 2.4845;  // > CustomCode.selectPlanet:67
    lonANdeg = 113.7150;  // > CustomCode.selectPlanet:68
    argDeg = 338.7169;  // > CustomCode.selectPlanet:69
  //  _view.resetTraces();  // > CustomCode.selectPlanet:70
    scaleStars();  // > CustomCode.selectPlanet:71
  text3D = "Saturn";// added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:72
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:73
  }  // > CustomCode.selectPlanet:74
  function selectUserDef () {  // > CustomCode.selectPlanet:75
    userDef=true;  // > CustomCode.selectPlanet:76
    notmars=true;  // > CustomCode.selectPlanet:77
    mars=false;  // > CustomCode.selectPlanet:78
    a = 1.5237;  // > CustomCode.selectPlanet:79
    e = 0.0934;  // > CustomCode.selectPlanet:80
    inclDeg = 1.8506;  // > CustomCode.selectPlanet:81
    lonANdeg = 49.5785;  // > CustomCode.selectPlanet:82
    argDeg = 286.4623;  // > CustomCode.selectPlanet:83
   // _view.resetTraces();  // > CustomCode.selectPlanet:84
    scaleStars();  // > CustomCode.selectPlanet:85
  text3D = "UserDef";// added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:86
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:87
  }  // > CustomCode.selectPlanet:88
  //added by lookang to include Uranus  	Neptune  	Pluto  // > CustomCode.selectPlanet:89
  //http://www.nasm.si.edu/etp/ss/ss_planetdata.html  // > CustomCode.selectPlanet:90
  function selectUranus () {  // > CustomCode.selectPlanet:91
    userDef=false;  // > CustomCode.selectPlanet:92
    notmars=true;  // > CustomCode.selectPlanet:93
    mars=false;  // > CustomCode.selectPlanet:94
    a = 19.19; //Mean Distance from the Sun (AU)  // > CustomCode.selectPlanet:95
    e = 0.046;  // > CustomCode.selectPlanet:96
    inclDeg = 0.77; // Inclination to ecliptic (degrees)  // > CustomCode.selectPlanet:97
    lonANdeg = 73.989821; // from wikipedia  // > CustomCode.selectPlanet:98
    argDeg = 96.541318; // from wikipedia  // > CustomCode.selectPlanet:99
  //  _view.resetTraces();  // > CustomCode.selectPlanet:100
    scaleStars();  // > CustomCode.selectPlanet:101
  text3D = "Uranus"; // added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:102
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:103
  }  // > CustomCode.selectPlanet:104
  function selectNeptune () {  // > CustomCode.selectPlanet:105
    userDef=false;  // > CustomCode.selectPlanet:106
    notmars=true;  // > CustomCode.selectPlanet:107
    mars=false;  // > CustomCode.selectPlanet:108
    a = 30.06;  // > CustomCode.selectPlanet:109
    e = 0.010;  // > CustomCode.selectPlanet:110
    inclDeg = 1.77; // Inclination to ecliptic (degrees)  // > CustomCode.selectPlanet:111
    lonANdeg = 131.794310; // from wikipedia  // > CustomCode.selectPlanet:112
    argDeg = 265.646853; // from wikipedia  // > CustomCode.selectPlanet:113
   // _view.resetTraces();  // > CustomCode.selectPlanet:114
    scaleStars();  // > CustomCode.selectPlanet:115
  text3D = "Neptune"; // added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:116
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:117
  }  // > CustomCode.selectPlanet:118
  function selectPluto () {  // > CustomCode.selectPlanet:119
    userDef=false;  // > CustomCode.selectPlanet:120
    notmars=true;  // > CustomCode.selectPlanet:121
    mars=false;  // > CustomCode.selectPlanet:122
    a = 39.48;  //Mean Distance from the Sun (AU)  // > CustomCode.selectPlanet:123
    e = 0.248; //Orbital  Eccentricity  // > CustomCode.selectPlanet:124
    inclDeg = 17.15; // Inclination to ecliptic (degrees)  // > CustomCode.selectPlanet:125
    lonANdeg = 110.30347; // from wikipedia  // > CustomCode.selectPlanet:126
    argDeg = 113.76329; // from wikipedia  // > CustomCode.selectPlanet:127
   // _view.resetTraces();  // > CustomCode.selectPlanet:128
    scaleStars();  // > CustomCode.selectPlanet:129
  text3D = "Pluto"; // added by lookang to make text appear in the gallaxy  // > CustomCode.selectPlanet:130
  t=0.0; // needed to fix bug of double planets  // > CustomCode.selectPlanet:131
  }  // > CustomCode.selectPlanet:132

  //this section of the model is correct as well  // > CustomCode.collectData:1
  //it recorded the data in a table  // > CustomCode.collectData:2
  function recordData () {  // > CustomCode.collectData:3
    collectData = false;  // > CustomCode.collectData:4
    magRow[0]=t; // period  // > CustomCode.collectData:5
    magRow[1]=r; // radius  // > CustomCode.collectData:6
   // _view.xytrail  // > CustomCode.collectData:7
     //adding points to a trail to be accessed by dataTool  // > CustomCode.collectData:8
      // > CustomCode.collectData:9
  //  _view.xytrail.addPoint(t, r);  // > CustomCode.collectData:10
  //  _view.Etrail.addPoint(r,getE(xDetector,yDetector)[2]);  // > CustomCode.collectData:11
    collectData = true;  // > CustomCode.collectData:12
  }  // > CustomCode.collectData:13

  _model.addToInitialization(function() {
    if (!__pagesEnabled["selectPlanet"]) return;
    //custom calls to set parameter values for various planets  // > Initialization.selectPlanet:1
    t=0.0; // needed to fix bug of double planets  // > Initialization.selectPlanet:2
    scaleStars(); // draw stars  // > Initialization.selectPlanet:3
  });

  _model.addToInitialization(function() {
    if (!__pagesEnabled["draw planets"]) return;
    //for (var i=0; i<9 /* Iterations */ ; i++) {  // > Initialization.draw planets:1
    // radius[i] = 0.04*scale;  // > Initialization.draw planets:2
       // > Initialization.draw planets:3
    //}  // > Initialization.draw planets:4
    textureurl[0] = "./KeplerSystem/Mercury_Map.jpg";  // > Initialization.draw planets:5
    radius[0] = 0.03*scale;  // > Initialization.draw planets:6
    textureurl[1] = "./KeplerSystem/ven0aaa2.jpg";  // > Initialization.draw planets:7
    radius[1] = 0.03*scale;  // > Initialization.draw planets:8
    //textureurl[2] = "./KeplerSystem/2_no_clouds_2k.jpg";  // > Initialization.draw planets:9
    textureurl[2] = "./KeplerSystem/mars_texture.jpg";  // > Initialization.draw planets:10
    radius[2] = 0.03*scale;  // > Initialization.draw planets:11
    textureurl[3] = "./KeplerSystem/jupiter.jpg";  // > Initialization.draw planets:12
    radius[3] = 0.06*scale;  // > Initialization.draw planets:13
    textureurl[4] = "./KeplerSystem/saturn.jpg";  // > Initialization.draw planets:14
    radius[4] = 0.06*scale;  // > Initialization.draw planets:15
    textureurl[5] = "./KeplerSystem/uranus.jpg";  // > Initialization.draw planets:16
    radius[5] = 0.06*scale;  // > Initialization.draw planets:17
    textureurl[6] = "./KeplerSystem/texture_neptune.jpg";  // > Initialization.draw planets:18
    radius[6] = 0.06*scale;  // > Initialization.draw planets:19
    textureurl[7] = "./KeplerSystem/plutobynasa.jpg";  // > Initialization.draw planets:20
    radius[7] = 0.03*scale;  // > Initialization.draw planets:21
  });

  _model.addToInitialization(function() {
    _initializeSolvers();
  });

  _model.addToEvolution(function() {
    if (!__pagesEnabled["Evol Page"]) return;
    _ODEi_evolution1.step();
  });

  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });

  _model.addToFixedRelations(function() {
    if (!__pagesEnabled["mercury"]) return;
    for (var i=0; i<n /* Iterations */ ; i++) {  // > FixedRelations.mercury:1
        // > FixedRelations.mercury:2
    //convert degree values to radians  // > FixedRelations.mercury:3
    lonEMercury[i] = pi*lonMercuryEdeg[i]/180.0;  // > FixedRelations.mercury:4
    lonANMercury[i] = pi*lonANdegMercury[i]/180.0;  // > FixedRelations.mercury:5
    inclMercury[i] = pi*inclDegMercury[i]/180.0;  // > FixedRelations.mercury:6
    argMercury[i] = pi*argDegMercury[i]/180.0;  // > FixedRelations.mercury:7
    //compute radial coordinate for Earth  // > FixedRelations.mercury:8
    rMercury[i] = aMercury[i]*(1-eMercury[i]*eMercury[i])/(1+eMercury[i]*Math.cos(phiMercury[i]));  // > FixedRelations.mercury:9
    //compute x and y coordinates for planet in its orbital plane  // > FixedRelations.mercury:10
    xMercury[i] = rMercury[i]*Math.cos(phiMercury[i]+argMercury[i]);  // > FixedRelations.mercury:11
    yMercury[i] = rMercury[i]*Math.sin(phiMercury[i]+argMercury[i]);  // > FixedRelations.mercury:12
    //compute true x,y,z coordinates for planet  // > FixedRelations.mercury:13
    xPMercury[i] = -yMercury[i]*Math.cos(lonANMercury[i])-xMercury[i]*Math.cos(inclMercury[i])*Math.sin(lonANMercury[i]);  // > FixedRelations.mercury:14
    yPMercury[i] = xMercury[i]*Math.cos(inclMercury[i])*Math.cos(lonANMercury[i])-yMercury[i]*Math.sin(lonANMercury[i]);  // > FixedRelations.mercury:15
    zPMercury[i] = xMercury[i]*Math.sin(inclMercury[i]);  // > FixedRelations.mercury:16
    //compute longitude and latitude of planet  // > FixedRelations.mercury:17
    lonEMercury[i] = Math.atan2(yPMercury[i]-yE,xPMercury[i]-xE);  // > FixedRelations.mercury:18
    latEMercury[i] = Math.atan2(zPMercury[i],Math.sqrt((xPMercury[i]-xE)*(xPMercury[i]-xE)+(yPMercury[i]-yE)*(yPMercury[i]-yE)));  // > FixedRelations.mercury:19
    //compute components of line-of-sight vector  // > FixedRelations.mercury:20
    xlosMercury[i] = scale*Math.cos(latEMercury[i])*Math.cos(lonEMercury[i]);  // > FixedRelations.mercury:21
    ylosMercury[i] = scale*Math.cos(latEMercury[i])*Math.sin(lonEMercury[i]);  // > FixedRelations.mercury:22
    zlosMercury[i] = scale*Math.sin(latEMercury[i]);  // > FixedRelations.mercury:23
    }  // > FixedRelations.mercury:24
  });

  _model.addToFixedRelations(function() {
    if (!__pagesEnabled["orbitFR"]) return;
    //set color for inferior/superior planet  // > FixedRelations.orbitFR:1
    if (a >= aE) {  // > FixedRelations.orbitFR:2
    pColor = "rgb(255,0,0)" ;  // > FixedRelations.orbitFR:3
      }  // > FixedRelations.orbitFR:4
    else {  // > FixedRelations.orbitFR:5
      pColor = "rgb(255,255,0)";  // > FixedRelations.orbitFR:6
      }  // > FixedRelations.orbitFR:7
      //pColor = new Color(255,0,0,255);}  // > FixedRelations.orbitFR:8
    //else {  // > FixedRelations.orbitFR:9
     // pColor = new Color(255,255,0,255);}  // > FixedRelations.orbitFR:10
    //convert degree values to radians  // > FixedRelations.orbitFR:11
    lonPE = Math.PI*lonPEdeg/180.0;  // > FixedRelations.orbitFR:12
    lonAN = Math.PI*lonANdeg/180.0;  // > FixedRelations.orbitFR:13
    incl = Math.PI*inclDeg/180.0;  // > FixedRelations.orbitFR:14
    arg = Math.PI*argDeg/180.0;  // > FixedRelations.orbitFR:15
    //compute radial coordinate for Earth  // > FixedRelations.orbitFR:16
    rE = aE*(1-eE*eE)/(1+eE*Math.cos(phiE));  // > FixedRelations.orbitFR:17
    //compute x and y coordinates for Earth  // > FixedRelations.orbitFR:18
    xE = rE*Math.cos(phiE+lonPE);  // > FixedRelations.orbitFR:19
    yE = rE*Math.sin(phiE+lonPE);  // > FixedRelations.orbitFR:20
    //compute radial coordinate for planet  // > FixedRelations.orbitFR:21
    r = a*(1-e*e)/(1+e*Math.cos(phi));  // > FixedRelations.orbitFR:22
    //compute x and y coordinates for planet in its orbital plane  // > FixedRelations.orbitFR:23
    x = r*Math.cos(phi+arg);  // > FixedRelations.orbitFR:24
    y = r*Math.sin(phi+arg);  // > FixedRelations.orbitFR:25
    //compute true x,y,z coordinates for planet  // > FixedRelations.orbitFR:26
    xP = -y*Math.cos(lonAN)-x*Math.cos(incl)*Math.sin(lonAN);  // > FixedRelations.orbitFR:27
    yP = x*Math.cos(incl)*Math.cos(lonAN)-y*Math.sin(lonAN);  // > FixedRelations.orbitFR:28
    zP = x*Math.sin(incl);  // > FixedRelations.orbitFR:29
    //compute longitude and latitude of planet  // > FixedRelations.orbitFR:30
    lon = Math.atan2(yP-yE,xP-xE);  // > FixedRelations.orbitFR:31
    lat = Math.atan2(zP,Math.sqrt((xP-xE)*(xP-xE)+(yP-yE)*(yP-yE)));  // > FixedRelations.orbitFR:32
    //compute components of line-of-sight vector  // > FixedRelations.orbitFR:33
    //xlos = scale*Math.cos(lat)*Math.cos(lon);  // > FixedRelations.orbitFR:34
    //ylos = scale*Math.cos(lat)*Math.sin(lon);  // > FixedRelations.orbitFR:35
    //zlos = scale*Math.sin(lat);  // > FixedRelations.orbitFR:36
    xlos = Math.cos(lat)*Math.cos(lon);  // > FixedRelations.orbitFR:37
    ylos = Math.cos(lat)*Math.sin(lon);  // > FixedRelations.orbitFR:38
    zlos = Math.sin(lat);  // > FixedRelations.orbitFR:39
  });

  _model.addToFixedRelations(function() {
    if (!__pagesEnabled["eciplticFR"]) return;
    //compute longitude of Sun (sign reversed)  // > FixedRelations.eciplticFR:1
    lonS = -Math.atan2(-yE,-xE);  // > FixedRelations.eciplticFR:2
    //compute distance from Earth to planet  // > FixedRelations.eciplticFR:3
    dist = Math.sqrt((xP-xE)*(xP-xE)+(yP-yE)*(yP-yE)+zP*zP);  // > FixedRelations.eciplticFR:4
    //check to see if Sun is closer to Earth than planet  // > FixedRelations.eciplticFR:5
    if (rE < dist) {  // > FixedRelations.eciplticFR:6
      sunFront=true;}  // > FixedRelations.eciplticFR:7
    else {  // > FixedRelations.eciplticFR:8
      sunFront=false;}  // > FixedRelations.eciplticFR:9
    //de-activate ecliptic trace when too close to edge  // > FixedRelations.eciplticFR:10
    if ((Math.PI-Math.abs(lon))<0.05) {  // > FixedRelations.eciplticFR:11
      traceon=false;  // > FixedRelations.eciplticFR:12
    }  // > FixedRelations.eciplticFR:13
    else {  // > FixedRelations.eciplticFR:14
      traceon=true;}  // > FixedRelations.eciplticFR:15
  });

  _model.addToFixedRelations(function() { _isPaused = _model.isPaused(); _isPlaying = _model.isPlaying(); });

  function _initializeSolvers() {
    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].initializeSolver();
  }

  function _automaticResetSolvers() {
    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].automaticResetSolver();
  }

  _model.resetSolvers = function() {
    for (var i=0,n=_privateOdesList.length; i<n; i++) _privateOdesList[i].resetSolver();
  };

  function _getODE(_odeName) {
    if (_odeName=="Evol Page") return _ODEi_evolution1;
    return null;
  }

  function _getEventSolver(_odeName) {
    var ode = _getODE(_odeName);
    if (ode===null) return null;
    return ode.getEventSolver();
  }

  function _setSolverClass(_odeName, _engine) {
    var ode = _getODE(_odeName);
    if (ode===null) return;
    if (!_engine.setODE) {
      var classname = _engine.toLowerCase();
      if      (classname.indexOf("boga")>=0)   _engine = EJSS_ODE_SOLVERS.bogackiShampine23;
      else if (classname.indexOf("cash")>=0)   _engine = EJSS_ODE_SOLVERS.cashKarp45;
      else if (classname.indexOf("dopri5")>=0) _engine = EJSS_ODE_SOLVERS.dopri5;
      else if (classname.indexOf("dopri8")>=0) _engine = EJSS_ODE_SOLVERS.dopri853;
      else if (classname.indexOf("richa")>=0)  _engine = EJSS_ODE_SOLVERS.eulerRichardson;
      else if (classname.indexOf("euler")>=0)  _engine = EJSS_ODE_SOLVERS.euler;
      else if (classname.indexOf("fehlberg87")>=0) _engine = EJSS_ODE_SOLVERS.fehlberg87;
      else if (classname.indexOf("fehlberg8")>=0)  _engine = EJSS_ODE_SOLVERS.fehlberg8;
      else if (classname.indexOf("radau")>=0)   _engine = EJSS_ODE_SOLVERS.radau5;
      else if (classname.indexOf("runge")>=0)  _engine = EJSS_ODE_SOLVERS.rungeKutta4;
      else if (classname.indexOf("rk4")>=0)    _engine = EJSS_ODE_SOLVERS.rungeKutta4;
      else if (classname.indexOf("verlet")>=0) _engine = EJSS_ODE_SOLVERS.velocityVerlet;
    }
    if (_engine) ode.setSolverClass(_engine);
  }

  function _ODE_evolution1() {
    var __odeSelf = {};
    var __eventSolver;
    var __solverClass = EJSS_ODE_SOLVERS.rungeKutta4;
    var __state=[];
    var _ODE_evolution1_Event1;
    var __ignoreErrors=false;
    var __mustInitialize=true;
    var __isEnabled=true;
    var __mustUserReinitialize=false;
    var __mustReinitialize=true;

    var _phiMercuryLength;

    __odeSelf.setSolverClass = function(__aSolverClass) {
      __solverClass = __aSolverClass;
      __instantiateSolver();
    };

    function __instantiateSolver() {
      __state=[];
      _phiMercuryLength = phiMercury.length;
      __pushState();
      __eventSolver = EJSS_ODE_SOLVERS.interpolatorEventSolver(__solverClass(),__odeSelf);
      __mustInitialize = true;
    }

    __odeSelf.setEnabled = function(_enabled) { __isEnabled = _enabled; };

    __odeSelf.getIndependentVariableValue = function() { return __eventSolver.getIndependentVariableValue(); };

    __odeSelf.getInternalStepSize = function() { return __eventSolver.getInternalStepSize(); };

    __odeSelf.isAccelerationIndependentOfVelocity = function() { return false; };

    __odeSelf.initializeSolver = function() {
      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); return; }
      __pushState();
      __eventSolver.initialize(dt);
      __eventSolver.setBestInterpolation(false);
      __eventSolver.setMaximumInternalSteps(10000);
      __eventSolver.removeAllEvents();
      if (__pagesEnabled["Event"]) __eventSolver.addEvent(_ODE_evolution1_Event1());
      __eventSolver.setEstimateFirstStep(false);
      __eventSolver.setEnableExceptions(false);
      __eventSolver.setTolerances(0.00001,0.00001);
      __mustReinitialize = true;
      __mustInitialize = false;
    };

    function __pushState() {
      // Copy our variables to __state[] 
        var __j=0;
        var __n=0;
        var __cIn=0;
        if (__state[__cIn]!=phiE) __mustReinitialize = true;
        __state[__cIn++] = phiE;
        if (__state[__cIn]!=phi) __mustReinitialize = true;
        __state[__cIn++] = phi;
      if (!__mustReinitialize)
        for (__j=0,__n=__cIn; __j<_phiMercuryLength; __j++)
           if (__state[__n++]!=phiMercury[__j]) { __mustReinitialize = true; break; }
        for (__j=0;__j<_phiMercuryLength; __j++) {
          __state[__cIn++] = phiMercury[__j];
        }
        if (__state[__cIn]!=t) __mustReinitialize = true;
        __state[__cIn++] = t;
    }

    function __arraysChanged () {
      if (_phiMercuryLength != phiMercury.length) return true;
      return false;
    }

    __odeSelf.getEventSolver = function() {
      return __eventSolver;
    };

    __odeSelf.resetSolver = function() {
      __mustUserReinitialize = true;
    };

    __odeSelf.automaticResetSolver = function() {
      __mustReinitialize = true;
    };

    function __errorAction () {
      if (__ignoreErrors) return;
      console.log (__eventSolver.getErrorMessage());
      _pause();
      // Make sure the solver is reinitialized;
      __mustReinitialize = true;
    }

    __odeSelf.step = function() { return __privateStep(false); };

    __odeSelf.solverStep = function() { return __privateStep(true); };

    function __privateStep(__takeMaximumStep) {
      if (!__isEnabled) return 0;
      if (dt===0) return 0;
      if (__mustInitialize) __odeSelf.initializeSolver();
      if (__arraysChanged()) { __instantiateSolver(); __odeSelf.initializeSolver(); }
      __eventSolver.setStepSize(dt);
      __eventSolver.setInternalStepSize(dt);
      __eventSolver.setMaximumInternalSteps(10000);
      __eventSolver.setTolerances(0.00001,0.00001);
      __pushState();
      if (__mustUserReinitialize) { 
        __eventSolver.userReinitialize();
        __mustUserReinitialize = false;
        __mustReinitialize = false;
        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();
      }
      else if (__mustReinitialize) { 
        __eventSolver.reinitialize();
        __mustReinitialize = false;
        if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();
      }
      var __stepTaken = __takeMaximumStep ? __eventSolver.maxStep() : __eventSolver.step();
      // Extract our variables from __state
        var __i=0;
        var __cOut=0;
        phiE = __state[__cOut++];
        phi = __state[__cOut++];
        for (__i=0;__i<_phiMercuryLength; __i++) {
          phiMercury[__i] = __state[__cOut++];
        }
        t = __state[__cOut++];
      // Check for error
      if (__eventSolver.getErrorCode()!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR) __errorAction();
      return __stepTaken;
    }

    __odeSelf.getState = function() { return __state; };

    __odeSelf.getRate = function(_aState,_aRate) {
      // Extract our variables from _aState
        var __i=0;
        var __cOut=0;
        var phiE = _aState[__cOut++];
        var phi = _aState[__cOut++];
        var phiMercury = [];
        for (__i=0;__i<_phiMercuryLength; __i++) {
          phiMercury[__i] = _aState[__cOut++];
        }
        var t = _aState[__cOut++];
      // Compute the rate
        var __cRate=0;
        _aRate[__cRate++] = 2*pi*(1+eE*Math.cos(phiE))*(1+eE*Math.cos(phiE))/Math.pow(aE*(1-eE*eE),1.5); // Rate for ODE: Evol Page:phiE
        _aRate[__cRate++] = 2*pi*(1+e*Math.cos(phi))*(1+e*Math.cos(phi))/Math.pow(a*(1-e*e),1.5); // Rate for ODE: Evol Page:phi
        var i;
        for (i=0;i<_phiMercuryLength;i++) {
          _aRate[__cRate++] = Array.isArray(2*pi*(1+eMercury[i]*Math.cos(phiMercury[i]))*(1+eMercury[i]*Math.cos(phiMercury[i]))/Math.pow(aMercury[i]*(1-eMercury[i]*eMercury[i]),1.5)) ? 2*pi*(1+eMercury[i]*Math.cos(phiMercury[i]))*(1+eMercury[i]*Math.cos(phiMercury[i]))/Math.pow(aMercury[i]*(1-eMercury[i]*eMercury[i]),1.5)[i] : 2*pi*(1+eMercury[i]*Math.cos(phiMercury[i]))*(1+eMercury[i]*Math.cos(phiMercury[i]))/Math.pow(aMercury[i]*(1-eMercury[i]*eMercury[i]),1.5); // Rate for ODE: Evol Page:phiMercury
        }
        _aRate[__cRate++] = 1; // independent variable
        return _aRate;
    }; //end of getRate

    _ODE_evolution1_Event1 = function() {
      var _eventSelf = {};

      _eventSelf.getTypeOfEvent = function() { return EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT; };

      _eventSelf.getRootFindingMethod = function() { return EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION; };

      _eventSelf.getMaxIterations = function() { return 100; };

      _eventSelf.getTolerance = function() { return 1.0e-5; };

      _eventSelf.evaluate = function(_aState) { 
      // Extract our variables from _aState
        var __i=0;
        var __cOut=0;
        var phiE = _aState[__cOut++];
        var phi = _aState[__cOut++];
        var phiMercury = [];
        for (__i=0;__i<_phiMercuryLength; __i++) {
          phiMercury[__i] = _aState[__cOut++];
        }
        var t = _aState[__cOut++];
        return phi-2*pi;  // > Event zero-condition for page Evol Page:1
      };

      _eventSelf.action = function() { 
      // Extract our variables from __state
        var __i=0;
        var __cOut=0;
        phiE = __state[__cOut++];
        phi = __state[__cOut++];
        for (__i=0;__i<_phiMercuryLength; __i++) {
          phiMercury[__i] = __state[__cOut++];
        }
        t = __state[__cOut++];
        var _returnValue = __userDefinedAction();
      // Copy our variables to __state[] 
        var __j=0;
        var __n=0;
        var __cIn=0;
        __state[__cIn++] = phiE;
        __state[__cIn++] = phi;
        for (__j=0;__j<_phiMercuryLength; __j++) {
          __state[__cIn++] = phiMercury[__j];
        }
        __state[__cIn++] = t;
        return _returnValue;
      };

      function __userDefinedAction() {
        _pause();  // > Event action for page Evol Page:1
        return true;
      }

      return _eventSelf;
    }; // End of event

    __instantiateSolver();

    return __odeSelf;
  }

  function _historic_phiE(__time) {
    var __index = 0;
    return _ODEi_evolution1.getEventSolver().getStateHistory().interpolate(__time,__index);
  }

  function _historic_phi(__time) {
    var __index = 0 + 1;
    return _ODEi_evolution1.getEventSolver().getStateHistory().interpolate(__time,__index);
  }

  function _historic_phiMercury(__time) {
    var __beginIndex = 0 + 1 + 1;
    return _ODEi_evolution1.getEventSolver().getStateHistory().interpolate(__time,new Array(phiMercury.length),__beginIndex,phiMercury.ength);
  }

    _model._resized = function(_width,_height) {
      _view._resized(_width,_height);
  }; // end of _resized
    _model._fontResized = function(iBase,iSize,iDelta) {
      _view._fontResized(iBase,iSize,iDelta);
  }; // end of _fontResized

  function _getViews() {
    var _viewsInfo = [];
    var _counter = 0;
    _viewsInfo[_counter++] = { name : "HtmlView Page", width : 800, height : 600 };
    return _viewsInfo;
  } // end of _getViews

  function _selectView(_viewNumber) {
    _view = null;
    _view = new gravity09fast_View(_topFrame,_viewNumber,_libraryPath,_codebasePath);
    var _view_super_reset = _view._reset;
    _view._reset = function() {
      _view_super_reset();
      switch(_viewNumber) {
        case -10 : break; // make Lint happy
        default :
        case 0:
          _view.drawingPanel3D.linkProperty("MinimumX",  function() { return -scale; } ); // HtmlView Page linking property 'MinimumX' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("MinimumY",  function() { return -scale; } ); // HtmlView Page linking property 'MinimumY' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("MinimumZ",  function() { return zmin; }, function(_v) { zmin = _v; } ); // HtmlView Page linking property 'MinimumZ' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("DecorationType",  function() { return decorationtypeaxes; }, function(_v) { decorationtypeaxes = _v; } ); // HtmlView Page linking property 'DecorationType' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("MaximumZ",  function() { return zmax; }, function(_v) { zmax = _v; } ); // HtmlView Page linking property 'MaximumZ' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("MaximumY",  function() { return scale; }, function(_v) { scale = _v; } ); // HtmlView Page linking property 'MaximumY' for element 'drawingPanel3D'
          _view.drawingPanel3D.linkProperty("MaximumX",  function() { return scale; }, function(_v) { scale = _v; } ); // HtmlView Page linking property 'MaximumX' for element 'drawingPanel3D'
          _view.Sun.linkProperty("Radius",  function() { return 0.1*scale; } ); // HtmlView Page linking property 'Radius' for element 'Sun'
          _view.Sun2.linkProperty("Visibility",  function() { return text; }, function(_v) { text = _v; } ); // HtmlView Page linking property 'Visibility' for element 'Sun2'
          _view.Earth.linkProperty("Radius",  function() { return 0.03*scale; } ); // HtmlView Page linking property 'Radius' for element 'Earth'
          _view.Earth.linkProperty("X",  function() { return xE; }, function(_v) { xE = _v; } ); // HtmlView Page linking property 'X' for element 'Earth'
          _view.Earth.linkProperty("Y",  function() { return yE; }, function(_v) { yE = _v; } ); // HtmlView Page linking property 'Y' for element 'Earth'
          _view.eTrace.linkProperty("Connected",  function() { return _isPlaying; } ); // HtmlView Page linking property 'Connected' for element 'eTrace'
          _view.eTrace.linkProperty("InputX",  function() { return xE; }, function(_v) { xE = _v; } ); // HtmlView Page linking property 'InputX' for element 'eTrace'
          _view.eTrace.linkProperty("Visibility",  function() { return eTrace; }, function(_v) { eTrace = _v; } ); // HtmlView Page linking property 'Visibility' for element 'eTrace'
          _view.eTrace.linkProperty("InputY",  function() { return yE; }, function(_v) { yE = _v; } ); // HtmlView Page linking property 'InputY' for element 'eTrace'
          _view.Earth2.linkProperty("X",  function() { return xE; }, function(_v) { xE = _v; } ); // HtmlView Page linking property 'X' for element 'Earth2'
          _view.Earth2.linkProperty("Y",  function() { return yE; }, function(_v) { yE = _v; } ); // HtmlView Page linking property 'Y' for element 'Earth2'
          _view.Earth2.linkProperty("Visibility",  function() { return text; }, function(_v) { text = _v; } ); // HtmlView Page linking property 'Visibility' for element 'Earth2'
          _view.Planet.linkProperty("Radius",  function() { return 0.03*scale; } ); // HtmlView Page linking property 'Radius' for element 'Planet'
          _view.Planet.linkProperty("X",  function() { return xP; }, function(_v) { xP = _v; } ); // HtmlView Page linking property 'X' for element 'Planet'
          _view.Planet.linkProperty("Y",  function() { return yP; }, function(_v) { yP = _v; } ); // HtmlView Page linking property 'Y' for element 'Planet'
          _view.Planet.linkProperty("Z",  function() { return zP; }, function(_v) { zP = _v; } ); // HtmlView Page linking property 'Z' for element 'Planet'
          _view.pTrace.linkProperty("InputZ",  function() { return zP; }, function(_v) { zP = _v; } ); // HtmlView Page linking property 'InputZ' for element 'pTrace'
          _view.pTrace.linkProperty("Connected",  function() { return _isPlaying; } ); // HtmlView Page linking property 'Connected' for element 'pTrace'
          _view.pTrace.linkProperty("InputX",  function() { return xP; }, function(_v) { xP = _v; } ); // HtmlView Page linking property 'InputX' for element 'pTrace'
          _view.pTrace.linkProperty("Visibility",  function() { return pTrace; }, function(_v) { pTrace = _v; } ); // HtmlView Page linking property 'Visibility' for element 'pTrace'
          _view.pTrace.linkProperty("InputY",  function() { return yP; }, function(_v) { yP = _v; } ); // HtmlView Page linking property 'InputY' for element 'pTrace'
          _view.Planet2.linkProperty("X",  function() { return xP; }, function(_v) { xP = _v; } ); // HtmlView Page linking property 'X' for element 'Planet2'
          _view.Planet2.linkProperty("Y",  function() { return yP; }, function(_v) { yP = _v; } ); // HtmlView Page linking property 'Y' for element 'Planet2'
          _view.Planet2.linkProperty("Z",  function() { return zP; }, function(_v) { zP = _v; } ); // HtmlView Page linking property 'Z' for element 'Planet2'
          _view.Planet2.linkProperty("Text",  function() { return text3D; }, function(_v) { text3D = _v; } ); // HtmlView Page linking property 'Text' for element 'Planet2'
          _view.Planet2.linkProperty("Visibility",  function() { return text; }, function(_v) { text = _v; } ); // HtmlView Page linking property 'Visibility' for element 'Planet2'
          _view.earthSunLine.linkProperty("SizeX",  function() { return xE; }, function(_v) { xE = _v; } ); // HtmlView Page linking property 'SizeX' for element 'earthSunLine'
          _view.earthSunLine.linkProperty("SizeY",  function() { return yE; }, function(_v) { yE = _v; } ); // HtmlView Page linking property 'SizeY' for element 'earthSunLine'
          _view.earthPlanet.linkProperty("SizeX",  function() { return xP-xE; } ); // HtmlView Page linking property 'SizeX' for element 'earthPlanet'
          _view.earthPlanet.linkProperty("X",  function() { return xE; }, function(_v) { xE = _v; } ); // HtmlView Page linking property 'X' for element 'earthPlanet'
          _view.earthPlanet.linkProperty("LineColor",  function() { return pColor; }, function(_v) { pColor = _v; } ); // HtmlView Page linking property 'LineColor' for element 'earthPlanet'
          _view.earthPlanet.linkProperty("Y",  function() { return yE; }, function(_v) { yE = _v; } ); // HtmlView Page linking property 'Y' for element 'earthPlanet'
          _view.earthPlanet.linkProperty("SizeZ",  function() { return zP; }, function(_v) { zP = _v; } ); // HtmlView Page linking property 'SizeZ' for element 'earthPlanet'
          _view.earthPlanet.linkProperty("SizeY",  function() { return yP-yE; } ); // HtmlView Page linking property 'SizeY' for element 'earthPlanet'
          _view.PlanetSun.linkProperty("SizeX",  function() { return xP; }, function(_v) { xP = _v; } ); // HtmlView Page linking property 'SizeX' for element 'PlanetSun'
          _view.PlanetSun.linkProperty("LineColor",  function() { return pColor; }, function(_v) { pColor = _v; } ); // HtmlView Page linking property 'LineColor' for element 'PlanetSun'
          _view.PlanetSun.linkProperty("SizeZ",  function() { return zP; }, function(_v) { zP = _v; } ); // HtmlView Page linking property 'SizeZ' for element 'PlanetSun'
          _view.PlanetSun.linkProperty("SizeY",  function() { return yP; }, function(_v) { yP = _v; } ); // HtmlView Page linking property 'SizeY' for element 'PlanetSun'
          _view.sphereSet3D.linkProperty("Radius",  function() { return radius; }, function(_v) { radius = _v; } ); // HtmlView Page linking property 'Radius' for element 'sphereSet3D'
          _view.sphereSet3D.linkProperty("TextureUrl",  function() { return textureurl; }, function(_v) { textureurl = _v; } ); // HtmlView Page linking property 'TextureUrl' for element 'sphereSet3D'
          _view.sphereSet3D.linkProperty("X",  function() { return xPMercury; }, function(_v) { xPMercury = _v; } ); // HtmlView Page linking property 'X' for element 'sphereSet3D'
          _view.sphereSet3D.linkProperty("Y",  function() { return yPMercury; }, function(_v) { yPMercury = _v; } ); // HtmlView Page linking property 'Y' for element 'sphereSet3D'
          _view.sphereSet3D.linkProperty("Z",  function() { return zPMercury; }, function(_v) { zPMercury = _v; } ); // HtmlView Page linking property 'Z' for element 'sphereSet3D'
          _view.cylinder3D.linkProperty("SizeX",  function() { return 2*scale; } ); // HtmlView Page linking property 'SizeX' for element 'cylinder3D'
          _view.cylinder3D.linkProperty("SizeY",  function() { return 2*scale; } ); // HtmlView Page linking property 'SizeY' for element 'cylinder3D'
          _view.rotateZ.linkProperty("Transformation",  function() { return [[0,1.57,0,1.57]]; } ); // HtmlView Page linking property 'Transformation' for element 'rotateZ'
          _view.orbitalPlane.linkProperty("SizeX",  function() { return 2*scale; } ); // HtmlView Page linking property 'SizeX' for element 'orbitalPlane'
          _view.orbitalPlane.linkProperty("SizeY",  function() { return 2*scale; } ); // HtmlView Page linking property 'SizeY' for element 'orbitalPlane'
          _view.controlPanel.linkProperty("Display",  function() { return !print?"inline-flex":"none"; } ); // HtmlView Page linking property 'Display' for element 'controlPanel'
          _view.testingclevercode.linkProperty("Options",  function() { return ["Select_Planet","Mercury","Venus","Earth","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto","Chelyabinsk Meteoroid","","print"]; } ); // HtmlView Page linking property 'Options' for element 'testingclevercode'
          _view.testingclevercode.setAction("OnChange", function() {
  // "Select_Planet","Mercury","Venus","Earth","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto","Chelyabinsk Meteoroid"
  if (cmode[0] === "Mercury") {
    cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 0.3871; //Mean Distance from the Sun (AU)
    e = 0.2056; // Orbital  Eccentricity
    inclDeg = 7.0049; // Inclination to ecliptic (degrees)
    lonANdeg = 48.3317; //longitude of planet's ascending node in degrees
    argDeg = 29.1248; //argument of planet's perihelion in degrees
  //    _view.resetTraces();
    scaleStars();
  text3D = "Mercury"; // added by lookang to make text appear in the gallaxy
  T = 1.88;
  dt=0.01;
  }
  //printing with cmode??
  else if (cmode[0] === "print"){
    print = true;
  }
  //printing ends here
  else if(cmode[0] === "Venus")
  {
    cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 0.7233;
    e = 0.0068;
    inclDeg = 3.3947;
    lonANdeg = 76.6807;
    argDeg = 54.8523;
  //  _view.resetTraces();
    scaleStars();
  text3D = "Venus"; // added by lookang to make text appear in the gallaxy
  TVenus = 0.615;
  dt=0.01;
  }
  else if(cmode[0] === "Earth")
  {
    cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 1.0;
    e = 0.0167;
    inclDeg = 0.0;
    lonANdeg = 258.7; // by trail or error //102.9472; //348.73936; // http://en.wikipedia.org/wiki/Earth
    argDeg = 114.20783; //http://en.wikipedia.org/wiki/Earth
  //  _view.resetTraces();
    scaleStars();
  text3D = "Earth"; // added by lookang to make text appear in the gallaxy
  TEarth = 1.0;
  dt=0.01;
  }
  else if(cmode[0] === "Mars")
  {
    cmodeenabled=1;
     mars=true;
   userDef=false;
    notmars=false;
    a = 1.5237;
    e = 0.0934;
    inclDeg = 1.8506;
    lonANdeg = 49.5785;
    argDeg = 286.4623;
   // _view.resetTraces();
    scaleStars();
  text3D = "Mars";// added by lookang to make text appear in the gallaxy
  TMars = 1.88;
  dt=0.01;
  }
  else if(cmode[0] === "Jupiter")
  {
    cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 5.2034;
    e = 0.0484;
    inclDeg = 1.3053;
    lonANdeg = 100.5562;
    argDeg = 274.1977;
   // _view.resetTraces();
    scaleStars();
  text3D = "Jupiter";// added by lookang to make text appear in the gallaxy
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;
  }
  else if(cmode[0] === "Saturn")
  {
    cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 9.5371;
    e = 0.0542;
    inclDeg = 2.4845;
    lonANdeg = 113.7150;
    argDeg = 338.7169;
   // _view.resetTraces();
    scaleStars();
  text3D = "Saturn";// added by lookang to make text appear in the gallaxy
  dt=0.1;
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;
  }
  else if(cmode[0] === "UserDefine")
  {
    cmodeenabled=1;
    userDef=true;
    notmars=true;
    mars=false;
    a = 1.5237;
    e = 0.0934;
    inclDeg = 1.8506;
    lonANdeg = 49.5785;
    argDeg = 286.4623;
   // _view.resetTraces();
    scaleStars();
  text3D = "UserDef";// added by lookang to make text appear in the gallaxy
  }
  //added by lookang to include Uranus  	Neptune  	Pluto
  //http://www.nasm.si.edu/etp/ss/ss_planetdata.html
  else if(cmode[0] === "Uranus")
  { 
  cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 19.19; //Mean Distance from the Sun (AU)
    e = 0.046;
    inclDeg = 0.77; // Inclination to ecliptic (degrees)
    lonANdeg = 73.989821; // from wikipedia
    argDeg = 96.541318; // from wikipedia
  //  _view.resetTraces();
    scaleStars();
  text3D = "Uranus"; // added by lookang to make text appear in the gallaxy
  dt=0.5;
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;
  }
  else if(cmode[0] === "Neptune")
  { 
  cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 30.06;
    e = 0.010;
    inclDeg = 1.77; // Inclination to ecliptic (degrees)
    lonANdeg = 131.794310; // from wikipedia
    argDeg = 265.646853; // from wikipedia
  //  _view.resetTraces();
    scaleStars();
  text3D = "Neptune"; // added by lookang to make text appear in the gallaxy
  dt=1.0;
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;
  }
  else if(cmode[0] === "Pluto")
  { 
  cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    a = 39.48;  //Mean Distance from the Sun (AU)
    e = 0.248; //Orbital  Eccentricity
    inclDeg = 17.15; // Inclination to ecliptic (degrees)
    lonANdeg = 110.30347; // from wikipedia
    argDeg = 113.76329; // from wikipedia
  //  _view.resetTraces();
    scaleStars();
  text3D = "Pluto"; // added by lookang to make text appear in the gallaxy
  dt=2.0;
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;
  }
  else if(cmode[0] === "Chelyabinsk Meteoroid")
  { 
  cmodeenabled=1;
    userDef=false;
    notmars=true;
    mars=false;
    //taken from http://urania.udea.edu.co/sitios/facom/research/chelyabinsk-meteoroid.php?#
    a = 1.37;  //Mean Distance from the Sun (AU)
    e = 0.48; //Orbital  Eccentricity
    inclDeg = 4.31; // Inclination to ecliptic (degrees)
    lonANdeg = 326.5; // from wikipedia capital omega
    argDeg = 98.0; // from wikipedia small omega
  //  _view.resetTraces();
    scaleStars();
  text3D = "Chelyabinsk Meteoroid"; // added by lookang to make text appear in the gallaxy
  dt=0.01;
  }
  else if(cmode[0] === "Select_Planet")
  {
   cmodeenabled=0;
  }
  scalecamera = scale;
  radius[0] = 0.03*scale;
  radius[1] = 0.03*scale;
  radius[2] = 0.03*scale;
  radius[3] = 0.06*scale;
  radius[4] = 0.06*scale;
  radius[5] = 0.06*scale;
  radius[6] = 0.06*scale;
  radius[7] = 0.03*scale;

}); // HtmlView Page setting action 'OnChange' for element 'testingclevercode'
          _view.testingclevercode.linkProperty("Disabled",  function() { return t>0; } ); // HtmlView Page linking property 'Disabled' for element 'testingclevercode'
          _view.testingclevercode.linkProperty("SelectedOptions",  function() { return cmode; }, function(_v) { cmode = _v; } ); // HtmlView Page linking property 'SelectedOptions' for element 'testingclevercode'
          _view.testingclevercode.linkProperty("Font",  function() { return font; }, function(_v) { font = _v; } ); // HtmlView Page linking property 'Font' for element 'testingclevercode'
          _view.testingclevercode2.linkProperty("Options",  function() { return ["labels show","labels off","Earth trail show","Earth trail off","Planet trail show","Planet trail off","axes show","axes off","speed up","speed up2","speed down","speed down2","","print"]; } ); // HtmlView Page linking property 'Options' for element 'testingclevercode2'
          _view.testingclevercode2.setAction("OnChange", function() {
  // "Select_Planet","Mercury","Venus","Earth","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto","Chelyabinsk Meteoroid"
  if (cmode1[0] === "labels show") {
  text=true;
    
  }
  //printing begins now
  else if (cmode1[0] === "print"){
    print = true;
    }
  //printing the end~
  else if(cmode1[0] === "labels off")
  {
    text=false;
  }
  //"Earth trail show","Earth trail off"
  else if (cmode1[0] === "Earth trail show") {
  eTrace=true;
    
  }
  else if(cmode1[0] === "Earth trail off")
  {
   eTrace=false;
  }
  //"Planet trail show","Planet trail off"
  else if (cmode1[0] === "Planet trail show") {
  pTrace=true;
    
  }
  else if(cmode1[0] === "Planet trail off")
  {
   pTrace=false;
  }
  //"axes show","axes off"
  else if (cmode1[0] === "axes show") {
  decorationtypeaxes="CENTERED_AXES";
    
  }
  else if(cmode1[0] === "axes off")
  {
   decorationtypeaxes="NONE";
  }
  //"speed up","speed down"
  else if (cmode1[0] === "speed up") {
  dt=dt*10;
    
  }
  else if (cmode1[0] === "speed up2") {
  dt=dt*10;
    
  }
  else if(cmode1[0] === "speed down")
  {
  dt=dt*0.1;
  }
  else if(cmode1[0] === "speed down2")
  {
  dt=dt*0.1;
  }

}); // HtmlView Page setting action 'OnChange' for element 'testingclevercode2'
          _view.testingclevercode2.linkProperty("SelectedOptions",  function() { return cmode1; }, function(_v) { cmode1 = _v; } ); // HtmlView Page linking property 'SelectedOptions' for element 'testingclevercode2'
          _view.testingclevercode2.linkProperty("Font",  function() { return font; }, function(_v) { font = _v; } ); // HtmlView Page linking property 'Font' for element 'testingclevercode2'
          _view.playPauseButton.setAction("OffClick", _pause); // HtmlView Page setting action 'OffClick' for element 'playPauseButton'
          _view.playPauseButton.linkProperty("State",  function() { return _isPaused; } ); // HtmlView Page linking property 'State' for element 'playPauseButton'
          _view.playPauseButton.setAction("OnClick", _play); // HtmlView Page setting action 'OnClick' for element 'playPauseButton'
          _view.playPauseButton.linkProperty("Font",  function() { return fontb; }, function(_v) { fontb = _v; } ); // HtmlView Page linking property 'Font' for element 'playPauseButton'
          _view.step.setAction("OnClick", _step); // HtmlView Page setting action 'OnClick' for element 'step'
          _view.step.linkProperty("Font",  function() { return fontb; }, function(_v) { fontb = _v; } ); // HtmlView Page linking property 'Font' for element 'step'
          _view.resetButton.setAction("OnClick", _reset); // HtmlView Page setting action 'OnClick' for element 'resetButton'
          _view.resetButton.linkProperty("Font",  function() { return fontb; }, function(_v) { fontb = _v; } ); // HtmlView Page linking property 'Font' for element 'resetButton'
          _view.timeLabel.linkProperty("Font",  function() { return font; }, function(_v) { font = _v; } ); // HtmlView Page linking property 'Font' for element 'timeLabel'
          _view.timeField.linkProperty("Value",  function() { return t; }, function(_v) { t = _v; } ); // HtmlView Page linking property 'Value' for element 'timeField'
          _view.timeField.linkProperty("Font",  function() { return font; }, function(_v) { font = _v; } ); // HtmlView Page linking property 'Font' for element 'timeField'
          _view.messagesLabel.linkProperty("Font",  function() { return font; }, function(_v) { font = _v; } ); // HtmlView Page linking property 'Font' for element 'messagesLabel'
          break;
      } // end of switch
    }; // end of new reset

    _model.setView(_view);
    _model.reset();
    _view._enableEPub();
  } // end of _selectView

  _model.setAutoplay(false);
  _model.setFPS(20);
  _model.setStepsPerDisplay(1);
  _selectView(-1); // this includes _model.reset()
  return _model;
}

function gravity09fast_View (_topFrame,_viewNumber,_libraryPath,_codebasePath) {
  var _view;
  switch(_viewNumber) {
    case -10 : break; // make Lint happy
    default :
    case 0: _view = gravity09fast_View_0 (_topFrame); break;
  } // end of switch

  if (_codebasePath) _view._2(_codebasePath);

  if (_libraryPath) _view._4(_libraryPath);

  _view._addDescriptionPage('Intro Page','./gravity09.xhtml');

  return _view;
} // end of main function

function gravity09fast_View_0 (_topFrame) {
  var _view = EJSS_CORE.createView(_topFrame);

  _view._reset = function() {
    _view._1();
    _view._9(EJSS_INTERFACE.panel,"panel", _view._topFrame) // EJsS HtmlView.HtmlView Page: declaration of element 'panel'
      ;

    _view._9(EJSS_INTERFACE.panel,"displayPanel", _view.panel) // EJsS HtmlView.HtmlView Page: declaration of element 'displayPanel'
      ;

    _view._9(EJSS_INTERFACE.panel,"topPanel", _view.displayPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'topPanel'
      ;

    _view._9(EJSS_DRAWING3D.drawingPanel,"drawingPanel3D", _view.topPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'drawingPanel3D'
      .setProperty("Height",400) // EJsS HtmlView.HtmlView Page: setting property 'Height' for element 'drawingPanel3D'
      .setProperty("Width",640) // EJsS HtmlView.HtmlView Page: setting property 'Width' for element 'drawingPanel3D'
      .setProperty("Background","Black") // EJsS HtmlView.HtmlView Page: setting property 'Background' for element 'drawingPanel3D'
      .setProperty("Enabled",true) // EJsS HtmlView.HtmlView Page: setting property 'Enabled' for element 'drawingPanel3D'
      ;

    _view._9(EJSS_DRAWING3D.sphere,"Sun", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Sun'
      .setProperty("TextureUrl","./KeplerSystem/640px-Map_of_the_full_sun.jpg") // EJsS HtmlView.HtmlView Page: setting property 'TextureUrl' for element 'Sun'
      .setProperty("FillColor","Orange") // EJsS HtmlView.HtmlView Page: setting property 'FillColor' for element 'Sun'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'Sun'
      .setProperty("LineColor","Orange") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'Sun'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'Sun'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'Sun'
      ;

    _view._9(EJSS_DRAWING3D.text,"Sun2", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Sun2'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'Sun2'
      .setProperty("FontColor","White") // EJsS HtmlView.HtmlView Page: setting property 'FontColor' for element 'Sun2'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'Sun2'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'Sun2'
      .setProperty("Text","Sun") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'Sun2'
      .setProperty("Font","normal normal 24px ") // EJsS HtmlView.HtmlView Page: setting property 'Font' for element 'Sun2'
      ;

    _view._9(EJSS_DRAWING3D.sphere,"Earth", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Earth'
      .setProperty("TextureUrl","./KeplerSystem/2_no_clouds_2k.jpg") // EJsS HtmlView.HtmlView Page: setting property 'TextureUrl' for element 'Earth'
      .setProperty("FillColor","Blue") // EJsS HtmlView.HtmlView Page: setting property 'FillColor' for element 'Earth'
      .setProperty("LineColor","Blue") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'Earth'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'Earth'
      ;

    _view._9(EJSS_DRAWING3D.trail,"eTrace", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'eTrace'
      .setProperty("InputZ",0) // EJsS HtmlView.HtmlView Page: setting property 'InputZ' for element 'eTrace'
      .setProperty("LineColor","Blue") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'eTrace'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'eTrace'
      ;

    _view._9(EJSS_DRAWING3D.text,"Earth2", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Earth2'
      .setProperty("FontColor","White") // EJsS HtmlView.HtmlView Page: setting property 'FontColor' for element 'Earth2'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'Earth2'
      .setProperty("Text","Earth") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'Earth2'
      .setProperty("Font","normal normal 24px ") // EJsS HtmlView.HtmlView Page: setting property 'Font' for element 'Earth2'
      ;

    _view._9(EJSS_DRAWING3D.sphere,"Planet", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Planet'
      .setProperty("FillColor","Red") // EJsS HtmlView.HtmlView Page: setting property 'FillColor' for element 'Planet'
      .setProperty("LineColor","Red") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'Planet'
      ;

    _view._9(EJSS_DRAWING3D.trail,"pTrace", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'pTrace'
      .setProperty("LineColor","Red") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'pTrace'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'pTrace'
      ;

    _view._9(EJSS_DRAWING3D.text,"Planet2", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'Planet2'
      .setProperty("FontColor","White") // EJsS HtmlView.HtmlView Page: setting property 'FontColor' for element 'Planet2'
      .setProperty("Font","normal normal 24px ") // EJsS HtmlView.HtmlView Page: setting property 'Font' for element 'Planet2'
      ;

    _view._9(EJSS_DRAWING3D.segment,"earthSunLine", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'earthSunLine'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'earthSunLine'
      .setProperty("LineColor","Orange") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'earthSunLine'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'earthSunLine'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'earthSunLine'
      .setProperty("SizeZ",0) // EJsS HtmlView.HtmlView Page: setting property 'SizeZ' for element 'earthSunLine'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'earthSunLine'
      ;

    _view._9(EJSS_DRAWING3D.segment,"earthPlanet", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'earthPlanet'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'earthPlanet'
      .setProperty("Visibility",false) // EJsS HtmlView.HtmlView Page: setting property 'Visibility' for element 'earthPlanet'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'earthPlanet'
      ;

    _view._9(EJSS_DRAWING3D.segment,"PlanetSun", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'PlanetSun'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'PlanetSun'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'PlanetSun'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'PlanetSun'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'PlanetSun'
      ;

    _view._9(EJSS_DRAWING3D.group,"planets", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'planets'
      ;

    _view._9(EJSS_DRAWING3D.sphereSet,"sphereSet3D", _view.planets) // EJsS HtmlView.HtmlView Page: declaration of element 'sphereSet3D'
      .setProperty("NumberOfElements",8) // EJsS HtmlView.HtmlView Page: setting property 'NumberOfElements' for element 'sphereSet3D'
      .setProperty("FillColor","Magenta") // EJsS HtmlView.HtmlView Page: setting property 'FillColor' for element 'sphereSet3D'
      .setProperty("LineColor","Magenta") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'sphereSet3D'
      ;

    _view._9(EJSS_DRAWING3D.cylinder,"cylinder3D", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'cylinder3D'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'cylinder3D'
      .setProperty("LineColor","White") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'cylinder3D'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'cylinder3D'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'cylinder3D'
      .setProperty("SizeZ",0) // EJsS HtmlView.HtmlView Page: setting property 'SizeZ' for element 'cylinder3D'
      .setProperty("DrawLines",true) // EJsS HtmlView.HtmlView Page: setting property 'DrawLines' for element 'cylinder3D'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'cylinder3D'
      .setProperty("DrawFill",false) // EJsS HtmlView.HtmlView Page: setting property 'DrawFill' for element 'cylinder3D'
      ;

    _view._9(EJSS_DRAWING3D.group,"rotateZ", _view.drawingPanel3D) // EJsS HtmlView.HtmlView Page: declaration of element 'rotateZ'
      ;

    _view._9(EJSS_DRAWING3D.cylinder,"orbitalPlane", _view.rotateZ) // EJsS HtmlView.HtmlView Page: declaration of element 'orbitalPlane'
      .setProperty("X",0) // EJsS HtmlView.HtmlView Page: setting property 'X' for element 'orbitalPlane'
      .setProperty("LineColor","rgb(0,255,0)") // EJsS HtmlView.HtmlView Page: setting property 'LineColor' for element 'orbitalPlane'
      .setProperty("Y",0) // EJsS HtmlView.HtmlView Page: setting property 'Y' for element 'orbitalPlane'
      .setProperty("Z",0) // EJsS HtmlView.HtmlView Page: setting property 'Z' for element 'orbitalPlane'
      .setProperty("SizeZ",0) // EJsS HtmlView.HtmlView Page: setting property 'SizeZ' for element 'orbitalPlane'
      .setProperty("DrawLines",true) // EJsS HtmlView.HtmlView Page: setting property 'DrawLines' for element 'orbitalPlane'
      .setProperty("LineWidth",2) // EJsS HtmlView.HtmlView Page: setting property 'LineWidth' for element 'orbitalPlane'
      .setProperty("DrawFill",false) // EJsS HtmlView.HtmlView Page: setting property 'DrawFill' for element 'orbitalPlane'
      ;

    _view._9(EJSS_INTERFACE.panel,"controlPanel", _view.displayPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'controlPanel'
      ;

    _view._9(EJSS_INTERFACE.comboBox,"testingclevercode", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'testingclevercode'
      .setProperty("Tooltip","select user_defined and drag the mass") // EJsS HtmlView.HtmlView Page: setting property 'Tooltip' for element 'testingclevercode'
      ;

    _view._9(EJSS_INTERFACE.comboBox,"testingclevercode2", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'testingclevercode2'
      .setProperty("Tooltip","select user_defined and drag the mass") // EJsS HtmlView.HtmlView Page: setting property 'Tooltip' for element 'testingclevercode2'
      ;

    _view._9(EJSS_INTERFACE.twoStateButton,"playPauseButton", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'playPauseButton'
      .setProperty("TextOn","►") // EJsS HtmlView.HtmlView Page: setting property 'TextOn' for element 'playPauseButton'
      .setProperty("Tooltip","Play/Pause") // EJsS HtmlView.HtmlView Page: setting property 'Tooltip' for element 'playPauseButton'
      .setProperty("TextOff","❚❚") // EJsS HtmlView.HtmlView Page: setting property 'TextOff' for element 'playPauseButton'
      ;

    _view._9(EJSS_INTERFACE.button,"step", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'step'
      .setProperty("Tooltip","Step") // EJsS HtmlView.HtmlView Page: setting property 'Tooltip' for element 'step'
      .setProperty("Text","❚►") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'step'
      ;

    _view._9(EJSS_INTERFACE.button,"resetButton", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'resetButton'
      .setProperty("Tooltip","Reset") // EJsS HtmlView.HtmlView Page: setting property 'Tooltip' for element 'resetButton'
      .setProperty("Text","↻") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'resetButton'
      ;

    _view._9(EJSS_INTERFACE.imageAndTextButton,"timeLabel", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'timeLabel'
      .setProperty("Text","Time=") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'timeLabel'
      ;

    _view._9(EJSS_INTERFACE.numberField,"timeField", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'timeField'
      .setProperty("Width","5vw") // EJsS HtmlView.HtmlView Page: setting property 'Width' for element 'timeField'
      .setProperty("Format","0.00") // EJsS HtmlView.HtmlView Page: setting property 'Format' for element 'timeField'
      .setProperty("Editable",false) // EJsS HtmlView.HtmlView Page: setting property 'Editable' for element 'timeField'
      ;

    _view._9(EJSS_INTERFACE.imageAndTextButton,"messagesLabel", _view.controlPanel) // EJsS HtmlView.HtmlView Page: declaration of element 'messagesLabel'
      .setProperty("Text","years") // EJsS HtmlView.HtmlView Page: setting property 'Text' for element 'messagesLabel'
      ;

  };

  return _view;
}


//--><!]]></script>
  </head>
  <body>
    <div role="button" id="_topFrame" style="text-align:center"></div>
  <div id="metadata" class="metadata">
    <br />
    <div id="title_author">
      <hr />
      <b>Title and author:</b>
      <p>
      Solar System Model<br />
     <img alt="Logo" src="file:///Users/lookang/Google Drive/PublicLawrence/workspace/source/EJSS/02_newtonianmechanics_7gravity/fremont/ejss_src_gravity09fast/KeplerSystem/2016-07-01_1512s.png" />
      </p>
      <p>
      <img alt="author image" src="file:///Users/lookang/Google Drive/PublicLawrence/workspace/source/EJSS/02_newtonianmechanics_7gravity/fremont/ejss_src_gravity09fast/01authorlookang50x50.png" />
      <img alt="author image" src="file:///Users/lookang/Google Drive/PublicLawrence/workspace/source/EJSS/02_newtonianmechanics_7gravity/fremont/ejss_src_gravity09fast/01authortoddtimberlake_icon.png" />
 lookang (weelookang@gmail.com); Todd TimberLake
      </p>
    </div>
    <hr />
    <p></p>
    <div id="copyright_message">
      <div class="cc_left"  style="float:left">&#169; 2018, Creative Commons Attribution.</div>
      <div class="cc_right" style="float:right">    Released under a <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US"> <img alt="Creative Commons Attribution-NonCommercial-ShareAlike" src="file:///Users/lookang/Google Drive/PublicLawrence/EjsS_5.2_161123epub/bin/javascript/lib/images/cc_icon.png" /> </a> license.</div>
    </div>
  </div>
    <script type="text/javascript"><!--//--><![CDATA[//><!--
      var _model;
      window.addEventListener('load',
        function () { 
          _model =  new gravity09fast("_topFrame","file:/Users/lookang/Google%20Drive/PublicLawrence/EjsS_5.2_161123epub/bin/javascript/lib/","file:/Users/lookang/Google%20Drive/PublicLawrence/workspace/source/EJSS/02_newtonianmechanics_7gravity/fremont/ejss_src_gravity09fast/");
          if (typeof _isApp !== "undefined" && _isApp) _model.setRunAlways(true);
          TextResizeDetector.TARGET_ELEMENT_ID = '_topFrame';
          TextResizeDetector.USER_INIT_FUNC = function () {
            var iBase = TextResizeDetector.addEventListener(function(e,args) {
              _model._fontResized(args[0].iBase,args[0].iSize,args[0].iDelta);
              },null);
            _model._fontResized(iBase);
          };
          _model.onload();
        }, false);
      var interval = setInterval(function() {
         if(document.readyState === 'complete') {
           window.addEventListener('resize', function () { if (_model._resized) _model._resized(window.innerWidth,window.innerHeight); }, false);
           window.addEventListener('scroll', function () { if (_model._resized) _model._resized(window.innerWidth,window.innerHeight); }, false);
           var startCaptureBut = document.getElementById('startCaptureBut'); 
           var stopCaptureBut = document.getElementById('stopCaptureBut'); 
           var resetCaptureBut = document.getElementById('resetCaptureBut'); 
           var playCaptureBut = document.getElementById('playCaptureBut'); 
           var stepCaptureBut = document.getElementById('stepCaptureBut'); 
           if (startCaptureBut) {
             startCaptureBut.onclick = function() {
               _model.startCapture();
             };
             stopCaptureBut.onclick = function() {
               _model.saveText('recording','rec',JSON.stringify(_model.stopCapture()));
             };
             resetCaptureBut.onclick = function() {
               _model.resetCapture();
             };
             playCaptureBut.onclick = function() {
               _model.readText(null,'.rec',function(content){
               _model.playCapture(JSON.parse(content),function(){startCaptureBut.disabled=false; playCaptureBut.disabled=false; stepCaptureBut.disabled=false; window.alert(end_reproduction_message);});               });
             };
             stepCaptureBut.onchange= function() {
               var stepCapt;
               if (stepCaptureBut.value >= 0) stepCapt =  stepCaptureBut.value + 1;
               else stepCapt = 1 + 1.8*stepCaptureBut.value/8;
               _model.changeCaptureStep(stepCapt);
             };
           }
           clearInterval(interval);
         };
      }, 200)
    //--><!]]></script>
  </body>
</html>
